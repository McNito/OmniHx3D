var _isMainPageVisible_=!0
!function(e,t){"use strict"
function i(e,t){function i(){}i.prototype=e
var n=new i
for(var r in t)n[r]=t[r]
return t.toString!==Object.prototype.toString&&(n.toString=t.toString),n}function n(e){return e instanceof Array?function(){return c.iter(e)}:"function"==typeof e.iterator?r(e,e.iterator):e.iterator}function r(e,t){if(null==t)return null
null==t.__id__&&(t.__id__=Es++)
var i
return null==e.hx__closures__?e.hx__closures__={}:i=e.hx__closures__[t.__id__],null==i&&(i=function(){return i.method.apply(i.scope,arguments)},i.scope=e,i.method=t,e.hx__closures__[t.__id__]=i),i}t.lime=t.lime||{},t.BABYLON=t.BABYLON||{}
var s={},o=function(){return Me.__string_rec(this,"")},a=function(){}
s.ApplicationMain=a,a.__name__=["ApplicationMain"],a.create=function(){a.app=new p,a.app.create(a.config),a.preloader=new $i,a.preloader.onComplete=a.start,a.preloader.create(a.config)
var e=[],t=[]
if(e.push("assets/img/haxe-logo.png"),t.push("IMAGE"),e.push("assets/img/skybox/Sky_FantasySky_Fire_Cam_px.jpg"),t.push("IMAGE"),e.push("assets/models/Planisferio.mtl"),t.push("TEXT"),e.push("assets/models/Planisferio.obj"),t.push("TEXT"),null!=a.config.assetsPrefix)for(var i=0,n=e.length;n>i;){var r=i++
"FONT"!=t[r]&&(e[r]=a.config.assetsPrefix+e[r])}a.preloader.load(e,t)},a.main=function(){a.config={antialiasing:0,background:16777215,borderless:!1,company:"Krtolica Vujadin",depthBuffer:!0,file:"BabylonHx_Lime",fps:0,fullscreen:!1,hardware:!0,height:0,orientation:"",packageName:"com.babylonhx",resizable:!0,stencilBuffer:!1,title:"BabylonHx_Lime",version:"1.0.0",vsync:!1,width:0}},a.start=function(){a.app.exec()}
var l=function(){}
s["lime.AssetLibrary"]=l,l.__name__=["lime","AssetLibrary"],l.prototype={eventCallback:null,exists:function(){return!1},getAudioBuffer:function(){return null},getBytes:function(){return null},getFont:function(){return null},getImage:function(){return null},getPath:function(){return null},getText:function(e){var t=this.getBytes(e)
return null==t?null:t.readUTFBytes(t.length)},isLocal:function(){return!0},list:function(){return null},load:function(e){e(this)},loadAudioBuffer:function(e,t){t(this.getAudioBuffer(e))},loadBytes:function(e,t){t(this.getBytes(e))},loadFont:function(e,t){t(this.getFont(e))},loadImage:function(e,t){t(this.getImage(e))},loadText:function(e,t){var i=function(e){t(null==e?null:e.readUTFBytes(e.length))}
this.loadBytes(e,i)},__class__:l}
var h=function(){this.type=new Bi,this.path=new Bi,this.className=new Bi,l.call(this)
var e
e="assets/img/haxe-logo.png",this.path.set(e,e),this.type.set(e,"IMAGE"),e="assets/img/skybox/Sky_FantasySky_Fire_Cam_px.jpg",this.path.set(e,e),this.type.set(e,"IMAGE"),e="assets/models/Planisferio.mtl",this.path.set(e,e),this.type.set(e,"TEXT"),e="assets/models/Planisferio.obj",this.path.set(e,e),this.type.set(e,"TEXT")
var t=a.config.assetsPrefix
if(null!=t)for(var i=this.path.keys();i.hasNext();){var n=i.next(),r=t+this.path.get(n)
this.path.set(n,r)}}
s.DefaultAssetLibrary=h,h.__name__=["DefaultAssetLibrary"],h.__super__=l,h.prototype=i(l.prototype,{className:null,path:null,type:null,lastModified:null,timer:null,exists:function(e,t){var i
i=null!=t?Me.__cast(t,String):null
var n=this.type.get(e)
if(null!=n){if(n==i||("SOUND"==i||"MUSIC"==i)&&("MUSIC"==n||"SOUND"==n))return!0
if("BINARY"==i||null==i||"BINARY"==n&&"TEXT"==i)return!0}return!1},getAudioBuffer:function(){return null},getBytes:function(e){var t,i=null
return t=function(t){var i,n=t.path.get(e)
return i=$i.loaders.get(n)}(this).data,"string"==typeof t?(i=new Jn,i.writeUTFBytes(t)):i=Me.__instanceof(t,Jn)?t:null,null!=i?(i.position=0,i):null},getFont:function(e){return Me.__cast(w.createInstance(this.className.get(e),[]),Yn)},getImage:function(e){return _n.fromImageElement(function(t){var i,n=t.path.get(e)
return i=$i.images.get(n)}(this))},getPath:function(e){return this.path.get(e)},getText:function(e){var t,i=null
return t=function(t){var i,n=t.path.get(e)
return i=$i.loaders.get(n)}(this).data,"string"==typeof t?t:(i=Me.__instanceof(t,Jn)?t:null,null!=i?(i.position=0,i.readUTFBytes(i.length)):null)},isLocal:function(e,t){var i
return i=null!=t?Me.__cast(t,String):null,!0},list:function(e){var t
t=null!=e?Me.__cast(e,String):null
for(var i=[],n=this.type.keys();n.hasNext();){var r=n.next();(null==t||this.exists(r,e))&&i.push(r)}return i},loadAudioBuffer:function(e,t){t(this.getAudioBuffer(e))},loadBytes:function(e,t){t(this.getBytes(e))},loadImage:function(e,t){t(this.getImage(e))},loadText:function(e,t){var i=function(e){t(null==e?null:e.readUTFBytes(e.length))}
this.loadBytes(e,i)},__class__:h})
var u=function(e,t){t=t.split("u").join(""),this.r=RegExp(e,t)}
s.EReg=u,u.__name__=["EReg"],u.prototype={r:null,match:function(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m},__class__:u}
var c=function(){}
s.HxOverrides=c,c.__name__=["HxOverrides"],c.cca=function(e,t){var i=e.charCodeAt(t)
return i!=i?void 0:i},c.substr=function(e,t,i){return null!=t&&0!=t&&null!=i&&0>i?"":(null==i&&(i=e.length),0>t?(t=e.length+t,0>t&&(t=0)):0>i&&(i=e.length+i-t),e.substr(t,i))},c.indexOf=function(e,t,i){var n=e.length
for(0>i&&(i+=n,0>i&&(i=0));n>i;){if(e[i]===t)return i
i++}return-1},c.remove=function(e,t){var i=c.indexOf(e,t,0)
return-1==i?!1:(e.splice(i,1),!0)},c.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}}
var f=function(){}
s.Lambda=f,f.__name__=["Lambda"],f.count=function(e,t){var i=0
if(null==t)for(var r=n(e)();r.hasNext();){r.next()
i++}else for(var s=n(e)();s.hasNext();){var o=s.next()
t(o)&&i++}return i}
var d=function(){}
s["lime.app.IModule"]=d,d.__name__=["lime","app","IModule"],d.prototype={init:null,onGamepadAxisMove:null,onGamepadButtonDown:null,onGamepadButtonUp:null,onGamepadConnect:null,onGamepadDisconnect:null,onKeyDown:null,onKeyUp:null,onMouseDown:null,onMouseMove:null,onMouseMoveRelative:null,onMouseUp:null,onMouseWheel:null,onRenderContextLost:null,onRenderContextRestored:null,onTextEdit:null,onTextInput:null,onTouchEnd:null,onTouchMove:null,onTouchStart:null,onWindowActivate:null,onWindowClose:null,onWindowDeactivate:null,onWindowEnter:null,onWindowFocusIn:null,onWindowFocusOut:null,onWindowFullscreen:null,onWindowLeave:null,onWindowMove:null,onWindowMinimize:null,onWindowResize:null,onWindowRestore:null,render:null,update:null,__class__:d}
var m=function(){}
s["lime.app.Module"]=m,m.__name__=["lime","app","Module"],m.__interfaces__=[d],m.prototype={init:function(){},onGamepadAxisMove:function(){},onGamepadButtonDown:function(){},onGamepadButtonUp:function(){},onGamepadConnect:function(){},onGamepadDisconnect:function(){},onKeyDown:function(){},onKeyUp:function(){},onMouseDown:function(){},onMouseMove:function(){},onMouseMoveRelative:function(){},onMouseUp:function(){},onMouseWheel:function(){},onRenderContextLost:function(){},onRenderContextRestored:function(){},onTextEdit:function(){},onTextInput:function(){},onTouchEnd:function(){},onTouchMove:function(){},onTouchStart:function(){},onWindowActivate:function(){},onWindowClose:function(){},onWindowDeactivate:function(){},onWindowEnter:function(){},onWindowFocusIn:function(){},onWindowFocusOut:function(){},onWindowFullscreen:function(){},onWindowLeave:function(){},onWindowMinimize:function(){},onWindowMove:function(){},onWindowResize:function(){},onWindowRestore:function(){},render:function(){},update:function(){},__class__:m}
var _=function(){this.onUpdate=new Ji,m.call(this),null==_.current&&(_.current=this),this.modules=[],this.renderers=[],this.windows=[],this.backend=new Zi(this),this.onUpdate.add(r(this,this.update))}
s["lime.app.Application"]=_,_.__name__=["lime","app","Application"],_.__super__=m,_.prototype=i(m.prototype,{config:null,modules:null,onUpdate:null,renderer:null,renderers:null,window:null,windows:null,backend:null,initialized:null,addModule:function(e){this.modules.push(e),this.initialized&&null!=this.renderers[0]&&e.init(this.renderers[0].context)},addRenderer:function(e){e.onRender.add(r(this,this.render)),e.onRenderContextLost.add(r(this,this.onRenderContextLost)),e.onRenderContextRestored.add(r(this,this.onRenderContextRestored)),this.renderers.push(e)},addWindow:function(e){this.windows.push(e),e.onGamepadAxisMove.add(r(this,this.onGamepadAxisMove)),e.onGamepadButtonDown.add(r(this,this.onGamepadButtonDown)),e.onGamepadButtonUp.add(r(this,this.onGamepadButtonUp)),e.onGamepadConnect.add(r(this,this.onGamepadConnect)),e.onGamepadDisconnect.add(r(this,this.onGamepadDisconnect)),e.onKeyDown.add(r(this,this.onKeyDown)),e.onKeyUp.add(r(this,this.onKeyUp)),e.onMouseDown.add(r(this,this.onMouseDown)),e.onMouseMove.add(r(this,this.onMouseMove)),e.onMouseMoveRelative.add(r(this,this.onMouseMoveRelative)),e.onMouseUp.add(r(this,this.onMouseUp)),e.onMouseWheel.add(r(this,this.onMouseWheel)),e.onTextEdit.add(r(this,this.onTextEdit)),e.onTextInput.add(r(this,this.onTextInput)),e.onTouchStart.add(r(this,this.onTouchStart)),e.onTouchMove.add(r(this,this.onTouchMove)),e.onTouchEnd.add(r(this,this.onTouchEnd)),e.onWindowActivate.add(r(this,this.onWindowActivate)),e.onWindowClose.add(r(this,this.onWindowClose)),e.onWindowDeactivate.add(r(this,this.onWindowDeactivate)),e.onWindowEnter.add(r(this,this.onWindowEnter)),e.onWindowFocusIn.add(r(this,this.onWindowFocusIn)),e.onWindowFocusOut.add(r(this,this.onWindowFocusOut)),e.onWindowFullscreen.add(r(this,this.onWindowFullscreen)),e.onWindowLeave.add(r(this,this.onWindowLeave)),e.onWindowMinimize.add(r(this,this.onWindowMinimize)),e.onWindowMove.add(r(this,this.onWindowMove)),e.onWindowResize.add(r(this,this.onWindowResize)),e.onWindowRestore.add(r(this,this.onWindowRestore)),e.create(this)},create:function(e){this.backend.create(e)},exec:function(){return _.current=this,this.backend.exec()},init:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.init(e)}this.initialized=!0},onGamepadAxisMove:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onGamepadAxisMove(e,t,i)}},onGamepadButtonDown:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onGamepadButtonDown(e,t)}},onGamepadButtonUp:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onGamepadButtonUp(e,t)}},onGamepadConnect:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.onGamepadConnect(e)}},onGamepadDisconnect:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.onGamepadDisconnect(e)}},onKeyDown:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onKeyDown(e,t)}},onKeyUp:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onKeyUp(e,t)}},onMouseDown:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onMouseDown(e,t,i)}},onMouseMove:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onMouseMove(e,t)}},onMouseMoveRelative:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onMouseMoveRelative(e,t)}},onMouseUp:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onMouseUp(e,t,i)}},onMouseWheel:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onMouseWheel(e,t)}},onRenderContextLost:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onRenderContextLost()}},onRenderContextRestored:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.onRenderContextRestored(e)}},onTextEdit:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onTextEdit(e,t,i)}},onTextInput:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.onTextInput(e)}},onTouchEnd:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onTouchEnd(e,t,i)}},onTouchMove:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onTouchMove(e,t,i)}},onTouchStart:function(e,t,i){for(var n=0,r=this.modules;n<r.length;){var s=r[n];++n,s.onTouchStart(e,t,i)}},onWindowActivate:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowActivate()}},onWindowClose:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowClose()}},onWindowDeactivate:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowDeactivate()}},onWindowEnter:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowEnter()}},onWindowFocusIn:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowFocusIn()}},onWindowFocusOut:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowFocusOut()}},onWindowFullscreen:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowFullscreen()}},onWindowLeave:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowLeave()}},onWindowMinimize:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowMinimize()}},onWindowMove:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onWindowMove(e,t)}},onWindowResize:function(e,t){for(var i=0,n=this.modules;i<n.length;){var r=n[i];++i,r.onWindowResize(e,t)}},onWindowRestore:function(){for(var e=0,t=this.modules;e<t.length;){var i=t[e];++e,i.onWindowRestore()}},removeModule:function(e){c.remove(this.modules,e)},removeRenderer:function(e){null!=e&&c.indexOf(this.renderers,e,0)>-1&&c.remove(this.renderers,e)},removeWindow:function(e){null!=e&&c.indexOf(this.windows,e,0)>-1&&(e.close(),c.remove(this.windows,e))},render:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.render(e)}},update:function(e){for(var t=0,i=this.modules;t<i.length;){var n=i[t];++t,n.update(e)}},get_frameRate:function(){return this.backend.getFrameRate()},set_frameRate:function(e){return this.backend.setFrameRate(e)},get_renderer:function(){return this.renderers[0]},get_window:function(){return this.windows[0]},__class__:_,__properties__:{get_window:"get_window",get_renderer:"get_renderer",set_frameRate:"set_frameRate",get_frameRate:"get_frameRate"}})
var p=function(){_.call(this)}
s.MainLime=p,p.__name__=["MainLime"],p.__super__=_,p.prototype=i(_.prototype,{scene:null,engine:null,init:function(){this.engine=new M(this.windows[0],!1),this.scene=new P(this.engine),new Is(this.scene),this.engine.width=this.windows[0].__width,this.engine.height=this.windows[0].__height},onMouseDown:function(e,t,i){for(var n=0,r=M.mouseDown;n<r.length;){var s=r[n];++n,s(e,t,i)}},onMouseUp:function(){for(var e=0,t=M.mouseUp;e<t.length;){var i=t[e];++e,i()}},onMouseMove:function(e,t){for(var i=0,n=M.mouseMove;i<n.length;){var r=n[i];++i,r(e,t)}},onMouseWheel:function(e,t){for(var i=0,n=M.mouseWheel;i<n.length;){var r=n[i];++i,r(t/2)}},onTouchStart:function(e,t,i){for(var n=0,r=M.touchDown;n<r.length;){var s=r[n];++n,s(e,t,i)}},onTouchEnd:function(e,t,i){for(var n=0,r=M.touchUp;n<r.length;){var s=r[n];++n,s(e,t,i)}},onTouchMove:function(e,t,i){for(var n=0,r=M.touchMove;n<r.length;){var s=r[n];++n,s(e,t,i)}},onKeyUp:function(e){for(var t=0,i=M.keyUp;t<i.length;){var n=i[t];++t,n(e)}},onKeyDown:function(e){for(var t=0,i=M.keyDown;t<i.length;){var n=i[t];++t,n(e)}},onWindowResize:function(){this.engine.width=this.windows[0].__width,this.engine.height=this.windows[0].__height},update:function(){null!=this.engine&&_isMainPageVisible_&&this.engine._renderLoop()},__class__:p}),Math.__name__=["Math"]
var v=function(){}
s.Reflect=v,v.__name__=["Reflect"],v.hasField=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},v.field=function(e,t){try{return e[t]}catch(i){return i instanceof Wi&&(i=i.val),null}},v.setField=function(e,t,i){e[t]=i},v.getProperty=function(e,t){var i
return null==e?null:e.__properties__&&(i=e.__properties__["get_"+t])?e[i]():e[t]},v.setProperty=function(e,t,i){var n
e.__properties__&&(n=e.__properties__["set_"+t])?e[n](i):e[t]=i},v.callMethod=function(e,t,i){return t.apply(e,i)},v.fields=function(e){var t=[]
if(null!=e){var i=Object.prototype.hasOwnProperty
for(var n in e)"__id__"!=n&&"hx__closures__"!=n&&i.call(e,n)&&t.push(n)}return t},v.isFunction=function(e){return"function"==typeof e&&!(e.__name__||e.__ename__)},v.isObject=function(e){if(null==e)return!1
var t=typeof e
return"string"==t||"object"==t&&null==e.__enum__||"function"==t&&null!=(e.__name__||e.__ename__)},v.deleteField=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)?(delete e[t],!0):!1},v.makeVarArgs=function(e){return function(){var t=Array.prototype.slice.call(arguments)
return e(t)}}
var g=function(){}
s.Std=g,g.__name__=["Std"],g.string=function(e){return Me.__string_rec(e,"")},g["int"]=function(e){return 0|e},g.parseInt=function(e){var t=parseInt(e,10)
return 0!=t||120!=c.cca(e,1)&&88!=c.cca(e,1)||(t=parseInt(e)),isNaN(t)?null:t}
var x=function(){this.b=""}
s.StringBuf=x,x.__name__=["StringBuf"],x.prototype={b:null,add:function(e){this.b+=g.string(e)},__class__:x}
var y=function(){}
s.StringTools=y,y.__name__=["StringTools"],y.urlEncode=function(e){return encodeURIComponent(e)},y.urlDecode=function(e){return decodeURIComponent(e.split("+").join(" "))},y.startsWith=function(e,t){return e.length>=t.length&&c.substr(e,0,t.length)==t},y.isSpace=function(e,t){var i=c.cca(e,t)
return i>8&&14>i||32==i},y.ltrim=function(e){for(var t=e.length,i=0;t>i&&y.isSpace(e,i);)i++
return i>0?c.substr(e,i,t-i):e},y.rtrim=function(e){for(var t=e.length,i=0;t>i&&y.isSpace(e,t-i-1);)i++
return i>0?c.substr(e,0,t-i):e},y.trim=function(e){return y.ltrim(y.rtrim(e))},y.replace=function(e,t,i){return e.split(t).join(i)},y.fastCodeAt=function(e,t){return e.charCodeAt(t)}
var b=s.ValueType={__ename__:!0,__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]}
b.TNull=["TNull",0],b.TNull.toString=o,b.TNull.__enum__=b,b.TInt=["TInt",1],b.TInt.toString=o,b.TInt.__enum__=b,b.TFloat=["TFloat",2],b.TFloat.toString=o,b.TFloat.__enum__=b,b.TBool=["TBool",3],b.TBool.toString=o,b.TBool.__enum__=b,b.TObject=["TObject",4],b.TObject.toString=o,b.TObject.__enum__=b,b.TFunction=["TFunction",5],b.TFunction.toString=o,b.TFunction.__enum__=b,b.TClass=function(e){var t=["TClass",6,e]
return t.__enum__=b,t.toString=o,t},b.TEnum=function(e){var t=["TEnum",7,e]
return t.__enum__=b,t.toString=o,t},b.TUnknown=["TUnknown",8],b.TUnknown.toString=o,b.TUnknown.__enum__=b
var w=function(){}
s.Type=w,w.__name__=["Type"],w.getClassName=function(e){var t=e.__name__
return null==t?null:t.join(".")},w.resolveClass=function(e){var t=s[e]
return null!=t&&t.__name__?t:null},w.resolveEnum=function(e){var t=s[e]
return null!=t&&t.__ename__?t:null},w.createInstance=function(e,t){var i=t.length
switch(i){case 0:return new e
case 1:return new e(t[0])
case 2:return new e(t[0],t[1])
case 3:return new e(t[0],t[1],t[2])
case 4:return new e(t[0],t[1],t[2],t[3])
case 5:return new e(t[0],t[1],t[2],t[3],t[4])
case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5])
case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])
case 8:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7])
default:throw new Wi("Too many arguments")}return null},w.createEmptyInstance=function(e){function t(){}return t.prototype=e.prototype,new t},w.getInstanceFields=function(e){var t=[]
for(var i in e.prototype)t.push(i)
return c.remove(t,"__class__"),c.remove(t,"__properties__"),t},w["typeof"]=function(e){var t=typeof e
switch(t){case"boolean":return b.TBool
case"string":return b.TClass(String)
case"number":return Math.ceil(e)==e%2147483648?b.TInt:b.TFloat
case"object":if(null==e)return b.TNull
var i=e.__enum__
if(null!=i)return b.TEnum(i)
var n=Me.getClass(e)
return null!=n?b.TClass(n):b.TObject
case"function":return e.__name__||e.__ename__?b.TObject:b.TFunction
case"undefined":return b.TNull
default:return b.TUnknown}}
var S={}
s["_UInt.UInt_Impl_"]=S,S.__name__=["_UInt","UInt_Impl_"],S.gt=function(e,t){var i=0>e,n=0>t
return i!=n?i:e>t}
var M=t.BABYLON.Engine=function(e,t,i){null==t&&(t=!1),this._uintIndicesCurrentlySet=!1,this._canvasClientRect={x:0,y:0,width:800,height:600},this._compiledEffects=new Bi,this._activeTexturesCache=[],this._loadedTexturesCache=[],this._alphaMode=0,this._alphaState=new E,this._depthCullingState=new D,this.deltaTime=0,this.fps=60,this.previousFramesDuration=[],this.fpsRange=60,this._activeRenderLoops=[],this._renderingQueueLaunched=!1,this._drawCalls=0,this._runningLoop=!1,this._windowIsBackground=!1,this.scenes=[],this.renderEvenInBackground=!0,this.cullBackFaces=!0,this.isPointerLock=!1,this.isFullscreen=!1
var n=this
M.app=e,this._renderingCanvas=e,this._canvasClientRect.width=800,this._canvasClientRect.height=600,this.width=800,this.height=600,i=null!=i?i:{},i.antialias=t,null==i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),this._onBlur=function(){n._windowIsBackground=!0},this._onFocus=function(){n._windowIsBackground=!1},this._hardwareScalingLevel=1,this.resize(),this._caps=new T,this._caps.maxTexturesImageUnits=En.context.getParameter(34930),this._caps.maxTextureSize=En.context.getParameter(3379),this._caps.maxCubemapTextureSize=En.context.getParameter(34076),this._caps.maxRenderTextureSize=En.context.getParameter(34024),this._glVersion=En.context.getParameter(7938),this._glExtensions=En.context.getSupportedExtensions(),Ei.trace(this._glExtensions,{fileName:"Engine.hx",lineNumber:196,className:"com.babylonhx.Engine",methodName:"new"})
try{if(this._caps.standardDerivatives=null!=En.context.getExtension("OES_standard_derivatives"),this._caps.s3tc=En.context.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!=En.context.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=En.context.getExtension("EXT_texture_filter_anisotropic")||En.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||En.context.getExtension("MOZ_EXT_texture_filter_anisotropic"),null!=this._caps.textureAnisotropicFilterExtension?this._caps.maxAnisotropy=En.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):this._caps.maxAnisotropy=0,this._caps.instancedArrays=En.context.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!=En.context.getExtension("OES_element_index_uint"),this._caps.highPrecisionShaderSupported=!0,null!=En.getShaderPrecisionFormat){var r=En.context.getShaderPrecisionFormat(35632,36338)
this._caps.highPrecisionShaderSupported=null!=r&&0!=r.precision}}catch(s){s instanceof Wi&&(s=s.val)}this._depthCullingState.set_depthTest(!0),this._depthCullingState.set_depthFunc(515),this._depthCullingState.set_depthMask(!0),this.isFullscreen=!1,this.isPointerLock=!1}
s["com.babylonhx.Engine"]=M,M.__name__=["com","babylonhx","Engine"],M.compileShader=function(e,t,i){var n=En.context.createShader("vertex"==t?35633:35632)
if(En.context.shaderSource(n,(null!=i?i+"\n":"")+e),En.context.compileShader(n),0==En.context.getShaderParameter(n,35713))throw new Wi(En.context.getShaderInfoLog(n))
return n},M.getWebGLTextureType=function(e){var t
return t=1==e?5126:5121},M.getSamplingParameters=function(e,t){var i=9728,n=9728
return 2==e?(i=9729,n=t?9985:9729):3==e?(i=9729,n=t?9987:9729):1==e&&(i=9728,n=t?9986:9728),{min:n,mag:i}},M.prepareTexture=function(e,t,i,n,r,s,o,a,l,h){null==h&&(h=3)
var u=i._engine,c=Oe.GetExponantOfTwo(n,u.getCaps().maxTextureSize),f=Oe.GetExponantOfTwo(r,u.getCaps().maxTextureSize);(c!=n||f!=r)&&Ei.trace("Texture '"+e.url+"' is not power of two !",{fileName:"Engine.hx",lineNumber:1679,className:"com.babylonhx.Engine",methodName:"prepareTexture"}),En.context.bindTexture(3553,e.data),En.context.pixelStorei(37440,null==s?1:s?1:0),e._baseWidth=n,e._baseHeight=r,e._width=c,e._height=f,e.isReady=!0,l(0|c,0|f)
var d=M.getSamplingParameters(h,!o)
En.context.texParameteri(3553,10240,d.mag),En.context.texParameteri(3553,10241,d.min),o||a||En.context.generateMipmap(3553),En.context.bindTexture(3553,null),u._activeTexturesCache=[],i._removePendingData(e)},M.partialLoad=function(){},M.cascadeLoad=function(){},M.prototype={isFullscreen:null,isPointerLock:null,cullBackFaces:null,renderEvenInBackground:null,scenes:null,_renderingCanvas:null,_windowIsBackground:null,_onBlur:null,_onFocus:null,_onFullscreenChange:null,_onPointerLockChange:null,_hardwareScalingLevel:null,_caps:null,_pointerLockRequested:null,_alphaTest:null,_runningLoop:null,_renderFunction:null,_drawCalls:null,get_drawCalls:function(){return this._drawCalls},_glVersion:null,_glExtensions:null,_glRenderer:null,_glVendor:null,_renderingQueueLaunched:null,_activeRenderLoops:null,fpsRange:null,previousFramesDuration:null,fps:null,deltaTime:null,_depthCullingState:null,_alphaState:null,_alphaMode:null,_loadedTexturesCache:null,_activeTexturesCache:null,_currentEffect:null,_compiledEffects:null,_vertexAttribArrays:null,_cachedViewport:null,_cachedVertexBuffers:null,_cachedIndexBuffer:null,_cachedEffectForVertexBuffers:null,_currentRenderTarget:null,_canvasClientRect:null,_uintIndicesCurrentlySet:null,_workingCanvas:null,width:null,height:null,getExtensions:function(){return this._glExtensions},getAspectRatio:function(e){var t=e.viewport
return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},getRenderWidth:function(){return this.width},getRenderHeight:function(){return this.height},getRenderingCanvas:function(){return this._renderingCanvas},setHardwareScalingLevel:function(e){this._hardwareScalingLevel=e,this.resize()},getHardwareScalingLevel:function(){return this._hardwareScalingLevel},getLoadedTexturesCache:function(){return this._loadedTexturesCache},getCaps:function(){return this._caps},resetDrawCalls:function(){this._drawCalls=0},setDepthFunctionToGreater:function(){this._depthCullingState.set_depthFunc(516)},setDepthFunctionToGreaterOrEqual:function(){this._depthCullingState.set_depthFunc(518)},setDepthFunctionToLess:function(){this._depthCullingState.set_depthFunc(513)},setDepthFunctionToLessOrEqual:function(){this._depthCullingState.set_depthFunc(515)},stopRenderLoop:function(){this._renderFunction=null,this._runningLoop=!1},_renderLoop:function(){this._measureFps(),null!=this._renderFunction&&this._renderFunction()},runRenderLoop:function(e){this._runningLoop=!0,this._renderFunction=e},switchFullscreen:function(){},clear:function(e,t,i){this._depthCullingState.apply(),this._alphaState.apply(),Me.__instanceof(e,tt)?En.clearColor(e.r,e.g,e.b,e.a):En.clearColor(e.r,e.g,e.b,1),this._depthCullingState.get_depthMask()&&En.context.clearDepth(1)
var n=0
t&&(n|=16384),i&&this._depthCullingState.get_depthMask()&&(n|=256),En.context.clear(n)},setViewport:function(e,t,i){null==i&&(i=0),null==t&&(t=0)
var n
n=0==t?this.getRenderWidth():t
var r
r=0==i?this.getRenderHeight():i
var s=e.x,o=e.y
this._cachedViewport=e,En.context.viewport(s*n|0,o*r|0,n*e.width|0,r*e.height|0)},setDirectViewport:function(e,t,i,n){this._cachedViewport=null,En.context.viewport(e,t,i,n)},beginFrame:function(){this._measureFps()},endFrame:function(){},getFps:function(){return this.fps},getDeltaTime:function(){return this.deltaTime},_measureFps:function(){this.previousFramesDuration.push(g["int"](1e3*(Be.stamp()-Oe.__startTime)))
var e=this.previousFramesDuration.length
if(e>=2&&(this.deltaTime=this.previousFramesDuration[e-1]-this.previousFramesDuration[e-2]),e>=this.fpsRange){e>this.fpsRange&&(this.previousFramesDuration.splice(0,1),e=this.previousFramesDuration.length)
for(var t=0,i=0,n=e-1;n>i;){var r=i++
t+=this.previousFramesDuration[r+1]-this.previousFramesDuration[r]}this.fps=1e3/(t/(e-1))}},resize:function(){},setSize:function(){},bindFramebuffer:function(e){this._currentRenderTarget=e,En.context.bindFramebuffer(36160,e._framebuffer),En.context.viewport(0,0,0|e._width,0|e._height),this.wipeCaches()},unBindFramebuffer:function(e){this._currentRenderTarget=null,e.generateMipMaps&&(En.context.bindTexture(3553,e.data),En.context.generateMipmap(3553),En.context.bindTexture(3553,null)),En.context.bindFramebuffer(36160,null)},flushFramebuffer:function(){},restoreDefaultFramebuffer:function(){En.context.bindFramebuffer(36160,null),this.setViewport(this._cachedViewport,null,null),this.wipeCaches()},_resetVertexBufferBinding:function(){En.context.bindBuffer(34962,null),this._cachedVertexBuffers=null},createVertexBuffer:function(e){var t=En.context.createBuffer()
En.context.bindBuffer(34962,t),En.bufferData(34962,new Float32Array(e),35044),En.context.bindBuffer(34962,null),this._cachedVertexBuffers=null
var i=new Bt(t)
return i.references=1,i},createDynamicVertexBuffer:function(e){var t=En.context.createBuffer()
En.context.bindBuffer(34962,t),En.bufferData(34962,new Float32Array(e),35048),En.context.bindBuffer(34962,null),this._cachedVertexBuffers=null
var i=new Bt(t)
return i.references=1,i},updateDynamicVertexBuffer:function(e,t,i){null==i&&(i=0),En.context.bindBuffer(34962,e.buffer),t instanceof Array&&null==t.__enum__?En.bufferSubData(34962,i,new Float32Array(t)):En.bufferSubData(34962,i,t),En.context.bindBuffer(34962,null),this._cachedVertexBuffers=null},_resetIndexBufferBinding:function(){En.context.bindBuffer(34963,null),this._cachedIndexBuffer=null},createIndexBuffer:function(e){var t=En.context.createBuffer()
En.context.bindBuffer(34963,t)
var i=null,n=!1
if(this._caps.uintIndices){for(var r=0,s=e.length;s>r;){var o=r++
if(e[o]>65535){n=!0
break}}i=n?new Int32Array(e):new Int16Array(e)}else i=new Int16Array(e)
En.context.bufferData(34963,i,35044),En.context.bindBuffer(34963,null),this._cachedIndexBuffer=null
var a=new Bt(t)
return a.references=1,a.is32Bits=n,a},bindBuffers:function(e,t,i,n,r){if(this._cachedVertexBuffers!=e||this._cachedEffectForVertexBuffers!=r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,En.context.bindBuffer(34962,e.buffer)
for(var s=0,o=0,a=i.length;a>o;){var l=o++,h=r._attributes[l]
h>=0&&En.context.vertexAttribPointer(h,i[l],5126,!1,n,s),s+=4*i[l]}}this._cachedIndexBuffer!=t&&(this._cachedIndexBuffer=t,En.context.bindBuffer(34963,t.buffer),this._uintIndicesCurrentlySet=t.is32Bits)},bindMultiBuffers:function(e,t,i){if(this._cachedVertexBuffers!=e||this._cachedEffectForVertexBuffers!=i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i
for(var n=i._attributesNames,r=0,s=n.length;s>r;){var o=r++,a=i._attributes[o]
if(a>=0){var l=e.get(n[o])
if(null==l)continue
var h=l._strideSize
En.context.bindBuffer(34962,l._buffer.buffer),En.context.vertexAttribPointer(a,h,5126,!1,4*h,0)}}}null!=t&&this._cachedIndexBuffer!=t&&(this._cachedIndexBuffer=t,En.context.bindBuffer(34963,t.buffer),this._uintIndicesCurrentlySet=t.is32Bits)},_releaseBuffer:function(e){return e.references--,0==e.references?(En.context.deleteBuffer(e.buffer),!0):!1},createInstancesBuffer:function(e){var t=new Bt(En.context.createBuffer())
return t.capacity=e,En.context.bindBuffer(34962,t.buffer),En.bufferData(34962,new Float32Array(e),35048),t},deleteInstancesBuffer:function(e){En.context.deleteBuffer(e.buffer),e=null},updateAndBindInstancesBuffer:function(e,t,i){En.context.bindBuffer(34962,e.buffer),En.context.bufferSubData(34962,0,t)
for(var n=0;4>n;){var r=n++,s=i[r]
En.context.enableVertexAttribArray(s),En.context.vertexAttribPointer(s,4,5126,!1,64,16*r),this._caps.instancedArrays.vertexAttribDivisorANGLE(s,1)}},unBindInstancesBuffer:function(e,t){En.context.bindBuffer(34962,e.buffer)
for(var i=0;4>i;){var n=i++,r=t[n]
En.context.disableVertexAttribArray(r),this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}},applyStates:function(){this._depthCullingState.apply(),this._alphaState.apply()},draw:function(e,t,i,n){this._depthCullingState.apply(),this._alphaState.apply()
var r
r=this._uintIndicesCurrentlySet?5125:5123
var s
return s=this._uintIndicesCurrentlySet?4:2,null!=n?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?4:1,i,r,t*s,n):(En.context.drawElements(e?4:1,i,r,t*s),void this._drawCalls++)},drawPointClouds:function(e,t,i){return null==i&&(i=-1),this._depthCullingState.apply(),this._alphaState.apply(),i>-1?void this._caps.instancedArrays.drawArraysInstancedANGLE(0,e,t,i):(En.context.drawArrays(0,e,t),void this._drawCalls++)},_releaseEffect:function(e){this._compiledEffects.exists(e._key)&&(this._compiledEffects.remove(e._key),null!=e._program&&En.context.deleteProgram(e._program))},createEffect:function(e,t,i,n,r,s,o,a){var l
l=null!=e.vertexElement?e.vertexElement:null!=e.vertex?e.vertex:e
var h
h=null!=e.fragmentElement?e.fragmentElement:null!=e.fragment?e.fragment:e
var u=l+"+"+h+"@"+r
if(this._compiledEffects.exists(u))return this._compiledEffects.get(u)
var c=new pt(e,t,i,n,this,r,s,o,a)
return c._key=u,this._compiledEffects.set(u,c),c},createEffectForParticles:function(e,t,i,n,r,s,o){return null==n&&(n=""),null==t&&(t=[]),null==i&&(i=[]),this.createEffect({vertex:"particles",fragment:e},["position","color","options"],["view","projection"].concat(t),["diffuseSampler"].concat(i),n,r,s,o)},createShaderProgram:function(e,t,i){var n=M.compileShader(e,"vertex",i),r=M.compileShader(t,"fragment",i),s=En.context.createProgram()
En.context.attachShader(s,n),En.context.attachShader(s,r),En.context.linkProgram(s)
var o=En.context.getProgramParameter(s,35714)
if(0==o){var a=En.context.getProgramInfoLog(s)
if(""!=a)throw new Wi(a)}return En.context.deleteShader(n),En.context.deleteShader(r),s},getUniforms:function(e,t){for(var i=[],n=0,r=t.length;r>n;){var s=n++
i.push(En.context.getUniformLocation(e,t[s]))}return i},getAttributes:function(e,t){for(var i=[],n=0,r=t.length;r>n;){var s=n++
try{i.push(En.context.getAttribLocation(e,t[s]))}catch(o){o instanceof Wi&&(o=o.val),Ei.trace("getAttributes() -> ERROR: "+g.string(o),{fileName:"Engine.hx",lineNumber:800,className:"com.babylonhx.Engine",methodName:"getAttributes"}),i.push(-1)}}return i},enableEffect:function(e){if(null==e||0==e._attributes.length||this._currentEffect==e)return void(null!=e&&null!=e.onBind&&e.onBind(e))
null!=this._vertexAttribArrays?this._vertexAttribArrays=this._vertexAttribArrays:this._vertexAttribArrays=[],En.context.useProgram(e._program)
for(var t=0,i=this._vertexAttribArrays.length;i>t;){var n=t++
n>34338||!this._vertexAttribArrays[n]||(this._vertexAttribArrays[n]=!1,En.context.disableVertexAttribArray(n))}for(var r=e._attributes.length,s=0;r>s;){var o=s++,a=e._attributes[o]
a>=0&&(this._vertexAttribArrays[a]=!0,En.context.enableVertexAttribArray(a))}this._currentEffect=e,null!=e.onBind&&e.onBind(e)},setArray:function(e,t){En.uniform1fv(e,new Float32Array(t))},setArray2:function(e,t){t.length%2==0&&En.uniform2fv(e,new Float32Array(t))},setArray3:function(e,t){t.length%3==0&&En.uniform3fv(e,new Float32Array(t))},setArray4:function(e,t){t.length%4==0&&En.uniform4fv(e,new Float32Array(t))},setMatrices:function(e,t){En.context.uniformMatrix4fv(e,!1,t)},setMatrix:function(e,t){En.uniformMatrix4fv(e,!1,t.toArray())},setFloat:function(e,t){En.context.uniform1f(e,t)},setFloat2:function(e,t,i){En.context.uniform2f(e,t,i)},setFloat3:function(e,t,i,n){En.context.uniform3f(e,t,i,n)},setBool:function(e,t){En.context.uniform1i(e,t?1:0)},setFloat4:function(e,t,i,n,r){En.context.uniform4f(e,t,i,n,r)},setColor3:function(e,t){En.context.uniform3f(e,t.r,t.g,t.b)},setColor4:function(e,t,i){En.context.uniform4f(e,t.r,t.g,t.b,i)},setState:function(e,t,i){null==i&&(i=!1),null==t&&(t=0),(this._depthCullingState.get_cull()!=e||i)&&(e?(this._depthCullingState.set_cullFace(this.cullBackFaces?1029:1028),this._depthCullingState.set_cull(!0)):this._depthCullingState.set_cull(!1)),this._depthCullingState.set_zOffset(t)},setDepthBuffer:function(e){this._depthCullingState.set_depthTest(e)},getDepthWrite:function(){return this._depthCullingState.get_depthMask()},setDepthWrite:function(e){this._depthCullingState.set_depthMask(e)},setColorWrite:function(e){En.context.colorMask(e,e,e,e)},setAlphaMode:function(e){switch(e){case 0:this._depthCullingState.set_depthMask(!0),this._alphaState.set_alphaBlend(!1)
break
case 2:this._depthCullingState.set_depthMask(!1),this._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),this._alphaState.set_alphaBlend(!0)
break
case 1:this._depthCullingState.set_depthMask(!1),this._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),this._alphaState.set_alphaBlend(!0)}this._alphaMode=e},getAlphaMode:function(){return this._alphaMode},setAlphaTesting:function(e){this._alphaTest=e},getAlphaTesting:function(){return this._alphaTest},wipeCaches:function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},setSamplingMode:function(e,t){En.context.bindTexture(3553,e)
var i=9728,n=9728
2==t?(i=9729,n=9729):3==t&&(i=9729,n=9987),En.context.texParameteri(3553,10240,i),En.context.texParameteri(3553,10241,n),En.context.bindTexture(3553,null)},createTexture:function(e,t,i,n,r,s,o,a){null==r&&(r=3)
var l=new bt(e,En.context.createTexture()),h="",u=null
if("data:"==c.substr(e,0,5)&&(u=!0),null==u)h=c.substr(e,e.length-4,4).toLowerCase()
else{var f=e
u=f.split(":"),e=f,h=u[1].substr(u[1].length-4,4).toLowerCase()}var d=this.getCaps().s3tc&&".dds"==h,m=".tga"==h
n._addPendingData(l),l.url=e,l.noMipmap=t,l.references=1,l.samplingMode=r,this._loadedTexturesCache.push(l)
var _=function(){n._removePendingData(l),null!=o&&o()}
if(m);else if(d);else{var p=function(e){M.prepareTexture(l,En,n,e.width,e.height,i,t,!1,function(t,i){En.context.texImage2D(3553,0,6408,t,i,0,6408,5121,e.data),null!=s&&s()},r)}
u instanceof Array&&null==u.__enum__?Oe.LoadImage(a,p,_,n.database):Oe.LoadImage(e,p,_,n.database)}return l},createRawTexture:function(e,t,i,n,r,s,o){var a=new bt("",En.context.createTexture())
En.context.bindTexture(3553,a.data),En.context.pixelStorei(37440,s?1:0)
var l=6408
switch(n){case 0:l=6406
break
case 1:l=6409
break
case 2:l=6410
break
case 3:l=6407
break
case 4:l=6408}En.context.texImage2D(3553,0,l,t,i,0,l,5121,e),r&&En.context.generateMipmap(3553)
var h=M.getSamplingParameters(o,r)
return En.context.texParameteri(3553,10240,h.mag),En.context.texParameteri(3553,10241,h.min),En.context.bindTexture(3553,null),this._activeTexturesCache=[],a._baseWidth=t,a._baseHeight=i,a._width=t,a._height=i,a.isReady=!0,a.references=1,a.samplingMode=o,this._loadedTexturesCache.push(a),a},createDynamicTexture:function(e,t,i,n){var r=new bt("",En.context.createTexture())
return e=Oe.GetExponantOfTwo(e,this._caps.maxTextureSize),t=Oe.GetExponantOfTwo(t,this._caps.maxTextureSize),this._activeTexturesCache=[],r._baseWidth=e,r._baseHeight=t,r._width=e,r._height=t,r.isReady=!1,r.generateMipMaps=i,r.references=1,r.samplingMode=n,this.updateTextureSamplingMode(n,r),this._loadedTexturesCache.push(r),r},updateDynamicTexture:function(e,t){En.context.bindTexture(3553,e.data),Ei.trace(t.data.length,{fileName:"Engine.hx",lineNumber:1206,className:"com.babylonhx.Engine",methodName:"updateDynamicTexture"}),En.context.texImage2D(3553,0,6408,t.width,t.height,0,6408,5121,t.data),e.generateMipMaps&&En.context.generateMipmap(3553),En.context.bindTexture(3553,null),this._activeTexturesCache=[],e.isReady=!0},updateTextureSamplingMode:function(e,t){var i=M.getSamplingParameters(e,t.generateMipMaps)
En.context.bindTexture(3553,t.data),En.context.texParameteri(3553,10240,i.mag),En.context.texParameteri(3553,10241,i.min),En.context.bindTexture(3553,null)},updateVideoTexture:function(){},createRenderTargetTexture:function(e,t){var i=!1,n=!0,r=0,s=3
null!=t&&(i=null!=t.generateMipMaps?t.generateMipmaps:t,n=null!=t.generateDepthBuffer?t.generateDepthBuffer:!0,r=null==t.type?r:t.type,null!=t.samplingMode&&(s=t.samplingMode),1==r&&(s=1))
var o=new bt("",En.context.createTexture())
En.context.bindTexture(3553,o.data)
var a
a=null!=e.width?e.width:e
var l
l=null!=e.height?e.height:e
var h=M.getSamplingParameters(s,i)
1!=r||this._caps.textureFloat||(r=0,Ei.trace("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type",{fileName:"Engine.hx",lineNumber:1286,className:"com.babylonhx.Engine",methodName:"createRenderTargetTexture"})),En.context.texParameteri(3553,10240,h.mag),En.context.texParameteri(3553,10241,h.min),En.context.texParameteri(3553,10242,33071),En.context.texParameteri(3553,10243,33071),En.texImage2D(3553,0,6408,a,l,0,6408,M.getWebGLTextureType(r),null)
var u=null
n&&(u=En.context.createRenderbuffer(),En.context.bindRenderbuffer(36161,u),En.context.renderbufferStorage(36161,33189,a,l))
var c=En.context.createFramebuffer()
return En.context.bindFramebuffer(36160,c),En.context.framebufferTexture2D(36160,36064,3553,o.data,0),n&&En.context.framebufferRenderbuffer(36160,36096,36161,u),En.context.bindTexture(3553,null),En.context.bindRenderbuffer(36161,null),En.context.bindFramebuffer(36160,null),o._framebuffer=c,n&&(o._depthBuffer=u),o._width=a,o._height=l,o.isReady=!0,o.generateMipMaps=i,o.references=1,o.samplingMode=s,this._activeTexturesCache=[],this._loadedTexturesCache.push(o),o},createCubeTexture:function(e,t,i,n){null==n&&(n=!1)
var r=this,s=new bt(e,En.context.createTexture())
s.isCube=!0,s.url=e,s.references=1,this._loadedTexturesCache.push(s)
var o=c.substr(e,e.length-4,4).toLowerCase(),a=this.getCaps().s3tc&&".dds"==o
if(a);else{var l,h=[34069,34071,34073,34070,34072,34074],u=[],f=function(e,t){r._workingCanvas=e,En.context.texImage2D(h[t],0,6408,r._workingCanvas.width,r._workingCanvas.height,0,6408,5121,e.data)},d=function(){var e=Oe.GetExponantOfTwo(u[0].width,r._caps.maxCubemapTextureSize),t=e
En.context.bindTexture(34067,s.data),En.context.pixelStorei(37440,0)
for(var i=0,o=h.length;o>i;){var a=i++
f(u[a],a)}n||En.context.generateMipmap(34067),En.context.texParameteri(34067,10240,9729),En.context.texParameteri(34067,10241,n?9729:9987),En.context.texParameteri(34067,10242,33071),En.context.texParameteri(34067,10243,33071),En.context.bindTexture(34067,null),r._activeTexturesCache=[],s._width=e,s._height=t,s.isReady=!0},m=0,_=null
_=function(){Oe.LoadImage(e+i[m],function(e){u.push(e),++m==i.length?d():_()})},l=_,l()}return s},_releaseTexture:function(e){null!=e._framebuffer&&En.context.deleteFramebuffer(e._framebuffer),null!=e._depthBuffer&&En.context.deleteRenderbuffer(e._depthBuffer),En.context.deleteTexture(e.data)
for(var t=0,i=this._caps.maxTexturesImageUnits;i>t;){var n=t++
En.context.activeTexture(33984+n),En.context.bindTexture(3553,null),En.context.bindTexture(34067,null),this._activeTexturesCache[n]=null}var r=c.indexOf(this._loadedTexturesCache,e,0);-1!=r&&this._loadedTexturesCache.splice(r,1),e=null},getGLTexture:function(e){return 33984+e},bindSamplers:function(e){En.context.useProgram(e._program)
for(var t=e._samplers,i=0,n=t.length;n>i;){var r=i++,s=e._uniforms[c.indexOf(e._uniformsNames,t[r],0)]
En.context.uniform1i(s,r)}this._currentEffect=null},_bindTexture:function(e,t){En.context.activeTexture(33984+e),En.context.bindTexture(3553,t.data),this._activeTexturesCache[e]=null},setTextureFromPostProcess:function(e,t){t._textures.length>0&&this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},setTexture:function(e,t){if(!(0>e)){if(null==t||!t.isReady())return void(null!=this._activeTexturesCache[e]&&(En.context.activeTexture(33984+e),En.context.bindTexture(3553,null),En.context.bindTexture(34067,null),this._activeTexturesCache[e]=null))
if(Me.__instanceof(t,yt));else if(4==t.delayLoadState)return void t.delayLoad()
if(this._activeTexturesCache[e]!=t){this._activeTexturesCache[e]=t
var i=t.getInternalTexture()
if(En.context.activeTexture(33984+e),i.isCube)En.context.bindTexture(34067,i.data),En.context.texParameteri(34067,10242,33071),En.context.texParameteri(34067,10243,33071),this._setAnisotropicLevel(34067,t)
else{if(En.context.bindTexture(3553,i.data),i._cachedWrapU!=t.wrapU){i._cachedWrapU=t.wrapU
var n=t.wrapU
switch(n){case 1:En.context.texParameteri(3553,10242,10497)
break
case 0:En.context.texParameteri(3553,10242,33071)
break
case 2:En.context.texParameteri(3553,10242,33648)}}if(i._cachedWrapV!=t.wrapV){i._cachedWrapV=t.wrapV
var r=t.wrapV
switch(r){case 1:En.context.texParameteri(3553,10243,10497)
break
case 0:En.context.texParameteri(3553,10243,33071)
break
case 2:En.context.texParameteri(3553,10243,33648)}}this._setAnisotropicLevel(3553,t)}}}},_setAnisotropicLevel:function(e,t){var i=this._caps.textureAnisotropicFilterExtension
null!=i&&t._cachedAnisotropicFilteringLevel!=t.anisotropicFilteringLevel&&(En.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropicFilteringLevel,this._caps.maxAnisotropy)),t._cachedAnisotropicFilteringLevel=t.anisotropicFilteringLevel)},readPixels:function(e,t,i,n){var r=new Us(n*i*4)
return En.context.readPixels(0,0,i,n,6408,5121,r),r},dispose:function(){for(this.stopRenderLoop();this.scenes.length>0;)this.scenes[0].dispose(),this.scenes[0]=null,this.scenes.shift()
for(var e=this._compiledEffects.keys();e.hasNext();){var t=e.next()
En.deleteProgram(this._compiledEffects.get(t)._program)}},__class__:M,__properties__:{get_drawCalls:"get_drawCalls"}}
var T=t.BABYLON.EngineCapabilities=function(){}
s["com.babylonhx.EngineCapabilities"]=T,T.__name__=["com","babylonhx","EngineCapabilities"],T.prototype={maxTexturesImageUnits:null,maxTextureSize:null,maxCubemapTextureSize:null,maxRenderTextureSize:null,standardDerivatives:null,s3tc:null,textureFloat:null,textureAnisotropicFilterExtension:null,highPrecisionShaderSupported:null,maxAnisotropy:null,instancedArrays:null,uintIndices:null,__class__:T}
var C=t.BABYLON.IDisposable=function(){}
s["com.babylonhx.IDisposable"]=C,C.__name__=["com","babylonhx","IDisposable"],C.prototype={dispose:null,__class__:C}
var A=t.BABYLON.ISmartArrayCompatible=function(){}
s["com.babylonhx.ISmartArrayCompatible"]=A,A.__name__=["com","babylonhx","ISmartArrayCompatible"],A.prototype={__smartArrayFlags:null,__class__:A}
var I=t.BABYLON.Node=function(e,t){this.__smartArrayFlags=[],this._parentRenderId=-1,this._currentRenderId=-1,this._isReady=!0,this._isEnabled=!0,this._childrenFlag=-1,this.animations=[],this.state="",this.name=e,this.id=e,this._scene=t,this._initCache()}
s["com.babylonhx.Node"]=I,I.__name__=["com","babylonhx","Node"],I.__interfaces__=[A],I.prototype={parent:null,name:null,id:null,uniqueId:null,state:null,animations:null,onReady:null,_childrenFlag:null,_isEnabled:null,_isReady:null,_currentRenderId:null,_parentRenderId:null,__smartArrayFlags:null,_waitingParentId:null,_scene:null,_cache:null,getScene:function(){return this._scene},getEngine:function(){return this._scene._engine},getWorldMatrix:function(){return null},_initCache:function(){this._cache={},this._cache.parent=null},updateCache:function(e){null==e&&(e=!1),(e||!this.isSynchronized(null))&&(this._cache.parent=this.parent,this._updateCache())},_updateCache:function(e){null==e&&(e=!1)},_isSynchronized:function(){return!0},_markSyncedWithParent:function(){this._parentRenderId=this.parent._currentRenderId},isSynchronizedWithParent:function(){return null==this.parent?!0:this._parentRenderId!=this.parent._currentRenderId?!1:this.parent.isSynchronized(null)},isSynchronized:function(e){null==e&&(e=!1)
var t=this.hasNewParent()
return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},hasNewParent:function(e){return null==e&&(e=!1),this._cache.parent==this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},isReady:function(){return this._isReady},isEnabled:function(){return this._isEnabled?null!=this.parent?this.parent.isEnabled():!0:!1},setEnabled:function(e){this._isEnabled=e},isDescendantOf:function(e){return null!=this.parent?this.parent==e?!0:this.parent.isDescendantOf(e):!1},_getDescendants:function(e,t){for(var i=0,n=e.length;n>i;){var r=i++,s=e[r]
s.isDescendantOf(this)&&t.push(s)}},getDescendants:function(){var e=[]
return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},_setReady:function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1)
this._isReady=!0,null!=this.onReady&&this.onReady(this)}},__class__:I}
var P=t.BABYLON.Scene=function(e){this._uniqueIdCounter=0,this._scaledVelocity=new W(0,0,0),this._scaledPosition=new W(0,0,0),this._transformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._activeAnimatables=[],this._activeBones=0,this._activeSkeletons=new pi(32),this._activeParticleSystems=new pi(256),this._renderTargets=new pi(256),this._processedMaterials=new pi(256),this._activeMeshes=new pi(256),this._onAfterRenderCallbacks=[],this._onBeforeRenderCallbacks=[],this._pendingData=[],this._onReadyCallbacks=[],this._toBeDisposed=new pi(256),this._executeWhenReadyTimeoutId=-1,this._renderId=0,this._animationStartDate=-1,this._animationRatio=0,this._spritesDuration=0,this._renderDuration=0,this._particlesDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._lastFrameDuration=0,this._activeParticles=0,this._activeIndices=0,this._totalVertices=0,this._proceduralTextures=[],this.proceduralTexturesEnabled=!0,this._meshesForIntersections=new pi(256),this._actionManagers=[],this.importedMeshesFiles=[],this.customRenderTargets=[],this.dumpNextRenderTargets=!1,this.renderTargetsEnabled=!0,this.postProcessesEnabled=!0,this.gravity=new W(0,-9,0),this._workerCollisions=!1,this.collisionsEnabled=!0,this.lensFlareSystems=[],this.lensFlaresEnabled=!0,this.skeletons=[],this.skeletonsEnabled=!0,this.layers=[],this.spriteManagers=[],this.spritesEnabled=!0,this.particleSystems=[],this.particlesEnabled=!0,this.textures=[],this.texturesEnabled=!0,this.multiMaterials=[],this.materials=[],this._geometries=[],this.meshes=[],this.activeCameras=[],this.cameras=[],this.lights=[],this.lightsEnabled=!0,this.shadowsEnabled=!0,this.fogEnd=1e3,this.fogStart=0,this.fogDensity=.1,this.fogColor=new Re(.2,.2,.3),this.fogMode=P.FOGMODE_NONE,this.fogEnabled=!0,this.cameraToUseForPointers=null,this.animationsEnabled=!0,this.forceShowBoundingBoxes=!1,this.forcePointsCloud=!1,this.forceWireframe=!1,this.ambientColor=new Re(0,0,0),this.clearColor=new Re(.2,.2,.3),this.autoClear=!0,this._engine=e,e.scenes.push(this),this.defaultMaterial=new Fe("default material",this),this._renderingManager=new Ge(this),this.postProcessManager=new ni(this),this.postProcessRenderPipelineManager=new li,this._boundingBoxRenderer=new hi(this),this._outlineRenderer=new ci(this),this.attachControl(),this.simplificationQueue=new Xt}
s["com.babylonhx.Scene"]=P,P.__name__=["com","babylonhx","Scene"],P.prototype={autoClear:null,clearColor:null,ambientColor:null,beforeRender:null,afterRender:null,onDispose:null,beforeCameraRender:null,afterCameraRender:null,forceWireframe:null,forcePointsCloud:null,forceShowBoundingBoxes:null,clipPlane:null,animationsEnabled:null,_onPointerMove:null,_onPointerDown:null,onPointerDown:null,_onPointerUp:null,onPointerUp:null,cameraToUseForPointers:null,_pointerX:null,_pointerY:null,_meshUnderPointer:null,_onKeyDown:null,_onKeyUp:null,fogEnabled:null,fogMode:null,fogColor:null,fogDensity:null,fogStart:null,fogEnd:null,shadowsEnabled:null,lightsEnabled:null,lights:null,onNewLightAdded:null,onLightRemoved:null,cameras:null,onNewCameraAdded:null,onCameraRemoved:null,activeCameras:null,activeCamera:null,meshes:null,onNewMeshAdded:null,onMeshRemoved:null,_geometries:null,onGeometryAdded:null,onGeometryRemoved:null,materials:null,multiMaterials:null,defaultMaterial:null,texturesEnabled:null,textures:null,particlesEnabled:null,particleSystems:null,spritesEnabled:null,spriteManagers:null,layers:null,skeletonsEnabled:null,skeletons:null,lensFlaresEnabled:null,lensFlareSystems:null,collisionsEnabled:null,_workerCollisions:null,set_workerCollisions:function(e){return this._workerCollisions=e,null!=this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=new re,this.collisionCoordinator.init(this),e},get_workerCollisions:function(){return this._workerCollisions},collisionCoordinator:null,gravity:null,postProcessesEnabled:null,postProcessManager:null,postProcessRenderPipelineManager:null,renderTargetsEnabled:null,dumpNextRenderTargets:null,customRenderTargets:null,useDelayedTextureLoading:null,importedMeshesFiles:null,database:null,actionManager:null,_actionManagers:null,_meshesForIntersections:null,proceduralTexturesEnabled:null,_proceduralTextures:null,simplificationQueue:null,_engine:null,_totalVertices:null,_activeIndices:null,_activeParticles:null,_lastFrameDuration:null,_evaluateActiveMeshesDuration:null,_renderTargetsDuration:null,_particlesDuration:null,_renderDuration:null,_spritesDuration:null,_animationRatio:null,_animationStartDate:null,_cachedMaterial:null,_renderId:null,_executeWhenReadyTimeoutId:null,_toBeDisposed:null,_onReadyCallbacks:null,_pendingData:null,_onBeforeRenderCallbacks:null,_onAfterRenderCallbacks:null,_activeMeshes:null,_processedMaterials:null,_renderTargets:null,_activeParticleSystems:null,_activeSkeletons:null,_activeBones:null,_renderingManager:null,_physicsEngine:null,_activeAnimatables:null,_transformMatrix:null,_pickWithRayInverseMatrix:null,_scaledPosition:null,_scaledVelocity:null,_boundingBoxRenderer:null,_outlineRenderer:null,_depthRenderer:null,_uniqueIdCounter:null,_viewMatrix:null,_projectionMatrix:null,_frustumPlanes:null,_selectionOctree:null,_pointerOverMesh:null,get_meshUnderPointer:function(){return this._meshUnderPointer},get_pointerX:function(){return this._pointerX},get_pointerY:function(){return this._pointerY},getCachedMaterial:function(){return this._cachedMaterial},getBoundingBoxRenderer:function(){return this._boundingBoxRenderer},getOutlineRenderer:function(){return this._outlineRenderer},getEngine:function(){return this._engine},getTotalVertices:function(){return this._totalVertices},getActiveVertices:function(){return this._activeIndices},getActiveParticles:function(){return this._activeParticles},getActiveBones:function(){return this._activeBones},getLastFrameDuration:function(){return this._lastFrameDuration},getEvaluateActiveMeshesDuration:function(){return this._evaluateActiveMeshesDuration},getActiveMeshes:function(){return this._activeMeshes},getRenderTargetsDuration:function(){return this._renderTargetsDuration},getRenderDuration:function(){return this._renderDuration},getParticlesDuration:function(){return this._particlesDuration},getSpritesDuration:function(){return this._spritesDuration},getAnimationRatio:function(){return this._animationRatio},getRenderId:function(){return this._renderId},incrementRenderId:function(){this._renderId++},_updatePointerPosition:function(e,t){this._pointerX=e,this._pointerY=t,null!=this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},attachControl:function(){var e=this
this._onPointerMove=function(t,i){e._pointerX=t,e._pointerY=i,null!=e.cameraToUseForPointers&&(e._pointerX=e._pointerX-e.cameraToUseForPointers.viewport.x*e._engine.getRenderWidth(),e._pointerY=e._pointerY-e.cameraToUseForPointers.viewport.y*e._engine.getRenderHeight())
var n=e.pick(e._pointerX,e._pointerY,function(e){return e.get_isPickable()&&e.isVisible&&e.isReady()&&null!=e.actionManager&&e.actionManager.get_hasPointerTriggers()},!1,e.cameraToUseForPointers)
n.hit?(e._meshUnderPointer=n.pickedMesh,e.setPointerOverMesh(n.pickedMesh)):(e.setPointerOverMesh(null),e._meshUnderPointer=null)},this._onPointerDown=function(t,i,n){var r=null
null==e.onPointerDown&&(r=function(e){return e.get_isPickable()&&e.isVisible&&e.isReady()&&null!=e.actionManager&&e.actionManager.get_hasPickTriggers()}),e._pointerX=t,e._pointerY=i,null!=e.cameraToUseForPointers&&(e._pointerX=e._pointerX-e.cameraToUseForPointers.viewport.x*e._engine.getRenderWidth(),e._pointerY=e._pointerY-e.cameraToUseForPointers.viewport.y*e._engine.getRenderHeight())
var s=e.pick(e._pointerX,e._pointerY,r,!1,e.cameraToUseForPointers)
if(s.hit&&null!=s.pickedMesh.actionManager){switch(n){case 0:s.pickedMesh.actionManager.processTrigger(R.OnLeftPickTrigger,F.CreateNew(s.pickedMesh))
break
case 1:s.pickedMesh.actionManager.processTrigger(R.OnCenterPickTrigger,F.CreateNew(s.pickedMesh))
break
case 2:s.pickedMesh.actionManager.processTrigger(R.OnRightPickTrigger,F.CreateNew(s.pickedMesh))}s.pickedMesh.actionManager.processTrigger(R.OnPickTrigger,F.CreateNew(s.pickedMesh))}null!=e.onPointerDown&&e.onPointerDown(t,i,n,s)},this._onPointerUp=function(t,i,n){var r=null
null==e.onPointerUp&&(r=function(e){return e.get_isPickable()&&e.isVisible&&e.isReady()&&null!=e.actionManager&&e.actionManager.hasSpecificTrigger(R.OnPickUpTrigger)}),e._pointerX=t,e._pointerY=i,null!=e.cameraToUseForPointers&&(e._pointerX=e._pointerX-e.cameraToUseForPointers.viewport.x*e._engine.getRenderWidth(),e._pointerY=e._pointerY-e.cameraToUseForPointers.viewport.y*e._engine.getRenderHeight())
var s=e.pick(e._pointerX,e._pointerY,r,!1,e.cameraToUseForPointers)
s.hit&&null!=s.pickedMesh.actionManager&&s.pickedMesh.actionManager.processTrigger(R.OnPickUpTrigger,F.CreateNew(s.pickedMesh)),null!=e.onPointerUp&&e.onPointerUp(t,i,n,s)},this._onKeyDown=function(t){null!=e.actionManager&&e.actionManager.processTrigger(R.OnKeyDownTrigger,F.CreateNewFromScene(e,t))},this._onKeyUp=function(t){null!=e.actionManager&&e.actionManager.processTrigger(R.OnKeyUpTrigger,F.CreateNewFromScene(e,t))},M.mouseDown.push(this._onPointerDown),M.mouseUp.push(this._onPointerUp),M.mouseMove.push(this._onPointerMove),M.keyDown.push(this._onKeyDown),M.keyUp.push(this._onKeyUp)},detachControl:function(){var e=this._onPointerDown
c.remove(M.mouseDown,e)
var t=this._onPointerUp
c.remove(M.mouseUp,t)
var i=this._onPointerMove
c.remove(M.mouseMove,i)
var n=this._onKeyDown
c.remove(M.keyDown,n)
var r=this._onKeyUp
c.remove(M.keyUp,r)},isReady:function(){if(this._pendingData.length>0)return!1
for(var e=0,t=this._geometries.length;t>e;){var i=e++,n=this._geometries[i]
if(2==n.delayLoadState)return!1}for(var r=0,s=this.meshes.length;s>r;){var o=r++,a=this.meshes[o]
if(!a.isReady())return!1
var l=a.get_material()
if(null!=l&&!l.isReady(a))return!1}return!0},resetCachedMaterial:function(){this._cachedMaterial=null},registerBeforeRender:function(e){this._onBeforeRenderCallbacks.push(e)},unregisterBeforeRender:function(e){c.remove(this._onBeforeRenderCallbacks,e)},registerAfterRender:function(e){this._onAfterRenderCallbacks.push(e)},unregisterAfterRender:function(e){c.remove(this._onAfterRenderCallbacks,e)},_addPendingData:function(e){this._pendingData.push(e)},_removePendingData:function(e){var t=e
c.remove(this._pendingData,t)},getWaitingItemsCount:function(){return this._pendingData.length},executeWhenReady:function(e){this._onReadyCallbacks.push(e),-1==this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=1,Oe.delay(r(this,this._checkIsReady),150))},_checkIsReady:function(){if(this.isReady()){for(var e=0,t=this._onReadyCallbacks;e<t.length;){var i=t[e];++e,i()}return this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)}this._executeWhenReadyTimeoutId=1,Oe.delay(r(this,this._checkIsReady),150)},beginAnimation:function(e,t,i,n,r,s,o){if(null==r&&(r=1),null==n&&(n=!1),this.stopAnimation(e),null==o&&(o=new V(this,e,t,i,n,r,s)),null!=e.animations&&o.appendAnimations(e,e.animations),null!=e.getAnimatables)for(var a=e.getAnimatables(),l=0,h=a.length;h>l;){var u=l++
this.beginAnimation(a[u],t,i,n,r,s,o)}return o},beginDirectAnimation:function(e,t,i,n,r,s,o){null==s&&(s=1),null==r&&(r=!1)
var a=new V(this,e,i,n,r,s,o,t)
return a},getAnimatableByTarget:function(e){for(var t=0,i=this._activeAnimatables.length;i>t;){var n=t++
if(this._activeAnimatables[n].target==e)return this._activeAnimatables[n]}return null},stopAnimation:function(e){var t=this.getAnimatableByTarget(e)
null!=t&&t.stop()},_animate:function(){if(this.animationsEnabled){-1==this._animationStartDate&&(this._animationStartDate=g["int"](1e3*(Be.stamp()-Oe.__startTime)))
for(var e=g["int"](1e3*(Be.stamp()-Oe.__startTime)),t=e-this._animationStartDate,i=0,n=this._activeAnimatables.length;n>i;){var r=i++
null!=this._activeAnimatables[r]&&this._activeAnimatables[r]._animate(t)}}},getViewMatrix:function(){return this._viewMatrix},getProjectionMatrix:function(){return this._projectionMatrix},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},addMesh:function(e){e.uniqueId=this._uniqueIdCounter++
var t=this.meshes.push(e)
null!=this.onNewMeshAdded&&this.onNewMeshAdded(e,t,this)},removeMesh:function(e){var t=c.indexOf(this.meshes,e,0)
return-1!=t&&this.meshes.splice(t,1),null!=this.onMeshRemoved&&this.onMeshRemoved(e),t},removeLight:function(e){var t=c.indexOf(this.lights,e,0)
return-1!=t&&this.lights.splice(t,1),null!=this.onLightRemoved&&this.onLightRemoved(e),t},removeCamera:function(e){var t=c.indexOf(this.cameras,e,0)
return-1!=t&&this.cameras.splice(t,1),t=c.indexOf(this.activeCameras,e,0),-1!=t&&this.activeCameras.splice(t,1),this.activeCamera==e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),null!=this.onCameraRemoved&&this.onCameraRemoved(e),t},addLight:function(e){e.uniqueId=this._uniqueIdCounter++
var t=this.lights.push(e)
null!=this.onNewLightAdded&&this.onNewLightAdded(e,t,this)},addCamera:function(e){e.uniqueId=this._uniqueIdCounter++
var t=this.cameras.push(e)
null!=this.onNewCameraAdded&&this.onNewCameraAdded(e,t,this)},setActiveCameraByID:function(e){var t=this.getCameraByID(e)
return null!=t?(this.activeCamera=t,t):null},setActiveCameraByName:function(e){var t=this.getCameraByName(e)
return null!=t?(this.activeCamera=t,t):null},getMaterialByID:function(e){for(var t=0,i=this.materials.length;i>t;){var n=t++
if(this.materials[n].id==e)return this.materials[n]}return null},getMaterialByName:function(e){for(var t=0,i=this.materials.length;i>t;){var n=t++
if(this.materials[n].name==e)return this.materials[n]}return null},getCameraByID:function(e){for(var t=0,i=this.cameras.length;i>t;){var n=t++
if(this.cameras[n].id==e)return this.cameras[n]}return null},getCameraByUniqueID:function(e){for(var t=0,i=this.cameras.length;i>t;){var n=t++
if(this.cameras[n].uniqueId==e)return this.cameras[n]}return null},getCameraByName:function(e){for(var t=0,i=this.cameras.length;i>t;){var n=t++
if(this.cameras[n].name==e)return this.cameras[n]}return null},getLightByName:function(e){for(var t=0,i=this.lights.length;i>t;){var n=t++
if(this.lights[n].name==e)return this.lights[n]}return null},getLightByID:function(e){for(var t=0,i=this.lights.length;i>t;){var n=t++
if(this.lights[n].id==e)return this.lights[n]}return null},getLightByUniqueID:function(e){for(var t=0,i=this.lights.length;i>t;){var n=t++
if(this.lights[n].uniqueId==e)return this.lights[n]}return null},getGeometryByID:function(e){for(var t=0,i=this._geometries.length;i>t;){var n=t++
if(this._geometries[n].id==e)return this._geometries[n]}return null},pushGeometry:function(e,t){return null==t&&(t=!1),t||null==this.getGeometryByID(e.id)?(this._geometries.push(e),null!=this.onGeometryAdded&&this.onGeometryAdded(e),!0):!1},removeGeometry:function(e){var t=c.indexOf(this._geometries,e,0)
return t>-1?(this._geometries.splice(t,1),null!=this.onGeometryRemoved&&this.onGeometryRemoved(e),!0):!1},getGeometries:function(){return this._geometries},getMeshByID:function(e){for(var t=0,i=this.meshes.length;i>t;){var n=t++
if(this.meshes[n].id==e)return this.meshes[n]}return null},getMeshByUniqueID:function(e){for(var t=0,i=this.meshes.length;i>t;){var n=t++
if(this.meshes[n].uniqueId==e)return this.meshes[n]}return null},getLastMeshByID:function(e){for(var t=this.meshes.length-1;t>=0;){if(this.meshes[t].id==e)return this.meshes[t];--t}return null},getLastEntryByID:function(e){for(var t=this.meshes.length-1;t>=0;){if(this.meshes[t].id==e)return this.meshes[t];--t}for(t=this.cameras.length-1;t>=0;){if(this.cameras[t].id==e)return this.cameras[t];--t}for(t=this.lights.length-1;t>=0;){if(this.lights[t].id==e)return this.lights[t];--t}return null},getNodeByName:function(e){var t=this.getMeshByName(e)
if(null!=t)return t
var i=this.getLightByName(e)
return null!=i?i:this.getCameraByName(e)},getMeshByName:function(e){for(var t=0,i=this.meshes.length;i>t;){var n=t++
if(this.meshes[n].name==e)return this.meshes[n]}return null},getLastSkeletonByID:function(e){for(var t=this.skeletons.length-1;t>=0;){if(this.skeletons[t].id==e)return this.skeletons[t];--t}return null},getSkeletonById:function(e){for(var t=0,i=this.skeletons.length;i>t;){var n=t++
if(this.skeletons[n].id==e)return this.skeletons[n]}return null},getSkeletonByName:function(e){for(var t=0,i=this.skeletons.length;i>t;){var n=t++
if(this.skeletons[n].name==e)return this.skeletons[n]}return null},isActiveMesh:function(e){return-1!=this._activeMeshes.indexOf(e)},_evaluateSubMesh:function(e,t){if(t.alwaysSelectAsActiveMesh||1==t.subMeshes.length||e._boundingInfo.isInFrustum(this._frustumPlanes)){var i=e.getMaterial()
t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e._boundingInfo.boundingBox),null!=i&&(null!=i.getRenderTargetTextures&&-1==this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concat(i.getRenderTargetTextures())),this._activeIndices+=e.verticesCount,this._renderingManager.dispatch(e))}},_evaluateActiveMeshes:function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._boundingBoxRenderer.reset(),null==this._frustumPlanes?this._frustumPlanes=Ct.GetPlanes(this._transformMatrix):Ct.GetPlanesToRef(this._transformMatrix,this._frustumPlanes)
var e=null,t=-1
if(null!=this._selectionOctree){var i=this._selectionOctree.select(this._frustumPlanes,null)
e=i.data,t=i.length}else t=this.meshes.length,e=this.meshes
for(var n=0;t>n;){var r=n++,s=e[r]
if(!s.get_isBlocked()&&(this._totalVertices+=s.getTotalVertices(),s.isReady()&&s.isEnabled())){s.computeWorldMatrix(),null!=s.actionManager&&s.actionManager.hasSpecificTriggers([R.OnIntersectionEnterTrigger,R.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(s)
var o=s.getLOD(this.activeCamera)
null!=o&&(s._preActivate(),(s.alwaysSelectAsActiveMesh||s.isVisible&&s.get_visibility()>0&&0!=(s.layerMask&this.activeCamera.layerMask)&&s.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),s._activate(this._renderId),this._activeMesh(o)))}}var a=g["int"](1e3*(Be.stamp()-Oe.__startTime))
if(this.particlesEnabled)for(var l=0,h=this.particleSystems.length;h>l;){var u=l++,c=this.particleSystems[u]
c._started&&(null==c.emitter.position||null!=c.emitter&&c.emitter.isEnabled())&&(this._activeParticleSystems.push(c),c.animate())}this._particlesDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-a},_activeMesh:function(e){if(null!=e.get_skeleton()&&this.skeletonsEnabled&&this._activeSkeletons.pushNoDuplicate(e.get_skeleton()),(e.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),null!=e&&null!=e.subMeshes){var t=-1,i=null
if(null!=e._submeshesOctree&&e.useOctreeForRenderingSelection){var n=e._submeshesOctree.select(this._frustumPlanes,null)
t=n.length,i=n.data}else i=e.subMeshes,t=i.length
for(var r=0;t>r;){var s=r++,o=i[s]
this._evaluateSubMesh(o,e)}}},updateTransformMatrix:function(e){null==e&&(e=!1),this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},_renderForCamera:function(e){var t=this._engine
if(this.activeCamera=e,null==this.activeCamera)throw new Wi("Active camera not set")
t.setViewport(this.activeCamera.viewport,null,null),this._renderId++,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!1)),null!=this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera)
var i=g["int"](1e3*(Be.stamp()-Oe.__startTime))
this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-i
for(var n=0,r=this._activeSkeletons.length;r>n;){var s=n++,o=this._activeSkeletons.data[s]
o.prepare()}var a=g["int"](1e3*(Be.stamp()-Oe.__startTime))
if(this.renderTargetsEnabled){for(var l=0,h=this._renderTargets.length;h>l;){var u=l++,c=this._renderTargets.data[u]
if(c._shouldRender()){this._renderId++
var f=null!=c.activeCamera&&c.activeCamera!=this.activeCamera
c.render(f,this.dumpNextRenderTargets)}}this._renderId++}this._renderTargets.length>0&&(En.context.bindFramebuffer(36160,null),t.setViewport(t._cachedViewport,null,null),t.wipeCaches()),this._renderTargetsDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-a,this.postProcessManager._prepareFrame()
var d=g["int"](1e3*(Be.stamp()-Oe.__startTime))
if(this.layers.length>0){t._depthCullingState.set_depthTest(!1)
for(var m=null,_=0,p=this.layers.length;p>_;){var v=_++
m=this.layers[v],m.isBackground&&m.render()}t._depthCullingState.set_depthTest(!0)}if(this._renderingManager.render(null,null,!0,!0),this._boundingBoxRenderer.render(),this.lensFlaresEnabled)for(var x=0,y=this.lensFlareSystems.length;y>x;){var b=x++
this.lensFlareSystems[b].render()}if(this.layers.length>0){t._depthCullingState.set_depthTest(!1)
for(var w=0,S=this.layers.length;S>w;){var M=w++,T=this.layers[M]
T.isBackground||T.render()}t._depthCullingState.set_depthTest(!0)}this._renderDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-d,this.postProcessManager._finalizeFrame(e.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),null!=this.afterCameraRender&&this.afterCameraRender(this.activeCamera)},_processSubCameras:function(e){if(0==e.subCameras.length)return void this._renderForCamera(e)
for(var t=0,i=e.subCameras.length;i>t;){var n=t++
this._renderForCamera(e.subCameras[n])}this.activeCamera=e,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},_checkIntersections:function(){for(var e=0,t=this._meshesForIntersections.length;t>e;)for(var i=e++,n=this._meshesForIntersections.data[i],r=0,s=n.actionManager.actions.length;s>r;){var o=r++,a=n.actionManager.actions[o]
if(a.trigger==R.OnIntersectionEnterTrigger||a.trigger==R.OnIntersectionExitTrigger){var l=a.getTriggerParameter(),h=l.intersectsMesh(n,!1),u=c.indexOf(n._intersectionsInProgress,l,0)
if(h&&-1==u&&a.trigger==R.OnIntersectionEnterTrigger)a._executeCurrent(F.CreateNew(n)),n._intersectionsInProgress.push(l)
else if(!h&&u>-1&&a.trigger==R.OnIntersectionExitTrigger){a._executeCurrent(F.CreateNew(n))
var f=c.indexOf(n._intersectionsInProgress,l,0)
f>-1&&n._intersectionsInProgress.splice(f,1)}}}},render:function(){this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this._engine._drawCalls=0,this._meshesForIntersections.reset(),this._cachedMaterial=null,null!=this.actionManager&&this.actionManager.processTrigger(R.OnEveryFrameTrigger,null),this.simplificationQueue.running||this.simplificationQueue.executeNext(),null!=this.beforeRender&&this.beforeRender()
for(var e=0,t=this._onBeforeRenderCallbacks;e<t.length;){var i=t[e];++e,i()}var n=Math.max(P.MinDeltaTime,Math.min(this._engine.deltaTime,P.MaxDeltaTime))
this._animationRatio=.06*n,this._animate(),null!=this._physicsEngine&&this._physicsEngine._runOneStep(n/1e3)
var r=g["int"](1e3*(Be.stamp()-Oe.__startTime)),s=this._engine,o=this.activeCamera
if(this.renderTargetsEnabled){for(var a=0,l=this.customRenderTargets.length;l>a;){var h=a++,u=this.customRenderTargets[h]
if(u._shouldRender()){if(this._renderId++,null!=u.activeCamera?this.activeCamera=u.activeCamera:this.activeCamera=this.activeCamera,null==this.activeCamera)throw new Wi("Active camera not set")
s.setViewport(this.activeCamera.viewport,null,null),this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!1)),u.render(o!=this.activeCamera)}}this._renderId++}if(this.customRenderTargets.length>0&&(En.context.bindFramebuffer(36160,null),s.setViewport(s._cachedViewport,null,null),s.wipeCaches()),this._renderTargetsDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-r,this.activeCamera=o,this.proceduralTexturesEnabled)for(var f=0,d=this._proceduralTextures.length;d>f;){var m=f++,_=this._proceduralTextures[m]
_._shouldRender()&&_.render()}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var p=0,v=this.lights.length;v>p;){var x=p++,y=this.lights[x],b=y.getShadowGenerator()
y.isEnabled()&&null!=b&&-1!=function(){var e,t=b.getShadowMap().getScene().textures,i=b.getShadowMap()
return e=c.indexOf(t,i,0)}(this)&&this._renderTargets.push(b.getShadowMap())}if(null!=this._depthRenderer&&this._renderTargets.push(this._depthRenderer._depthMap),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var w=this._renderId,S=0,M=this.activeCameras.length;M>S;){var T=S++
this._renderId=w,this._processSubCameras(this.activeCameras[T])}else{if(null==this.activeCamera)throw new Wi("No camera defined")
this._processSubCameras(this.activeCamera)}this._checkIntersections(),null!=this.afterRender&&this.afterRender()
for(var C=0,A=this._onAfterRenderCallbacks;C<A.length;){var I=A[C];++C,I()}for(var E=0,D=this._toBeDisposed.length;D>E;){var L=E++
this._toBeDisposed.data[L].dispose(),this._toBeDisposed.data[L]=null}this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1)},enableDepthRenderer:function(){return null!=this._depthRenderer?this._depthRenderer:(this._depthRenderer=new ui(this),this._depthRenderer)},disableDepthRenderer:function(){null!=this._depthRenderer&&(this._depthRenderer._depthMap.dispose(),this._depthRenderer=null)},dispose:function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),null!=this._depthRenderer&&this._depthRenderer._depthMap.dispose(),null!=this.onDispose&&this.onDispose(),this.detachControl(),this._onBeforeRenderCallbacks=[],this._onAfterRenderCallbacks=[]
for(var e=0,t=this.cameras.length;t>e;){var i=e++
this.cameras[i].detachControl(this)}for(;this.lights.length>0;)this.lights[0].dispose()
for(;this.meshes.length>0;)this.meshes[0].dispose(!0)
for(;this.cameras.length>0;)this.cameras[0].dispose()
for(;this.materials.length>0;)this.materials[0].dispose()
for(;this.particleSystems.length>0;)this.particleSystems[0].dispose(null)
for(;this.spriteManagers.length>0;)this.spriteManagers[0].dispose()
for(;this.layers.length>0;)this.layers[0].dispose()
for(;this.textures.length>0;)this.textures[0].dispose()
this.postProcessManager.dispose(),null!=this._physicsEngine&&this.disablePhysicsEngine(),c.remove(this._engine.scenes,this),this._engine.wipeCaches()},_getNewPosition:function(e,t,i,n,r,s){e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,n,r,s),r.multiplyInPlace(i.radius)},_collideWithWorld:function(e,t,i,n,r,s){var o=10*M.CollisionsEpsilon
if(i.retry>=n)return r.x=e.x,r.y=e.y,void(r.z=e.z)
i._initialize(e,t,o)
for(var a=0,l=this.meshes.length;l>a;){var h=a++,u=this.meshes[h]
u.isEnabled()&&u.get_checkCollisions()&&null!=u.subMeshes&&u!=s&&u._checkCollision(i)}return i.collisionFound?((0!=t.x||0!=t.y||0!=t.z)&&(e.addToRef(t,i._destinationPoint),t.scaleInPlace(i.nearestDistance/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)),i.basePoint.addToRef(t,e),e.subtractToRef(i.intersectionPoint,i._slidePlaneNormal),i._slidePlaneNormal.normalize(),i._slidePlaneNormal.scaleToRef(i.epsilon,i._displacementVector),e.addInPlace(i._displacementVector),i.intersectionPoint.addInPlace(i._displacementVector),i._slidePlaneNormal.scaleInPlace(Ye.SignedDistanceToPlaneFromPositionAndNormal(i.intersectionPoint,i._slidePlaneNormal,i._destinationPoint)),i._destinationPoint.subtractInPlace(i._slidePlaneNormal),i._destinationPoint.subtractToRef(i.intersectionPoint,t)),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)<=o?(r.x=e.x,r.y=e.y,void(r.z=e.z)):(i.retry++,void this._collideWithWorld(e,t,i,n,r,s))):(r.x=e.x+t.x,r.y=e.y+t.y,void(r.z=e.z+t.z))},getWorldExtends:function(){for(var e=new W(1/0,1/0,1/0),t=new W(-(1/0),-(1/0),-(1/0)),i=0,n=this.meshes.length;n>i;){var r=i++,s=this.meshes[r]
s.computeWorldMatrix(!0)
var o=s.getBoundingInfo().boundingBox.minimumWorld,a=s.getBoundingInfo().boundingBox.maximumWorld
o.x<e.x&&(e.x=o.x),o.y<e.y&&(e.y=o.y),o.z<e.z&&(e.z=o.z),o.x>t.x&&(t.x=o.x),o.y>t.y&&(t.y=o.y),o.z>t.z&&(t.z=o.z),a.x<e.x&&(e.x=a.x),a.y<e.y&&(e.y=a.y),a.z<e.z&&(e.z=a.z),a.x>t.x&&(t.x=a.x),a.y>t.y&&(t.y=a.y),a.z>t.z&&(t.z=a.z)}return{min:e,max:t}},createOrUpdateSelectionOctree:function(e,t){null==t&&(t=2),null==e&&(e=64),null==this._selectionOctree&&(this._selectionOctree=new ce(ce.CreationFuncForMeshes,e,t))
var i=this.getWorldExtends()
return this._selectionOctree.update(i.min,i.max,this.meshes),this._selectionOctree},createPickingRay:function(e,t,i,n){var r=this._engine
if(null==n){if(null==this.activeCamera)throw new Wi("Active camera not set")
n=this.activeCamera}var s=n.viewport,o=s.toGlobal(r)
return e=e/this._engine.getHardwareScalingLevel()-o.x,t=t/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-o.y-o.height),Pt.CreateNew(e,t,o.width,o.height,null!=i?i:U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),n.getViewMatrix(),n.getProjectionMatrix())},_internalPick:function(e,t,i){null==i&&(i=!1)
for(var n=null,r=0,s=this.meshes.length;s>r;){var o=r++,a=this.meshes[o]
if(null!=t){if(!t(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.get_isPickable())continue
var l=a.getWorldMatrix(),h=e(l),u=a.intersects(h,i)
if(null!=u&&u.hit&&(i||null==n||!(u.distance>=n.distance))&&(n=u,i))break}return null!=n?n:new oe},pick:function(e,t,i,n,r){null==n&&(n=!1)
var s=this
return this._internalPick(function(i){return s.createPickingRay(e,t,i,r)},i,n)},pickWithRay:function(e,t,i){null==i&&(i=!1)
var n=this
return this._internalPick(function(t){return null==n._pickWithRayInverseMatrix&&(n._pickWithRayInverseMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),t.invertToRef(n._pickWithRayInverseMatrix),Pt.Transform(e,n._pickWithRayInverseMatrix)},t,i)},setPointerOverMesh:function(e){this._pointerOverMesh!=e&&(null!=this._pointerOverMesh&&null!=this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(R.OnPointerOutTrigger,F.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,null!=this._pointerOverMesh&&null!=this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(R.OnPointerOverTrigger,F.CreateNew(this._pointerOverMesh)))},getPointerOverMesh:function(){return this._pointerOverMesh},getPhysicsEngine:function(){return this._physicsEngine},enablePhysics:function(e,t){return null!=this._physicsEngine?!0:(this._physicsEngine=new Jt(t),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(e),!0):(this._physicsEngine=null,!1))},disablePhysicsEngine:function(){null!=this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},isPhysicsEnabled:function(){return null!=this._physicsEngine},setGravity:function(e){null!=this._physicsEngine&&this._physicsEngine._setGravity(e)},createCompoundImpostor:function(e,t){if(null!=e.parts&&(t=e,e=e.parts),null==this._physicsEngine)return null
for(var i=0,n=e.length;n>i;){var r=i++,s=e[r].mesh
s._physicImpostor=e[r].impostor,s._physicsMass=t.mass/e.length,s._physicsFriction=t.friction,s._physicRestitution=t.restitution}return this._physicsEngine._registerMeshesAsCompound(e,t)},deleteCompoundImpostor:function(e){for(var t=0,i=e.parts.length;i>t;){var n=t++,r=e.parts[n].mesh
r._physicImpostor=0,this._physicsEngine._unregisterMesh(r)}},createDefaultCameraOrLight:function(){if(0==this.lights.length&&new xe("default light",new W(0,1,0),this),null==this.activeCamera){var e=new $("default camera",new W(0,0,0),this),t=this.getWorldExtends(),i=t.min.add(t.max.subtract(t.min).scale(.5))
e.position=new W(i.x,i.y,t.min.z-(t.max.z-t.min.z)),e.setTarget(i),this.activeCamera=e}},__class__:P,__properties__:{get_pointerY:"get_pointerY",get_pointerX:"get_pointerX",get_meshUnderPointer:"get_meshUnderPointer",set_workerCollisions:"set_workerCollisions",get_workerCollisions:"get_workerCollisions"}}
var E=t.BABYLON._AlphaState=function(){this._blendFunctionParameters=[],this._alphaBlend=!1,this._isBlendFunctionParametersDirty=!1,this._isAlphaBlendDirty=!1}
s["com.babylonhx._AlphaState"]=E,E.__name__=["com","babylonhx","_AlphaState"],E.prototype={_isAlphaBlendDirty:null,_isBlendFunctionParametersDirty:null,_alphaBlend:null,_blendFunctionParameters:null,get_isDirty:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},get_alphaBlend:function(){return this._alphaBlend},set_alphaBlend:function(e){return this._alphaBlend==e?e:(this._alphaBlend=e,this._isAlphaBlendDirty=!0,e)},setAlphaBlendFunctionParameters:function(e,t,i,n){(this._blendFunctionParameters[0]!=e||this._blendFunctionParameters[1]!=t||this._blendFunctionParameters[2]!=i||this._blendFunctionParameters[3]!=n)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},reset:function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=-1,this._blendFunctionParameters[1]=-1,this._blendFunctionParameters[2]=-1,this._blendFunctionParameters[3]=-1,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},apply:function(){this.get_isDirty()&&(this._isAlphaBlendDirty&&(this._alphaBlend?En.context.enable(3042):En.context.disable(3042),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(En.context.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},__class__:E,__properties__:{set_alphaBlend:"set_alphaBlend",get_alphaBlend:"get_alphaBlend",get_isDirty:"get_isDirty"}}
var D=t.BABYLON._DepthCullingState=function(){this._zOffset=0,this._isZOffsetDirty=!1,this._isCullDirty=!1,this._isCullFaceDirty=!1,this._isDepthFuncDirty=!1,this._isDepthMaskDirty=!1,this._isDepthTestDirty=!1}
s["com.babylonhx._DepthCullingState"]=D,D.__name__=["com","babylonhx","_DepthCullingState"],D.prototype={_isDepthTestDirty:null,_isDepthMaskDirty:null,_isDepthFuncDirty:null,_isCullFaceDirty:null,_isCullDirty:null,_isZOffsetDirty:null,_depthTest:null,_depthMask:null,_depthFunc:null,_cull:null,_cullFace:null,_zOffset:null,get_isDirty:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},get_zOffset:function(){return this._zOffset},set_zOffset:function(e){return this._zOffset==e?e:(this._zOffset=e,this._isZOffsetDirty=!0,e)},get_cullFace:function(){return this._cullFace},set_cullFace:function(e){return this._cullFace==e?e:(this._cullFace=e,this._isCullFaceDirty=!0,e)},get_cull:function(){return this._cull},set_cull:function(e){return this._cull==e?e:(this._cull=e,this._isCullDirty=!0,e)},get_depthFunc:function(){return this._depthFunc},set_depthFunc:function(e){return this._depthFunc==e?e:(this._depthFunc=e,this._isDepthFuncDirty=!0,e)},get_depthMask:function(){return this._depthMask},set_depthMask:function(e){return this._depthMask==e?e:(this._depthMask=e,this._isDepthMaskDirty=!0,e)},get_depthTest:function(){return this._depthTest},set_depthTest:function(e){return this._depthTest==e?e:(this._depthTest=e,this._isDepthTestDirty=!0,e)},reset:function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},apply:function(){this.get_isDirty()&&(this._isCullDirty&&(null!=this.get_cull()&&this.get_cull()?En.context.enable(2884):En.context.disable(2884),this._isCullDirty=!1),this._isCullFaceDirty&&(En.cullFace(this.get_cullFace()),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(En.depthMask(this.get_depthMask()),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.get_depthTest()?En.context.enable(2929):En.context.disable(2929),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(En.depthFunc(this.get_depthFunc()),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(0!=this.get_zOffset()?(En.context.enable(32823),En.polygonOffset(this.get_zOffset(),0)):En.context.disable(32823),this._isZOffsetDirty=!1))},__class__:D,__properties__:{set_depthTest:"set_depthTest",get_depthTest:"get_depthTest",set_depthMask:"set_depthMask",get_depthMask:"get_depthMask",set_depthFunc:"set_depthFunc",get_depthFunc:"get_depthFunc",set_cull:"set_cull",get_cull:"get_cull",set_cullFace:"set_cullFace",get_cullFace:"get_cullFace",set_zOffset:"set_zOffset",get_zOffset:"get_zOffset",get_isDirty:"get_isDirty"}}
var L=t.BABYLON.Action=function(e,t){null!=v.getProperty(e,"parameter")?(this.trigger=v.getProperty(e,"trigger"),this._triggerParameter=v.getProperty(e,"parameter")):this.trigger=e,this._nextActiveAction=this,this._condition=t}
s["com.babylonhx.actions.Action"]=L,L.__name__=["com","babylonhx","actions","Action"],L.prototype={trigger:null,_actionManager:null,_nextActiveAction:null,_child:null,_condition:null,_triggerParameter:null,_prepare:function(){},getTriggerParameter:function(){return this._triggerParameter},_executeCurrent:function(e){if(null!=this._nextActiveAction._condition){var t=this._nextActiveAction._condition,i=this._actionManager.getScene().getRenderId()
if(t._evaluationId==i){if(!t._currentResult)return}else{if(t._evaluationId=i,!t.isValid())return void(t._currentResult=!1)
t._currentResult=!0}}this._nextActiveAction.execute(e),null!=this._nextActiveAction._child?(null==this._nextActiveAction._child._actionManager&&(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},execute:function(){},then:function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},_getProperty:function(e){return this._actionManager._getProperty(e)},_getEffectiveTarget:function(e,t){return this._actionManager._getEffectiveTarget(e,t)},__class__:L}
var F=t.BABYLON.ActionEvent=function(e,t,i,n,r){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=r}
s["com.babylonhx.actions.ActionEvent"]=F,F.__name__=["com","babylonhx","actions","ActionEvent"],F.CreateNew=function(e){var t=e._scene
return new F(e,t.get_pointerX(),t.get_pointerY(),t.get_meshUnderPointer())},F.CreateNewFromScene=function(e,t){return new F(null,e.get_pointerX(),e.get_pointerY(),e.get_meshUnderPointer(),t)},F.prototype={source:null,pointerX:null,pointerY:null,meshUnderPointer:null,sourceEvent:null,__class__:F}
var R=t.BABYLON.ActionManager=function(e){this.actions=[],this._scene=e,e._actionManagers.push(this)}
s["com.babylonhx.actions.ActionManager"]=R,R.__name__=["com","babylonhx","actions","ActionManager"],R.prototype={actions:null,_scene:null,dispose:function(){var e=c.indexOf(this._scene._actionManagers,this,0)
e>-1&&this._scene._actionManagers.splice(e,1)},getScene:function(){return this._scene},hasSpecificTriggers:function(e){for(var t=0,i=this.actions.length;i>t;){var n=t++,r=this.actions[n]
if(c.indexOf(e,r.trigger,0)>-1)return!0}return!1},hasSpecificTrigger:function(e){for(var t=0,i=this.actions.length;i>t;){var n=t++,r=this.actions[n]
if(r.trigger==e)return!0}return!1},hasPointerTriggers:null,get_hasPointerTriggers:function(){for(var e=0,t=this.actions.length;t>e;){var i=e++,n=this.actions[i]
if(n.trigger>=R.OnPickTrigger&&n.trigger<=R.OnPointerOutTrigger)return!0}return!1},hasPickTriggers:null,get_hasPickTriggers:function(){for(var e=0,t=this.actions.length;t>e;){var i=e++,n=this.actions[i]
if(n.trigger>=R.OnPickTrigger&&n.trigger<=R.OnCenterPickTrigger)return!0
if(n.trigger==R.OnPickUpTrigger)return!0}return!1},registerAction:function(e){return e.trigger==R.OnEveryFrameTrigger&&this.getScene().actionManager!=this?(Ei.trace("OnEveryFrameTrigger can only be used with scene.actionManager",{fileName:"ActionManager.hx",lineNumber:117,className:"com.babylonhx.actions.ActionManager",methodName:"registerAction"}),null):(this.actions.push(e),e._actionManager=this,e._prepare(),e)},processTrigger:function(e,t){for(var i=0,n=this.actions.length;n>i;){var r=i++,s=this.actions[r]
if(s.trigger==e){if(e==R.OnKeyUpTrigger||e==R.OnKeyDownTrigger){var o=s.getTriggerParameter()
if(null!=o&&t.sourceEvent.key!=o)continue}s._executeCurrent(t)}}},_getEffectiveTarget:function(e,t){for(var i=t.split("."),n=0,r=i.length-1;r>n;){var s=n++
e=v.getProperty(e,i[s])}return e},_getProperty:function(e){var t=e.split(".")
return t[t.length-1]},__class__:R,__properties__:{get_hasPickTriggers:"get_hasPickTriggers",get_hasPointerTriggers:"get_hasPointerTriggers"}}
var z=t.BABYLON.Condition=function(e){this._actionManager=e}
s["com.babylonhx.actions.Condition"]=z,z.__name__=["com","babylonhx","actions","Condition"],z.prototype={_actionManager:null,_evaluationId:null,_currentResult:null,isValid:function(){return!0},_getProperty:function(e){return this._actionManager._getProperty(e)},_getEffectiveTarget:function(e,t){return this._actionManager._getEffectiveTarget(e,t)},__class__:z}
var B=t.BABYLON.InterpolateValueAction=function(e,t,i,n,r,s,o){null==o&&(o=!1),null==r&&(r=1e3),L.call(this,e,s),this._target=t,this.propertyPath=i,this.value=n,this.duration=r,this.stopOtherAnimations=o}
s["com.babylonhx.actions.InterpolateValueAction"]=B,B.__name__=["com","babylonhx","actions","InterpolateValueAction"],B.__super__=L,B.prototype=i(L.prototype,{_target:null,_property:null,propertyPath:null,value:null,duration:null,stopOtherAnimations:null,_prepare:function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},execute:function(){var e=this._actionManager.getScene(),t=[{frame:0,value:v.getProperty(this._target,this._property)},{frame:100,value:this.value}],i=-1
if(Me.__instanceof(this.value,Ds)||"number"==typeof this.value)i=G.ANIMATIONTYPE_FLOAT
else if(Me.__instanceof(this.value,Re))i=G.ANIMATIONTYPE_COLOR3
else if(Me.__instanceof(this.value,W))i=G.ANIMATIONTYPE_VECTOR3
else if(Me.__instanceof(this.value,U))i=G.ANIMATIONTYPE_MATRIX
else{if(!Me.__instanceof(this.value,N))return void Ei.trace("InterpolateValueAction:Unsupported type ("+w.getClassName(this.value)+")",{fileName:"InterpolateValueAction.hx",lineNumber:65,className:"com.babylonhx.actions.InterpolateValueAction",methodName:"execute"})
i=G.ANIMATIONTYPE_QUATERNION}var n=new G("InterpolateValueAction",this._property,100*(1e3/this.duration)|0,i,G.ANIMATIONLOOPMODE_CONSTANT)
n.setKeys(t),this.stopOtherAnimations&&e.stopAnimation(this._target),e.beginDirectAnimation(this._target,[n],0,100)},__class__:B})
var O=t.BABYLON.PlayAnimationAction=function(e,t,i,n,r,s){L.call(this,e,s),this._target=t,this.from=i,this.to=n,this.loop=r}
s["com.babylonhx.actions.PlayAnimationAction"]=O,O.__name__=["com","babylonhx","actions","PlayAnimationAction"],O.__super__=L,O.prototype=i(L.prototype,{_target:null,from:null,to:null,loop:null,execute:function(){var e=this._actionManager.getScene()
e.beginAnimation(this._target,this.from,this.to,this.loop)},__class__:O})
var k=t.BABYLON.ValueCondition=function(e,t,i,n,r){null==r&&(r=0),z.call(this,e),this._target=this._getEffectiveTarget(t,this.propertyPath),this._property=this._getProperty(this.propertyPath),this.propertyPath=i,this.value=n,this.operator=r}
s["com.babylonhx.actions.ValueCondition"]=k,k.__name__=["com","babylonhx","actions","ValueCondition"],k.__super__=z,k.prototype=i(z.prototype,{_target:null,_property:null,propertyPath:null,value:null,operator:null,isValid:function(){var e=this.operator
switch(e){case 2:return v.field(this._target,this._property)>this.value
case 3:return v.field(this._target,this._property)<this.value
case 0:case 1:var t=!1
return t=null!=this.value.equals?this.value.equals(v.field(this._target,this._property)):this.value==v.field(this._target,this._property),0==this.operator?t:!t}return!1},__class__:k})
var V=t.BABYLON.Animatable=function(e,t,i,n,r,s,o,a){null==s&&(s=1),null==r&&(r=!1),null==n&&(n=100),null==i&&(i=0),this.animationStarted=!1,this._paused=!1,this._animations=[],this._pausedDelay=-1,this._localDelayOffset=-1,this.target=t,this.fromFrame=i,this.toFrame=n,this.loopAnimation=r,this.speedRatio=s,this.onAnimationEnd=o,null!=a&&this.appendAnimations(t,a),this._scene=e,e._activeAnimatables.push(this)}
s["com.babylonhx.animations.Animatable"]=V,V.__name__=["com","babylonhx","animations","Animatable"],V.prototype={_localDelayOffset:null,_pausedDelay:null,_animations:null,_paused:null,_scene:null,target:null,fromFrame:null,toFrame:null,loopAnimation:null,speedRatio:null,onAnimationEnd:null,animationStarted:null,appendAnimations:function(e,t){for(var i=0,n=t.length;n>i;){var r=i++,s=t[r]
s._target=e,this._animations.push(s)}},getAnimationByTargetProperty:function(e){for(var t=this._animations,i=0,n=t.length;n>i;){var r=i++
if(t[r].targetProperty==e)return t[r]}return null},pause:function(){this._paused=!0},restart:function(){this._paused=!1},stop:function(){var e=c.indexOf(this._scene._activeAnimatables,this,0)
e>-1&&this._scene._activeAnimatables.splice(e,1),null!=this.onAnimationEnd&&this.onAnimationEnd()},_animate:function(e){if(this._paused)return-1==this._pausedDelay&&(this._pausedDelay=e),!0;-1==this._localDelayOffset?this._localDelayOffset=e:-1!=this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=-1)
for(var t=!1,i=this._animations,n=0,r=i.length;r>n;){var s=n++,o=i[s],a=o.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio)
t=t||a}if(!t){var l=c.indexOf(this._scene._activeAnimatables,this,0)
this._scene._activeAnimatables.splice(l,1)}return t||null==this.onAnimationEnd||this.onAnimationEnd(),t},__class__:V}
var N=t.BABYLON.Quaternion=function(e,t,i,n){null==n&&(n=1),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i,this.w=n}
s["com.babylonhx.math.Quaternion"]=N,N.__name__=["com","babylonhx","math","Quaternion"],N.FromRotationMatrix=function(e){var t=new N
return N.FromRotationMatrixToRef(e,t),t},N.FromRotationMatrixToRef=function(e,t){var i=e.m,n=i[0],r=i[4],s=i[8],o=i[1],a=i[5],l=i[9],h=i[2],u=i[6],c=i[10],f=n+a+c,d=0
f>0?(d=.5/Math.sqrt(f+1),t.w=.25/d,t.x=(u-l)*d,t.y=(s-h)*d,t.z=(o-r)*d):n>a&&n>c?(d=2*Math.sqrt(1+n-a-c),t.w=(u-l)/d,t.x=.25*d,t.y=(r+o)/d,t.z=(s+h)/d):a>c?(d=2*Math.sqrt(1+a-n-c),t.w=(s-h)/d,t.x=(r+o)/d,t.y=.25*d,t.z=(l+u)/d):(d=2*Math.sqrt(1+c-n-a),t.w=(o-r)/d,t.x=(s+h)/d,t.y=(l+u)/d,t.z=.25*d)},N.Inverse=function(e){return new N(-e.x,-e.y,-e.z,e.w)},N.RotationAxis=function(e,t){var i=new N,n=Math.sin(t/2)
return i.w=Math.cos(t/2),i.x=e.x*n,i.y=e.y*n,i.z=e.z*n,i},N.FromArray=function(e,t){return null==t&&(t=0),new N(e[t],e[t+1],e[t+2],e[t+3])},N.RotationYawPitchRoll=function(e,t,i){var n=new N
return N.RotationYawPitchRollToRef(e,t,i,n),n},N.RotationYawPitchRollToRef=function(e,t,i,n){var r=.5*i,s=.5*t,o=.5*e,a=Math.sin(r),l=Math.cos(r),h=Math.sin(s),u=Math.cos(s),c=Math.sin(o),f=Math.cos(o)
n.x=f*h*l+c*u*a,n.y=c*u*l-f*h*a,n.z=f*u*a-c*h*l,n.w=f*u*l+c*h*a},N.Slerp=function(e,t,i){var n=0,r=0,s=i,o=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,a=!1
if(0>o&&(a=!0,o=-o),o>.999999)r=1-s,n=a?-s:s
else{var l=Math.acos(o),h=1/Math.sin(l)
r=Math.sin((1-s)*l)*h,n=a?-Math.sin(s*l)*h:Math.sin(s*l)*h}return new N(r*e.x+n*t.x,r*e.y+n*t.y,r*e.z+n*t.z,r*e.w+n*t.w)},N.prototype={x:null,y:null,z:null,w:null,toString:function(){return"{X:"+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},asArray:function(){return[this.x,this.y,this.z,this.w]},set:function(e,t,i,n){null==n&&(n=1),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i,this.w=n},equals:function(e){return null!=e&&this.x==e.x&&this.y==e.y&&this.z==e.z&&this.w==e.w},clone:function(){return new N(this.x,this.y,this.z,this.w)},copyFrom:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},copyFromFloats:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},add:function(e){return new N(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},subtract:function(e){return new N(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},scale:function(e){return new N(this.x*e,this.y*e,this.z*e,this.w*e)},multiply:function(e){var t=new N(0,0,0,1)
return t.x=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,t.y=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,t.z=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,t.w=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w,t},multiplyToRef:function(e,t){t.x=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,t.y=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,t.z=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,t.w=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)
return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},toEulerAngles:function(){var e=new W(0,0,0)
return this.toEulerAnglesToRef(e),e},toEulerAnglesToRef:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,s=t*i,o=t*n,a=r*i,l=r*n,h=r*t,u=i*n,c=t*t,f=i*i,d=c+f
0!=d&&1!=d?(e.x=Math.atan2(o+a,h-u),e.y=Math.acos(1-2*d),e.z=Math.atan2(o-a,h+u)):0==d?(e.x=0,e.y=0,e.z=Math.atan2(s-l,.5-f-n*n)):(e.x=Math.atan2(s-l,.5-f-n*n),e.y=Math.PI,e.z=0)},toRotationMatrix:function(e){var t=this.x*this.x,i=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,o=this.z*this.x,a=this.y*this.w,l=this.y*this.z,h=this.x*this.w
e.m[0]=1-2*(i+n),e.m[1]=2*(r+s),e.m[2]=2*(o-a),e.m[3]=0,e.m[4]=2*(r-s),e.m[5]=1-2*(n+t),e.m[6]=2*(l+h),e.m[7]=0,e.m[8]=2*(o+a),e.m[9]=2*(l-h),e.m[10]=1-2*(i+t),e.m[11]=0,e.m[12]=0,e.m[13]=0,e.m[14]=0,e.m[15]=1},fromRotationMatrix:function(e){return N.FromRotationMatrixToRef(e,this),this},__class__:N}
var U=t.BABYLON.Matrix=function(){this.m=new Float32Array(16)}
s["com.babylonhx.math.Matrix"]=U,U.__name__=["com","babylonhx","math","Matrix"],U.FromArray=function(e,t){null==t&&(t=0)
var i=new U
return U.FromArrayToRef(e,t,i),i},U.FromArrayToRef=function(e,t,i){for(var n=0;16>n;){var r=n++
i.m[r]=e[r+t]}},U.FromValuesToRef=function(e,t,i,n,r,s,o,a,l,h,u,c,f,d,m,_,p){p.m[0]=e,p.m[1]=t,p.m[2]=i,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=o,p.m[7]=a,p.m[8]=l,p.m[9]=h,p.m[10]=u,p.m[11]=c,p.m[12]=f,p.m[13]=d,p.m[14]=m,p.m[15]=_},U.FromValues=function(e,t,i,n,r,s,o,a,l,h,u,c,f,d,m,_){var p=new U
return p.m[0]=e,p.m[1]=t,p.m[2]=i,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=o,p.m[7]=a,p.m[8]=l,p.m[9]=h,p.m[10]=u,p.m[11]=c,p.m[12]=f,p.m[13]=d,p.m[14]=m,p.m[15]=_,p},U.Compose=function(e,t,i){var n=U.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),r=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)
return t.toRotationMatrix(r),n=n.multiply(r),n.m[12]=i.x,n.m[13]=i.y,n.m[14]=i.z,n},U.Identity=function(){return U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},U.IdentityToRef=function(e){U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},U.Zero=function(){return U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},U.RotationX=function(e){var t=new U
return U.RotationXToRef(e,t),t},U.Invert=function(e){var t=new U
return e.invertToRef(t),t},U.RotationXToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e)
t.m[0]=1,t.m[15]=1,t.m[5]=n,t.m[10]=n,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},U.RotationY=function(e){var t=new U
return U.RotationYToRef(e,t),t},U.RotationYToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e)
t.m[5]=1,t.m[15]=1,t.m[0]=n,t.m[2]=-i,t.m[8]=i,t.m[10]=n,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},U.RotationZ=function(e){var t=new U
return U.RotationZToRef(e,t),t},U.RotationZToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e)
t.m[10]=1,t.m[15]=1,t.m[0]=n,t.m[1]=i,t.m[4]=-i,t.m[5]=n,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},U.RotationAxis=function(e,t){var i=Math.sin(-t),n=Math.cos(-t),r=1-n
e.normalize()
var s=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return s.m[0]=e.x*e.x*r+n,s.m[1]=e.x*e.y*r-e.z*i,s.m[2]=e.x*e.z*r+e.y*i,s.m[3]=0,s.m[4]=e.y*e.x*r+e.z*i,s.m[5]=e.y*e.y*r+n,s.m[6]=e.y*e.z*r-e.x*i,s.m[7]=0,s.m[8]=e.z*e.x*r-e.y*i,s.m[9]=e.z*e.y*r+e.x*i,s.m[10]=e.z*e.z*r+n,s.m[11]=0,s.m[15]=1,s},U.RotationYawPitchRoll=function(e,t,i){var n=new U
return N.RotationYawPitchRollToRef(e,t,i,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(n),n},U.RotationYawPitchRollToRef=function(e,t,i,n){N.RotationYawPitchRollToRef(e,t,i,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(n)},U.Scaling=function(e,t,i){var n=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return n.m[0]=e,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=t,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=i,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1,n},U.ScalingToRef=function(e,t,i,n){n.m[0]=e,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=t,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=i,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},U.Translation=function(e,t,i){var n=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)
return U.TranslationToRef(e,t,i,n),n},U.TranslationToRef=function(e,t,i,n){U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,n)},U.LookAtLH=function(e,t,i){var n=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return U.LookAtLHToRef(e,t,i,n),n},U.LookAtLHToRef=function(e,t,i,n){t.subtractToRef(e,U._zAxis),U._zAxis.normalize(),W.CrossToRef(i,U._zAxis,U._xAxis),U._xAxis.normalize(),W.CrossToRef(U._zAxis,U._xAxis,U._yAxis),U._yAxis.normalize()
var r=-W.Dot(U._xAxis,e),s=-W.Dot(U._yAxis,e),o=-W.Dot(U._zAxis,e)
U.FromValuesToRef(U._xAxis.x,U._yAxis.x,U._zAxis.x,0,U._xAxis.y,U._yAxis.y,U._zAxis.y,0,U._xAxis.z,U._yAxis.z,U._zAxis.z,0,r,s,o,1,n)},U.OrthoLH=function(e,t,i,n){var r=2/e,s=2/t,o=1/(n-i),a=i/(i-n)
return U.FromValues(r,0,0,0,0,s,0,0,0,0,o,0,0,0,a,1)},U.OrthoOffCenterLH=function(e,t,i,n,r,s){var o=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return U.OrthoOffCenterLHToRef(e,t,i,n,r,s,o),o},U.OrthoOffCenterLHToRef=function(e,t,i,n,r,s,o){o.m[0]=2/(t-e),o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2/(n-i),o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-1/(r-s),o.m[8]=o.m[9]=o.m[11]=0,o.m[12]=(e+t)/(e-t),o.m[13]=(n+i)/(i-n),o.m[14]=r/(r-s),o.m[15]=1},U.PerspectiveLH=function(e,t,i,n){var r=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return r.m[0]=2*i/e,r.m[1]=r.m[2]=r.m[3]=0,r.m[5]=2*i/t,r.m[4]=r.m[6]=r.m[7]=0,r.m[10]=-n/(i-n),r.m[8]=r.m[9]=0,r.m[11]=1,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=i*n/(i-n),r},U.PerspectiveFovLH=function(e,t,i,n){var r=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
return U.PerspectiveFovLHToRef(e,t,i,n,r),r},U.PerspectiveFovLHToRef=function(e,t,i,n,r,s){var o=1/Math.tan(.5*e),a=null==s||0==s,l=1==s
a?r.m[0]=o/t:l&&(r.m[0]=o),r.m[1]=r.m[2]=r.m[3]=0,a?r.m[5]=o:l&&(r.m[5]=o*t),r.m[4]=r.m[6]=r.m[7]=0,r.m[8]=r.m[9]=0,r.m[10]=-n/(i-n),r.m[11]=1,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=i*n/(i-n)},U.GetFinalMatrix=function(e,t,i,n,r,s){var o=e.width,a=e.height,l=e.x,h=e.y,u=U.FromValues(o/2,0,0,0,0,-a/2,0,0,0,0,s-r,0,l+o/2,a/2+h,r,1)
return t.multiply(i).multiply(n).multiply(u)},U.Transpose=function(e){var t=new U
return t.m[0]=e.m[0],t.m[1]=e.m[4],t.m[2]=e.m[8],t.m[3]=e.m[12],t.m[4]=e.m[1],t.m[5]=e.m[5],t.m[6]=e.m[9],t.m[7]=e.m[13],t.m[8]=e.m[2],t.m[9]=e.m[6],t.m[10]=e.m[10],t.m[11]=e.m[14],t.m[12]=e.m[3],t.m[13]=e.m[7],t.m[14]=e.m[11],t.m[15]=e.m[15],t},U.Reflection=function(e){var t=new U
return U.ReflectionToRef(e,t),t},U.ReflectionToRef=function(e,t){e.normalize()
var i=e.normal.x,n=e.normal.y,r=e.normal.z,s=-2*i,o=-2*n,a=-2*r
t.m[0]=s*i+1,t.m[1]=o*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=s*n,t.m[5]=o*n+1,t.m[6]=a*n,t.m[7]=0,t.m[8]=s*r,t.m[9]=o*r,t.m[10]=a*r+1,t.m[11]=0,t.m[12]=s*e.d,t.m[13]=o*e.d,t.m[14]=a*e.d,t.m[15]=1},U.prototype={m:null,toString:function(){for(var e="[",t=0,i=this.m;t<i.length;){var n=i[t];++t,e+=n+", "}return e+"]"},isIdentity:function(){return 1!=this.m[0]||1!=this.m[5]||1!=this.m[10]||1!=this.m[15]?!1:0!=this.m[1]||0!=this.m[2]||0!=this.m[3]||0!=this.m[4]||0!=this.m[6]||0!=this.m[7]||0!=this.m[8]||0!=this.m[9]||0!=this.m[11]||0!=this.m[12]||0!=this.m[13]||0!=this.m[14]?!1:!0},determinant:function(){var e=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],i=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12]
return this.m[0]*(this.m[5]*e-this.m[6]*t+this.m[7]*i)-this.m[1]*(this.m[4]*e-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*t-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*i-this.m[5]*r+this.m[6]*s)},toArray:function(){return this.m},asArray:function(){return this.toArray()},invert:function(){return this.invertToRef(this),this},invertToRef:function(e){var t=this.m[0],i=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],o=this.m[5],a=this.m[6],l=this.m[7],h=this.m[8],u=this.m[9],c=this.m[10],f=this.m[11],d=this.m[12],m=this.m[13],_=this.m[14],p=this.m[15],v=c*p-f*_,g=u*p-f*m,x=u*_-c*m,y=h*p-f*d,b=h*_-c*d,w=h*m-u*d,S=o*v-a*g+l*x,M=-(s*v-a*y+l*b),T=s*g-o*y+l*w,C=-(s*x-o*b+a*w),A=1/(t*S+i*M+n*T+r*C),I=a*p-l*_,P=o*p-l*m,E=o*_-a*m,D=s*p-l*d,L=s*_-a*d,F=s*m-o*d,R=a*f-l*c,z=o*f-l*u,B=o*c-a*u,O=s*f-l*h,k=s*c-a*h,V=s*u-o*h
e.m[0]=S*A,e.m[4]=M*A,e.m[8]=T*A,e.m[12]=C*A,e.m[1]=-(i*v-n*g+r*x)*A,e.m[5]=(t*v-n*y+r*b)*A,e.m[9]=-(t*g-i*y+r*w)*A,e.m[13]=(t*x-i*b+n*w)*A,e.m[2]=(i*I-n*P+r*E)*A,e.m[6]=-(t*I-n*D+r*L)*A,e.m[10]=(t*P-i*D+r*F)*A,e.m[14]=-(t*E-i*L+n*F)*A,e.m[3]=-(i*R-n*z+r*B)*A,e.m[7]=(t*R-n*O+r*k)*A,e.m[11]=-(t*z-i*O+r*V)*A,e.m[15]=(t*B-i*k+n*V)*A},setTranslation:function(e){this.m[12]=e.x,this.m[13]=e.y,this.m[14]=e.z},multiply:function(e){var t=new U
return this.multiplyToRef(e,t),t},copyFrom:function(e){for(var t=0;16>t;){var i=t++
this.m[i]=e.m[i]}},copyToArray:function(e,t){null==t&&(t=0)
for(var i=0;16>i;){var n=i++
e[t+n]=this.m[n]}},multiplyToRef:function(e,t){this.multiplyToArray(e,t.m,0)},multiplyToArray:function(e,t,i){t[i]=this.m[0]*e.m[0]+this.m[1]*e.m[4]+this.m[2]*e.m[8]+this.m[3]*e.m[12],t[i+1]=this.m[0]*e.m[1]+this.m[1]*e.m[5]+this.m[2]*e.m[9]+this.m[3]*e.m[13],t[i+2]=this.m[0]*e.m[2]+this.m[1]*e.m[6]+this.m[2]*e.m[10]+this.m[3]*e.m[14],t[i+3]=this.m[0]*e.m[3]+this.m[1]*e.m[7]+this.m[2]*e.m[11]+this.m[3]*e.m[15],t[i+4]=this.m[4]*e.m[0]+this.m[5]*e.m[4]+this.m[6]*e.m[8]+this.m[7]*e.m[12],t[i+5]=this.m[4]*e.m[1]+this.m[5]*e.m[5]+this.m[6]*e.m[9]+this.m[7]*e.m[13],t[i+6]=this.m[4]*e.m[2]+this.m[5]*e.m[6]+this.m[6]*e.m[10]+this.m[7]*e.m[14],t[i+7]=this.m[4]*e.m[3]+this.m[5]*e.m[7]+this.m[6]*e.m[11]+this.m[7]*e.m[15],t[i+8]=this.m[8]*e.m[0]+this.m[9]*e.m[4]+this.m[10]*e.m[8]+this.m[11]*e.m[12],t[i+9]=this.m[8]*e.m[1]+this.m[9]*e.m[5]+this.m[10]*e.m[9]+this.m[11]*e.m[13],t[i+10]=this.m[8]*e.m[2]+this.m[9]*e.m[6]+this.m[10]*e.m[10]+this.m[11]*e.m[14],t[i+11]=this.m[8]*e.m[3]+this.m[9]*e.m[7]+this.m[10]*e.m[11]+this.m[11]*e.m[15],t[i+12]=this.m[12]*e.m[0]+this.m[13]*e.m[4]+this.m[14]*e.m[8]+this.m[15]*e.m[12],t[i+13]=this.m[12]*e.m[1]+this.m[13]*e.m[5]+this.m[14]*e.m[9]+this.m[15]*e.m[13],t[i+14]=this.m[12]*e.m[2]+this.m[13]*e.m[6]+this.m[14]*e.m[10]+this.m[15]*e.m[14],t[i+15]=this.m[12]*e.m[3]+this.m[13]*e.m[7]+this.m[14]*e.m[11]+this.m[15]*e.m[15]},equals:function(e){return null!=e&&this.m[0]==e.m[0]&&this.m[1]==e.m[1]&&this.m[2]==e.m[2]&&this.m[3]==e.m[3]&&this.m[4]==e.m[4]&&this.m[5]==e.m[5]&&this.m[6]==e.m[6]&&this.m[7]==e.m[7]&&this.m[8]==e.m[8]&&this.m[9]==e.m[9]&&this.m[10]==e.m[10]&&this.m[11]==e.m[11]&&this.m[12]==e.m[12]&&this.m[13]==e.m[13]&&this.m[14]==e.m[14]&&this.m[15]==e.m[15]},clone:function(){return U.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},decompose:function(e,t,i){i.x=this.m[12],i.y=this.m[13],i.z=this.m[14]
var n
n=Oe.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1
var r
r=Oe.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1
var s
if(s=Oe.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1,e.x=n*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),e.y=r*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),e.z=s*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0==e.x||0==e.y||0==e.z)return t.x=0,t.y=0,t.z=0,t.w=1,!1
var o=U.FromValues(this.m[0]/e.x,this.m[1]/e.x,this.m[2]/e.x,0,this.m[4]/e.y,this.m[5]/e.y,this.m[6]/e.y,0,this.m[8]/e.z,this.m[9]/e.z,this.m[10]/e.z,0,0,0,0,1)
return N.FromRotationMatrixToRef(o,t),!0},__class__:U}
var W=t.BABYLON.Vector3=function(e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i}
s["com.babylonhx.math.Vector3"]=W,W.__name__=["com","babylonhx","math","Vector3"],W.GetClipFactor=function(e,t,i,n){var r=e.x*i.x+e.y*i.y+e.z*i.z-n,s=t.x*i.x+t.y*i.y+t.z*i.z-n,o=r/(r-s)
return o},W.FromArray=function(e,t){return null==t&&(t=0),new W(e[t],e[t+1],e[t+2])},W.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},W.FromFloatArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},W.FromFloatsToRef=function(e,t,i,n){n.x=e,n.y=t,n.z=i},W.Zero=function(){return new W(0,0,0)},W.Up=function(){return new W(0,1,0)},W.TransformCoordinates=function(e,t){var i=new W(0,0,0)
return W.TransformCoordinatesToRef(e,t,i),i},W.TransformCoordinatesToRef=function(e,t,i){var n=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8]+t.m[12],r=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9]+t.m[13],s=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]+t.m[14],o=e.x*t.m[3]+e.y*t.m[7]+e.z*t.m[11]+t.m[15]
i.x=n/o,i.y=r/o,i.z=s/o},W.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,r){var s=e*n.m[0]+t*n.m[4]+i*n.m[8]+n.m[12],o=e*n.m[1]+t*n.m[5]+i*n.m[9]+n.m[13],a=e*n.m[2]+t*n.m[6]+i*n.m[10]+n.m[14],l=e*n.m[3]+t*n.m[7]+i*n.m[11]+n.m[15]
r.x=s/l,r.y=o/l,r.z=a/l},W.TransformNormal=function(e,t){var i=new W(0,0,0)
return i.x=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],i.y=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],i.z=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10],i},W.TransformNormalToRef=function(e,t,i){i.x=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],i.y=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],i.z=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]},W.TransformNormalFromFloatsToRef=function(e,t,i,n,r){r.x=e*n.m[0]+t*n.m[4]+i*n.m[8],r.y=e*n.m[1]+t*n.m[5]+i*n.m[9],r.z=e*n.m[2]+t*n.m[6]+i*n.m[10]},W.CatmullRom=function(e,t,i,n,r){var s=r*r,o=r*s,a=.5*(2*t.x+(-e.x+i.x)*r+(2*e.x-5*t.x+4*i.x-n.x)*s+(-e.x+3*t.x-3*i.x+n.x)*o),l=.5*(2*t.y+(-e.y+i.y)*r+(2*e.y-5*t.y+4*i.y-n.y)*s+(-e.y+3*t.y-3*i.y+n.y)*o),h=.5*(2*t.z+(-e.z+i.z)*r+(2*e.z-5*t.z+4*i.z-n.z)*s+(-e.z+3*t.z-3*i.z+n.z)*o)
return new W(a,l,h)},W.Clamp=function(e,t,i){var n=e.x
n=n>i.x?i.x:n,n=n<t.x?t.x:n
var r=e.y
r=r>i.y?i.y:r,r=r<t.y?t.y:r
var s=e.z
return s=s>i.z?i.z:s,s=s<t.z?t.z:s,new W(n,r,s)},W.Hermite=function(e,t,i,n,r){var s=r*r,o=r*s,a=2*o-3*s+1,l=-2*o+3*s,h=o-2*s+r,u=o-s,c=e.x*a+i.x*l+t.x*h+n.x*u,f=e.y*a+i.y*l+t.y*h+n.y*u,d=e.z*a+i.z*l+t.z*h+n.z*u
return new W(c,f,d)},W.Lerp=function(e,t,i){var n=e.x+(t.x-e.x)*i,r=e.y+(t.y-e.y)*i,s=e.z+(t.z-e.z)*i
return new W(n,r,s)},W.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},W.Cross=function(e,t){var i=new W(0,0,0)
return i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x,i},W.CrossToRef=function(e,t,i){i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x},W.Normalize=function(e){var t=new W(0,0,0)
return t.x=e.x,t.y=e.y,t.z=e.z,t.normalize(),t},W.NormalizeToRef=function(e,t){t.x=e.x,t.y=e.y,t.z=e.z,t.normalize()},W.Project=function(e,t,i,n){var r=n.width,s=n.height,o=n.x,a=n.y,l=U.FromValues(r/2,0,0,0,0,-s/2,0,0,0,0,1,0,o+r/2,s/2+a,0,1),h=t.multiply(i).multiply(l)
return W.TransformCoordinates(e,h)},W.Unproject=function(e,t,i,n,r,s){W.Unproject_matrix=n.multiply(r).multiply(s),W.Unproject_matrix.invert(),e.x=e.x/t*2-1,e.y=-(e.y/i*2-1)
var o=W.TransformCoordinates(e,W.Unproject_matrix),a=e.x*W.Unproject_matrix.m[3]+e.y*W.Unproject_matrix.m[7]+e.z*W.Unproject_matrix.m[11]+W.Unproject_matrix.m[15]
return Oe.WithinEpsilon(a,1,null)&&(o=o.scale(1/a)),o},W.Minimize=function(e,t){var i=new W(e.x,e.y,e.z)
return t.x<i.x&&(i.x=t.x),t.y<i.y&&(i.y=t.y),t.z<i.z&&(i.z=t.z),i},W.Maximize=function(e,t){var i=new W(e.x,e.y,e.z)
return t.x>i.x&&(i.x=t.x),t.y>i.y&&(i.y=t.y),t.z>i.z&&(i.z=t.z),i},W.Distance=function(e,t){return Math.sqrt(W.DistanceSquared(e,t))},W.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z
return i*i+n*n+r*r},W.Center=function(e,t){var i=new W(e.x+t.x,e.y+t.y,e.z+t.z)
return i.x*=.5,i.y*=.5,i.z*=.5,i},W.prototype={x:null,y:null,z:null,toString:function(){return"{X:"+this.x+" Y:"+this.y+" Z:"+this.z+"}"},asArray:function(){var e=[]
return e[0]=this.x,e[1]=this.y,e[2]=this.z,e},set:function(e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i},toArray:function(e,t){null==t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z},toQuaternion:function(){var e=new N(0,0,0,1),t=Math.cos(.5*(this.x+this.z)),i=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),o=Math.sin(.5*this.y)
return e.x=n*o,e.y=-r*o,e.z=i*s,e.w=t*s,e},addInPlace:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},add:function(e){return new W(this.x+e.x,this.y+e.y,this.z+e.z)},addToRef:function(e,t){t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z},subtractInPlace:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subtract:function(e){return new W(this.x-e.x,this.y-e.y,this.z-e.z)},subtractToRef:function(e,t){t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z},subtractFromFloats:function(e,t,i){return new W(this.x-e,this.y-t,this.z-i)},subtractFromFloatsToRef:function(e,t,i,n){n.x=this.x-e,n.y=this.y-t,n.z=this.z-i},negate:function(){return new W(-this.x,-this.y,-this.z)},scaleInPlace:function(e){return this.x*=e,this.y*=e,this.z*=e,this},scale:function(e){return new W(this.x*e,this.y*e,this.z*e)},scaleToRef:function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e},equals:function(e){return null!=e&&this.x==e.x&&this.y==e.y&&this.z==e.z},equalsWithEpsilon:function(e){return Math.abs(this.x-e.x)<M.Epsilon&&Math.abs(this.y-e.y)<M.Epsilon&&Math.abs(this.z-e.z)<M.Epsilon},equalsToFloats:function(e,t,i){return this.x==e&&this.y==t&&this.z==i},multiplyInPlace:function(e){this.x*=e.x,this.y*=e.y,this.z*=e.z},multiply:function(e){return new W(this.x*e.x,this.y*e.y,this.z*e.z)},multiplyToRef:function(e,t){t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z},multiplyByFloats:function(e,t,i){return new W(this.x*e,this.y*t,this.z*i)},divide:function(e){return new W(this.x/e.x,this.y/e.y,this.z/e.z)},divideToRef:function(e,t){t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z},MinimizeInPlace:function(e){e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z)},MaximizeInPlace:function(e){e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)
if(0==e)return this
var t=1/e
return this.x*=t,this.y*=t,this.z*=t,this},clone:function(){return new W(this.x,this.y,this.z)},copyFrom:function(e){this.x=e.x,this.y=e.y,this.z=e.z},copyFromFloats:function(e,t,i){this.x=e,this.y=t,this.z=i},__class__:W}
var G=t.BABYLON.Animation=function(e,t,i,n,r){null==r&&(r=-1),this._stopped=!1,this._highLimitsCache=[],this._offsetsCache=[],this.name=e,this.targetProperty=t,this.targetPropertyPath=t.split("."),this.framePerSecond=i,this.dataType=n,-1==r?this.loopMode=G.ANIMATIONLOOPMODE_CYCLE:this.loopMode=r}
s["com.babylonhx.animations.Animation"]=G,G.__name__=["com","babylonhx","animations","Animation"],G.CreateAndStartAnimation=function(e,t,i,n,r,s,o,a){var l=-1
if("number"==typeof s?l=G.ANIMATIONTYPE_FLOAT:Me.__instanceof(s,N)?l=G.ANIMATIONTYPE_QUATERNION:Me.__instanceof(s,W)?l=G.ANIMATIONTYPE_VECTOR3:Me.__instanceof(s,Et)?l=G.ANIMATIONTYPE_VECTOR2:Me.__instanceof(s,Re)&&(l=G.ANIMATIONTYPE_COLOR3),-1==l)return null
var h=new G(e,i,n,l,a),u=[]
return u.push({frame:0,value:s}),u.push({frame:r,value:o}),h.setKeys(u),t.animations.push(h),t._scene.beginAnimation(t,0,r,1==h.loopMode)},G.prototype={_keys:null,_offsetsCache:null,_highLimitsCache:null,_stopped:null,_easingFunction:null,_target:null,name:null,targetProperty:null,targetPropertyPath:null,framePerSecond:null,dataType:null,loopMode:null,currentFrame:null,isStopped:function(){return this._stopped},getKeys:function(){return this._keys},getEasingFunction:function(){return this._easingFunction},setEasingFunction:function(e){this._easingFunction=e},floatInterpolateFunction:function(e,t,i){return e+(t-e)*i},quaternionInterpolateFunction:function(e,t,i){return N.Slerp(e,t,i)},vector3InterpolateFunction:function(e,t,i){return W.Lerp(e,t,i)},vector2InterpolateFunction:function(e,t,i){return Et.Lerp(e,t,i)},color3InterpolateFunction:function(e,t,i){return Re.Lerp(e,t,i)},matrixInterpolateFunction:function(e,t,i){G.matrixInterpolateFunction_startScale.set(0,0,0),G.matrixInterpolateFunction_startRotation.set(null,null,null,null),G.matrixInterpolateFunction_startTranslation.set(0,0,0),e.decompose(G.matrixInterpolateFunction_startScale,G.matrixInterpolateFunction_startRotation,G.matrixInterpolateFunction_startTranslation),G.matrixInterpolateFunction_endScale.set(0,0,0),G.matrixInterpolateFunction_endRotation.set(null,null,null,null),G.matrixInterpolateFunction_endTranslation.set(0,0,0),t.decompose(G.matrixInterpolateFunction_endScale,G.matrixInterpolateFunction_endRotation,G.matrixInterpolateFunction_endTranslation)
var n=W.Lerp(G.matrixInterpolateFunction_startScale,G.matrixInterpolateFunction_endScale,i),r=N.Slerp(G.matrixInterpolateFunction_startRotation,G.matrixInterpolateFunction_endRotation,i),s=W.Lerp(G.matrixInterpolateFunction_startTranslation,G.matrixInterpolateFunction_endTranslation,i)
return U.Compose(n,r,s)},clone:function(){var e=new G(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode)
return e.setKeys(this._keys),e},setKeys:function(e){this._keys=e.slice(0),this._offsetsCache=[],this._highLimitsCache=[]},_interpolate:function(e,t,i,n,r){if(i==G.ANIMATIONLOOPMODE_CONSTANT&&t>0&&null!=r)return null!=r.clone?r.clone():r
this.currentFrame=e
var s=g["int"](Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(e-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1)))
if(this._keys[s].frame>=e)for(;s-1>=0&&this._keys[s].frame>=e;)s--
for(var o=s,a=this._keys.length;a>o;){var l=o++
if(null!=this._keys[l+1]&&this._keys[l+1].frame>=e){var h=this._keys[l].value,u=this._keys[l+1].value,c=(e-this._keys[l].frame)/(this._keys[l+1].frame-this._keys[l].frame)
null!=this._easingFunction&&(c=this._easingFunction.ease(c))
var f=this.dataType
switch(f){case 0:switch(i){case 1:case 2:return this.floatInterpolateFunction(h,u,c)
case 0:return n*t+this.floatInterpolateFunction(h,u,c)}break
case 2:var d=null
switch(i){case 1:case 2:d=N.Slerp(h,u,c)
break
case 0:d=N.Slerp(h,u,c).add(n.scale(t))}return d
case 1:switch(i){case 1:case 2:return W.Lerp(h,u,c)
case 0:return W.Lerp(h,u,c).add(n.scale(t))}break
case 5:switch(i){case 1:case 2:return Et.Lerp(h,u,c)
case 0:return Et.Lerp(h,u,c).add(n.scale(t))}break
case 4:switch(i){case 1:case 2:return Re.Lerp(h,u,c)
case 0:return Re.Lerp(h,u,c).add(n.scale(t))}break
case 3:switch(i){case 1:case 2:case 0:return h}}}}return this._keys[this._keys.length-1].value},animate:function(e,t,i,n,r){if(null==this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1
var s=!0
if(0!=this._keys[0].frame){var o={frame:0,value:this._keys[0].value}
this._keys.unshift(o)}(t<this._keys[0].frame||t>this._keys[this._keys.length-1].frame)&&(t=this._keys[0].frame),(i<this._keys[0].frame||i>this._keys[this._keys.length-1].frame)&&(i=this._keys[this._keys.length-1].frame)
var a=i-t,l=null,h=e*this.framePerSecond*r/1e3,u=null
if(h>a&&!n)s=!1,u=this._keys[this._keys.length-1].value
else if(u=0,this.loopMode!=G.ANIMATIONLOOPMODE_CYCLE){var c=i+t
if(this._offsetsCache.length>c){var f=this._interpolate(t,0,G.ANIMATIONLOOPMODE_CYCLE),d=this._interpolate(i,0,G.ANIMATIONLOOPMODE_CYCLE),m=this.dataType
switch(m){case 0:this._offsetsCache[c]=d-f
break
case 2:this._offsetsCache[c]=Me.__cast(d,N).subtract(Me.__cast(f,N))
break
case 1:this._offsetsCache[c]=Me.__cast(d,W).subtract(Me.__cast(f,W))
break
case 5:this._offsetsCache[c]=Me.__cast(d,Et).subtract(Me.__cast(f,Et))
break
case 4:this._offsetsCache[c]=Me.__cast(d,Re).subtract(Me.__cast(f,Re))}this._highLimitsCache[c]=d}u=this._highLimitsCache[c],l=this._offsetsCache[c]}if(null==l){var _=this.dataType
switch(_){case 0:l=0
break
case 2:l=new N(0,0,0,0)
break
case 1:l=new W(0,0,0)
break
case 5:l=new Et(0,0)
break
case 4:l=Re.Black()}}var p,g=h/a|0
p=s?t+h%a:i
var x=this._interpolate(p,g,this.loopMode,l,u)
if(this.targetPropertyPath.length>1){for(var y=v.getProperty(this._target,this.targetPropertyPath[0]),b=1,w=this.targetPropertyPath.length-1;w>b;){var S=b++
y=v.getProperty(y,this.targetPropertyPath[S])}v.setProperty(y,this.targetPropertyPath[this.targetPropertyPath.length-1],x)}else v.setProperty(this._target,this.targetPropertyPath[0],x)
return null!=this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty),s||(this._stopped=!0),s},__class__:G}
var Y=t.BABYLON.IAnimatable=function(){}
s["com.babylonhx.animations.IAnimatable"]=Y,Y.__name__=["com","babylonhx","animations","IAnimatable"],Y.prototype={animations:null,__class__:Y}
var H=t.BABYLON.IEasingFunction=function(){}
s["com.babylonhx.animations.easing.IEasingFunction"]=H,H.__name__=["com","babylonhx","animations","easing","IEasingFunction"],H.prototype={ease:null,__class__:H}
var X=t.BABYLON.EasingFunction=function(){this._easingMode=X.EASINGMODE_EASEIN}
s["com.babylonhx.animations.easing.EasingFunction"]=X,X.__name__=["com","babylonhx","animations","easing","EasingFunction"],X.__interfaces__=[H],X.prototype={_easingMode:null,setEasingMode:function(e){var t=Math.min(Math.max(e,0),2)
this._easingMode=t},getEasingMode:function(){return this._easingMode},easeInCore:function(){throw new Wi("You must implement this method")},ease:function(e){var t=this._easingMode
switch(t){case 0:return this.easeInCore(e)
case 1:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)},__class__:X}
var j=t.BABYLON.Bone=function(e,t,i,n){this._invertedAbsoluteTransform=new U,this._absoluteTransform=new U,this._worldTransform=new U,this.animations=[],this.children=[],this.name=e,this._skeleton=t,this._matrix=n,this._baseMatrix=n,t.bones.push(this),null!=i?(this._parent=i,i.children.push(this)):this._parent=null,this._updateDifferenceMatrix()}
s["com.babylonhx.bones.Bone"]=j,j.__name__=["com","babylonhx","bones","Bone"],j.__interfaces__=[Y],j.prototype={name:null,children:null,animations:null,_skeleton:null,_matrix:null,_baseMatrix:null,_worldTransform:null,_absoluteTransform:null,_invertedAbsoluteTransform:null,_parent:null,getParent:function(){return this._parent},getLocalMatrix:function(){return this._matrix},getBaseMatrix:function(){return this._baseMatrix},getWorldMatrix:function(){return this._worldTransform},getInvertedAbsoluteTransform:function(){return this._invertedAbsoluteTransform},getAbsoluteMatrix:function(){for(var e=this._matrix.clone(),t=this._parent;null!=t;)e=e.multiply(t._matrix),t=t._parent
return e},updateMatrix:function(e){this._matrix=e,this._skeleton._isDirty=!0,this._updateDifferenceMatrix()},_updateDifferenceMatrix:function(){null!=this._parent?this._matrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(this._matrix),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform)
for(var e=0,t=this.children.length;t>e;){var i=e++
this.children[i]._updateDifferenceMatrix()}},markAsDirty:function(){this._skeleton._isDirty=!0},__class__:j}
var K=t.BABYLON.Skeleton=function(e,t,i){this._identity=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._isDirty=!0,this.name=e,this.id=t,this.bones=[],this._scene=i,i.skeletons.push(this),this.prepare(),this._isDirty=!0}
s["com.babylonhx.bones.Skeleton"]=K,K.__name__=["com","babylonhx","bones","Skeleton"],K.__interfaces__=[A],K.prototype={id:null,name:null,bones:null,_scene:null,_isDirty:null,_transformMatrices:null,_animatables:null,_identity:null,__smartArrayFlags:null,getTransformMatrices:function(){return this._transformMatrices},_markAsDirty:function(){this._isDirty=!0},prepare:function(){if(this._isDirty){(null==this._transformMatrices||this._transformMatrices.length!=16*(this.bones.length+1))&&(this._transformMatrices=new Float32Array(16*(this.bones.length+1)))
for(var e=0,t=this.bones.length;t>e;){var i=e++,n=this.bones[i],r=n._parent
null!=r?n._matrix.multiplyToRef(r._worldTransform,n._worldTransform):n._worldTransform.copyFrom(n._matrix),n._invertedAbsoluteTransform.multiplyToArray(n._worldTransform,this._transformMatrices,16*i)}this._identity.copyToArray(this._transformMatrices,16*this.bones.length),this._isDirty=!1}},getAnimatables:function(){if(null==this._animatables||this._animatables.length!=this.bones.length){this._animatables=[]
for(var e=0,t=this.bones.length;t>e;){var i=e++
this._animatables.push(this.bones[i])}}return this._animatables},clone:function(e,t){for(var i=new K(e,null!=t?t:e,this._scene),n=0,r=this.bones.length;r>n;){var s=n++,o=this.bones[s],a=null
if(null!=o._parent){var l=c.indexOf(this.bones,o._parent,0)
a=i.bones[l]}for(var h=new j(o.name,i,a,o._baseMatrix),u=0,f=o.animations;u<f.length;){var d=f[u];++u,h.animations.push(d.clone())}}return i},__class__:K}
var Z=t.BABYLON.Camera=function(e,t,i){this._globalPosition=new W(0,0,0),this._activeMeshes=new pi(256),this._postProcessesTakenIndices=[],this._postProcesses=[],this._projectionMatrix=new U,this._computedViewMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this.fovMode=0,this.layerMask=-1,this.subCameras=[],this.viewport=new Dt(0,0,1,1),this.isIntermediate=!1,this.mode=0,this.inertia=.9,this.maxZ=1e4,this.minZ=1,this.fov=.8,this.orthoTop=null,this.orthoBottom=null,this.orthoRight=null,this.orthoLeft=null,this.upVector=new W(0,1,0),this.position=new W(0,0,0),I.call(this,e,i),this.position=t,i.addCamera(this),null==i.activeCamera&&(i.activeCamera=this)}
s["com.babylonhx.cameras.Camera"]=Z,Z.__name__=["com","babylonhx","cameras","Camera"],Z.__super__=I,Z.prototype=i(I.prototype,{position:null,upVector:null,orthoLeft:null,orthoRight:null,orthoBottom:null,orthoTop:null,fov:null,minZ:null,maxZ:null,inertia:null,mode:null,isIntermediate:null,viewport:null,subCameras:null,layerMask:null,fovMode:null,_computedViewMatrix:null,_projectionMatrix:null,_worldMatrix:null,_postProcesses:null,_postProcessesTakenIndices:null,_activeMeshes:null,_globalPosition:null,get_globalPosition:function(){return this._globalPosition},getActiveMeshes:function(){return this._activeMeshes},isActiveMesh:function(e){return-1!=this._activeMeshes.indexOf(e)},_initCache:function(){I.prototype._initCache.call(this),this._cache.position=new W(1/0,1/0,1/0),this._cache.upVector=new W(1/0,1/0,1/0),this._cache.mode=null,this._cache.minZ=null,this._cache.maxZ=null,this._cache.fov=null,this._cache.aspectRatio=null,this._cache.orthoLeft=null,this._cache.orthoRight=null,this._cache.orthoBottom=null,this._cache.orthoTop=null,this._cache.renderWidth=null,this._cache.renderHeight=null},_updateCache:function(e){null==e&&(e=!1),e||I.prototype._updateCache.call(this)
var t=this._scene._engine
this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()},_updateFromScene:function(){this.updateCache(),this._update()},_isSynchronized:function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},_isSynchronizedViewMatrix:function(){return I.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},_isSynchronizedProjectionMatrix:function(){var e=this._cache.mode==this.mode&&this._cache.minZ==this.minZ&&this._cache.maxZ==this.maxZ
if(!e)return!1
var t=this._scene._engine
return e=0==this.mode?this._cache.fov==this.fov&&this._cache.aspectRatio==t.getAspectRatio(this):this._cache.orthoLeft==this.orthoLeft&&this._cache.orthoRight==this.orthoRight&&this._cache.orthoBottom==this.orthoBottom&&this._cache.orthoTop==this.orthoTop&&this._cache.renderWidth==t.getRenderWidth()&&this._cache.renderHeight==t.getRenderHeight()},attachControl:function(){},detachControl:function(){},_update:function(){},attachPostProcess:function(e,t){if(!e.isReusable()&&c.indexOf(this._postProcesses,e,0)>-1)return Ei.trace("You're trying to reuse a post process not defined as reusable.",{fileName:"Camera.hx",lineNumber:185,className:"com.babylonhx.cameras.Camera",methodName:"attachPostProcess"}),0
if(null==t||0>t)return this._postProcesses.push(e),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1
var i=0
if(null!=this._postProcesses[t]){for(var n=this._postProcesses.length-1,r=n;r>=t+1;)this._postProcesses[r+1]=this._postProcesses[r],--r
i=1}for(var s=0,o=this._postProcessesTakenIndices.length;o>s;){var a=s++
if(!(this._postProcessesTakenIndices[a]<t)){for(var l=this._postProcessesTakenIndices.length-1,h=l;h>=a;)this._postProcessesTakenIndices[h+1]=this._postProcessesTakenIndices[h]+i,--h
this._postProcessesTakenIndices[a]=t
break}}0==i&&-1==c.indexOf(this._postProcessesTakenIndices,t,0)&&this._postProcessesTakenIndices.push(t)
var u=t+i
return this._postProcesses[u]=e,u},detachPostProcess:function(e,t){var i=[]
if(null==t)for(var n=0,r=this._postProcesses.length;r>n;){var s=n++
if(this._postProcesses[s]==e){this._postProcesses.splice(s,1)
var o=c.indexOf(this._postProcessesTakenIndices,s,0)
this._postProcessesTakenIndices.splice(o,1)}}else{t=t instanceof Array&&null==t.__enum__?t:[t]
for(var a=0,l=t.length;l>a;){var h=a++,u=this._postProcesses[t[h]]
if(u==e){this._postProcesses.splice(t[h],1)
var f=c.indexOf(this._postProcessesTakenIndices,t[h],0)
this._postProcessesTakenIndices.splice(f,1)}else i.push(h)}}return i},getWorldMatrix:function(){null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))
var e=this.getViewMatrix()
return e.invertToRef(this._worldMatrix),this._worldMatrix},_getViewMatrix:function(){return U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},getViewMatrix:function(e){return null==e&&(e=!1),this._computedViewMatrix=this._computeViewMatrix(e),!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(null==this.parent||null==(Ps=this.parent,r(Ps,Ps.getWorldMatrix))?this._globalPosition.copyFrom(this.position):(null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._parentRenderId=this.parent._currentRenderId),this._currentRenderId=this._scene._renderId,this._computedViewMatrix)},_computeViewMatrix:function(e){return null==e&&(e=!1),!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this._scene._renderId,this._computedViewMatrix)},getProjectionMatrix:function(e){if(null==e&&(e=!1),!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix
var t=this._scene._engine
if(0==this.mode)return this.minZ<=0&&(this.minZ=.1),U.PerspectiveFovLHToRef(this.fov,t.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode),this._projectionMatrix
var i=t.getRenderWidth()/2,n=t.getRenderHeight()/2
return U.OrthoOffCenterLHToRef(null==this.orthoLeft?-i:this.orthoLeft,null==this.orthoRight?i:this.orthoRight,null==this.orthoBottom?-n:this.orthoBottom,null==this.orthoTop?n:this.orthoTop,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},dispose:function(){this._scene.removeCamera(this)
for(var e=0,t=this._postProcessesTakenIndices.length;t>e;){var i=e++
this._postProcesses[this._postProcessesTakenIndices[i]].dispose(this)}},__class__:Z,__properties__:{get_globalPosition:"get_globalPosition"}})
var q=t.BABYLON.ArcRotateCamera=function(e,t,i,n,r,s){this.pinchPrecision=20,this._mouseButtonPressed=0,this._newPosition=new W(0,0,0),this._collisionVelocity=new W(0,0,0),this._previousPosition=new W(0,0,0),this._collider=new ie,this.collisionRadius=new W(.5,.5,.5),this.checkCollisions=!1,this._viewMatrix=new U,this._keys=[],this.pinchInwards=!0,this.targetScreenOffset=new Et(0,0),this.zoomOnFactor=1,this.keysRight=[xi.right],this.keysLeft=[xi.left],this.keysDown=[xi.down],this.keysUp=[xi.up],this.wheelPrecision=5,this.angularSensibility=1e3,this.upperRadiusLimit=null,this.lowerRadiusLimit=null,this.upperBetaLimit=Math.PI,this.lowerBetaLimit=.01,this.upperAlphaLimit=null,this.lowerAlphaLimit=null,this.inertialRadiusOffset=0,this.inertialBetaOffset=0,this.inertialAlphaOffset=0,Z.call(this,e,new W(0,0,0),s),this.alpha=t,this.beta=i,this.radius=n,null!=r?null!=r.position?this.target=r.position.clone():this.target=r.clone():this.target=new W(0,0,0),this.getViewMatrix()}
s["com.babylonhx.cameras.ArcRotateCamera"]=q,q.__name__=["com","babylonhx","cameras","ArcRotateCamera"],q.__super__=Z,q.prototype=i(Z.prototype,{inertialAlphaOffset:null,inertialBetaOffset:null,inertialRadiusOffset:null,lowerAlphaLimit:null,upperAlphaLimit:null,lowerBetaLimit:null,upperBetaLimit:null,lowerRadiusLimit:null,upperRadiusLimit:null,angularSensibility:null,wheelPrecision:null,keysUp:null,keysDown:null,keysLeft:null,keysRight:null,zoomOnFactor:null,targetScreenOffset:null,pinchInwards:null,_keys:null,_viewMatrix:null,_attachedElement:null,_onMouseDown:null,_onMouseUp:null,_onMouseMove:null,_wheel:null,_onKeyDown:null,_onKeyUp:null,_onLostFocus:null,_reset:null,onCollide:null,checkCollisions:null,collisionRadius:null,_collider:null,_previousPosition:null,_collisionVelocity:null,_newPosition:null,_previousAlpha:null,_previousBeta:null,_previousRadius:null,_mouseButtonPressed:null,pinchPrecision:null,_touchStart:null,_touchMove:null,_touchEnd:null,_pinchStart:null,_pinchMove:null,_pinchEnd:null,alpha:null,beta:null,radius:null,target:null,_getTargetPosition:function(){return null!=this.target.position?this.target.position:this.target},_initCache:function(){Z.prototype._initCache.call(this),this._cache.target=new W(1/0,1/0,1/0),this._cache.alpha=null,this._cache.beta=null,this._cache.radius=null,this._cache.targetScreenOffset=null},_updateCache:function(e){null==e&&(e=!1),e||Z.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset=this.targetScreenOffset.clone()},_isSynchronizedViewMatrix:function(){return Z.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha==this.alpha&&this._cache.beta==this.beta&&this._cache.radius==this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},attachControl:function(e){var t=this,i=null,n=-1
if(null==this._attachedElement){this._attachedElement=e
var r=this._scene._engine
null==this._onMouseDown&&(this._onMouseDown=function(e,n,r){t._mouseButtonPressed=r,i={x:e,y:n}},this._onMouseUp=function(){i=null},this._onMouseMove=function(e,n){if(null!=i||r.isPointerLock){var s=0,o=0
r.isPointerLock||(s=e-i.x,o=n-i.y),2!=t._mouseButtonPressed?(t.inertialAlphaOffset-=s/t.angularSensibility,t.inertialBetaOffset-=o/t.angularSensibility):(t.target.x+=s/10,t.target.y+=o/10),i={x:e,y:n}}},this._wheel=function(e){var i=e/t.wheelPrecision
t.inertialRadiusOffset+=i},this._onKeyDown=function(e){if(-1!=c.indexOf(t.keysUp,e,0)||-1!=c.indexOf(t.keysDown,e,0)||-1!=c.indexOf(t.keysLeft,e,0)||-1!=c.indexOf(t.keysRight,e,0)){var i=c.indexOf(t._keys,e,0);-1==i&&t._keys.push(e)}},this._onKeyUp=function(e){if(-1!=c.indexOf(t.keysUp,e,0)||-1!=c.indexOf(t.keysDown,e,0)||-1!=c.indexOf(t.keysLeft,e,0)||-1!=c.indexOf(t.keysRight,e,0)){var i=c.indexOf(t._keys,e,0)
i>=0&&t._keys.splice(i,1)}},this._onLostFocus=function(){t._keys=[],n=0},this._reset=function(){t._keys=[],t.inertialAlphaOffset=0,t.inertialBetaOffset=0,t.inertialRadiusOffset=0,i=null,n=0}),M.keyDown.push(this._onKeyDown),M.keyUp.push(this._onKeyUp),M.mouseDown.push(this._onMouseDown),M.mouseUp.push(this._onMouseUp),M.mouseMove.push(this._onMouseMove),M.mouseWheel.push(this._wheel)}},detachControl:function(e){if(this._attachedElement==e){var t=this._onKeyDown
c.remove(M.keyDown,t)
var i=this._onKeyUp
c.remove(M.keyUp,i)
var n=this._onMouseDown
c.remove(M.mouseDown,n)
var r=this._onMouseUp
c.remove(M.mouseUp,r)
var s=this._onMouseMove
c.remove(M.mouseMove,s)
var o=this._wheel
c.remove(M.mouseWheel,o),this._attachedElement=null,null!=this._reset&&this._reset()}},_update:function(){for(var e=0,t=this._keys.length;t>e;){var i=e++,n=this._keys[i];-1!=c.indexOf(this.keysLeft,n,0)?this.inertialAlphaOffset-=.01:-1!=c.indexOf(this.keysUp,n,0)?this.inertialBetaOffset-=.01:-1!=c.indexOf(this.keysRight,n,0)?this.inertialAlphaOffset+=.01:-1!=c.indexOf(this.keysDown,n,0)&&(this.inertialBetaOffset+=.01)}(0!=this.inertialAlphaOffset||0!=this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<M.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<M.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<M.Epsilon&&(this.inertialRadiusOffset=0)),null!=this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!=this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!=this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!=this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},setPosition:function(e){var t=e.subtract(this._getTargetPosition())
this.radius=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2))),t.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(t.y/this.radius)},_getViewMatrix:function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),i=Math.cos(this.beta),n=Math.sin(this.beta),r=this._getTargetPosition()
return r.addToRef(new W(this.radius*e*n,this.radius*i,this.radius*t*n),this.position),this.checkCollisions&&(this._collider.radius=this.collisionRadius,this.position.subtractToRef(this._previousPosition,this._collisionVelocity),this._scene._getNewPosition(this._previousPosition,this._collisionVelocity,this._collider,3,this._newPosition),this._newPosition.equalsWithEpsilon(this.position)||(this.position.copyFrom(this._previousPosition),this.alpha=this._previousAlpha,this.beta=this._previousBeta,this.radius=this._previousRadius,null!=this.onCollide&&this.onCollide(this._collider.collidedMesh))),U.LookAtLHToRef(this.position,r,this.upVector,this._viewMatrix),this._previousAlpha=this.alpha,this._previousBeta=this.beta,this._previousRadius=this.radius,this._previousPosition.copyFrom(this.position),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y,this._viewMatrix},zoomOn:function(e){e=null!=e?e:this._scene.meshes
var t=qe.MinMax(e),i=Math.sqrt(W.DistanceSquared(t.minimum,t.maximum))
this.radius=i*this.zoomOnFactor,this.focusOn({min:t.minimum,max:t.maximum,distance:i})},focusOn:function(e){var t=null,i=0
null==e.minimum?(t=null!=e?e:this._scene.meshes,t=qe.MinMax(t),i=W.Distance(t.minimum,t.maximum)):(t=e,i=e.distance),this.target.position=qe.Center(t),this.maxZ=2*i},__class__:q})
var Q=t.BABYLON.AnaglyphArcRotateCamera=function(e,t,i,n,r,s,o){q.call(this,e,t,i,n,r,o),this._eyeSpace=s*Math.PI/180,this._leftCamera=new q(e+"_left",t-this._eyeSpace,i,n,r,o),this._rightCamera=new q(e+"_right",t+this._eyeSpace,i,n,r,o),Q.buildCamera(this,e)}
s["com.babylonhx.cameras.AnaglyphArcRotateCamera"]=Q,Q.__name__=["com","babylonhx","cameras","AnaglyphArcRotateCamera"],Q.buildCamera=function(e,t){e._leftCamera.isIntermediate=!0,e.subCameras.push(e._leftCamera),e.subCameras.push(e._rightCamera),e._leftTexture=new ft(t+"_leftTexture",1,e._leftCamera),e._anaglyphPostProcess=new dt(t+"_anaglyph",1,e._rightCamera),e._anaglyphPostProcess.onApply=function(t){t.setTextureFromPostProcess("leftSampler",e._leftTexture)},e._update()},Q.__super__=q,Q.prototype=i(q.prototype,{_eyeSpace:null,_leftCamera:null,_rightCamera:null,_update:function(){this._updateCamera(this._leftCamera),this._updateCamera(this._rightCamera),this._leftCamera.alpha=this.alpha-this._eyeSpace,this._rightCamera.alpha=this.alpha+this._eyeSpace,q.prototype._update.call(this)},_updateCamera:function(e){e.beta=this.beta,e.radius=this.radius,e.minZ=this.minZ,e.maxZ=this.maxZ,e.fov=this.fov,e.target=this.target},__class__:Q})
var J=t.BABYLON.TargetCamera=function(e,t,i){this._tempMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._lookAtTemp=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._transformedReferencePoint=new W(0,0,0),this._referencePoint=new W(0,0,1),this._cameraRotationMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._cameraTransformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._camMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._viewMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._currentTarget=new W(0,0,0),this.lockedTarget=null,this.noRotationConstraint=!1,this.speed=2,this.rotation=new W(0,0,0),this.cameraRotation=new Et(0,0),this.cameraDirection=new W(0,0,0),Z.call(this,e,t,i)}
s["com.babylonhx.cameras.TargetCamera"]=J,J.__name__=["com","babylonhx","cameras","TargetCamera"],J.__super__=Z,J.prototype=i(Z.prototype,{cameraDirection:null,cameraRotation:null,rotation:null,speed:null,noRotationConstraint:null,lockedTarget:null,_currentTarget:null,_viewMatrix:null,_camMatrix:null,_cameraTransformMatrix:null,_cameraRotationMatrix:null,_referencePoint:null,_transformedReferencePoint:null,_lookAtTemp:null,_tempMatrix:null,_reset:null,_waitingLockedTargetId:null,_getLockedTargetPosition:function(){return null==this.lockedTarget?null:null!=this.lockedTarget.position?this.lockedTarget.position:this.lockedTarget},_initCache:function(){Z.prototype._initCache.call(this),this._cache.lockedTarget=new W(1/0,1/0,1/0),this._cache.rotation=new W(1/0,1/0,1/0)},_updateCache:function(e){null==e&&(e=!1),e||Z.prototype._updateCache.call(this)
var t=this._getLockedTargetPosition()
null==t?this._cache.lockedTarget=null:null==this._cache.lockedTarget?this._cache.lockedTarget=new W(t.x,t.y,t.z):this._cache.lockedTarget.copyFrom(t),this._cache.rotation.copyFrom(this.rotation)},_isSynchronizedViewMatrix:function(){if(!Z.prototype._isSynchronizedViewMatrix.call(this))return!1
var e=this._getLockedTargetPosition()
return(null!=this._cache.lockedTarget?this._cache.lockedTarget.equals(e):null==e)&&this._cache.rotation.equals(this.rotation)},_computeLocalCameraSpeed:function(){var e=this._scene._engine
return this.speed*(e.deltaTime/(10*e.fps))},setTarget:function(e){this.upVector.normalize(),U.LookAtLHToRef(this.position,e,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10])
var t=e.subtract(this.position)
t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=-Math.acos(W.Dot(new W(0,1,0),this.upVector))},getTarget:function(){return this._currentTarget},_decideIfNeedsToMove:function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},_updatePosition:function(){this.position.addInPlace(this.cameraDirection)},_update:function(){var e=this._decideIfNeedsToMove(),t=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0
if(e&&this._updatePosition(),t&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var i=Math.PI/2*.95
this.rotation.x>i&&(this.rotation.x=i),this.rotation.x<-i&&(this.rotation.x=-i)}e&&(Math.abs(this.cameraDirection.x)<M.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<M.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<M.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),t&&(Math.abs(this.cameraRotation.x)<M.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<M.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia))},_getViewMatrix:function(){return null==this.lockedTarget?(0!=this.upVector.x||1!=this.upVector.y||0!=this.upVector.z?(U.LookAtLHToRef(new W(0,0,0),this._referencePoint,this.upVector,this._lookAtTemp),N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):(N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(this._cameraRotationMatrix)),W.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)):this._currentTarget.copyFrom(this._getLockedTargetPosition()),U.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},__class__:J})
var $=t.BABYLON.FreeCamera=function(e,t,i){this._newPosition=new W(0,0,0),this._diffPosition=new W(0,0,0),this._oldPosition=new W(0,0,0),this._needMoveForGravity=!0,this._collider=new ie,this._keys=[],this.angularSensibility=2e3,this.applyGravity=!1,this.checkCollisions=!1,this.keysRight=[xi.right,xi.key_d],this.keysLeft=[xi.left,xi.key_a],this.keysDown=[xi.down,xi.key_s],this.keysUp=[xi.up,xi.key_w],this.ellipsoid=new W(.5,1,.5),J.call(this,e,t,i)}
s["com.babylonhx.cameras.FreeCamera"]=$,$.__name__=["com","babylonhx","cameras","FreeCamera"],$.__super__=J,$.prototype=i(J.prototype,{ellipsoid:null,keysUp:null,keysDown:null,keysLeft:null,keysRight:null,checkCollisions:null,applyGravity:null,angularSensibility:null,onCollide:null,_keys:null,_collider:null,_needMoveForGravity:null,_oldPosition:null,_diffPosition:null,_newPosition:null,_attachedElement:null,_localDirection:null,_transformedDirection:null,_onMouseDown:null,_onMouseUp:null,_onMouseOut:null,_onMouseMove:null,_onKeyDown:null,_onKeyUp:null,_onLostFocus:null,attachControl:function(e){var t=this,i=null,n=this._scene._engine
this._attachedElement=e,null==this._onMouseDown&&(this._onMouseDown=function(e,t){i={x:e,y:t}},this._onMouseUp=function(){i=null},this._onMouseOut=function(){i=null,t._keys=[]},this._onMouseMove=function(e,r){if(null!=i||n.isPointerLock){var s=0,o=0
n.isPointerLock||(s=e-i.x,o=r-i.y),t.cameraRotation.y+=s/t.angularSensibility,t.cameraRotation.x+=o/t.angularSensibility,i={x:e,y:r}}},this._onKeyDown=function(e){if(-1!=c.indexOf(t.keysUp,e,0)||-1!=c.indexOf(t.keysDown,e,0)||-1!=c.indexOf(t.keysLeft,e,0)||-1!=c.indexOf(t.keysRight,e,0)){var i=c.indexOf(t._keys,e,0);-1==i&&t._keys.push(e)}},this._onKeyUp=function(e){if(-1!=c.indexOf(t.keysUp,e,0)||-1!=c.indexOf(t.keysDown,e,0)||-1!=c.indexOf(t.keysLeft,e,0)||-1!=c.indexOf(t.keysRight,e,0)){var i=c.indexOf(t._keys,e,0)
i>=0&&t._keys.splice(i,1)}},this._onLostFocus=function(){t._keys=[]},this._reset=function(){t._keys=[],i=null,t.cameraDirection=new W(0,0,0),t.cameraRotation=new Et(0,0)}),M.keyDown.push(this._onKeyDown),M.keyUp.push(this._onKeyUp),M.mouseDown.push(this._onMouseDown),M.mouseUp.push(this._onMouseUp),M.mouseMove.push(this._onMouseMove)},detachControl:function(){var e=this._onKeyDown
c.remove(M.keyDown,e)
var t=this._onKeyUp
c.remove(M.keyUp,t)
var i=this._onMouseDown
c.remove(M.mouseDown,i)
var n=this._onMouseUp
c.remove(M.mouseUp,n)
var r=this._onMouseMove
c.remove(M.mouseMove,r),null!=this._reset&&this._reset()},_collideWithWorld:function(e){var t=null
t=null!=this.parent?W.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid,this._scene._getNewPosition(this._oldPosition,e,this._collider,3,this._newPosition),this._newPosition.subtractToRef(this._oldPosition,this._diffPosition),this._diffPosition.length()>M.CollisionsEpsilon&&(this.position.addInPlace(this._diffPosition),null!=this.onCollide&&this.onCollide(this._collider.collidedMesh))},_checkInputs:function(){null==this._localDirection&&(this._localDirection=new W(0,0,0),this._transformedDirection=new W(0,0,0))
for(var e=0,t=this._keys.length;t>e;){var i=e++,n=this._keys[i],r=this._computeLocalCameraSpeed();-1!=c.indexOf(this.keysLeft,n,0)?this._localDirection.copyFromFloats(-r,0,0):-1!=c.indexOf(this.keysUp,n,0)?this._localDirection.copyFromFloats(0,0,r):-1!=c.indexOf(this.keysRight,n,0)?this._localDirection.copyFromFloats(r,0,0):-1!=c.indexOf(this.keysDown,n,0)&&this._localDirection.copyFromFloats(0,0,-r),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),W.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)}},_decideIfNeedsToMove:function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},_updatePosition:function(){if(this.checkCollisions&&this._scene.collisionsEnabled){if(this._collideWithWorld(this.cameraDirection),this.applyGravity){var e=this.position
this._collideWithWorld(this._scene.gravity),this._needMoveForGravity=0!=W.DistanceSquared(e,this.position)}}else this.position.addInPlace(this.cameraDirection)},_update:function(){this._checkInputs(),J.prototype._update.call(this)},__class__:$})
var ee=t.BABYLON.AnaglyphFreeCamera=function(e,t,i,n){$.call(this,e,t,n),this._eyeSpace=i*Math.PI/180,this._transformMatrix=new U,this._leftCamera=new $(e+"_left",new W(t.x,t.y,t.z),n),this._rightCamera=new $(e+"_right",new W(t.x,t.y,t.z),n),Q.buildCamera(this,e)}
s["com.babylonhx.cameras.AnaglyphFreeCamera"]=ee,ee.__name__=["com","babylonhx","cameras","AnaglyphFreeCamera"],ee.__super__=$,ee.prototype=i($.prototype,{_eyeSpace:null,_leftCamera:null,_rightCamera:null,_transformMatrix:null,_getSubCameraPosition:function(e,t){var i=this.getTarget()
U.Translation(-i.x,-i.y,-i.z).multiplyToRef(U.RotationY(e),this._transformMatrix),this._transformMatrix=this._transformMatrix.multiply(U.Translation(i.x,i.y,i.z)),W.TransformCoordinatesToRef(this.position,this._transformMatrix,t)},_update:function(){this._getSubCameraPosition(-this._eyeSpace,this._leftCamera.position),this._getSubCameraPosition(this._eyeSpace,this._rightCamera.position),this._updateCamera(this._leftCamera),this._updateCamera(this._rightCamera),$.prototype._update.call(this)},_updateCamera:function(e){e.minZ=this.minZ,e.maxZ=this.maxZ,e.fov=this.fov,e.viewport=this.viewport,e.setTarget(this.getTarget())},__class__:ee})
var te=t.BABYLON.FollowCamera=function(e,t,i){this.maxCameraSpeed=20,this.cameraAcceleration=.05,this.heightOffset=4,this.rotationOffset=0,this.radius=12,J.call(this,e,t,i)}
s["com.babylonhx.cameras.FollowCamera"]=te,te.__name__=["com","babylonhx","cameras","FollowCamera"],te.__super__=J,te.prototype=i(J.prototype,{radius:null,rotationOffset:null,heightOffset:null,cameraAcceleration:null,maxCameraSpeed:null,target:null,getRadians:function(e){return e*Math.PI/180},follow:function(e){if(null!=e){var t=0
if(null!=e.rotationQuaternion){var i=new U
e.rotationQuaternion.toRotationMatrix(i),t=Math.atan2(i.m[8],i.m[10])}else t=e.rotation.y
var n=this.getRadians(this.rotationOffset)+t,r=e.position.x+Math.sin(n)*this.radius,s=e.position.z+Math.cos(n)*this.radius,o=r-this.position.x,a=e.position.y+this.heightOffset-this.position.y,l=s-this.position.z,h=o*this.cameraAcceleration*2,u=a*this.cameraAcceleration,c=l*this.cameraAcceleration*2;(h>this.maxCameraSpeed||h<-this.maxCameraSpeed)&&(h=1>h?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=1>u?-this.maxCameraSpeed:this.maxCameraSpeed),(c>this.maxCameraSpeed||c<-this.maxCameraSpeed)&&(c=1>c?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new W(this.position.x+h,this.position.y+u,this.position.z+c),this.setTarget(e.position)}},_update:function(){J.prototype._update.call(this),this.follow(this.target)},__class__:te})
var ie=t.BABYLON.Collider=function(){this._displacementVector=new W(0,0,0),this._slidePlaneNormal=new W(0,0,0),this._destinationPoint=new W(0,0,0),this._baseToVertex=new W(0,0,0),this._edge=new W(0,0,0),this._tempVector4=new W(0,0,0),this._tempVector3=new W(0,0,0),this._tempVector2=new W(0,0,0),this._tempVector=new W(0,0,0),this._planeIntersectionPoint=new W(0,0,0),this._collisionPoint=new W(0,0,0),this.normalizedVelocity=new W(0,0,0),this.velocityWorld=new W(0,0,0),this.basePointWorld=new W(0,0,0),this.retry=0,this.radius=new W(1,1,1)}
s["com.babylonhx.collisions.Collider"]=ie,ie.__name__=["com","babylonhx","collisions","Collider"],ie.intersectBoxAASphere=function(e,t,i,n){return e.x>i.x+n?!1:i.x-n>t.x?!1:e.y>i.y+n?!1:i.y-n>t.y?!1:e.z>i.z+n?!1:i.z-n>t.z?!1:!0},ie.getLowestRoot=function(e,t,i,n){var r=t*t-4*e*i,s={root:0,found:!1}
if(0>r)return s
var o=Math.sqrt(r),a=(-t-o)/(2*e),l=(-t+o)/(2*e)
if(a>l){var h=l
l=a,a=h}return a>0&&n>a?(s.root=a,s.found=!0,s):l>0&&n>l?(s.root=l,s.found=!0,s):s},ie.prototype={radius:null,retry:null,velocity:null,basePoint:null,epsilon:null,collisionFound:null,velocityWorldLength:null,basePointWorld:null,velocityWorld:null,normalizedVelocity:null,initialVelocity:null,initialPosition:null,nearestDistance:null,intersectionPoint:null,collidedMesh:null,_collisionPoint:null,_planeIntersectionPoint:null,_tempVector:null,_tempVector2:null,_tempVector3:null,_tempVector4:null,_edge:null,_baseToVertex:null,_destinationPoint:null,_slidePlaneNormal:null,_displacementVector:null,_initialize:function(e,t,i){this.velocity=t,W.NormalizeToRef(t,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),t.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},_checkPointInTriangle:function(e,t,i,n,r){t.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),W.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4)
var s=W.Dot(this._tempVector4,r)
return 0>s?!1:(n.subtractToRef(e,this._tempVector3),W.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=W.Dot(this._tempVector4,r),0>s?!1:(W.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=W.Dot(this._tempVector4,r),s>=0))},_canDoCollision:function(e,t,i,n){var r=Math.sqrt(W.DistanceSquared(this.basePointWorld,e)),s=Math.max(Math.max(this.radius.x,this.radius.y),this.radius.z)
return r>this.velocityWorldLength+s+t?!1:ie.intersectBoxAASphere(i,n,this.basePointWorld,this.velocityWorldLength+s)?!0:!1},_testTriangle:function(e,t,i,n,r){var s=0,o=!1
null==t._trianglePlanes&&(t._trianglePlanes=[]),null==t._trianglePlanes[e]&&(t._trianglePlanes[e]=new Ye(0,0,0,0),t._trianglePlanes[e].copyFromPoints(i,n,r))
var a=t._trianglePlanes[e]
if(null!=t.getMaterial()||a.isFrontFacingTo(this.normalizedVelocity,0)){var l=W.Dot(this.basePoint,a.normal)+a.d,h=W.Dot(a.normal,this.velocity)
if(0==h){if(Math.abs(l)>=1)return
o=!0,s=0}else{s=(-1-l)/h
var u=(1-l)/h
if(s>u){var c=u
u=s,s=c}if(s>1||0>u)return
0>s&&(s=0),s>1&&(s=1)}this._collisionPoint.copyFromFloats(0,0,0)
var f=!1,d=1
if(o||(this.basePoint.subtractToRef(a.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(s,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,i,n,r,a.normal)&&(f=!0,d=s,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!f){var m=this.velocity.lengthSquared(),_=m
this.basePoint.subtractToRef(i,this._tempVector)
var p=2*W.Dot(this.velocity,this._tempVector),v=this._tempVector.lengthSquared()-1,g=ie.getLowestRoot(_,p,v,d)
g.found&&(d=g.root,f=!0,this._collisionPoint.copyFrom(i)),this.basePoint.subtractToRef(n,this._tempVector),p=2*W.Dot(this.velocity,this._tempVector),v=this._tempVector.lengthSquared()-1,g=ie.getLowestRoot(_,p,v,d),g.found&&(d=g.root,f=!0,this._collisionPoint.copyFrom(n)),this.basePoint.subtractToRef(r,this._tempVector),p=2*W.Dot(this.velocity,this._tempVector),v=this._tempVector.lengthSquared()-1,g=ie.getLowestRoot(_,p,v,d),g.found&&(d=g.root,f=!0,this._collisionPoint.copyFrom(r)),n.subtractToRef(i,this._edge),i.subtractToRef(this.basePoint,this._baseToVertex)
var x=this._edge.lengthSquared(),y=W.Dot(this._edge,this.velocity),b=W.Dot(this._edge,this._baseToVertex)
if(_=x*-m+y*y,p=2*x*W.Dot(this.velocity,this._baseToVertex)-2*y*b,v=x*(1-this._baseToVertex.lengthSquared())+b*b,g=ie.getLowestRoot(_,p,v,d),g.found){var w=(y*g.root-b)/x
w>=0&&1>=w&&(d=g.root,f=!0,this._edge.scaleInPlace(w),i.addToRef(this._edge,this._collisionPoint))}if(r.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),x=this._edge.lengthSquared(),y=W.Dot(this._edge,this.velocity),b=W.Dot(this._edge,this._baseToVertex),_=x*-m+y*y,p=2*x*W.Dot(this.velocity,this._baseToVertex)-2*y*b,v=x*(1-this._baseToVertex.lengthSquared())+b*b,g=ie.getLowestRoot(_,p,v,d),g.found){var S=(y*g.root-b)/x
S>=0&&1>=S&&(d=g.root,f=!0,this._edge.scaleInPlace(S),n.addToRef(this._edge,this._collisionPoint))}if(i.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),x=this._edge.lengthSquared(),y=W.Dot(this._edge,this.velocity),b=W.Dot(this._edge,this._baseToVertex),_=x*-m+y*y,p=2*x*W.Dot(this.velocity,this._baseToVertex)-2*y*b,v=x*(1-this._baseToVertex.lengthSquared())+b*b,g=ie.getLowestRoot(_,p,v,d),g.found){var M=(y*g.root-b)/x
M>=0&&1>=M&&(d=g.root,f=!0,this._edge.scaleInPlace(M),r.addToRef(this._edge,this._collisionPoint))}}if(f){var T=d*this.velocity.length();(!this.collisionFound||T<this.nearestDistance)&&(null==this.intersectionPoint?this.intersectionPoint=this._collisionPoint.clone():this.intersectionPoint.copyFrom(this._collisionPoint),this.nearestDistance=T,this.collisionFound=!0,this.collidedMesh=t._mesh)}}},_collide:function(e,t,i,n,r,s){for(var o=n;r>o;){var a=t[i[o]-s],l=t[i[o+1]-s],h=t[i[o+2]-s]
this._testTriangle(o,e,h,l,a),o+=3}},_getResponse:function(e,t){e.addToRef(t,this._destinationPoint),t.scaleInPlace(this.nearestDistance/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)),this.basePoint.addToRef(t,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(Ye.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,t)},__class__:ie}
var ne=function(){}
s["com.babylonhx.collisions.ICollisionCoordinator"]=ne,ne.__name__=["com","babylonhx","collisions","ICollisionCoordinator"],ne.prototype={getNewPosition:null,init:null,destroy:null,onMeshAdded:null,onMeshUpdated:null,onMeshRemoved:null,onGeometryAdded:null,onGeometryUpdated:null,onGeometryDeleted:null,__class__:ne}
var re=t.BABYLON.CollisionCoordinatorLegacy=function(){this._finalPosition=new W(0,0,0),this._scaledVelocity=new W(0,0,0),this._scaledPosition=new W(0,0,0)}
s["com.babylonhx.collisions.CollisionCoordinatorLegacy"]=re,re.__name__=["com","babylonhx","collisions","CollisionCoordinatorLegacy"],re.__interfaces__=[ne],re.prototype={_scene:null,_scaledPosition:null,_scaledVelocity:null,_finalPosition:null,init:function(e){this._scene=e},destroy:function(){},getNewPosition:function(e,t,i,n,r,s,o){e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,n,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(o,this._finalPosition,i.collidedMesh)},onMeshAdded:function(){},onMeshUpdated:function(){},onMeshRemoved:function(){},onGeometryAdded:function(){},onGeometryUpdated:function(){},onGeometryDeleted:function(){},_collideWithWorld:function(e,t,i,n,r,s){var o=10*M.CollisionsEpsilon
if(i.retry>=n)return r.x=e.x,r.y=e.y,void(r.z=e.z)
i._initialize(e,t,o)
for(var a=0,l=this._scene.meshes;a<l.length;){var h=l[a];++a,h.isEnabled()&&h.get_checkCollisions()&&null!=h.subMeshes&&h!=s&&h._checkCollision(i)}return i.collisionFound?((0!=t.x||0!=t.y||0!=t.z)&&(e.addToRef(t,i._destinationPoint),t.scaleInPlace(i.nearestDistance/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)),i.basePoint.addToRef(t,e),e.subtractToRef(i.intersectionPoint,i._slidePlaneNormal),i._slidePlaneNormal.normalize(),i._slidePlaneNormal.scaleToRef(i.epsilon,i._displacementVector),e.addInPlace(i._displacementVector),i.intersectionPoint.addInPlace(i._displacementVector),i._slidePlaneNormal.scaleInPlace(Ye.SignedDistanceToPlaneFromPositionAndNormal(i.intersectionPoint,i._slidePlaneNormal,i._destinationPoint)),i._destinationPoint.subtractInPlace(i._slidePlaneNormal),i._destinationPoint.subtractToRef(i.intersectionPoint,t)),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)<=o?(r.x=e.x,r.y=e.y,void(r.z=e.z)):(i.retry++,void this._collideWithWorld(e,t,i,n,r,s))):(r.x=e.x+t.x,r.y=e.y+t.y,void(r.z=e.z+t.z))},__class__:re}
var se=t.BABYLON.IntersectionInfo=function(e,t,i){this.subMeshId=0,this.faceId=0,this.bu=e,this.bv=t,this.distance=i}
s["com.babylonhx.collisions.IntersectionInfo"]=se,se.__name__=["com","babylonhx","collisions","IntersectionInfo"],se.prototype={faceId:null,subMeshId:null,bu:null,bv:null,distance:null,__class__:se}
var oe=t.BABYLON.PickingInfo=function(){this.subMeshId=0,this.faceId=-1,this.bv=0,this.bu=0,this.pickedMesh=null,this.pickedPoint=null,this.distance=0,this.hit=!1}
s["com.babylonhx.collisions.PickingInfo"]=oe,oe.__name__=["com","babylonhx","collisions","PickingInfo"],oe.prototype={hit:null,distance:null,pickedPoint:null,pickedMesh:null,bu:null,bv:null,faceId:null,subMeshId:null,getNormal:function(e){if(null==e&&(e=!1),null==this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Qe.NormalKind))return null
var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(Qe.NormalKind),n=W.FromArray(i,3*t[3*this.faceId]),r=W.FromArray(i,3*t[3*this.faceId+1]),s=W.FromArray(i,3*t[3*this.faceId+2])
n=n.scale(this.bu),r=r.scale(this.bv),s=s.scale(1-this.bu-this.bv)
var o=new W(n.x+r.x+s.x,n.y+r.y+s.y,n.z+r.z+s.z)
return e&&(o=W.TransformNormal(o,this.pickedMesh.getWorldMatrix())),o},getTextureCoordinates:function(){if(null==this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Qe.UVKind))return null
var e=this.pickedMesh.getIndices(),t=this.pickedMesh.getVerticesData(Qe.UVKind),i=Et.FromArray(t,2*e[3*this.faceId]),n=Et.FromArray(t,2*e[3*this.faceId+1]),r=Et.FromArray(t,2*e[3*this.faceId+2])
return i=i.scale(this.bu),n=n.scale(this.bv),r=r.scale(1-this.bu-this.bv),new Et(i.x+n.x+r.x,i.y+n.y+r.y)},__class__:oe}
var ae=t.BABYLON.BoundingBox=function(e,t){this.vectorsWorld=[],this.vectors=[],this.minimum=e,this.maximum=t,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[new W(0,0,0),new W(0,0,0),new W(0,0,0)]
for(var i=0,n=this.vectors.length;n>i;){var r=i++
this.vectorsWorld[r]=new W(0,0,0)}this.minimumWorld=new W(0,0,0),this.maximumWorld=new W(0,0,0),this._update(U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))}
s["com.babylonhx.culling.BoundingBox"]=ae,ae.__name__=["com","babylonhx","culling","BoundingBox"],ae.__interfaces__=[A],ae.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},ae.IntersectsSphere=function(e,t,i,n){ae.IntersectsSphere_vector=W.Clamp(i,e,t)
var r=W.DistanceSquared(i,ae.IntersectsSphere_vector)
return n*n>=r},ae.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;)for(var n=i++,r=0;8>r;){var s=r++
if(t[n].dotCoordinate(e[s])<0)return!1}return!0},ae.IsInFrustum=function(e,t){for(var i=0;6>i;){for(var n=i++,r=8,s=0;8>s;){var o=s++
if(!(t[n].dotCoordinate(e[o])<0))break;--r}if(0==r)return!1}return!0},ae.prototype={minimum:null,maximum:null,vectors:null,center:null,extendSize:null,directions:null,vectorsWorld:null,minimumWorld:null,maximumWorld:null,_worldMatrix:null,__smartArrayFlags:null,getWorldMatrix:function(){return this._worldMatrix},_update:function(e){W.FromFloatsToRef(1/0,1/0,1/0,this.minimumWorld),W.FromFloatsToRef(-(1/0),-(1/0),-(1/0),this.maximumWorld)
for(var t=0,i=this.vectors.length;i>t;){var n=t++,r=this.vectorsWorld[n]
W.TransformCoordinatesToRef(this.vectors[n],e,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),W.FromFloatArrayToRef(e.m,0,this.directions[0]),W.FromFloatArrayToRef(e.m,4,this.directions[1]),W.FromFloatArrayToRef(e.m,8,this.directions[2]),this._worldMatrix=e},isInFrustum:function(e){return ae.IsInFrustum(this.vectorsWorld,e)},isCompletelyInFrustum:function(e){return ae.IsCompletelyInFrustum(this.vectorsWorld,e)},intersectsPoint:function(e){var t=-M.Epsilon
return this.maximumWorld.x-e.x<t||t>e.x-this.minimumWorld.x?!1:this.maximumWorld.y-e.y<t||t>e.y-this.minimumWorld.y?!1:this.maximumWorld.z-e.z<t||t>e.z-this.minimumWorld.z?!1:!0},intersectsSphere:function(e){return ae.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},intersectsMinMax:function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},__class__:ae}
var le=t.BABYLON.BoundingInfo=function(e,t){this.minimum=e,this.maximum=t,this.boundingBox=new ae(e,t),this.boundingSphere=new he(e,t)}
s["com.babylonhx.culling.BoundingInfo"]=le,le.__name__=["com","babylonhx","culling","BoundingInfo"],le.computeBoxExtents=function(e,t){var i=W.Dot(t.center,e),n=Math.abs(W.Dot(t.directions[0],e))*t.extendSize.x,r=Math.abs(W.Dot(t.directions[1],e))*t.extendSize.y,s=Math.abs(W.Dot(t.directions[2],e))*t.extendSize.z,o=n+r+s
return{min:i-o,max:i+o}},le.extentsOverlap=function(e,t,i,n){return!(e>n||i>t)},le.axisOverlap=function(e,t,i){var n=le.computeBoxExtents(e,t),r=le.computeBoxExtents(e,i)
return!(n.min>r.max||r.min>n.max)},le.prototype={boundingBox:null,boundingSphere:null,minimum:null,maximum:null,_update:function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},isInFrustum:function(e){return this.boundingSphere.isInFrustum(e)?ae.IsInFrustum(this.boundingBox.vectorsWorld,e):!1},isCompletelyInFrustum:function(e){return ae.IsCompletelyInFrustum(this.boundingBox.vectorsWorld,e)},_checkCollision:function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},intersectsPoint:function(e){return null==this.boundingSphere.centerWorld?!1:this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},intersects:function(e,t){if(null==t&&(t=!1),null==this.boundingSphere.centerWorld||null==e.boundingSphere.centerWorld)return!1
if(!he.Intersects(this.boundingSphere,e.boundingSphere))return!1
if(!ae.Intersects(this.boundingBox,e.boundingBox))return!1
if(t)return!0
var i=this.boundingBox,n=e.boundingBox
return le.axisOverlap(i.directions[0],i,n)&&le.axisOverlap(i.directions[1],i,n)&&le.axisOverlap(i.directions[2],i,n)&&le.axisOverlap(n.directions[0],i,n)&&le.axisOverlap(n.directions[1],i,n)&&le.axisOverlap(n.directions[2],i,n)&&le.axisOverlap(W.Cross(i.directions[0],n.directions[0]),i,n)&&le.axisOverlap(W.Cross(i.directions[0],n.directions[1]),i,n)&&le.axisOverlap(W.Cross(i.directions[0],n.directions[2]),i,n)&&le.axisOverlap(W.Cross(i.directions[1],n.directions[0]),i,n)&&le.axisOverlap(W.Cross(i.directions[1],n.directions[1]),i,n)&&le.axisOverlap(W.Cross(i.directions[1],n.directions[2]),i,n)&&le.axisOverlap(W.Cross(i.directions[2],n.directions[0]),i,n)&&le.axisOverlap(W.Cross(i.directions[2],n.directions[1]),i,n)&&le.axisOverlap(W.Cross(i.directions[2],n.directions[2]),i,n)?!0:!1},__class__:le}
var he=t.BABYLON.BoundingSphere=function(e,t){this._tempRadiusVector=new W(0,0,0)
var i=Math.sqrt(W.DistanceSquared(e,t))
this.center=W.Lerp(e,t,.5),this.radius=.5*i,this.centerWorld=new W(0,0,0),this._update(U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))}
s["com.babylonhx.culling.BoundingSphere"]=he,he.__name__=["com","babylonhx","culling","BoundingSphere"],he.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,n=e.centerWorld.y-t.centerWorld.y,r=e.centerWorld.z-t.centerWorld.z,s=Math.sqrt(i*i+n*n+r*r)
return e.radiusWorld+t.radiusWorld<s?!1:!0},he.prototype={center:null,radius:null,centerWorld:null,radiusWorld:null,_tempRadiusVector:null,_update:function(e){W.TransformCoordinatesToRef(this.center,e,this.centerWorld),W.TransformNormalFromFloatsToRef(1,1,1,e,this._tempRadiusVector),this.radiusWorld=Math.max(Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y)),Math.abs(this._tempRadiusVector.z))*this.radius},isInFrustum:function(e){for(var t=0;6>t;){var i=t++
if(e[i].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1}return!0},intersectsPoint:function(e){var t=this.centerWorld.x-e.x,i=this.centerWorld.y-e.y,n=this.centerWorld.z-e.z,r=Math.sqrt(t*t+i*i+n*n)
return Math.abs(this.radiusWorld-r)<M.Epsilon?!1:!0},__class__:he}
var ue=t.BABYLON.IOctreeContainer=function(){}
s["com.babylonhx.culling.octrees.IOctreeContainer"]=ue,ue.__name__=["com","babylonhx","culling","octrees","IOctreeContainer"],ue.prototype={blocks:null,__class__:ue}
var ce=t.BABYLON.Octree=function(e,t,i){null==i&&(i=2),null==t&&(t=64),this.dynamicContent=[],this._maxBlockCapacity=t,this._selectionContent=new pi(1024),this._creationFunc=e,this.maxDepth=i}
s["com.babylonhx.culling.octrees.Octree"]=ce,ce.__name__=["com","babylonhx","culling","octrees","Octree"],ce.__interfaces__=[ue],ce._CreateBlocks=function(e,t,i,n,r,s,o,a){o.blocks=[]
for(var l=new W((t.x-e.x)/2,(t.y-e.y)/2,(t.z-e.z)/2),h=0;2>h;)for(var u=h++,c=0;2>c;)for(var f=c++,d=0;2>d;){var m=d++,_=e.add(l.multiplyByFloats(u,f,m)),p=e.add(l.multiplyByFloats(u+1,f+1,m+1)),v=new fe(_,p,n,r+1,s,a)
v.addEntries(i),o.blocks.push(v)}},ce.CreationFuncForMeshes=function(e,t){!e.get_isBlocked()&&e.getBoundingInfo().boundingBox.intersectsMinMax(t.get_minPoint(),t.get_maxPoint())&&t.entries.push(e)},ce.CreationFuncForSubMeshes=function(e,t){e._boundingInfo.boundingBox.intersectsMinMax(t.get_minPoint(),t.get_maxPoint())&&t.entries.push(e)},ce.prototype={blocks:null,dynamicContent:null,maxDepth:null,_maxBlockCapacity:null,_selectionContent:null,_creationFunc:null,update:function(e,t,i){ce._CreateBlocks(e,t,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},addMesh:function(e){for(var t=0,i=this.blocks.length;i>t;){var n=t++,r=this.blocks[n]
r.addEntry(e)}},select:function(e,t){null==t&&(t=!1),this._selectionContent.reset()
for(var i=0,n=this.blocks.length;n>i;){var r=i++,s=this.blocks[r]
s.select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},intersects:function(e,t,i){null==i&&(i=!1),this._selectionContent.reset()
for(var n=0,r=this.blocks.length;r>n;){var s=n++,o=this.blocks[s]
o.intersects(e,t,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},intersectsRay:function(e){this._selectionContent.reset()
for(var t=0,i=this.blocks.length;i>t;){var n=t++,r=this.blocks[n]
r.intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},__class__:ce}
var fe=t.BABYLON.OctreeBlock=function(e,t,i,n,r,s){this._boundingVectors=[],this.entries=[],this._capacity=i,this._depth=n,this._maxDepth=r,this._creationFunc=s,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(new W(e.x,e.y,e.z)),this._boundingVectors.push(new W(t.x,t.y,t.z)),this._boundingVectors.push(new W(e.x,e.y,e.z)),this._boundingVectors[2].x=t.x,this._boundingVectors.push(new W(e.x,e.y,e.z)),this._boundingVectors[3].y=t.y,this._boundingVectors.push(new W(e.x,e.y,e.z)),this._boundingVectors[4].z=t.z,this._boundingVectors.push(new W(t.x,t.y,t.z)),this._boundingVectors[5].z=e.z,this._boundingVectors.push(new W(t.x,t.y,t.z)),this._boundingVectors[6].x=e.x,this._boundingVectors.push(new W(t.x,t.y,t.z)),this._boundingVectors[7].y=e.y}
s["com.babylonhx.culling.octrees.OctreeBlock"]=fe,fe.__name__=["com","babylonhx","culling","octrees","OctreeBlock"],fe.__interfaces__=[ue],fe.prototype={entries:null,blocks:null,_depth:null,_maxDepth:null,_capacity:null,_minPoint:null,_maxPoint:null,_boundingVectors:null,_creationFunc:null,capacity:null,get_capacity:function(){return this._capacity},minPoint:null,get_minPoint:function(){return this._minPoint},maxPoint:null,get_maxPoint:function(){return this._maxPoint},addEntry:function(e){if(null==this.blocks)this._creationFunc(e,this),this.entries.length>this.get_capacity()&&this._depth<this._maxDepth&&this.createInnerBlocks()
else for(var t=0,i=this.blocks.length;i>t;){var n=t++,r=this.blocks[n]
r.addEntry(e)}},addEntries:function(e){for(var t=0,i=e.length;i>t;){var n=t++,r=e[n]
this.addEntry(r)}},select:function(e,t,i){if(null==i&&(i=!1),ae.IsInFrustum(this._boundingVectors,e)){if(null!=this.blocks){for(var n=0,r=this.blocks.length;r>n;){var s=n++,o=this.blocks[s]
o.select(e,t,i)}return}i?t.concat(this.entries):t.concatWithNoDuplicate(this.entries)}},intersects:function(e,t,i,n){if(null==n&&(n=!1),ae.IntersectsSphere(this._minPoint,this._maxPoint,e,t)){if(null!=this.blocks){for(var r=0,s=this.blocks.length;s>r;){var o=r++,a=this.blocks[o]
a.intersects(e,t,i,n)}return}n?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},intersectsRay:function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(null!=this.blocks){for(var i=0,n=this.blocks.length;n>i;){var r=i++,s=this.blocks[r]
s.intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},createInnerBlocks:function(){ce._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},__class__:fe,__properties__:{get_maxPoint:"get_maxPoint",get_minPoint:"get_minPoint",get_capacity:"get_capacity"}}
var de=t.BABYLON.Layer=function(e,t,i,n,r){null==n&&(n=!0),this._vertexStrideSize=8,this._vertexDeclaration=[],this.indices=[],this.vertices=[],this.name=e,null!=t?this.texture=new Ve(t,i,!1):this.texture=null,this.isBackground=n,null==r?this.color=new tt(1,1,1,1):this.color=r,this._scene=i,this._scene.layers.push(this),this.vertices.push(1),this.vertices.push(1),this.vertices.push(-1),this.vertices.push(1),this.vertices.push(-1),this.vertices.push(-1),this.vertices.push(1),this.vertices.push(-1),this._vertexDeclaration=[2],this._vertexBuffer=i._engine.createVertexBuffer(this.vertices),this.indices.push(0),this.indices.push(1),this.indices.push(2),this.indices.push(0),this.indices.push(2),this.indices.push(3),this._indexBuffer=i._engine.createIndexBuffer(this.indices),this._effect=this._scene._engine.createEffect("layer",["position"],["textureMatrix","color"],["textureSampler"],"")}
s["com.babylonhx.layer.Layer"]=de,de.__name__=["com","babylonhx","layer","Layer"],de.prototype={name:null,texture:null,isBackground:null,color:null,onDispose:null,vertices:null,indices:null,_scene:null,_vertexDeclaration:null,_vertexStrideSize:null,_vertexBuffer:null,_indexBuffer:null,_effect:null,render:function(){if(this._effect._isReady&&null!=this.texture&&this.texture.isReady()){var e=this._scene._engine
e.enableEffect(this._effect),0!=e._depthCullingState.get_cull()&&e._depthCullingState.set_cull(!1),e._depthCullingState.set_zOffset(0),this._effect.setTexture("textureSampler",this.texture),this._effect.setMatrix("textureMatrix",this.texture.getTextureMatrix()),this._effect.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),e.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),e._depthCullingState.set_depthMask(!1),e._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),e._alphaState.set_alphaBlend(!0),e._alphaMode=2,e.draw(!0,0,6),e._depthCullingState.set_depthMask(!0),e._alphaState.set_alphaBlend(!1),e._alphaMode=0}},dispose:function(){null!=this._vertexBuffer&&(this._scene._engine._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this._indexBuffer&&(this._scene._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),null!=this.texture&&(this.texture.dispose(),this.texture=null)
var e=c.indexOf(this._scene.layers,this,0)
this._scene.layers.splice(e,1),null!=this.onDispose&&this.onDispose()},__class__:de}
var me=t.BABYLON.LensFlare=function(e,t,i,n,r){null!=i?this.color=i:this.color=new Re(1,1,1),this.position=t,this.size=e,null!=n?this.texture=new Ve(n,r.getScene(),!0):this.texture=null,this._system=r,this._system.lensFlares.push(this)}
s["com.babylonhx.lensflare.LensFlare"]=me,me.__name__=["com","babylonhx","lensflare","LensFlare"],me.prototype={size:null,color:null,texture:null,position:null,_system:null,dispose:function(){null!=this.texture&&this.texture.dispose(),c.remove(this._system.lensFlares,this)},__class__:me}
var _e=t.BABYLON.LensFlareSystem=function(e,t,i){this._isEnabled=!0,this.borderLimit=300,this.lensFlares=[],this.name=e,this._scene=i,this._emitter=t,i.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return null!=e.get_material()&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&i.activeCamera.layerMask)}
var n=[]
n.push(1),n.push(1),n.push(-1),n.push(1),n.push(-1),n.push(-1),n.push(1),n.push(-1),this._vertexDeclaration=[2],this._vertexStrideSize=8,this._vertexBuffer=i._engine.createVertexBuffer(n)
var r=[]
r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),this._indexBuffer=i._engine.createIndexBuffer(r),this._effect=this._scene._engine.createEffect("lensFlare",["position"],["color","viewportMatrix"],["textureSampler"],"")}
s["com.babylonhx.lensflare.LensFlareSystem"]=_e,_e.__name__=["com","babylonhx","lensflare","LensFlareSystem"],_e.prototype={name:null,lensFlares:null,borderLimit:null,meshesSelectionPredicate:null,_scene:null,_emitter:null,_vertexDeclaration:null,_vertexStrideSize:null,_vertexBuffer:null,_indexBuffer:null,_effect:null,_positionX:null,_positionY:null,_isEnabled:null,isEnabled:null,get_isEnabled:function(){return this._isEnabled},set_isEnabled:function(e){return this._isEnabled=e,e},getScene:function(){return this._scene},getEmitter:function(){return this._emitter},getEmitterPosition:function(){return null!=this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},computeEffectivePosition:function(e){var t=this.getEmitterPosition()
return t=W.Project(t,U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._scene._transformMatrix,e),this._positionX=t.x,this._positionY=t.y,t=W.TransformCoordinates(this.getEmitterPosition(),this._scene._viewMatrix),t.z>0&&this._positionX>e.x&&this._positionX<e.x+e.width&&this._positionY>e.y&&this._positionY<e.y+e.height?!0:!1},_isVisible:function(){if(!this._isEnabled)return!1
var e=this.getEmitterPosition(),t=e.subtract(this._scene.activeCamera.position),i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)
t.normalize()
var n=new Pt(this._scene.activeCamera.position,t),r=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0)
return!r.hit||r.distance>i},render:function(){if(!this._effect._isReady)return!1
var e=this._scene._engine,t=this._scene.activeCamera.viewport,i=t.toGlobal(e)
if(!this.computeEffectivePosition(i))return!1
if(!this._isVisible())return!1
var n=0,r=0
n=this._positionX<this.borderLimit+i.x?this.borderLimit+i.x-this._positionX:this._positionX>i.x+i.width-this.borderLimit?this._positionX-i.x-i.width+this.borderLimit:0,r=this._positionY<this.borderLimit+i.y?this.borderLimit+i.y-this._positionY:this._positionY>i.y+i.height-this.borderLimit?this._positionY-i.y-i.height+this.borderLimit:0
var s
s=n>r?n:r,s>this.borderLimit&&(s=this.borderLimit)
var o=1-s/this.borderLimit
if(0>o)return!1
o>1&&(o=1)
var a=i.x+i.width/2,l=i.y+i.height/2,h=a-this._positionX,u=l-this._positionY
e.enableEffect(this._effect),0!=e._depthCullingState.get_cull()&&e._depthCullingState.set_cull(!1),e._depthCullingState.set_zOffset(0),e._depthCullingState.set_depthTest(!1),e._depthCullingState.set_depthMask(!1),e._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),e._alphaState.set_alphaBlend(!0),e._alphaMode=1,e.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect)
for(var c=0,f=this.lensFlares.length;f>c;){var d=c++,m=this.lensFlares[d],_=a-h*m.position,p=l-u*m.position,v=m.size,g=m.size*e.getAspectRatio(this._scene.activeCamera),x=2*(_/i.width)-1,y=1-2*(p/i.height),b=U.FromValues(v/2,0,0,0,0,g/2,0,0,0,0,1,0,x,y,0,1)
this._effect.setMatrix("viewportMatrix",b),this._effect.setTexture("textureSampler",m.texture),this._effect.setFloat4("color",m.color.r*o,m.color.g*o,m.color.b*o,1),e.draw(!0,0,6)}return e._depthCullingState.set_depthTest(!0),e._depthCullingState.set_depthMask(!0),e._alphaState.set_alphaBlend(!1),e._alphaMode=0,!0},dispose:function(){for(null!=this._vertexBuffer&&(this._scene._engine._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this._indexBuffer&&(this._scene._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length>0;)this.lensFlares[0].dispose()
c.remove(this._scene.lensFlareSystems,this)},__class__:_e,__properties__:{get_isEnabled:"get_isEnabled"}}
var pe=t.BABYLON.Light=function(e,t){this._includedOnlyMeshesIds=[],this._excludedMeshesIds=[],this.excludeWithLayerMask=0,this.excludedMeshes=[],this.includedOnlyMeshes=[],this.includeOnlyWithLayerMask=0,this.range=1/0,this.intensity=1,this.specular=new Re(1,1,1),this.diffuse=new Re(1,1,1),I.call(this,e,t),t.addLight(this)}
s["com.babylonhx.lights.Light"]=pe,pe.__name__=["com","babylonhx","lights","Light"],pe.__super__=I,pe.prototype=i(I.prototype,{diffuse:null,specular:null,intensity:null,range:null,includeOnlyWithLayerMask:null,includedOnlyMeshes:null,excludedMeshes:null,excludeWithLayerMask:null,_shadowGenerator:null,_parentedWorldMatrix:null,_excludedMeshesIds:null,_includedOnlyMeshesIds:null,getShadowGenerator:function(){return this._shadowGenerator},getAbsolutePosition:function(){return new W(0,0,0)},transferToEffect:function(){},_getWorldMatrix:function(){return U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},canAffectMesh:function(e){return null==e?!0:this.includedOnlyMeshes.length>0&&-1==c.indexOf(this.includedOnlyMeshes,e,0)?!1:this.excludedMeshes.length>0&&-1!=c.indexOf(this.excludedMeshes,e,0)?!1:0!=this.includeOnlyWithLayerMask&&this.includeOnlyWithLayerMask!=e.layerMask?!1:0!=this.excludeWithLayerMask&&Me.__cast(this.excludeWithLayerMask&e.layerMask,Rs)?!1:!0},getWorldMatrix:function(){this._currentRenderId=this._scene._renderId
var e=this._getWorldMatrix()
return null!=this.parent&&null!=this.parent.getWorldMatrix()?(null==this._parentedWorldMatrix&&(this._parentedWorldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),e.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._parentRenderId=this.parent._currentRenderId,this._parentedWorldMatrix):e},dispose:function(){null!=this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this._scene.removeLight(this)},__class__:pe})
var ve=t.BABYLON.IShadowLight=function(){}
s["com.babylonhx.lights.IShadowLight"]=ve,ve.__name__=["com","babylonhx","lights","IShadowLight"],ve.prototype={position:null,direction:null,transformedPosition:null,name:null,computeTransformedPosition:null,getScene:null,setShadowProjectionMatrix:null,supportsVSM:null,needRefreshPerFrame:null,_shadowGenerator:null,__class__:ve}
var ge=t.BABYLON.DirectionalLight=function(e,t,i){this.shadowOrthoScale=.1,pe.call(this,e,i),this.direction=t,this.position=new W(-1*t.x,-1*t.y,-1*t.z)}
s["com.babylonhx.lights.DirectionalLight"]=ge,ge.__name__=["com","babylonhx","lights","DirectionalLight"],ge.__interfaces__=[ve],ge.__super__=pe,ge.prototype=i(pe.prototype,{position:null,direction:null,_transformedDirection:null,transformedPosition:null,_worldMatrix:null,shadowOrthoScale:null,getAbsolutePosition:function(){return null!=this.transformedPosition?this.transformedPosition:this.position},setDirectionToTarget:function(e){return this.direction=W.Normalize(e.subtract(this.position)),this.direction},setShadowProjectionMatrix:function(e,t,i){for(var n=1/0,r=-(1/0),s=-(1/0),o=1/0,a=new W(0,0,0),l=this._scene.activeCamera,h=0,u=i.length;u>h;){var c=h++,f=i[c]
if(null!=f){var d=f.getBoundingInfo()
if(null!=d)for(var m=d.boundingBox,_=0,p=m.vectorsWorld.length;p>_;){var v=_++
W.TransformCoordinatesToRef(m.vectorsWorld[v],t,a),a.x<n&&(n=a.x),a.y<o&&(o=a.y),a.x>r&&(r=a.x),a.y>s&&(s=a.y)}}}var g=r-n,x=s-o
U.OrthoOffCenterLHToRef(n-g*this.shadowOrthoScale,r+g*this.shadowOrthoScale,o-x*this.shadowOrthoScale,s+x*this.shadowOrthoScale,-l.maxZ,l.maxZ,e)},supportsVSM:function(){return!0},needRefreshPerFrame:function(){return!0},computeTransformedPosition:function(){return null!=this.parent&&null!=(Ps=this.parent,r(Ps,Ps.getWorldMatrix))?(null==this.transformedPosition&&(this.transformedPosition=new W(0,0,0)),W.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},transferToEffect:function(e,t){return null!=this.parent&&null!=(Ps=this.parent,r(Ps,Ps.getWorldMatrix))?(null==this._transformedDirection&&(this._transformedDirection=new W(0,0,0)),W.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void e.setFloat4(t,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void e.setFloat4(t,this.direction.x,this.direction.y,this.direction.z,1)},_getWorldMatrix:function(){return null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),U.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},__class__:ge})
var xe=t.BABYLON.HemisphericLight=function(e,t,i){this.groundColor=new Re(0,0,0),pe.call(this,e,i),this.direction=t}
s["com.babylonhx.lights.HemisphericLight"]=xe,xe.__name__=["com","babylonhx","lights","HemisphericLight"],xe.__super__=pe,xe.prototype=i(pe.prototype,{groundColor:null,direction:null,_worldMatrix:null,setDirectionToTarget:function(e){return this.direction=W.Normalize(e.subtract(new W(0,0,0))),this.direction},getShadowGenerator:function(){return null},transferToEffect:function(e,t,i){var n=W.Normalize(this.direction)
e.setFloat4(t,n.x,n.y,n.z,0),e.setColor3(i,this.groundColor.scale(this.intensity))},_getWorldMatrix:function(){return null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),this._worldMatrix},__class__:xe})
var ye=t.BABYLON.PointLight=function(e,t,i){pe.call(this,e,i),this.position=t}
s["com.babylonhx.lights.PointLight"]=ye,ye.__name__=["com","babylonhx","lights","PointLight"],ye.__super__=pe,ye.prototype=i(pe.prototype,{_worldMatrix:null,_transformedPosition:null,position:null,getAbsolutePosition:function(){return null!=this._transformedPosition?this._transformedPosition:this.position},transferToEffect:function(e,t){return null!=this.parent&&null!=this.parent.getWorldMatrix()?(null==this._transformedPosition&&(this._transformedPosition=new W(0,0,0)),W.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void e.setFloat4(t,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void e.setFloat4(t,this.position.x,this.position.y,this.position.z,0)},getShadowGenerator:function(){return null},_getWorldMatrix:function(){return null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),U.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},__class__:ye})
var be=t.BABYLON.SpotLight=function(e,t,i,n,r,s){pe.call(this,e,s),this.position=t,this.direction=i,this.angle=n,this.exponent=r}
s["com.babylonhx.lights.SpotLight"]=be,be.__name__=["com","babylonhx","lights","SpotLight"],be.__interfaces__=[ve],be.__super__=pe,be.prototype=i(pe.prototype,{transformedPosition:null,_transformedDirection:null,_worldMatrix:null,position:null,direction:null,angle:null,exponent:null,getAbsolutePosition:function(){return null!=this.transformedPosition?this.transformedPosition:this.position},setShadowProjectionMatrix:function(e){var t=this._scene.activeCamera
U.PerspectiveFovLHToRef(this.angle,1,t.minZ,t.maxZ,e)},supportsVSM:function(){return!0},needRefreshPerFrame:function(){return!1},setDirectionToTarget:function(e){return this.direction=W.Normalize(e.subtract(this.position)),this.direction},computeTransformedPosition:function(){return null!=this.parent&&null!=this.parent.getWorldMatrix()?(null==this.transformedPosition&&(this.transformedPosition=new W(0,0,0)),W.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},transferToEffect:function(e,t,i){var n=new W(0,0,0)
if(null!=this.parent&&null!=this.parent.getWorldMatrix()){null==this._transformedDirection&&(this._transformedDirection=new W(0,0,0)),this.computeTransformedPosition()
var r=this.parent.getWorldMatrix()
W.TransformNormalToRef(this.direction,r,this._transformedDirection),e.setFloat4(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),n=W.Normalize(this._transformedDirection)}else e.setFloat4(t,this.position.x,this.position.y,this.position.z,this.exponent),n=W.Normalize(this.direction)
e.setFloat4(i,n.x,n.y,n.z,Math.cos(.5*this.angle))},_getWorldMatrix:function(){return null==this._worldMatrix&&(this._worldMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),U.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},__class__:be})
var we=t.BABYLON.ShadowGenerator=function(e,t){this._worldViewProjection=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._transformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._projectionMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._viewMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._transparencyShadow=!1,this._darkness=0,this._bias=5e-5,this._blurBoxOffset=0,this.blurScale=2,this._filter=we.FILTER_NONE
var i=this
this._light=t,this._scene=t.getScene(),this._mapSize=e,t._shadowGenerator=this,this._shadowMap=new Ue(t.name+"_shadowMap",e,this._scene,!1),this._shadowMap.wrapU=0,this._shadowMap.wrapV=0,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(1),this._shadowMap.renderParticles=!1,this._shadowMap.onAfterUnbind=function(){i.get_useBlurVarianceShadowMap()&&(null==i._shadowMap2&&(i._shadowMap2=new Ue(t.name+"_shadowMap",e,i._scene,!1),i._shadowMap2.wrapU=0,i._shadowMap2.wrapV=0,i._shadowMap2.updateSamplingMode(3),i._downSamplePostprocess=new ft("downScale",1/i.blurScale,null,2,i._scene._engine),i._downSamplePostprocess.onApply=function(e){e._engine.setTexture(c.indexOf(e._samplers,"textureSampler",0),i._shadowMap)},i.set_blurBoxOffset(1)),i._scene.postProcessManager.directRender([i._downSamplePostprocess,i._boxBlurPostprocess],i._shadowMap2.getInternalTexture()))}
var n=function(e){var t=e._renderingMesh,n=i._scene,r=n._engine
r.setState(e.getMaterial().backFaceCulling,null,null)
var s=t._getInstancesRenderList(e._id)
if(!s.mustReturn){var o=null!=r.getCaps().instancedArrays&&null!=s.visibleInstances[e._id]
if(i.isReady(e,o)){r.enableEffect(i._effect),t._bind(e,i._effect,Le.TriangleFillMode)
var a=e.getMaterial()
if(i._effect.setMatrix("viewProjection",i.getTransformMatrix()),null!=a&&a.needAlphaTesting()){var l=a.getAlphaTestTexture()
i._effect.setTexture("diffuseSampler",l),i._effect.setMatrix("diffuseMatrix",l.getTextureMatrix())}t.get_useBones()&&i._effect.setMatrices("mBones",t.get_skeleton().getTransformMatrices()),t._processRendering(e,i._effect,Le.TriangleFillMode,s,o,function(e,t){i._effect.setMatrix("world",t)})}else i._shadowMap.resetRefreshCounter()}}
this._shadowMap.customRenderFunction=function(e,t,r){for(var s=0,o=e.length;o>s;){var a=s++
n(e.data[a])}for(var l=0,h=t.length;h>l;){var u=l++
n(t.data[u])}if(i._transparencyShadow)for(var c=0,f=r.length;f>c;){var d=c++
n(r.data[d])}},this._shadowMap.onClear=function(e){i.get_useBlurVarianceShadowMap()||i.get_useVarianceShadowMap()?e.clear(new tt(0,0,0,0),!0,!0):e.clear(new tt(1,1,1,1),!0,!0)}}
s["com.babylonhx.lights.shadows.ShadowGenerator"]=we,we.__name__=["com","babylonhx","lights","shadows","ShadowGenerator"],we.prototype={_filter:null,blurScale:null,_blurBoxOffset:null,_bias:null,get_bias:function(){return this._bias},set_bias:function(e){return this._bias=e,e},get_blurBoxOffset:function(){return this._blurBoxOffset},set_blurBoxOffset:function(e){var t=this
return this._blurBoxOffset==e?e:(this._blurBoxOffset=e,null!=this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new ct("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,2,this._scene._engine,!1,"#define OFFSET "+e),this._boxBlurPostprocess.onApply=function(e){e.setFloat2("screenSize",t._mapSize/t.blurScale,t._mapSize/t.blurScale)},e)},get_filter:function(){return this._filter},set_filter:function(e){return this._filter==e?e:(this._filter=e,this.get_useVarianceShadowMap()||this.get_useBlurVarianceShadowMap()?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(3)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(1)),e)},get_useVarianceShadowMap:function(){return this.get_filter()==we.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set_useVarianceShadowMap:function(e){return this.set_filter(e?we.FILTER_VARIANCESHADOWMAP:we.FILTER_NONE),e},get_usePoissonSampling:function(){return this.get_filter()==we.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.get_filter()==we.FILTER_VARIANCESHADOWMAP||this.get_filter()==we.FILTER_BLURVARIANCESHADOWMAP)},set_usePoissonSampling:function(e){return this.set_filter(e?we.FILTER_POISSONSAMPLING:we.FILTER_NONE),e},get_useBlurVarianceShadowMap:function(){return this.get_filter()==we.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set_useBlurVarianceShadowMap:function(e){return this.set_filter(e?we.FILTER_BLURVARIANCESHADOWMAP:we.FILTER_NONE),e},_light:null,_scene:null,_shadowMap:null,_shadowMap2:null,_darkness:null,_transparencyShadow:null,_effect:null,_viewMatrix:null,_projectionMatrix:null,_transformMatrix:null,_worldViewProjection:null,_cachedPosition:null,_cachedDirection:null,_cachedDefines:null,_currentRenderID:null,_downSamplePostprocess:null,_boxBlurPostprocess:null,_mapSize:null,isReady:function(e,t){var i=[];(this.get_useVarianceShadowMap()||this.get_useBlurVarianceShadowMap())&&i.push("#define VSM")
var n=[Qe.PositionKind],r=e._mesh,s=e.getMaterial()
null!=s&&s.needAlphaTesting()&&(i.push("#define ALPHATEST"),r.isVerticesDataPresent(Qe.UVKind)&&(n.push(Qe.UVKind),i.push("#define UV1")),r.isVerticesDataPresent(Qe.UV2Kind)&&(n.push(Qe.UV2Kind),i.push("#define UV2"))),r.get_useBones()&&(n.push(Qe.MatricesIndicesKind),n.push(Qe.MatricesWeightsKind),i.push("#define BONES"),i.push("#define BonesPerMesh "+(r.get_skeleton().bones.length+1))),t&&(i.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"))
var o=i.join("\n")
return this._cachedDefines!=o&&(this._cachedDefines=o,this._effect=this._scene._engine.createEffect("shadowMap",n,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],o)),this._effect._isReady},getShadowMap:function(){return this._shadowMap},getShadowMapForRendering:function(){return null!=this._shadowMap2?this._shadowMap2:this._shadowMap},getLight:function(){return this._light},getTransformMatrix:function(){var e=this._scene
if(this._currentRenderID==e._renderId)return this._transformMatrix
this._currentRenderID=e._renderId
var t=this._light.position,i=this._light.direction
return this._light.computeTransformedPosition()&&(t=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&null!=this._cachedPosition&&null!=this._cachedDirection&&t.equals(this._cachedPosition)&&i.equals(this._cachedDirection)||(this._cachedPosition=new W(t.x,t.y,t.z),this._cachedDirection=new W(i.x,i.y,i.z),U.LookAtLHToRef(t,this._light.position.add(i),new W(0,1,0),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList,!1),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},getDarkness:function(){return this._darkness},setDarkness:function(e){e>=1?this._darkness=1:0>=e?this._darkness=0:this._darkness=e},setTransparencyShadow:function(e){this._transparencyShadow=e},_packHalf:function(e){var t=255*e,i=t-Math.floor(t)
return new Et(e-i/255,i)},dispose:function(){this._shadowMap.dispose(),null!=this._shadowMap2&&this._shadowMap2.dispose(),null!=this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),null!=this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},__class__:we,__properties__:{set_useBlurVarianceShadowMap:"set_useBlurVarianceShadowMap",get_useBlurVarianceShadowMap:"get_useBlurVarianceShadowMap",set_usePoissonSampling:"set_usePoissonSampling",get_usePoissonSampling:"get_usePoissonSampling",set_useVarianceShadowMap:"set_useVarianceShadowMap",get_useVarianceShadowMap:"get_useVarianceShadowMap",set_filter:"set_filter",get_filter:"get_filter",set_blurBoxOffset:"set_blurBoxOffset",get_blurBoxOffset:"get_blurBoxOffset",set_bias:"set_bias",get_bias:"get_bias"}}
var Se=t.BABYLON.SceneLoader=function(){}
s["com.babylonhx.loading.SceneLoader"]=Se,Se.__name__=["com","babylonhx","loading","SceneLoader"],Se.__properties__={set_ShowLoadingScreen:"set_ShowLoadingScreen",get_ShowLoadingScreen:"get_ShowLoadingScreen",set_ForceFullSceneLoadingForIncremental:"set_ForceFullSceneLoadingForIncremental",get_ForceFullSceneLoadingForIncremental:"get_ForceFullSceneLoadingForIncremental"},Se.get_ForceFullSceneLoadingForIncremental=function(){return Se._ForceFullSceneLoadingForIncremental},Se.set_ForceFullSceneLoadingForIncremental=function(e){return Se._ForceFullSceneLoadingForIncremental=e,e},Se.get_ShowLoadingScreen=function(){return Se._ShowLoadingScreen},Se.set_ShowLoadingScreen=function(e){return Se._ShowLoadingScreen=e,e},Se._getPluginForFilename=function(e){var t=e.lastIndexOf("."),i=e.indexOf("?");-1==i&&(i=e.length)
for(var n=e.substring(t,i).toLowerCase(),r=0,s=Se._registeredPlugins.length;s>r;){var o=r++,a=Se._registeredPlugins[o]
if(-1!=a.extensions.indexOf(n))return a}return Se._registeredPlugins[Se._registeredPlugins.length-1]},Se.RegisterPlugin=function(e){e.extensions=e.extensions.toLowerCase(),Se._registeredPlugins.push(e)},Se.ImportMesh=function(e,t,i,n,r,s,o){var a=function(){var s=Se._getPluginForFilename(i)
if(null==s){var a=i.lastIndexOf("."),l=i.indexOf("?"),h=i.substring(a,l).toLowerCase()
throw Ei.trace("Error: No plugin loaded for '"+h+"' file type !",{fileName:"SceneLoader.hx",lineNumber:78,className:"com.babylonhx.loading.SceneLoader",methodName:"ImportMesh"}),new Wi("No plugin loaded for '"+h+"' file type !")}var u=function(a){var l=[],h=[],u=[]
try{if(!s.importMesh(e,n,a,t,l,h,u))return void(null!=o&&o(n,"unable to load the scene"))}catch(c){return c instanceof Wi&&(c=c.val),Ei.trace(c,{fileName:"SceneLoader.hx",lineNumber:96,className:"com.babylonhx.loading.SceneLoader",methodName:"ImportMesh"}),void(null!=o&&o(n,c))}null!=r&&(n.importedMeshesFiles.push(t+i),r(l,h,u))}
return"data:"==c.substr(i,0,5)?void u(c.substr(i,5,null)):void Oe.LoadFile(t+i,function(a){var l=[],h=[],u=[]
try{if(!s.importMesh(e,n,a,t,l,h,u))return void(null!=o&&o(n,"unable to load the scene"))}catch(c){return c instanceof Wi&&(c=c.val),Ei.trace(c,{fileName:"SceneLoader.hx",lineNumber:130,className:"com.babylonhx.loading.SceneLoader",methodName:"ImportMesh"}),void(null!=o&&o(n,c))}null!=r&&(n.importedMeshesFiles.push(t+i),r(l,h,u))})}
a()},Se.Load=function(e,t,i,n,r,s){Se.Append(e,t,new P(i),n,r,s)},Se.Append=function(e,t,i,n,r,s){var o=Se._getPluginForFilename(null!=t.name?t.name:t),a=function(t){return o.load(i,t,e)?void(null!=n&&n(i)):void(null!=s&&s(i))}
return Oe.LoadFile(e+g.string(t),a),"data:"==t.substr(0,5)?void a(t.substr(5)):void 0}
var Me=function(){}
s["js.Boot"]=Me,Me.__name__=["js","Boot"],Me.__unhtml=function(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},Me.__trace=function(t,i){var n
if(n=null!=i?i.fileName+":"+i.lineNumber+": ":"",n+=Me.__string_rec(t,""),null!=i&&null!=i.customParams)for(var r=0,s=i.customParams;r<s.length;){var o=s[r];++r,n+=","+Me.__string_rec(o,"")}var a
"undefined"!=typeof document&&null!=(a=document.getElementById("haxe:trace"))?a.innerHTML+=Me.__unhtml(n)+"<br/>":void 0!==e&&null!=e.log&&e.log(n)},Me.__clear_trace=function(){var e=document.getElementById("haxe:trace")
null!=e&&(e.innerHTML="")},Me.isClass=function(e){return e.__name__},Me.isEnum=function(e){return e.__ename__},Me.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array
var t=e.__class__
if(null!=t)return t
var i=Me.__nativeClassName(e)
return null!=i?Me.__resolveNativeClass(i):null},Me.__string_rec=function(e,t){if(null==e)return"null"
if(t.length>=5)return"<...>"
var i=typeof e
switch("function"==i&&(e.__name__||e.__ename__)&&(i="object"),i){case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0]
var n=e[0]+"("
t+="	"
for(var r=2,s=e.length;s>r;){var o=r++
n+=2!=o?","+Me.__string_rec(e[o],t):Me.__string_rec(e[o],t)}return n+")"}var a=e.length,l="["
t+="	"
for(var h=0;a>h;){var u=h++
l+=(u>0?",":"")+Me.__string_rec(e[u],t)}return l+="]"}var c
try{c=e.toString}catch(f){return f instanceof Wi&&(f=f.val),"???"}if(null!=c&&c!=Object.toString&&"function"==typeof c){var d=""+e
if("[object Object]"!=d)return d}var m=null,_="{\n"
t+="	"
var p=null!=e.hasOwnProperty
for(var m in e)(!p||e.hasOwnProperty(m))&&"prototype"!=m&&"__class__"!=m&&"__super__"!=m&&"__interfaces__"!=m&&"__properties__"!=m&&(2!=_.length&&(_+=", \n"),_+=t+m+" : "+Me.__string_rec(e[m],t))
return t=t.substring(1),_+="\n"+t+"}"
case"function":return"<function>"
case"string":return e
default:return e+""}},Me.__interfLoop=function(e,t){if(null==e)return!1
if(e==t)return!0
var i=e.__interfaces__
if(null!=i)for(var n=0,r=i.length;r>n;){var s=n++,o=i[s]
if(o==t||Me.__interfLoop(o,t))return!0}return Me.__interfLoop(e.__super__,t)},Me.__instanceof=function(e,t){if(null==t)return!1
switch(t){case Ds:return(0|e)===e
case Fs:return"number"==typeof e
case Rs:return"boolean"==typeof e
case String:return"string"==typeof e
case Array:return e instanceof Array&&null==e.__enum__
case Ls:return!0
default:if(null==e)return!1
if("function"==typeof t){if(e instanceof t)return!0
if(Me.__interfLoop(Me.getClass(e),t))return!0}else if("object"==typeof t&&Me.__isNativeObj(t)&&e instanceof t)return!0
return t==zs&&null!=e.__name__?!0:t==Bs&&null!=e.__ename__?!0:e.__enum__==t}},Me.__cast=function(e,t){if(Me.__instanceof(e,t))return e
throw new Wi("Cannot cast "+g.string(e)+" to "+g.string(t))},Me.__nativeClassName=function(e){var t=Me.__toStr.call(e).slice(8,-1)
return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},Me.__isNativeObj=function(e){return null!=Me.__nativeClassName(e)},Me.__resolveNativeClass=function(e){return Function("return typeof "+e+' != "undefined" ? '+e+" : null")()}
var Te=function(e){this.length=e.byteLength,this.b=new Us(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b}
s["haxe.io.Bytes"]=Te,Te.__name__=["haxe","io","Bytes"],Te.alloc=function(e){return new Te(new ks(e))},Te.ofString=function(e){for(var t=[],i=0;i<e.length;){var n=y.fastCodeAt(e,i++)
n>=55296&&56319>=n&&(n=n-55232<<10|1023&y.fastCodeAt(e,i++)),127>=n?t.push(n):2047>=n?(t.push(192|n>>6),t.push(128|63&n)):65535>=n?(t.push(224|n>>12),t.push(128|n>>6&63),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|n>>12&63),t.push(128|n>>6&63),t.push(128|63&n))}return new Te(new Us(t).buffer)},Te.ofData=function(e){var t=e.hxBytes
return null!=t?t:new Te(e)},Te.prototype={length:null,b:null,get:function(e){return this.b[e]},set:function(e,t){this.b[e]=255&t},getString:function(e,t){if(0>e||0>t||e+t>this.length)throw new Wi(De.OutsideBounds)
for(var i="",n=this.b,r=String.fromCharCode,s=e,o=e+t;o>s;){var a=n[s++]
if(128>a){if(0==a)break
i+=r(a)}else if(224>a)i+=r((63&a)<<6|127&n[s++])
else if(240>a){var l=n[s++]
i+=r((31&a)<<12|(127&l)<<6|127&n[s++])}else{var h=n[s++],u=n[s++],c=(15&a)<<18|(127&h)<<12|(127&u)<<6|127&n[s++]
i+=r((c>>10)+55232),i+=r(1023&c|56320)}}return i},toString:function(){return this.getString(0,this.length)},__class__:Te}
var Ce=function(){}
s["org.msgpack.MsgPack"]=Ce,Ce.__name__=["org","msgpack","MsgPack"],Ce.encode=function(e){return new As(e).getBytes()},Ce.decode=function(e,t){return null==t&&(t=Ae.AsObject),new Ie(e,t).getResult()}
var Ae=s["org.msgpack.DecodeOption"]={__ename__:!0,__constructs__:["AsMap","AsObject"]}
Ae.AsMap=["AsMap",0],Ae.AsMap.toString=o,Ae.AsMap.__enum__=Ae,Ae.AsObject=["AsObject",1],Ae.AsObject.toString=o,Ae.AsObject.__enum__=Ae
var Ie=function(e,t){var i=new Ee(e)
i.set_bigEndian(!0),this.o=this.decode(i,t)}
s["org.msgpack.Decoder"]=Ie,Ie.__name__=["org","msgpack","Decoder"],Ie.prototype={o:null,decode:function(e,t){try{var i=e.readByte()
switch(i){case 192:return null
case 194:return!1
case 195:return!0
case 196:return e.read(e.readByte())
case 197:return e.read(e.readUInt16())
case 198:return e.read(e.readInt32())
case 202:return Ui.i32ToFloat(e.readInt32())
case 203:return e.readDouble()
case 204:return e.readByte()
case 205:return e.readUInt16()
case 206:return e.readInt32()
case 207:throw new Wi("UInt64 not supported")
case 208:return e.readInt8()
case 209:return e.readInt16()
case 210:return e.readInt32()
case 211:return this.readInt64(e)
case 217:return e.readString(e.readByte())
case 218:return e.readString(e.readUInt16())
case 219:return e.readString(e.readInt32())
case 220:return this.readArray(e,e.readUInt16(),t)
case 221:return this.readArray(e,e.readInt32(),t)
case 222:return this.readMap(e,e.readUInt16(),t)
case 223:return this.readMap(e,e.readInt32(),t)
default:if(128>i)return i
if(144>i)return this.readMap(e,15&i,t)
if(160>i)return this.readArray(e,15&i,t)
if(192>i)return e.readString(31&i)
if(i>223)return-256|i}}catch(n){if(n instanceof Wi&&(n=n.val),!Me.__instanceof(n,Ni))throw n}return null},readInt64:function(e){var t=e.readInt32(),i=e.readInt32(),n=new Pi(t,i)
return n},readArray:function(e,t,i){for(var n=[],r=0;t>r;){r++
n.push(this.decode(e,i))}return n},readMap:function(e,t,i){switch(i[1]){case 1:for(var n={},r=0;t>r;){var s=(r++,this.decode(e,i)),o=this.decode(e,i)
n[g.string(s)]=o}return n
case 0:for(var a=[],l=0;t>l;){var h=(l++,this.decode(e,i)),u=this.decode(e,i)
a.push(new Cs(h,u))}if(0==a.length)return new Bi
var c=w["typeof"](a[0].k)
switch(c[1]){case 1:for(var f=new Fi,d=0;d<a.length;){var m=a[d];++d
var _=w["typeof"](m.k)
switch(_[1]){case 1:break
default:throw new Wi("Error: Mixed key type when decoding IntMap")}if(f.exists(m.k))throw new Wi("Error: Duplicate keys found => "+g.string(m.k))
f.set(m.k,m.v)}return f
case 6:var p=c[2]
if("String"==w.getClassName(p)){for(var v=new Bi,x=0;x<a.length;){var y=a[x];++x
var b=w["typeof"](y.k)
switch(b[1]){case 6:var S=b[2]
if("String"!=w.getClassName(S))throw new Wi("Error: Mixed key type when decoding StringMap")
break
default:throw new Wi("Error: Mixed key type when decoding StringMap")}if(v.exists(y.k))throw new Wi("Error: Duplicate keys found => "+g.string(y.k))
v.set(y.k,y.v)}return v}throw new Wi("Error: Unsupported key Type")
default:throw new Wi("Error: Unsupported key Type")}}throw new Wi("Should not get here")},getResult:function(){return this.o},__class__:Ie}
var Pe=function(){}
s["haxe.io.Input"]=Pe,Pe.__name__=["haxe","io","Input"],Pe.prototype={bigEndian:null,readByte:function(){throw new Wi("Not implemented")},readBytes:function(e,t,i){var n=i,r=e.b
if(0>t||0>i||t+i>e.length)throw new Wi(De.OutsideBounds)
for(;n>0;)r[t]=this.readByte(),t++,n--
return i},set_bigEndian:function(e){return this.bigEndian=e,e},readFullBytes:function(e,t,i){for(;i>0;){var n=this.readBytes(e,t,i)
t+=n,i-=n}},read:function(e){for(var t=Te.alloc(e),i=0;e>0;){var n=this.readBytes(t,i,e)
if(0==n)throw new Wi(De.Blocked)
i+=n,e-=n}return t},readDouble:function(){var e=this.readInt32(),t=this.readInt32()
return this.bigEndian?Ui.i64ToDouble(t,e):Ui.i64ToDouble(e,t)},readInt8:function(){var e=this.readByte()
return e>=128?e-256:e},readInt16:function(){var e,t=this.readByte(),i=this.readByte()
return e=this.bigEndian?i|t<<8:t|i<<8,0!=(32768&e)?e-65536:e},readUInt16:function(){var e=this.readByte(),t=this.readByte()
return this.bigEndian?t|e<<8:e|t<<8},readInt32:function(){var e=this.readByte(),t=this.readByte(),i=this.readByte(),n=this.readByte()
return this.bigEndian?n|i<<8|t<<16|e<<24:e|t<<8|i<<16|n<<24},readString:function(e){var t=Te.alloc(e)
return this.readFullBytes(t,0,e),""+t},__class__:Pe,__properties__:{set_bigEndian:"set_bigEndian"}}
var Ee=function(e,t,i){if(null==t&&(t=0),null==i&&(i=e.length-t),0>t||0>i||t+i>e.length)throw new Wi(De.OutsideBounds)
this.b=e.b,this.pos=t,this.len=i,this.totlen=i}
s["haxe.io.BytesInput"]=Ee,Ee.__name__=["haxe","io","BytesInput"],Ee.__super__=Pe,Ee.prototype=i(Pe.prototype,{b:null,pos:null,len:null,totlen:null,readByte:function(){if(0==this.len)throw new Wi(new Ni)
return this.len--,this.b[this.pos++]},readBytes:function(e,t,i){if(0>t||0>i||t+i>e.length)throw new Wi(De.OutsideBounds)
if(0==this.len&&i>0)throw new Wi(new Ni)
this.len<i&&(i=this.len)
for(var n=this.b,r=e.b,s=0;i>s;){var o=s++
r[t+o]=n[this.pos+o]}return this.pos+=i,this.len-=i,i},__class__:Ee})
var De=s["haxe.io.Error"]={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]}
De.Blocked=["Blocked",0],De.Blocked.toString=o,De.Blocked.__enum__=De,De.Overflow=["Overflow",1],De.Overflow.toString=o,De.Overflow.__enum__=De,De.OutsideBounds=["OutsideBounds",2],De.OutsideBounds.toString=o,De.OutsideBounds.__enum__=De,De.Custom=function(e){var t=["Custom",3,e]
return t.__enum__=De,t.toString=o,t}
var Le=t.BABYLON.Material=function(e,t,i){null==i&&(i=!1),this.zOffset=0,this.pointSize=1,this._fillMode=Le.TriangleFillMode,this._wasPreviouslyReady=!1,this.backFaceCulling=!0,this.alpha=1,this.state="",this.checkReadyOnlyOnce=!1,this.checkReadyOnEveryCall=!0,this.id=e,this.name=e,this._scene=t,i||t.materials.push(this)}
s["com.babylonhx.materials.Material"]=Le,Le.__name__=["com","babylonhx","materials","Material"],Le.__interfaces__=[A],Le.prototype={id:null,name:null,checkReadyOnEveryCall:null,checkReadyOnlyOnce:null,state:null,alpha:null,backFaceCulling:null,onCompiled:null,onError:null,onDispose:null,onBind:null,getRenderTargetTextures:null,__smartArrayFlags:null,_effect:null,_wasPreviouslyReady:null,_scene:null,_fillMode:null,pointSize:null,zOffset:null,get_wireframe:function(){return this._fillMode==Le.WireFrameFillMode},set_wireframe:function(e){return e?this._fillMode=Le.WireFrameFillMode:this._fillMode=Le.TriangleFillMode,e},get_pointsCloud:function(){return this._fillMode==Le.PointFillMode},set_pointsCloud:function(e){return e?this._fillMode=Le.PointFillMode:this._fillMode=Le.TriangleFillMode,e},get_fillMode:function(){return this._fillMode},set_fillMode:function(e){return this._fillMode=e,e},isReady:function(e,t){return null==t&&(t=!1),!0},getEffect:function(){return this._effect},getScene:function(){return this._scene},needAlphaBlending:function(){return this.alpha<1},needAlphaTesting:function(){return!1},getAlphaTestTexture:function(){return null},trackCreation:function(){},_preBind:function(){var e=this._scene._engine
e.enableEffect(this._effect),e.setState(this.backFaceCulling,null,0!=this.zOffset)},bind:function(){this._scene._cachedMaterial=this,null!=this.onBind&&this.onBind(this)},bindOnlyWorldMatrix:function(){},unbind:function(){},dispose:function(e){null==e&&(e=!1),c.remove(this._scene.materials,this),e&&null!=this._effect&&(this._scene._engine._releaseEffect(this._effect),this._effect=null),null!=this.onDispose&&this.onDispose()},__class__:Le,__properties__:{set_fillMode:"set_fillMode",get_fillMode:"get_fillMode",set_pointsCloud:"set_pointsCloud",get_pointsCloud:"get_pointsCloud",set_wireframe:"set_wireframe",get_wireframe:"get_wireframe"}}
var Fe=t.BABYLON.StandardMaterial=function(e,t){this.maxSimultaneousLights=4,this._renderId=-1,this._scaledSpecular=new Re,this._scaledDiffuse=new Re,this._globalAmbientColor=new Re(0,0,0),this._worldViewProjectionMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._renderTargets=new pi(16),this._cachedDefines=null,this.fogEnabled=!0,this.useSpecularOverAlpha=!0,this.useAlphaFromDiffuseTexture=!1,this.emissiveColor=new Re(0,0,0),this.specularPower=64,this.specularColor=new Re(1,1,1),this.diffuseColor=new Re(1,1,1),this.ambientColor=new Re(0,0,0),this.bumpTexture=null,this.specularTexture=null,this.emissiveTexture=null,this.reflectionTexture=null,this.opacityTexture=null,this.ambientTexture=null,this.diffuseTexture=null
var i=this
Le.call(this,e,t),this.getRenderTargetTextures=function(){return i._renderTargets.reset(),null!=i.reflectionTexture&&i.reflectionTexture.isRenderTarget&&i._renderTargets.push(i.reflectionTexture),i._renderTargets}}
s["com.babylonhx.materials.StandardMaterial"]=Fe,Fe.__name__=["com","babylonhx","materials","StandardMaterial"],Fe.__super__=Le,Fe.prototype=i(Le.prototype,{diffuseTexture:null,ambientTexture:null,opacityTexture:null,reflectionTexture:null,emissiveTexture:null,specularTexture:null,bumpTexture:null,ambientColor:null,diffuseColor:null,specularColor:null,specularPower:null,emissiveColor:null,useAlphaFromDiffuseTexture:null,useSpecularOverAlpha:null,fogEnabled:null,diffuseFresnelParameters:null,opacityFresnelParameters:null,reflectionFresnelParameters:null,emissiveFresnelParameters:null,_cachedDefines:null,_renderTargets:null,_worldViewProjectionMatrix:null,_globalAmbientColor:null,_scaledDiffuse:null,_scaledSpecular:null,_renderId:null,maxSimultaneousLights:null,needAlphaBlending:function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||null!=this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},needAlphaTesting:function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},_shouldUseAlphaFromDiffuseTexture:function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},getAlphaTestTexture:function(){return this.diffuseTexture},isReady:function(e,t){if(null==t&&(t=!1),this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0
var i=this.getScene()
if(!this.checkReadyOnEveryCall&&this._renderId==i._renderId)return!0
var n=i._engine
Fe.defines=[]
var r=new vt,s=!1,o=!1
if(i.texturesEnabled){if(null!=this.diffuseTexture&&Fe.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1
o=!0,Fe.defines.push("#define DIFFUSE")}if(null!=this.ambientTexture&&Fe.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1
o=!0,Fe.defines.push("#define AMBIENT")}if(null!=this.opacityTexture&&Fe.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1
o=!0,Fe.defines.push("#define OPACITY"),this.opacityTexture.getAlphaFromRGB&&Fe.defines.push("#define OPACITYRGB")}if(null!=this.reflectionTexture&&Fe.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1
s=!0,o=!0,Fe.defines.push("#define REFLECTION"),r.addFallback(0,"REFLECTION")}if(null!=this.emissiveTexture&&Fe.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1
o=!0,Fe.defines.push("#define EMISSIVE")}if(null!=this.specularTexture&&Fe.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1
o=!0,Fe.defines.push("#define SPECULAR"),r.addFallback(0,"SPECULAR")}}if(1==i._engine.getCaps().standardDerivatives&&null!=this.bumpTexture&&Fe.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1
o=!0,Fe.defines.push("#define BUMP"),r.addFallback(0,"BUMP")}this.useSpecularOverAlpha&&(Fe.defines.push("#define SPECULAROVERALPHA"),r.addFallback(0,"SPECULAROVERALPHA")),null!=i.clipPlane&&Fe.defines.push("#define CLIPPLANE"),n._alphaTest&&Fe.defines.push("#define ALPHATEST"),this._shouldUseAlphaFromDiffuseTexture()&&Fe.defines.push("#define ALPHAFROMDIFFUSE"),(this.get_pointsCloud()||i.forcePointsCloud)&&Fe.defines.push("#define POINTSIZE"),i.fogEnabled&&null!=e&&e.applyFog&&i.fogMode!=P.FOGMODE_NONE&&this.fogEnabled&&(Fe.defines.push("#define FOG"),r.addFallback(1,"FOG"))
var a=!1,l=0
if(i.lightsEnabled)for(var h=0,u=i.lights.length;u>h;){var c=h++,f=i.lights[c]
if(f.isEnabled()){if(f._excludedMeshesIds.length>0){for(var d=0,m=f._excludedMeshesIds.length;m>d;){var _=d++,p=i.getMeshByID(f._excludedMeshesIds[_])
null!=p&&f.excludedMeshes.push(p)}f._excludedMeshesIds=[]}if(f._includedOnlyMeshesIds.length>0){for(var v=0,g=f._includedOnlyMeshesIds.length;g>v;){var x=v++,b=i.getMeshByID(f._includedOnlyMeshesIds[x])
null!=b&&f.includedOnlyMeshes.push(b)}f._includedOnlyMeshesIds=[]}if(f.canAffectMesh(e)){s=!0,Fe.defines.push("#define LIGHT"+l),l>0&&r.addFallback(l,"LIGHT"+l)
var w=""
if(w=Me.__instanceof(f,be)?"#define SPOTLIGHT"+l:Me.__instanceof(f,xe)?"#define HEMILIGHT"+l:"#define POINTDIRLIGHT"+l,Fe.defines.push(w),l>0&&r.addFallback(l,y.replace(w,"#define ","")),i.shadowsEnabled){var S=f.getShadowGenerator()
null!=e&&e.get_receiveShadows()&&null!=S&&(Fe.defines.push("#define SHADOW"+l),r.addFallback(0,"SHADOW"+l),a||(Fe.defines.push("#define SHADOWS"),a=!0),(S.get_useVarianceShadowMap()||S.get_useBlurVarianceShadowMap())&&(Fe.defines.push("#define SHADOWVSM"+l),l>0&&r.addFallback(0,"SHADOWVSM"+l)),S.get_usePoissonSampling()&&(Fe.defines.push("#define SHADOWPCF"+l),l>0&&r.addFallback(0,"SHADOWPCF"+l)))}if(l++,l==this.maxSimultaneousLights)break}}}if(Fe.FresnelEnabled&&(null!=this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||null!=this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||null!=this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||null!=this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)){var M=1
null!=this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Fe.defines.push("#define DIFFUSEFRESNEL"),r.addFallback(M,"DIFFUSEFRESNEL"),M++),null!=this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(Fe.defines.push("#define OPACITYFRESNEL"),r.addFallback(M,"OPACITYFRESNEL"),M++),null!=this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Fe.defines.push("#define REFLECTIONFRESNEL"),r.addFallback(M,"REFLECTIONFRESNEL"),M++),null!=this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Fe.defines.push("#define EMISSIVEFRESNEL"),r.addFallback(M,"EMISSIVEFRESNEL"),M++),s=!0,Fe.defines.push("#define FRESNEL"),r.addFallback(M-1,"FRESNEL")}var T=[Qe.PositionKind]
null!=e&&(s&&e.isVerticesDataPresent(Qe.NormalKind)&&(T.push(Qe.NormalKind),Fe.defines.push("#define NORMAL")),o&&(e.isVerticesDataPresent(Qe.UVKind)&&(T.push(Qe.UVKind),Fe.defines.push("#define UV1")),e.isVerticesDataPresent(Qe.UV2Kind)&&(T.push(Qe.UV2Kind),Fe.defines.push("#define UV2"))),e.useVertexColors&&e.isVerticesDataPresent(Qe.ColorKind)&&(T.push(Qe.ColorKind),Fe.defines.push("#define VERTEXCOLOR"),e.hasVertexAlpha&&Fe.defines.push("#define VERTEXALPHA")),e.get_useBones()&&(T.push(Qe.MatricesIndicesKind),T.push(Qe.MatricesWeightsKind),Fe.defines.push("#define BONES"),Fe.defines.push("#define BonesPerMesh "+(e.get_skeleton().bones.length+1)),Fe.defines.push("#define BONES4"),r.addFallback(0,"BONES4")),t&&(Fe.defines.push("#define INSTANCES"),T.push("world0"),T.push("world1"),T.push("world2"),T.push("world3")))
var C=Fe.defines.join("\n")
if(this._cachedDefines!=C){this._cachedDefines=C,i._cachedMaterial=null
var A="default"
0==i._engine.getCaps().standardDerivatives&&(A="legacydefault"),this._effect=i._engine.createEffect(A,T,["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vLightData0","vLightDiffuse0","vLightSpecular0","vLightDirection0","vLightGround0","lightMatrix0","vLightData1","vLightDiffuse1","vLightSpecular1","vLightDirection1","vLightGround1","lightMatrix1","vLightData2","vLightDiffuse2","vLightSpecular2","vLightDirection2","vLightGround2","lightMatrix2","vLightData3","vLightDiffuse3","vLightSpecular3","vLightDirection3","vLightGround3","lightMatrix3","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","shadowsInfo0","shadowsInfo1","shadowsInfo2","shadowsInfo3","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor"],["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","shadowSampler0","shadowSampler1","shadowSampler2","shadowSampler3"],C,r,this.onCompiled,this.onError)}return this._effect._isReady?(this._renderId=i._renderId,this._wasPreviouslyReady=!0,!0):!1},unbind:function(){null!=this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null)},bindOnlyWorldMatrix:function(e){this._effect.setMatrix("world",e)},bind:function(e,t){var i=this.getScene()
if(this.bindOnlyWorldMatrix(e),this._effect.setMatrix("viewProjection",i._transformMatrix),null!=t&&t.get_useBones()&&this._effect.setMatrices("mBones",t.get_skeleton().getTransformMatrices()),i.getCachedMaterial()!=this){if(Fe.FresnelEnabled&&(null!=this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),null!=this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new Re(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),null!=this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),null!=this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),null!=this.diffuseTexture&&Fe.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),null!=this.ambientTexture&&Fe.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),null!=this.opacityTexture&&Fe.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),null!=this.reflectionTexture&&Fe.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat3("vReflectionInfos",this.reflectionTexture.coordinatesMode,this.reflectionTexture.level,this.reflectionTexture.isCube?1:0)),null!=this.emissiveTexture&&Fe.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),null!=this.specularTexture&&Fe.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),null!=this.bumpTexture&&1==i._engine.getCaps().standardDerivatives&&Fe.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat2("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),null!=i.clipPlane){var n=i.clipPlane
this._effect.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}this.get_pointsCloud()&&this._effect.setFloat("pointSize",this.pointSize),i.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._scaledSpecular.r=this.specularColor.r*Math.min(1,Math.max(0,1-this.emissiveColor.r)),this._scaledSpecular.g=this.specularColor.g*Math.min(1,Math.max(0,1-this.emissiveColor.g)),this._scaledSpecular.b=this.specularColor.b*Math.min(1,Math.max(0,1-this.emissiveColor.b)),this._effect.setVector3("vEyePosition",i.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._effect.setColor4("vSpecularColor",this._scaledSpecular,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor)}if(this._scaledDiffuse.r=this.diffuseColor.r*Math.min(1,Math.max(0,1-this.emissiveColor.r)),this._scaledDiffuse.g=this.diffuseColor.g*Math.min(1,Math.max(0,1-this.emissiveColor.g)),this._scaledDiffuse.b=this.diffuseColor.b*Math.min(1,Math.max(0,1-this.emissiveColor.b)),this._effect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.get_visibility()),i.lightsEnabled)for(var r=0,s=0,o=i.lights.length;o>s;){var a=s++,l=i.lights[a]
if(l.isEnabled()&&l.canAffectMesh(t)){if(Me.__instanceof(l,ye)?l.transferToEffect(this._effect,"vLightData"+r):Me.__instanceof(l,ge)?l.transferToEffect(this._effect,"vLightData"+r):Me.__instanceof(l,be)?l.transferToEffect(this._effect,"vLightData"+r,"vLightDirection"+r):Me.__instanceof(l,xe)&&l.transferToEffect(this._effect,"vLightData"+r,"vLightGround"+r),l.diffuse.scaleToRef(l.intensity,this._scaledDiffuse),l.specular.scaleToRef(l.intensity,this._scaledSpecular),this._effect.setColor4("vLightDiffuse"+r,this._scaledDiffuse,l.range),this._effect.setColor3("vLightSpecular"+r,this._scaledSpecular),i.shadowsEnabled){var h=l.getShadowGenerator()
t.get_receiveShadows()&&null!=h&&(this._effect.setMatrix("lightMatrix"+r,h.getTransformMatrix()),this._effect.setTexture("shadowSampler"+r,h.getShadowMapForRendering()),this._effect.setFloat3("shadowsInfo"+r,h.getDarkness(),h.getShadowMap().getSize().width,h.get_bias()))}if(r++,r==this.maxSimultaneousLights)break}}(i.fogEnabled&&t.applyFog&&i.fogMode!=P.FOGMODE_NONE||null!=this.reflectionTexture)&&this._effect.setMatrix("view",i._viewMatrix),i.fogEnabled&&t.applyFog&&i.fogMode!=P.FOGMODE_NONE&&(this._effect.setFloat4("vFogInfos",i.fogMode,i.fogStart,i.fogEnd,i.fogDensity),this._effect.setColor3("vFogColor",i.fogColor)),Le.prototype.bind.call(this,e,t)},getAnimatables:function(){var e=[]
return null!=this.diffuseTexture&&null!=this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),null!=this.ambientTexture&&null!=this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&e.push(this.ambientTexture),null!=this.opacityTexture&&null!=this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&e.push(this.opacityTexture),null!=this.reflectionTexture&&null!=this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&e.push(this.reflectionTexture),null!=this.emissiveTexture&&null!=this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&e.push(this.emissiveTexture),null!=this.specularTexture&&null!=this.specularTexture.animations&&this.specularTexture.animations.length>0&&e.push(this.specularTexture),null!=this.bumpTexture&&null!=this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),e},dispose:function(e){null==e&&(e=!1),null!=this.diffuseTexture&&this.diffuseTexture.dispose(),null!=this.ambientTexture&&this.ambientTexture.dispose(),null!=this.opacityTexture&&this.opacityTexture.dispose(),null!=this.reflectionTexture&&this.reflectionTexture.dispose(),null!=this.emissiveTexture&&this.emissiveTexture.dispose(),null!=this.specularTexture&&this.specularTexture.dispose(),null!=this.bumpTexture&&this.bumpTexture.dispose(),Le.prototype.dispose.call(this,e)},clone:function(e){var t=new Fe(e,this.getScene())
return t.checkReadyOnEveryCall=this.checkReadyOnEveryCall,t.alpha=this.alpha,t.set_fillMode(this.get_fillMode()),t.backFaceCulling=this.backFaceCulling,null!=this.diffuseTexture&&(t.diffuseTexture=this.diffuseTexture.clone()),null!=this.ambientTexture&&(t.ambientTexture=this.ambientTexture.clone()),null!=this.opacityTexture&&(t.opacityTexture=this.opacityTexture.clone()),null!=this.reflectionTexture&&(t.reflectionTexture=this.reflectionTexture.clone()),null!=this.emissiveTexture&&(t.emissiveTexture=this.emissiveTexture.clone()),null!=this.specularTexture&&(t.specularTexture=this.specularTexture.clone()),null!=this.bumpTexture&&(t.bumpTexture=this.bumpTexture.clone()),t.ambientColor=this.ambientColor.clone(),t.diffuseColor=this.diffuseColor.clone(),t.specularColor=this.specularColor.clone(),t.specularPower=this.specularPower,t.emissiveColor=this.emissiveColor.clone(),t},__class__:Fe})
var Re=t.BABYLON.Color3=function(e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.r=e,this.g=t,this.b=i}
s["com.babylonhx.math.Color3"]=Re,Re.__name__=["com","babylonhx","math","Color3"],Re.FromArray=function(e,t){return null==t&&(t=0),new Re(e[0],e[1],e[2])},Re.FromInts=function(e,t,i){return new Re(e/255,t/255,i/255)},Re.Lerp=function(e,t,i){var n=e.r+(t.r-e.r)*i,r=e.g+(t.g-e.g)*i,s=e.b+(t.b-e.b)*i
return new Re(n,r,s)},Re.Red=function(){return new Re(1,0,0)},Re.Green=function(){return new Re(0,1,0)},Re.Blue=function(){return new Re(0,0,1)},Re.Black=function(){return new Re(0,0,0)},Re.White=function(){return new Re(1,1,1)},Re.Purple=function(){return new Re(.5,0,.5)},Re.Magenta=function(){return new Re(1,0,1)},Re.Yellow=function(){return new Re(1,1,0)},Re.Gray=function(){return new Re(.5,.5,.5)},Re.prototype={r:null,g:null,b:null,toString:function(){return"{R:"+this.r+" G:"+this.g+" B:"+this.b+"}"},toArray:function(e,t){return null==t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},toColor4:function(e){return null==e&&(e=1),new tt(this.r,this.g,this.b,e)},asArray:function(){var e=[]
return this.toArray(e,0),e},toLuminance:function(){return.3*this.r+.59*this.g+.11*this.b},multiply:function(e){return new Re(this.r*e.r,this.g*e.g,this.b*e.b)},multiplyToRef:function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},equals:function(e){return null!=e&&this.r==e.r&&this.g==e.g&&this.b==e.b},scale:function(e){return new Re(this.r*e,this.g*e,this.b*e)},scaleToRef:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},add:function(e){return new Re(this.r+e.r,this.g+e.g,this.b+e.b)},addToRef:function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},subtract:function(e){return new Re(this.r-e.r,this.g-e.g,this.b-e.b)},subtractToRef:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},clone:function(){return new Re(this.r,this.g,this.b)},copyFrom:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyFromFloats:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},__class__:Re}
var ze=t.BABYLON.Tags=function(){}
s["com.babylonhx.tools.Tags"]=ze,ze.__name__=["com","babylonhx","tools","Tags"],ze.EnableFor=function(e){null!=e._tags?e._tags=e._tags:e._tags={},e.hasTags=function(){return ze.HasTags(e)},e.addTags=function(t){ze.AddTagsTo(e,t)},e.removeTags=function(t){ze.RemoveTagsFrom(e,t)}},ze.DisableFor=function(e){e._tags=null,e.hasTags=null,e.addTags=null,e.removeTags=null,e.matchesTagsQuery=null},ze.HasTags=function(e){return e._tags?!Oe.IsEmpty(e._tags):!1},ze.GetTags=function(e){return null==e._tags?null:e._tags},ze.AddTagsTo=function(e,t){if(null==t&&(t=""),""!=t)for(var i=t.split(" "),n=0;n<i.length;){var r=i[n];++n,ze._AddTagTo(e,r)}},ze._AddTagTo=function(e,t){if(t=y.trim(t),""!=t&&"true"!=t&&"false"!=t){var i=new u("[\\s]",""),n=new u("^([!]|([|]|[&]){2})","")
i.match(t)||n.match(t)||ze.EnableFor(e)}},ze.RemoveTagsFrom=function(e,t){if(ze.HasTags(e))for(var i=t.split(" "),n=0;n<i.length;){var r=i[n];++n,ze._RemoveTagFrom(e,r)}},ze._RemoveTagFrom=function(e,t){e._tags.remove(t)}
var Be=function(e){var t=this
this.id=setInterval(function(){t.run()},e)}
s["haxe.Timer"]=Be,Be.__name__=["haxe","Timer"],Be.delay=function(e,t){var i=new Be(t)
return i.run=function(){i.stop(),e()},i},Be.measure=function(e,t){var i=Be.stamp(),n=e()
return Ei.trace(Be.stamp()-i+"s",t),n},Be.stamp=function(){return(new Date).getTime()/1e3},Be.prototype={id:null,stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:Be}
var Oe=t.BABYLON.Tools=function(){}
s["com.babylonhx.tools.Tools"]=Oe,Oe.__name__=["com","babylonhx","tools","Tools"],Oe.GetExponantOfTwo=function(e,t){var i=1
do i*=2
while(e>i)
return i>t&&(i=t),i},Oe.GetFilename=function(e){var t=e.lastIndexOf("/")
return 0>t?e:e.substring(t+1)},Oe.ToDegrees=function(e){return 180*e/Math.PI},Oe.ToRadians=function(e){return e*Math.PI/180},Oe.delay=function(e,t){var i=new Be(t)
return i.run=function(){i.stop(),e()},i},Oe.ExtractMinAndMaxIndexed=function(e,t,i,n){for(var r=new W(1/0,1/0,1/0),s=new W(-(1/0),-(1/0),-(1/0)),o=i,a=i+n;a>o;){var l=o++,h=new W(e[3*t[l]],e[3*t[l]+1],e[3*t[l]+2])
r=W.Minimize(h,r),s=W.Maximize(h,s)}return{minimum:r,maximum:s}},Oe.ExtractMinAndMax=function(e,t,i){for(var n=new W(1/0,1/0,1/0),r=new W(-(1/0),-(1/0),-(1/0)),s=t,o=t+i;o>s;){var a=s++,l=new W(e[3*a],e[3*a+1],e[3*a+2])
n=W.Minimize(l,n),r=W.Maximize(l,r)}return{minimum:n,maximum:r}},Oe.MakeArray=function(e,t){if(null==t&&(t=!1),1!=t&&null==e)return null
if(Object.prototype.hasOwnProperty.call(e,"get")){for(var i=[],n=function(){var t,i
return i=Me.__cast(e,Ii),t=i.keys()}(this);n.hasNext();){var r=n.next()
i.push(e.get(r))}return i}return e instanceof Array&&null==e.__enum__?e:[e]},Oe.LoadFile=function(e,t,i){null==i&&(i="")
var n
n=null!=t?function(e){t(e)}:function(){}
var r=new XMLHttpRequest
r.onreadystatechange=function(){if(4==r.readyState&&200==r.status&&null!=n){var e=r.response
n(e)}},r.open("GET",e),r.send()},Oe.LoadImage=function(e,t){var i
i=null!=t?function(e){var i=_n.fromCanvas(e),n=new vi(i.get_data(),i.width,i.height)
t(n)}:function(){}
var n,r=window.document
n=r.createElement("img"),n.src=e,n.onload=function(e){var t,n=window.document
t=n.createElement("canvas")
var r=t.getContext("2d",null)
t.width=e.target.width,t.height=e.target.height,r.drawImage(e.target,0,0,e.target.width,e.target.height),i(t)}},Oe.Clamp=function(e,t,i){return null==i&&(i=1),null==t&&(t=0),Math.min(i,Math.max(t,e))},Oe.Clamp2=function(e,t,i){return t>e?t:e>i?i:e},Oe.Sign=function(e){return 0==e?0:e>0?1:-1},Oe.Format=function(e,t){null==t&&(t=2),e=Math.round(e*Math.pow(10,t))
var i=""+e,n=i.length
if(t>=n){for(;t>n;)i="0"+i,n++
return(0==t?"":"0.")+i}return c.substr(i,0,i.length-t)+(0==t?"":".")+c.substr(i,i.length-t,null)},Oe.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},Oe.WithinEpsilon=function(e,t,i){null==i&&(i=1.401298e-45)
var n=e-t
return n>=-i&&i>=n},Oe.DeepCopy=function(e,t,i,n){for(var r=w.getInstanceFields(e),s=0;s<r.length;){var o=r[s]
if(++s,("_"!=o.charAt(0)||null!=n&&-1!=c.indexOf(n,o,0))&&(null==i||-1==c.indexOf(i,o,0))){var a=v.getProperty(e,o)
v.isFunction(a)||v.setField(t,o,Oe.dcopy(a))}}},Oe.dcopy=function(e){if(e instanceof Array&&null==e.__enum__){for(var t=w.createInstance(null==e?null:Me.getClass(e),[]),i=0,n=e.length;n>i;){var r=i++
t.push(Oe.dcopy(e[r]))}return t}if(null==(null==e?null:Me.getClass(e))){for(var s={},o=0,a=v.fields(e);o<a.length;){var l=a[o];++o,v.setField(s,l,Oe.dcopy(v.field(e,l)))}return s}for(var h=w.createEmptyInstance(null==e?null:Me.getClass(e)),u=0,c=v.fields(e);u<c.length;){var f=c[u];++u,v.setField(h,f,Oe.dcopy(v.field(e,f)))}return h},Oe.deepCopy=function(e){if(v.isObject(e)){if(e instanceof Array&&null==e.__enum__){for(var t=w.createInstance(null==e?null:Me.getClass(e),[]),i=0,n=e.length;n>i;){var r=i++
t.push(Oe.deepCopy(e[r]))}return t}if(null==(null==e?null:Me.getClass(e))){for(var s={},o=0,a=v.fields(e);o<a.length;){var l=a[o];++o,v.setField(s,l,Oe.deepCopy(v.field(e,l)))}return s}for(var h=w.createEmptyInstance(null==e?null:Me.getClass(e)),u=0,c=v.fields(e);u<c.length;){var f=c[u];++u,v.setField(h,f,Oe.deepCopy(v.field(e,f)))}return h}return e},Oe.cloneValue=function(e,t){return null==e?null:Me.__instanceof(e,qe)?null:Me.__instanceof(e,Je)?Me.__cast(e,Je).clone(Me.__cast(t,je)):Object.prototype.hasOwnProperty.call(e,"clone")?e.clone():null},Oe.IsEmpty=function(e){if(e instanceof Array&&null==e.__enum__){var t,i=0
for(t=Me.__cast(e,Array);i<t.length;){t[i]
return++i,!1}}return!0},Oe.Now=function(){return g["int"](1e3*(Be.stamp()-Oe.__startTime))},Oe.getTimer=function(){return g["int"](1e3*(Be.stamp()-Oe.__startTime))},Oe.uuid=function(){var e=function(e,t){null==t&&(t=61)
var i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n=[]
for(t=t>61?61:t;e-->0;)n.push(i[Math.floor((t+1)*Math.random())])
return n.join("")}
return e(8,15)+"-"+e(4,15)+"-4"+e(3,15)+"-"+Math.floor(4*Math.random())+e(3,15)+"-"+e(12,15)},Oe.randomInt=function(e,t){return e+Math.floor((t-e+1)*Math.random())}
var ke=t.BABYLON.BaseTexture=function(e){this.anisotropicFilteringLevel=4,this.wrapV=1,this.wrapU=1,this.coordinatesMode=0,this.coordinatesIndex=0,this.animations=[],this.isRenderTarget=!1,this.isCube=!1,this.level=1,this.getAlphaFromRGB=!1,this.hasAlpha=!1,this.delayLoadState=0,this._scene=e,this._scene.textures.push(this)}
s["com.babylonhx.materials.textures.BaseTexture"]=ke,ke.__name__=["com","babylonhx","materials","textures","BaseTexture"],ke.__interfaces__=[Y],ke.prototype={name:null,delayLoadState:null,hasAlpha:null,getAlphaFromRGB:null,level:null,isCube:null,isRenderTarget:null,animations:null,onDispose:null,coordinatesIndex:null,coordinatesMode:null,wrapU:null,wrapV:null,anisotropicFilteringLevel:null,_cachedAnisotropicFilteringLevel:null,__smartArrayFlags:null,_scene:null,_texture:null,getScene:function(){return this._scene},getTextureMatrix:function(){return null},getReflectionTextureMatrix:function(){return null},getInternalTexture:function(){return this._texture},isReady:function(){return 4==this.delayLoadState?!0:null!=this._texture?this._texture.isReady:!1},getSize:function(){return-1!=this._texture._width&&0!=this._texture._width?{width:this._texture._width,height:this._texture._height}:null!=this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},getBaseSize:function(){return this.isReady()?null!=this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},scale:function(){},_removeFromCache:function(e,t){for(var i=this._scene._engine.getLoadedTexturesCache(),n=0,r=i.length;r>n;){var s=n++,o=i[s]
if(o.url==e&&o.noMipmap==t)return void i.splice(s,1)}},_getFromCache:function(e,t,i){for(var n=this._scene._engine.getLoadedTexturesCache(),r=0,s=n.length;s>r;){var o=r++,a=n[o]
if(a.url==e&&a.noMipmap==t&&(null==i||i==a.samplingMode))return a.references++,a}return null},delayLoad:function(){},releaseInternalTexture:function(){if(null!=this._texture){var e=this._scene._engine.getLoadedTexturesCache()
this._texture.references--,0==this._texture.references&&(c.remove(e,this._texture),this._scene._engine._releaseTexture(this._texture),this._texture=null)}},clone:function(){return null},dispose:function(){var e=c.indexOf(this._scene.textures,this,0)
e>=0&&this._scene.textures.splice(e,1),null!=this._texture&&(this.releaseInternalTexture(),null!=this.onDispose&&this.onDispose())},__class__:ke}
var Ve=t.BABYLON.Texture=function(e,t,i,n,r,s,o,a,l){null==l&&(l=!1),null==r&&(r=3),null==n&&(n=!0),null==i&&(i=!1),this.wAng=0,this.vAng=0,this.uAng=0,this.vScale=1,this.uScale=1,this.vOffset=0,this.uOffset=0,ke.call(this,t),this.name=e,this.url=e,this._noMipmap=i,this._invertY=n,this._samplingMode=r,this._buffer=a,this._deleteBuffer=l,null!=e&&""!=y.trim(e)&&(this._texture=this._getFromCache(e,i,r),null==this._texture&&(t.useDelayedTextureLoading?this.delayLoadState=4:-1!=e.indexOf(".")&&(this._texture=t._engine.createTexture(e,i,n,t,this._samplingMode,s,o,this._buffer),l&&(this._buffer=null))))}
s["com.babylonhx.materials.textures.Texture"]=Ve,Ve.__name__=["com","babylonhx","materials","textures","Texture"],Ve.CreateFromBase64String=function(e,t,i,n,r,s,o,a){return null==s&&(s=3),new Ve("data:"+t,i,n,r,s,o,a,e)},Ve.__super__=ke,Ve.prototype=i(ke.prototype,{url:null,uOffset:null,vOffset:null,uScale:null,vScale:null,uAng:null,vAng:null,wAng:null,_noMipmap:null,_invertY:null,_rowGenerationMatrix:null,_cachedTextureMatrix:null,_projectionModeMatrix:null,_t0:null,_t1:null,_t2:null,_cachedUOffset:null,_cachedVOffset:null,_cachedUScale:null,_cachedVScale:null,_cachedUAng:null,_cachedVAng:null,_cachedWAng:null,_cachedCoordinatesMode:null,_samplingMode:null,_buffer:null,_deleteBuffer:null,delayLoad:function(){4==this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),null==this._texture&&(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,null,null,this._buffer),this._deleteBuffer&&(this._buffer=null)))},updateSamplingMode:function(e){null!=this._texture&&this.getScene().getEngine().updateTextureSamplingMode(e,this._texture)},_prepareRowForTextureGeneration:function(e,t,i,n){e-=this.uOffset+.5,t-=this.vOffset+.5,i-=.5,W.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,n),n.x*=this.uScale,n.y*=this.vScale,n.x+=.5,n.y+=.5,n.z+=.5},getTextureMatrix:function(){return this.uOffset==this._cachedUOffset&&this.vOffset==this._cachedVOffset&&this.uScale==this._cachedUScale&&this.vScale==this._cachedVScale&&this.uAng==this._cachedUAng&&this.vAng==this._cachedVAng&&this.wAng==this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,null==this._cachedTextureMatrix&&(this._cachedTextureMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._rowGenerationMatrix=new U,this._t0=new W(0,0,0),this._t1=new W(0,0,0),this._t2=new W(0,0,0)),N.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},getReflectionTextureMatrix:function(){if(this.uOffset==this._cachedUOffset&&this.vOffset==this._cachedVOffset&&this.uScale==this._cachedUScale&&this.vScale==this._cachedVScale&&this.coordinatesMode==this._cachedCoordinatesMode)return this._cachedTextureMatrix
null==this._cachedTextureMatrix&&(this._cachedTextureMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._projectionModeMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),this._cachedCoordinatesMode=this.coordinatesMode
var e=this.coordinatesMode
switch(e){case 1:U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=-.5*this.uScale,this._cachedTextureMatrix.m[5]=-.5*this.vScale,this._cachedTextureMatrix.m[12]=.5+this.uOffset,this._cachedTextureMatrix.m[13]=.5+this.vOffset
break
case 2:U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this.uScale,this._cachedTextureMatrix.m[5]=this.vScale,this._cachedTextureMatrix.m[12]=this.uOffset,this._cachedTextureMatrix.m[13]=this.vOffset
break
case 4:U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1,this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix)
break
default:U.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,this._cachedTextureMatrix)}return this._cachedTextureMatrix},clone:function(){var e=new Ve(this._texture.url,this.getScene(),this._noMipmap,this._invertY,this._samplingMode)
return e.hasAlpha=this.hasAlpha,e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e.uOffset=this.uOffset,e.vOffset=this.vOffset,e.uScale=this.uScale,e.vScale=this.vScale,e.uAng=this.uAng,e.vAng=this.vAng,e.wAng=this.wAng,e},__class__:Ve})
var Ne=t.BABYLON.CubeTexture=function(e,t,i,n){Ve.call(this,e,t,n),this.coordinatesMode=3,this.name=e,this.url=e,this._noMipmap=n,this.hasAlpha=!1,null==i&&(i=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._extensions=i,null==this._texture&&(t.useDelayedTextureLoading?this.delayLoadState=4:this._texture=t._engine.createCubeTexture(e,t,i,n)),this.isCube=!0,this._textureMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}
s["com.babylonhx.materials.textures.CubeTexture"]=Ne,Ne.__name__=["com","babylonhx","materials","textures","CubeTexture"],Ne.__super__=Ve,Ne.prototype=i(Ve.prototype,{_extensions:null,_textureMatrix:null,clone:function(){var e=new Ne(this.url,this.getScene(),this._extensions,this._noMipmap)
return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},delayLoad:function(){4==this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),null==this._texture&&(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},getReflectionTextureMatrix:function(){return this._textureMatrix},__class__:Ne})
var Ue=t.BABYLON.RenderTargetTexture=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=!0),this._refreshRate=1,this._currentRefreshId=-1,this.renderSprites=!1,this.renderParticles=!0,this.renderList=[],Ve.call(this,null,i,!n),this.coordinatesMode=4,this.name=e,this.isRenderTarget=!0,this._size=t,this._generateMipMaps=n,this._doNotChangeAspectRatio=r,this._texture=i._engine.createRenderTargetTexture(t,{generateMipMaps:n,type:s}),this._renderingManager=new Ge(i)}
s["com.babylonhx.materials.textures.RenderTargetTexture"]=Ue,Ue.__name__=["com","babylonhx","materials","textures","RenderTargetTexture"],Ue.__super__=Ve,Ue.prototype=i(Ve.prototype,{renderList:null,renderParticles:null,renderSprites:null,onBeforeRender:null,onAfterRender:null,onAfterUnbind:null,onClear:null,activeCamera:null,customRenderFunction:null,_size:null,_generateMipMaps:null,_renderingManager:null,_waitingRenderList:null,_doNotChangeAspectRatio:null,_currentRefreshId:null,_refreshRate:null,resetRefreshCounter:function(){this._currentRefreshId=-1},get_refreshRate:function(){return this._refreshRate},set_refreshRate:function(e){return this._refreshRate=e,this.resetRefreshCounter(),e},_shouldRender:function(){return-1==this._currentRefreshId?(this._currentRefreshId=1,!0):this.get_refreshRate()==this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},isReady:function(){return this.getScene().renderTargetsEnabled?Ve.prototype.isReady.call(this):!1},getRenderSize:function(){return this._size},get_canRescale:function(){return!0},scale:function(e){var t=this._size*e
this.resize(t,this._generateMipMaps)},resize:function(e,t){this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t)},render:function(e){null==e&&(e=!1)
var t=this.getScene(),i=t._engine
if(null!=this._waitingRenderList){this.renderList=[]
for(var n=0,r=this._waitingRenderList.length;r>n;){var s=n++,o=this._waitingRenderList[s]
this.renderList.push(t.getMeshByID(o))}this._waitingRenderList=null}if(null==this.renderList||0!=this.renderList.length){e&&t.postProcessManager._prepareFrame(this._texture)||i.bindFramebuffer(this._texture),this._renderingManager.reset()
var a
a=null!=this.renderList?this.renderList:t._activeMeshes.data
for(var l=0,h=a.length;h>l;){var u=l++,c=a[u]
if(null!=c){if(!c.isReady()){this.resetRefreshCounter()
continue}if(c.isEnabled()&&c.isVisible&&null!=c.subMeshes&&0!=(c.layerMask&t.activeCamera.layerMask)){c._activate(t._renderId)
for(var f=0,d=c.subMeshes.length;d>f;){var m=f++,_=c.subMeshes[m]
t._activeIndices+=_.indexCount,this._renderingManager.dispatch(_)}}}}null!=this.onBeforeRender&&this.onBeforeRender(),null!=this.onClear?this.onClear(i):i.clear(t.clearColor,!0,!0),this._doNotChangeAspectRatio||t.setTransformMatrix(t.activeCamera.getViewMatrix(),t.activeCamera.getProjectionMatrix(!0)),this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites),e&&t.postProcessManager._finalizeFrame(!1,this._texture),this._doNotChangeAspectRatio||t.setTransformMatrix(t.activeCamera.getViewMatrix(),t.activeCamera.getProjectionMatrix(!0)),null!=this.onAfterRender&&this.onAfterRender(),i.unBindFramebuffer(this._texture),null!=this.onAfterUnbind&&this.onAfterUnbind()}},clone:function(){var e=this.getSize(),t=new Ue(this.name,e.width,this.getScene(),this._generateMipMaps)
return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t.renderList=this.renderList.slice(0),t},__class__:Ue,__properties__:{get_canRescale:"get_canRescale",set_refreshRate:"set_refreshRate",get_refreshRate:"get_refreshRate"}})
var We=t.BABYLON.MirrorTexture=function(e,t,i,n){this._mirrorMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._transformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this.mirrorPlane=new Ye(0,1,0,1)
var r=this
Ue.call(this,e,t,i,n,!0),this.onBeforeRender=function(){U.ReflectionToRef(r.mirrorPlane,r._mirrorMatrix),r._savedViewMatrix=i._viewMatrix,r._mirrorMatrix.multiplyToRef(r._savedViewMatrix,r._transformMatrix),i._viewMatrix=r._transformMatrix,i._projectionMatrix=i._projectionMatrix,i._viewMatrix.multiplyToRef(i._projectionMatrix,i._transformMatrix),i.clipPlane=r.mirrorPlane,i._engine.cullBackFaces=!1},this.onAfterRender=function(){i._viewMatrix=r._savedViewMatrix,i._projectionMatrix=i._projectionMatrix,i._viewMatrix.multiplyToRef(i._projectionMatrix,i._transformMatrix),i._engine.cullBackFaces=!0,i.clipPlane=null}}
s["com.babylonhx.materials.textures.MirrorTexture"]=We,We.__name__=["com","babylonhx","materials","textures","MirrorTexture"],We.__super__=Ue,We.prototype=i(Ue.prototype,{mirrorPlane:null,_transformMatrix:null,_mirrorMatrix:null,_savedViewMatrix:null,clone:function(){var e=this.getSize(),t=new We(this.name,e.width,this.getScene(),this._generateMipMaps)
return t.hasAlpha=this.hasAlpha,t.level=this.level,t.mirrorPlane=this.mirrorPlane.clone(),t.renderList=this.renderList.slice(0),t},__class__:We})
var Ge=t.BABYLON.RenderingManager=function(e){this._renderingGroups=[],this._scene=e}
s["com.babylonhx.rendering.RenderingManager"]=Ge,Ge.__name__=["com","babylonhx","rendering","RenderingManager"],Ge.prototype={_scene:null,_renderingGroups:null,_depthBufferAlreadyCleaned:null,_renderParticles:function(e,t){if(0!=this._scene._activeParticleSystems.length){for(var i=g["int"](1e3*(Be.stamp()-Oe.__startTime)),n=0,r=this._scene._activeParticleSystems.length;r>n;){var s=n++,o=this._scene._activeParticleSystems.data[s]
o.renderingGroupId==e&&(this._clearDepthBuffer(),(null==o.emitter.position||null==t||-1!=function(){var e,i=o.emitter
return e=c.indexOf(t,i,0)}(this))&&(this._scene._activeParticles+=o.render()))}this._scene._particlesDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-i}},_renderSprites:function(e){if(this._scene.spritesEnabled&&0!=this._scene.spriteManagers.length){for(var t=g["int"](1e3*(Be.stamp()-Oe.__startTime)),i=0,n=this._scene.spriteManagers.length;n>i;){var r=i++,s=this._scene.spriteManagers[r]
s.renderingGroupId==e&&(this._clearDepthBuffer(),s.render())}this._scene._spritesDuration+=g["int"](1e3*(Be.stamp()-Oe.__startTime))-t}},_clearDepthBuffer:function(){this._depthBufferAlreadyCleaned||(this._scene._engine.clear(new tt(0,0,0),!1,!0),this._depthBufferAlreadyCleaned=!0)},render:function(e,t,i,n){for(var r=0;r<Ge.MAX_RENDERINGGROUPS;){this._depthBufferAlreadyCleaned=!1
var s=this._renderingGroups[r],o=!1
null!=s&&(this._clearDepthBuffer(),s.render(e)||(this._renderingGroups.splice(r,1),o=!0)),n&&this._renderSprites(r),i&&this._renderParticles(r,t),o&&r--,++r}},reset:function(){for(var e=0,t=this._renderingGroups;e<t.length;){var i=t[e];++e,null!=i&&i.prepare()}},dispatch:function(e){var t=e._mesh,i=t.renderingGroupId
null==this._renderingGroups[i]&&(this._renderingGroups[i]=new fi(i,this._scene)),this._renderingGroups[i].dispatch(e)},__class__:Ge}
var Ye=t.BABYLON.Plane=function(e,t,i,n){this.normal=new W(e,t,i),this.d=n}
s["com.babylonhx.math.Plane"]=Ye,Ye.__name__=["com","babylonhx","math","Plane"],Ye.FromArray=function(e){return new Ye(e[0],e[1],e[2],e[3])},Ye.FromPoints=function(e,t,i){var n=new Ye(0,0,0,0)
return n.copyFromPoints(e,t,i),n},Ye.FromPositionAndNormal=function(e,t){var i=new Ye(0,0,0,0)
return t.normalize(),i.normal=t,i.d=-(t.x*e.x+t.y*e.y+t.z*e.z),i},Ye.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var n=-(t.x*e.x+t.y*e.y+t.z*e.z)
return i.x*t.x+i.y*t.y+i.z*t.z+n},Ye.prototype={normal:null,d:null,asArray:function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},clone:function(){return new Ye(this.normal.x,this.normal.y,this.normal.z,this.d)},normalize:function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0
0!=e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t},transform:function(e){Ye.transposedMatrix=U.Transpose(e)
var t=this.normal.x,i=this.normal.y,n=this.normal.z,r=this.d,s=t*Ye.transposedMatrix.m[0]+i*Ye.transposedMatrix.m[1]+n*Ye.transposedMatrix.m[2]+r*Ye.transposedMatrix.m[3],o=t*Ye.transposedMatrix.m[4]+i*Ye.transposedMatrix.m[5]+n*Ye.transposedMatrix.m[6]+r*Ye.transposedMatrix.m[7],a=t*Ye.transposedMatrix.m[8]+i*Ye.transposedMatrix.m[9]+n*Ye.transposedMatrix.m[10]+r*Ye.transposedMatrix.m[11],l=t*Ye.transposedMatrix.m[12]+i*Ye.transposedMatrix.m[13]+n*Ye.transposedMatrix.m[14]+r*Ye.transposedMatrix.m[15]
return new Ye(s,o,a,l)},dotCoordinate:function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},copyFromPoints:function(e,t,i){var n,r=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=i.x-e.x,l=i.y-e.y,h=i.z-e.z,u=s*h-o*l,c=o*a-r*h,f=r*l-s*a,d=Math.sqrt(u*u+c*c+f*f)
n=0!=d?1/d:0,this.normal.x=u*n,this.normal.y=c*n,this.normal.z=f*n,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z)},isFrontFacingTo:function(e,t){var i=W.Dot(this.normal,e)
return t>=i},signedDistanceTo:function(e){return W.Dot(e,this.normal)+this.d},__class__:Ye}
var He=t.BABYLON.FresnelParameters=function(){this.power=1,this.bias=0,this.rightColor=Re.Black(),this.leftColor=Re.White(),this.isEnabled=!0}
s["com.babylonhx.materials.FresnelParameters"]=He,He.__name__=["com","babylonhx","materials","FresnelParameters"],He.prototype={isEnabled:null,leftColor:null,rightColor:null,bias:null,power:null,__class__:He}
var Xe=t.BABYLON.MultiMaterial=function(e,t){this.subMaterials=[],Le.call(this,e,t,!0),t.multiMaterials.push(this)}
s["com.babylonhx.materials.MultiMaterial"]=Xe,Xe.__name__=["com","babylonhx","materials","MultiMaterial"],Xe.__super__=Le,Xe.prototype=i(Le.prototype,{subMaterials:null,getSubMaterial:function(e){return 0>e||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},isReady:function(e,t){null==t&&(t=!1)
for(var i=0,n=this.subMaterials.length;n>i;){var r=i++,s=this.subMaterials[r]
if(null!=s&&!this.subMaterials[r].isReady(e))return!1}return!0},clone:function(e){for(var t=new Xe(e,this.getScene()),i=0,n=this.subMaterials.length;n>i;){var r=i++,s=this.subMaterials[r]
t.subMaterials.push(s)}return t},__class__:Xe})
var je=t.BABYLON.AbstractMesh=function(e,t){this._isWorldMatrixFrozen=!1,this._onAfterWorldMatrixUpdate=[],this._intersectionsInProgress=[],this._renderId=0,this._isDisposed=!1,this._pivotMatrix=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._isDirty=!1,this._collisionsScalingMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._collisionsTransformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._absolutePosition=new W(0,0,0),this._rotateYByPI=U.RotationY(Math.PI),this._worldMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localWorld=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localPivotScalingRotation=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localPivotScaling=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localBillboard=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localTranslation=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localRotation=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._localScaling=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._newPositionForCollisions=new W(0,0,0),this._diffPositionForCollisions=new W(0,0,0),this._oldPositionForCollisions=new W(0,0,0),this._collider=new ie,this.ellipsoidOffset=new W(0,0,0),this.ellipsoid=new W(.5,1,.5),this._checkCollisions=!1,this._physicRestitution=0,this._physicsFriction=0,this._physicsMass=0,this._physicImpostor=0,this.alwaysSelectAsActiveMesh=!1,this.layerMask=268435455,this.useOctreeForCollisions=!0,this.useOctreeForPicking=!0,this.useOctreeForRenderingSelection=!0,this.applyFog=!0,this.useVertexColors=!0,this.hasVertexAlpha=!1,this.overlayAlpha=.5,this.overlayColor=Re.Red(),this.renderOverlay=!1,this.outlineWidth=.02,this.outlineColor=Re.Red(),this.renderOutline=!1,this._receiveShadows=!1,this.renderingGroupId=0,this.isBlocker=!1,this.onDispose=null,this.showSubMeshesBoundingBox=!1,this.showBoundingBox=!1,this._isPickable=!0,this.isVisible=!0,this.infiniteDistance=!1,this.alphaIndex=1/0,this._visibility=1,this.billboardMode=je.BILLBOARDMODE_NONE,this.scaling=new W(1,1,1),this.rotation=new W(0,0,0),this.position=new W(0,0,0),this.definedFacingForward=!0,I.call(this,e,t),t.addMesh(this)}
s["com.babylonhx.mesh.AbstractMesh"]=je,je.__name__=["com","babylonhx","mesh","AbstractMesh"],je.__interfaces__=[C],je.__super__=I,je.prototype=i(I.prototype,{definedFacingForward:null,position:null,rotation:null,rotationQuaternion:null,scaling:null,billboardMode:null,_visibility:null,get_visibility:function(){return this._visibility},set_visibility:function(e){return this._visibility=e,e},alphaIndex:null,infiniteDistance:null,isVisible:null,_isPickable:null,get_isPickable:function(){return this._isPickable},set_isPickable:function(e){return this._isPickable=e,e},showBoundingBox:null,showSubMeshesBoundingBox:null,onDispose:null,isBlocker:null,_skeleton:null,get_skeleton:function(){return this._skeleton},set_skeleton:function(e){return this._skeleton=e,e},renderingGroupId:null,_material:null,get_material:function(){return this._material},set_material:function(e){return this._material=e,e},_receiveShadows:null,get_receiveShadows:function(){return this._receiveShadows},set_receiveShadows:function(e){return this._receiveShadows=e,e},actionManager:null,renderOutline:null,outlineColor:null,outlineWidth:null,renderOverlay:null,overlayColor:null,overlayAlpha:null,hasVertexAlpha:null,useVertexColors:null,applyFog:null,useOctreeForRenderingSelection:null,useOctreeForPicking:null,useOctreeForCollisions:null,layerMask:null,alwaysSelectAsActiveMesh:null,_physicImpostor:null,_physicsMass:null,_physicsFriction:null,_physicRestitution:null,_checkCollisions:null,ellipsoid:null,ellipsoidOffset:null,_collider:null,_oldPositionForCollisions:null,_diffPositionForCollisions:null,_newPositionForCollisions:null,_localScaling:null,_localRotation:null,_localTranslation:null,_localBillboard:null,_localPivotScaling:null,_localPivotScalingRotation:null,_localWorld:null,_worldMatrix:null,_rotateYByPI:null,_absolutePosition:null,_collisionsTransformMatrix:null,_collisionsScalingMatrix:null,_savedMaterial:null,_positions:null,get_positions:function(){return this._positions},set_positions:function(e){return this._positions=e,e},get_useBones:function(){return null!=this.get_skeleton()&&this._scene.skeletonsEnabled&&this.isVerticesDataPresent(Qe.MatricesIndicesKind)&&this.isVerticesDataPresent(Qe.MatricesWeightsKind)},_isDirty:null,_masterMesh:null,_boundingInfo:null,_pivotMatrix:null,_isDisposed:null,_renderId:null,subMeshes:null,_submeshesOctree:null,_intersectionsInProgress:null,_onAfterWorldMatrixUpdate:null,_isWorldMatrixFrozen:null,_waitingActions:null,_isBlocked:null,get_isBlocked:function(){return!1},getLOD:function(){return this},getTotalVertices:function(){return 0},getIndices:function(e){return null==e&&(e=!1),null},getVerticesData:function(e,t){return null==t&&(t=!1),null},isVerticesDataPresent:function(){return!1},getBoundingInfo:function(){return null!=this._masterMesh?this._masterMesh.getBoundingInfo():(null==this._boundingInfo&&(null==this._boundingInfo?this._boundingInfo=new le(this.get_absolutePosition(),this.get_absolutePosition()):this._boundingInfo=this._boundingInfo,this._boundingInfo._update(this.get_worldMatrixFromCache()),this._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache())),this._boundingInfo)},_preActivate:function(){},_activate:function(e){this._renderId=e},getWorldMatrix:function(){return null!=this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!=this._scene._renderId&&this.computeWorldMatrix(),this._worldMatrix)},get_worldMatrixFromCache:function(){return this._worldMatrix},get_absolutePosition:function(){return this._absolutePosition},freezeWorldMatrix:function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},unfreezeWorldMatrix:function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},get_isWorldMatrixFrozen:function(){return this._isWorldMatrixFrozen},rotate:function(e,t,i){if(null==this.rotationQuaternion&&(this.rotationQuaternion=N.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=new W(0,0,0)),null==i||i==Mt.LOCAL){var n=N.RotationAxis(e,t)
this.rotationQuaternion=this.rotationQuaternion.multiply(n)}else{if(null!=this.parent){var r=this.parent.getWorldMatrix().clone()
r.invert(),e=W.TransformNormal(e,r)}this.rotationQuaternion=N.RotationAxis(e,t),this.rotationQuaternion=this.rotationQuaternion.multiply(this.rotationQuaternion)}},translate:function(e,t,i){var n=new W(e.x*t,e.y*t,e.z*t)
if(null==i||i==Mt.LOCAL){var r=this.getPositionExpressedInLocalSpace().add(n)
this.computeWorldMatrix(),this.position=W.TransformNormal(r,this._localWorld)}else this.setAbsolutePosition(function(e){var t
return e.computeWorldMatrix(),t=e._absolutePosition}(this).add(n))},getAbsolutePosition:function(){return this.computeWorldMatrix(),this._absolutePosition},setAbsolutePosition:function(e){if(null!=e){var t=0,i=0,n=0
if(e instanceof Array&&null==e.__enum__){if(e.length<3)return
t=e[0],i=e[1],n=e[2]}else t=e.x,i=e.y,n=e.z
if(null!=this.parent){var r=this.parent.getWorldMatrix().clone()
r.invert()
var s=new W(t,i,n)
this.position=W.TransformCoordinates(s,r)}else this.position.x=t,this.position.y=i,this.position.z=n}},movePOV:function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},calcMovePOV:function(e,t,i){var n,r=new U
n=null!=this.rotationQuaternion?this.rotationQuaternion:N.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),n.toRotationMatrix(r)
var s,o=new W(0,0,0)
return s=this.definedFacingForward?-1:1,W.TransformCoordinatesFromFloatsToRef(e*s,t,i*s,r,o),o},rotatePOV:function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},calcRotatePOV:function(e,t,i){var n
return n=this.definedFacingForward?1:-1,new W(e*n,t,i*n)},setPivotMatrix:function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},getPivotMatrix:function(){return this._pivotMatrix},_isSynchronized:function(){if(this._isDirty)return!1
if(this.billboardMode!=je.BILLBOARDMODE_NONE)return!1
if(this._cache.pivotMatrixUpdated)return!1
if(this.infiniteDistance)return!1
if(!this._cache.position.equals(this.position))return!1
if(null!=this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1
return this._cache.scaling.equals(this.scaling)?!0:!1},_initCache:function(){I.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=new W(0,0,0),this._cache.scaling=new W(0,0,0),this._cache.rotation=new W(0,0,0),this._cache.rotationQuaternion=new N(0,0,0,0)},markAsDirty:function(e){"rotation"==e&&(this.rotationQuaternion=null),this._currentRenderId=1/0,this._isDirty=!0},_updateBoundingInfo:function(){null==this._boundingInfo?this._boundingInfo=new le(this.get_absolutePosition(),this.get_absolutePosition()):this._boundingInfo=this._boundingInfo,this._boundingInfo._update(this.get_worldMatrixFromCache()),this._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache())},_updateSubMeshesBoundingInfo:function(e){if(null!=this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;){var n=i[t];++t,null==n._boundingInfo&&n.refreshBoundingInfo(),n._boundingInfo._update(e)}},computeWorldMatrix:function(e){if(null==e&&(e=!1),this._isWorldMatrixFrozen)return this._worldMatrix
if(!e&&(this._currentRenderId==this._scene._renderId||this.isSynchronized(!0)))return this._worldMatrix
if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this._scene._renderId,this._isDirty=!1,U.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),null!=this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,U._tempQuaternion),U._tempQuaternion.toRotationMatrix(this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&null==this.parent){var t=this._scene.activeCamera
if(null!=t){var i=t.getWorldMatrix(),n=new W(i.m[12],i.m[13],i.m[14])
U.TranslationToRef(this.position.x+n.x,this.position.y+n.y,this.position.z+n.z,this._localTranslation)}}else U.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation)
if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!=je.BILLBOARDMODE_NONE&&null!=this._scene.activeCamera){var r=this.position.clone(),s=this._scene.activeCamera.get_globalPosition().clone()
null!=this.parent&&Object.prototype.hasOwnProperty.call(this.parent,"position")&&(r.addInPlace(v.field(this.parent,"position")),U.TranslationToRef(r.x,r.y,r.z,this._localTranslation)),(this.billboardMode&je.BILLBOARDMODE_ALL)!=je.BILLBOARDMODE_ALL?s=this._scene.activeCamera.position:(0!=(this.billboardMode&je.BILLBOARDMODE_X)&&(s.x=r.x+M.Epsilon),0!=(this.billboardMode&je.BILLBOARDMODE_Y)&&(s.y=r.y+.001),0!=(this.billboardMode&je.BILLBOARDMODE_Z)&&(s.z=r.z+.001)),U.LookAtLHToRef(r,s,new W(0,1,0),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),null!=this.parent&&null!=this.parent.getWorldMatrix()&&this.billboardMode==je.BILLBOARDMODE_NONE?(this._parentRenderId=this.parent._currentRenderId,this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),null==this._boundingInfo?this._boundingInfo=new le(this.get_absolutePosition(),this.get_absolutePosition()):this._boundingInfo=this._boundingInfo,this._boundingInfo._update(this.get_worldMatrixFromCache()),this._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache()),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14])
for(var o=0,a=this._onAfterWorldMatrixUpdate;o<a.length;){var l=a[o];++o,l(this)}return this._worldMatrix},registerAfterWorldMatrixUpdate:function(e){this._onAfterWorldMatrixUpdate.push(e)},unregisterAfterWorldMatrixUpdate:function(e){var t=c.indexOf(this._onAfterWorldMatrixUpdate,e,0)
t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},setPositionWithLocalVector:function(e){this.computeWorldMatrix(),this.position=W.TransformNormal(e,this._localWorld)},getPositionExpressedInLocalSpace:function(){this.computeWorldMatrix()
var e=this._localWorld.clone()
return e.invert(),W.TransformNormal(this.position,e)},locallyTranslate:function(e){this.computeWorldMatrix(),this.position=W.TransformCoordinates(e,this._localWorld)},lookAt:function(e,t,i,n){null==n&&(n=0),null==i&&(i=0),null==t&&(t=0)
var r=e.subtract(this.position),s=-Math.atan2(r.z,r.x)-Math.PI/2,o=Math.sqrt(r.x*r.x+r.z*r.z),a=Math.atan2(r.y,o)
this.rotationQuaternion=N.RotationYawPitchRoll(s+t,a+i,n)},isInFrustum:function(e){return this._boundingInfo.isInFrustum(e)},isCompletelyInFrustum:function(e){null==e&&(e=this._scene.activeCamera)
var t=e.getViewMatrix().multiply(e.getProjectionMatrix())
return this._boundingInfo.isCompletelyInFrustum(Ct.GetPlanes(t))?!0:!1},intersectsMesh:function(e,t){return null==t&&(t=!1),null==this._boundingInfo||null==e._boundingInfo?!1:this._boundingInfo.intersects(e._boundingInfo,t)},intersectsPoint:function(e){return null==this._boundingInfo?!1:this._boundingInfo.intersectsPoint(e)},setPhysicsState:function(e,t){var i=this._scene._physicsEngine
return null==i?null:(e=null!=e?e:0,Object.prototype.hasOwnProperty.call(e,"impostor")&&(t=e,e=e.impostor),0==e?(i._unregisterMesh(this),null):(null==t?(t.mass=0,t.friction=.2,t.restitution=.2):(null==t.mass&&(t.mass=0),null==t.friction&&(t.friction=.2),null==t.restitution&&(t.restitution=.2)),this._physicImpostor=e,this._physicsMass=t.mass,this._physicsFriction=t.friction,this._physicRestitution=t.restitution,i._registerMesh(this,e,t)))},getPhysicsImpostor:function(){return this._physicImpostor},getPhysicsMass:function(){return this._physicsMass},getPhysicsFriction:function(){return this._physicsFriction},getPhysicsRestitution:function(){return this._physicRestitution},getPositionInCameraSpace:function(e){return null==e&&(e=this._scene.activeCamera),W.TransformCoordinates(this.get_absolutePosition(),e.getViewMatrix())},getDistanceToCamera:function(e){return null==e&&(e=this._scene.activeCamera),this.get_absolutePosition().subtract(e.position).length()},applyImpulse:function(e,t){0!=this._physicImpostor&&this._scene._physicsEngine._applyImpulse(this,e,t)},setPhysicsLinkWith:function(e,t,i,n){0!=this._physicImpostor&&this._scene._physicsEngine._createLink(this,e,t,i,n)},updatePhysicsBodyPosition:function(){0!=this._physicImpostor&&this._scene._physicsEngine._updateBodyPosition(this)},get_checkCollisions:function(){return this._checkCollisions},set_checkCollisions:function(e){return this._checkCollisions=e,this._scene.get_workerCollisions()&&this._scene.collisionCoordinator.onMeshUpdated(this),e},moveWithCollisions:function(e){var t
this.computeWorldMatrix(),t=this._absolutePosition,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this._scene.collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,r(this,this._onCollisionPositionChange),this.uniqueId)},_onCollisionPositionChange:function(e,t){this._scene.get_workerCollisions()&&t.multiplyInPlace(this._collider.radius),t.subtractToRef(this._oldPositionForCollisions,this._diffPositionForCollisions),this._diffPositionForCollisions.length()>M.CollisionsEpsilon&&this.position.addInPlace(this._diffPositionForCollisions)},createOrUpdateSubmeshesOctree:function(e,t){null==t&&(t=2),null==e&&(e=64),null==this._submeshesOctree&&(this._submeshesOctree=new ce(ce.CreationFuncForSubMeshes,e,t)),this.computeWorldMatrix(!0)
var i=this.getBoundingInfo().boundingBox
return this._submeshesOctree.update(i.minimumWorld,i.maximumWorld,this.subMeshes),this._submeshesOctree},_collideForSubMesh:function(e,t,i){if(this._generatePointsArray(),null==e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=U.FromValues(t.m[0],t.m[1],t.m[2],t.m[3],t.m[4],t.m[5],t.m[6],t.m[7],t.m[8],t.m[9],t.m[10],t.m[11],t.m[12],t.m[13],t.m[14],t.m[15]),e._lastColliderWorldVertices=[],e._trianglePlanes=[]
for(var n=e.verticesStart,r=e.verticesStart+e.verticesCount,s=n;r>s;){var o=s++
e._lastColliderWorldVertices.push(W.TransformCoordinates(this._positions[o],t))}}i._collide(e,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart),i.collisionFound&&(i.collidedMesh=this)},_processCollisionsForSubMeshes:function(e,t){var i,n=0
if(null!=this._submeshesOctree&&this.useOctreeForCollisions){var r=e.velocityWorldLength+Math.max(Math.max(e.radius.x,e.radius.y),e.radius.z),s=this._submeshesOctree.intersects(e.basePointWorld,r,null)
n=s.length,i=s.data}else i=this.subMeshes,n=i.length
for(var o=0;n>o;){var a=o++,l=i[a]
n>1&&!l._boundingInfo._checkCollision(e)||this._collideForSubMesh(l,t,e)}},_checkCollision:function(e){this._boundingInfo._checkCollision(e)&&(U.ScalingToRef(1/e.radius.x,1/e.radius.y,1/e.radius.z,this._collisionsScalingMatrix),this.get_worldMatrixFromCache().multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(e,this._collisionsTransformMatrix))},_generatePointsArray:function(){return!1},intersects:function(e,t){null==t&&(t=!1)
var i=new oe
if(null==this.subMeshes||null==this._boundingInfo||!e.intersectsSphere(this._boundingInfo.boundingSphere)||!e.intersectsBox(this._boundingInfo.boundingBox))return i
if(!this._generatePointsArray())return i
var n,r,s=null
if(null!=this._submeshesOctree&&this.useOctreeForPicking){var o=Pt.Transform(e,this.getWorldMatrix()),a=this._submeshesOctree.intersectsRay(o)
r=a.length,n=a.data}else n=this.subMeshes,r=n.length
for(var l=0;r>l;){var h=l++,u=n[h]
if(!(r>1)||e.intersectsBox(u._boundingInfo.boundingBox)){var c=u.intersects(e,this._positions,this.getIndices(),t)
if(null!=c&&(t||null==s||c.distance<s.distance)&&(s=c,t))break}}if(null!=s){var f=this.getWorldMatrix(),d=W.TransformCoordinates(e.origin,f),m=e.direction.clone()
m=m.scale(s.distance)
var _=W.TransformNormal(m,f),p=new W(d.x+_.x,d.y+_.y,d.z+_.z)
return i.hit=!0,i.distance=Math.sqrt(W.DistanceSquared(d,p)),i.pickedPoint=p,i.pickedMesh=this,i.bu=s.bu,i.bv=s.bv,i.faceId=s.faceId,i.subMeshId=s.subMeshId,i}return i},clone:function(e,t,i){return null==i&&(i=!1),null},releaseSubMeshes:function(){if(null!=this.subMeshes)for(;this.subMeshes.length>0;)this.subMeshes[0].dispose()
else this.subMeshes=[]},dispose:function(e){null==e&&(e=!1),0!=this._physicImpostor&&this.setPhysicsState(0)
for(var t=0,i=this._intersectionsInProgress.length;i>t;){var n=t++,r=this._intersectionsInProgress[n],s=c.indexOf(r._intersectionsInProgress,this,0)
r._intersectionsInProgress.splice(s,1)}if(this._intersectionsInProgress=[],this.releaseSubMeshes(),this._scene.removeMesh(this),e)for(var o=0,a=this._scene.meshes.length;a>o;){var l=o++,h=this._scene.meshes[l]
h.parent==this&&(h.parent=null,h.computeWorldMatrix(!0))}else{for(var u=0;u<this._scene.particleSystems.length;)this._scene.particleSystems[u].emitter==this&&(this._scene.particleSystems[u].dispose(null),u--),++u
for(var f=this._scene.meshes.slice(0),d=0,m=f.length;m>d;){var _=d++
f[_].parent==this&&f[_].dispose()}}this._onAfterWorldMatrixUpdate=[],this._isDisposed=!0,null!=this.onDispose&&this.onDispose()},__class__:je,__properties__:{set_checkCollisions:"set_checkCollisions",get_checkCollisions:"get_checkCollisions",get_isWorldMatrixFrozen:"get_isWorldMatrixFrozen",get_absolutePosition:"get_absolutePosition",get_worldMatrixFromCache:"get_worldMatrixFromCache",get_isBlocked:"get_isBlocked",get_useBones:"get_useBones",set_positions:"set_positions",get_positions:"get_positions",set_receiveShadows:"set_receiveShadows",get_receiveShadows:"get_receiveShadows",set_material:"set_material",get_material:"get_material",set_skeleton:"set_skeleton",get_skeleton:"get_skeleton",set_isPickable:"set_isPickable",get_isPickable:"get_isPickable",set_visibility:"set_visibility",get_visibility:"get_visibility"}})
var Ke=t.BABYLON.IGetSetVerticesData=function(){}
s["com.babylonhx.mesh.IGetSetVerticesData"]=Ke,Ke.__name__=["com","babylonhx","mesh","IGetSetVerticesData"],Ke.prototype={isVerticesDataPresent:null,getVerticesData:null,getIndices:null,setVerticesData:null,updateVerticesData:null,setIndices:null,__class__:Ke}
var Ze=t.VertexData=function(){}
s["com.babylonhx.mesh.VertexData"]=Ze,Ze.__name__=["com","babylonhx","mesh","VertexData"],Ze.ExtractFromMesh=function(e,t){return null==t&&(t=!1),Ze._ExtractFrom(e,t)},Ze.ExtractFromGeometry=function(e,t){return null==t&&(t=!1),Ze._ExtractFrom(e,t)},Ze._ExtractFrom=function(e,t){null==t&&(t=!1)
var i=new Ze
return e.isVerticesDataPresent(Qe.PositionKind)&&(i.positions=e.getVerticesData(Qe.PositionKind,t)),e.isVerticesDataPresent(Qe.NormalKind)&&(i.normals=e.getVerticesData(Qe.NormalKind,t)),e.isVerticesDataPresent(Qe.UVKind)&&(i.uvs=e.getVerticesData(Qe.UVKind,t)),e.isVerticesDataPresent(Qe.UV2Kind)&&(i.uv2s=e.getVerticesData(Qe.UV2Kind,t)),e.isVerticesDataPresent(Qe.ColorKind)&&(i.colors=e.getVerticesData(Qe.ColorKind,t)),e.isVerticesDataPresent(Qe.MatricesIndicesKind)&&(i.matricesIndices=e.getVerticesData(Qe.MatricesIndicesKind,t)),e.isVerticesDataPresent(Qe.MatricesWeightsKind)&&(i.matricesWeights=e.getVerticesData(Qe.MatricesWeightsKind,t)),i.indices=e.getIndices(t),i},Ze.CreateRibbon=function(e,t,i,n,r){null==r&&(r=0),null==i&&(i=!1),null==t&&(t=!1)
var s=Math.floor(e[0].length/2)
n=null!=n?n:s,n=n>s?s:Math.floor(n)
var o=[],a=[],l=[],h=[],u=[],c=[],f=[],d=[],m=0,_=0,p=0,v=[],g=[],x=0
if(e.length<2){for(var y=[],b=[],w=0,S=e[0].length-n;S>w;){var M=w++
y.push(e[0][M]),b.push(e[0][M+n])}e=[y,b]}var T=0
m=e[0].length
for(var C=0,A=e.length;A>C;){var I=C++
f[I]=0,u[I]=[0]
var P=e[I],E=P.length
m=E>m?m:E,v[I]=E,g[I]=T
for(var D=0;E>D;)a.push(P[D].x),a.push(P[D].y),a.push(P[D].z),D>0&&(_=P[D].subtract(P[D-1]).length(),p=_+f[I],u[I].push(p),f[I]=p),D++
i&&(_=P[0].subtract(P[D-1]).length(),p=_+f[I],f[I]=p),T+=E}for(var L=0;m>L;){var F=L++
d[F]=0,c[F]=[0]
for(var R=[],z=[],B=0,O=e.length-1;O>B;){var k=B++
R=e[k],z=e[k+1],_=z[F].subtract(R[F]).length(),p=_+d[F],c[F].push(p),d[F]=p}t&&(R=e[x],z=e[0],_=z[F].subtract(R[F]).length(),p=_+d[F],d[F]=p)}for(var V=0,N=0,U=0,W=e.length;W>U;)for(var G=U++,Y=0;m>Y;){var H=Y++
V=u[G][H]/f[G],N=c[H][G]/d[H],h.push(V),h.push(N)}x=0
var X,j=0,K=v[x]-1,Z=v[x+1]-1
X=Z>K?K:Z
var q,Q=g[1]-g[0]
q=t?v.length:v.length-1
for(var J=0,$=0,ee=0,te=0;X>=j&&q>x;)J=j,$=j+Q,ee=j+1,te=j+Q+1,o.push(j),o.push(j+Q),o.push(j+1),o.push(j+Q+1),o.push(j+1),o.push(j+Q),j+=1,j==X&&(i&&(o.push(j),o.push(j+Q),o.push(g[x]),o.push(g[x]+Q),o.push(g[x]),o.push(j+Q),ee=g[x],te=g[x]+Q),x++,x==v.length-1?(Q=g[0]-g[x],K=v[x]-1,Z=v[0]-1):(Q=g[x+1]-g[x],K=v[x]-1,Z=v[x+1]-1),j=g[x],X=Z>K?K+j:Z+j)
Ze.ComputeNormals(a,o,l),Ze._ComputeSides(r,a,o,l,h)
var ie=new Ze
return ie.indices=o,ie.positions=a,ie.normals=l,ie.uvs=h,ie},Ze.CreateBox=function(e,t){null==t&&(t=0),null==e&&(e=1)
for(var i=[new W(0,0,1),new W(0,0,-1),new W(1,0,0),new W(-1,0,0),new W(0,1,0),new W(0,-1,0)],n=[],r=[],s=[],o=[],a=0,l=i.length;l>a;){var h=a++,u=i[h],c=new W(u.y,u.z,u.x),f=W.Cross(u,c),d=r.length/3|0
n.push(d),n.push(d+1),n.push(d+2),n.push(d),n.push(d+2),n.push(d+3)
var m=new W(u.x-c.x,u.y-c.y,u.z-c.z).subtract(f).scale(e/2)
r.push(m.x),r.push(m.y),r.push(m.z),s.push(u.x),s.push(u.y),s.push(u.z),o.push(1),o.push(1),m=new W(u.x-c.x,u.y-c.y,u.z-c.z).add(f).scale(e/2),r.push(m.x),r.push(m.y),r.push(m.z),s.push(u.x),s.push(u.y),s.push(u.z),o.push(0),o.push(1),m=new W(u.x+c.x,u.y+c.y,u.z+c.z).add(f).scale(e/2),r.push(m.x),r.push(m.y),r.push(m.z),s.push(u.x),s.push(u.y),s.push(u.z),o.push(0),o.push(0),m=new W(u.x+c.x,u.y+c.y,u.z+c.z).subtract(f).scale(e/2),r.push(m.x),r.push(m.y),r.push(m.z),s.push(u.x),s.push(u.y),s.push(u.z),o.push(1),o.push(0)}Ze._ComputeSides(t,r,n,s,o)
var _=new Ze
return _.indices=n,_.positions=r,_.normals=s,_.uvs=o,_},Ze.CreateSphere=function(e,t,i){null==i&&(i=0),null==t&&(t=1),null==e&&(e=32)
for(var n=t/2,r=2+e,s=2*r,o=[],a=[],l=[],h=[],u=0,c=r+1;c>u;){for(var f=u++,d=f/r,m=d*Math.PI,_=0,p=s+1;p>_;){var v=_++,g=v/s,x=g*Math.PI*2,y=U.RotationZ(-m),b=U.RotationY(x),w=W.TransformCoordinates(new W(0,1,0),y),S=W.TransformCoordinates(w,b),M=new W(S.x*n,S.y*n,S.z*n),T=W.Normalize(M)
a.push(M.x),a.push(M.y),a.push(M.z),l.push(T.x),l.push(T.y),l.push(T.z),h.push(d),h.push(g)}if(f>0)for(var C=a.length/3,A=C-2*(s+1)|0;C>A+s+2;)o.push(A),o.push(A+1),o.push(A+s+1),o.push(A+s+1),o.push(A+1),o.push(A+s+2),A++}Ze._ComputeSides(i,a,o,l,h)
var I=new Ze
return I.indices=o,I.positions=a,I.normals=l,I.uvs=h,I},Ze.CreateCylinder=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=1),null==n&&(n=16),null==i&&(i=1),null==t&&(t=.5),null==e&&(e=1)
var o=t/2,a=i/2,l=[],h=[],u=[],c=[]
r=1>r?1:r
for(var f=function(e){var t=2*e*Math.PI/n,i=Math.cos(t),r=Math.sin(t)
return new W(i,0,r)},d=function(t){var i
if(i=t?o:a,0!=i){var r=h.length/3|0,s=new W(0,e/2,0),u=new Et(.5,.5)
t||(s.x*=-1,s.y*=-1,s.z*=-1,u.x=-u.x)
for(var d=0;n>d;){var m=d++,_=f(m),p=new W(_.x*i,_.y*i,_.z*i).add(s),v=new Et(_.x*u.x+.5,_.z*u.y+.5)
h.push(p.x),h.push(p.y),h.push(p.z),c.push(v.x),c.push(v.y)}for(var g=0,x=n-2;x>g;){var y=g++
t?(l.push(r),l.push(r+(y+1)%n),l.push(r+(y+2)%n)):(l.push(r),l.push(r+(y+2)%n),l.push(r+(y+1)%n))}}},m=new W(0,-1,0).scale(e/2),_=new W(0,1,0).scale(e/r),p=n+1,v=0,g=n+1;g>v;)for(var x=v++,y=f(x),b=new Et(x/n,0),w=null,S=a,M=0,T=r+1;T>M;){var C=M++
w=new W(y.x*S,y.y*S,y.z*S),w.addInPlace(m.add(new W(_.x*C,_.y*C,_.z*C))),b.y+=1/r,S+=(o-a)/r,h.push(w.x),h.push(w.y),h.push(w.z),c.push(b.x),c.push(b.y)}r+=1
for(var A=0,I=r-1;I>A;)for(var P=A++,E=0,D=n+1;D>E;){var L=E++
l.push(L*r+P),l.push((L*r+(P+r))%(p*r)),l.push(L*r+(P+1)),l.push(L*r+(P+1)),l.push((L*r+(P+r))%(p*r)),l.push((L*r+(P+r+1))%(p*r))}d(!0),d(!1),Ze.ComputeNormals(h,l,u),Ze._ComputeSides(s,h,l,u,c)
var F=new Ze
return F.indices=l,F.positions=h,F.normals=u,F.uvs=c,F},Ze.CreateTorus=function(e,t,i,n){null==n&&(n=0),null==i&&(i=16),null==t&&(t=.5),null==e&&(e=1)
for(var r=[],s=[],o=[],a=[],l=i+1,h=0,u=i+1;u>h;)for(var c=h++,f=c/i,d=c*Math.PI*2/i-Math.PI/2,m=U.Translation(e/2,0,0).multiply(U.RotationY(d)),_=0,p=i+1;p>_;){var v=_++,g=1-v/i,x=v*Math.PI*2/i+Math.PI,y=Math.cos(x),b=Math.sin(x),w=new W(y,b,0),S=w.scale(t/2),M=new Et(f,g)
S=W.TransformCoordinates(S,m),w=W.TransformNormal(w,m),s.push(S.x),s.push(S.y),s.push(S.z),o.push(w.x),o.push(w.y),o.push(w.z),a.push(M.x),a.push(M.y)
var T=(c+1)%l,C=(v+1)%l
r.push(c*l+v),r.push(c*l+C),r.push(T*l+v),r.push(c*l+C),r.push(T*l+C),r.push(T*l+v)}Ze._ComputeSides(n,s,r,o,a)
var A=new Ze
return A.indices=r,A.positions=s,A.normals=o,A.uvs=a,A},Ze.CreateLines=function(e){for(var t=[],i=[],n=0,r=e.length;r>n;){var s=n++
i.push(e[s].x),i.push(e[s].y),i.push(e[s].z),s>0&&(t.push(s-1),t.push(s))}var o=new Ze
return o.indices=t,o.positions=i,o},Ze.CreateGround=function(e,t,i){null==i&&(i=1),null==t&&(t=1),null==e&&(e=1)
for(var n=[],r=[],s=[],o=[],a=0,l=i+1;l>a;)for(var h=a++,u=0,c=i+1;c>u;){var f=u++,d=new W(f*e/i-e/2,0,(i-h)*t/i-t/2),m=new W(0,1,0)
r.push(d.x),r.push(d.y),r.push(d.z),s.push(m.x),s.push(m.y),s.push(m.z),o.push(f/i),o.push(1-h/i)}for(var _=0;i>_;)for(var p=_++,v=0;i>v;){var g=v++
n.push(g+1+(p+1)*(i+1)),n.push(g+1+p*(i+1)),n.push(g+p*(i+1)),n.push(g+(p+1)*(i+1)),n.push(g+1+(p+1)*(i+1)),n.push(g+p*(i+1))}var x=new Ze
return x.indices=n,x.positions=r,x.normals=s,x.uvs=o,x},Ze.CreateTiledGround=function(e,t,i,n,r,s){null==r&&(r={w:1,h:1}),null==s&&(s={w:1,h:1})
var o=[],a=[],l=[],h=[]
r.w<1?r.h=1:r.h=r.h,r.w<1?r.w=1:r.w=r.w,s.w<1?s.w=1:s.w=s.w,s.h<1?s.h=1:s.h=s.h
for(var u=(i-e)/r.w,c=(n-t)/r.h,f=function(e,t,i,n){for(var r=a.length/3,u=s.w+1,c=0,f=s.h;f>c;)for(var d=c++,m=0,_=s.w;_>m;){var p=m++,v=r+p+d*u|0,g=r+(p+1)+d*u|0,x=r+(p+1)+(d+1)*u|0,y=r+p+(d+1)*u|0
o.push(g),o.push(x),o.push(y),o.push(v),o.push(g),o.push(y)}for(var b=new W(0,0,0),w=new W(0,1,0),S=0,M=s.h+1;M>S;){var T=S++
b.z=T*(n-t)/s.h+t
for(var C=0,A=s.w+1;A>C;){var I=C++
b.x=I*(i-e)/s.w+e,b.y=0,a.push(b.x),a.push(b.y),a.push(b.z),l.push(w.x),l.push(w.y),l.push(w.z),h.push(I/s.w),h.push(T/s.h)}}},d=0,m=r.h;m>d;)for(var _=d++,p=0,v=r.w;v>p;){var g=p++
f(e+g*u,t+_*c,e+(g+1)*u,t+(_+1)*c)}var x=new Ze
return x.indices=o,x.positions=a,x.normals=l,x.uvs=h,x},Ze.CreateGroundFromHeightMap=function(e,t,i,n,r,s,o,a){for(var l=[],h=[],u=[],c=[],f=0,d=i+1;d>f;)for(var m=f++,_=0,p=i+1;p>_;){var v=_++,g=new W(v*e/i-e/2,0,(i-m)*t/i-t/2),x=(g.x+e/2)/e*(o-1)|0,y=(1-(g.z+t/2)/t)*(a-1)|0,b=4*(x+y*o)|0,w=s[b]/255,S=s[b+1]/255,M=s[b+2]/255,T=.3*w+.59*S+.11*M
g.y=n+(r-n)*T,h.push(g.x),h.push(g.y),h.push(g.z),u.push(0),u.push(0),u.push(0),c.push(v/i),c.push(1-m/i)}for(var C=0;i>C;)for(var A=C++,I=0;i>I;){var P=I++
l.push(P+1+(A+1)*(i+1)),l.push(P+1+A*(i+1)),l.push(P+A*(i+1)),l.push(P+(A+1)*(i+1)),l.push(P+1+(A+1)*(i+1)),l.push(P+A*(i+1))}Ze.ComputeNormals(h,l,u)
var E=new Ze
return E.indices=l,E.positions=h,E.normals=u,E.uvs=c,E},Ze.CreatePlane=function(e,t){null==t&&(t=0),null==e&&(e=1)
var i=[],n=[],r=[],s=[],o=e/2
n.push(-o),n.push(-o),n.push(0),r.push(0),r.push(0),r.push(-1),s.push(0),s.push(0),n.push(o),n.push(-o),n.push(0),r.push(0),r.push(0),r.push(-1),s.push(1),s.push(0),n.push(o),n.push(o),n.push(0),r.push(0),r.push(0),r.push(-1),s.push(1),s.push(1),n.push(-o),n.push(o),n.push(0),r.push(0),r.push(0),r.push(-1),s.push(0),s.push(1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),Ze._ComputeSides(t,n,i,r,s)
var a=new Ze
return a.indices=i,a.positions=n,a.normals=r,a.uvs=s,a},Ze.CreateDisc=function(e,t,i){null==i&&(i=0)
var n=[],r=[],s=[],o=[]
r.push(0),r.push(0),r.push(0),o.push(.5),o.push(.5)
for(var a=2*Math.PI/t,l=0;l<2*Math.PI;){var h=Math.cos(l),u=Math.sin(l),c=(h+1)/2,f=(1-u)/2
r.push(e*h),r.push(e*u),r.push(0),o.push(c),o.push(f),l+=a}r.push(r[3]),r.push(r[4]),r.push(r[5]),o.push(o[2]),o.push(o[3])
for(var d=r.length/3|0,m=1,_=d-1;_>m;){var p=m++
n.push(p+1),n.push(0),n.push(p)}Ze.ComputeNormals(r,n,s),Ze._ComputeSides(i,r,n,s,o)
var v=new Ze
return v.indices=n,v.positions=r,v.normals=s,v.uvs=o,v},Ze.CreateTorusKnot=function(e,t,i,n,r,s,o){null==o&&(o=0),null==s&&(s=3),null==r&&(r=2),null==n&&(n=32),null==i&&(i=32),null==t&&(t=.5),null==e&&(e=2)
for(var a=[],l=[],h=[],u=[],c=function(t){var i=Math.cos(t),n=Math.sin(t),o=s/r*t,a=Math.cos(o),l=e*(2+a)*.5*i,h=e*(2+a)*n*.5,u=e*Math.sin(o)*.5
return new W(l,h,u)},f=0,d=i+1;d>f;){var m=f++,_=m%i,p=_/i*2*r*Math.PI,v=c(p),g=c(p+.01),x=new W(g.x-v.x,g.y-v.y,g.z-v.z),y=new W(g.x+v.x,g.y+v.y,g.z+v.z),b=W.Cross(x,y)
y=W.Cross(b,x),b.normalize(),y.normalize()
for(var w=0;n>w;){var S=w++,M=S%n,T=M/n*2*Math.PI,C=-t*Math.cos(T),A=t*Math.sin(T)
l.push(v.x+C*y.x+A*b.x),l.push(v.y+C*y.y+A*b.y),l.push(v.z+C*y.z+A*b.z),u.push(m/i),u.push(S/n)}}for(var I=0;i>I;)for(var P=I++,E=0;n>E;){var D=E++,L=(D+1)%n,F=P*n+D,R=(P+1)*n+D,z=(P+1)*n+L,B=P*n+L
a.push(B),a.push(R),a.push(F),a.push(B),a.push(z),a.push(R)}Ze.ComputeNormals(l,a,h),Ze._ComputeSides(o,l,a,h,u)
var O=new Ze
return O.indices=a,O.positions=l,O.normals=h,O.uvs=u,O},Ze.ComputeNormals=function(e,t,i){for(var n=new W(0,0,0),r=new W(0,0,0),s=new W(0,0,0),o=new W(0,0,0),a=new W(0,0,0),l=new W(0,0,0),h=new W(0,0,0),u=new W(0,0,0),c=new W(0,0,0),f=t.length/3|0,d=0;f>d;){var m=d++,_=t[3*m],p=t[3*m+1],v=t[3*m+2]
n.x=e[3*_],n.y=e[3*_+1],n.z=e[3*_+2],r.x=e[3*p],r.y=e[3*p+1],r.z=e[3*p+2],s.x=e[3*v],s.y=e[3*v+1],s.z=e[3*v+2],o.x=n.x-r.x,o.y=n.y-r.y,o.z=n.z-r.z,a.x=s.x-r.x,a.y=s.y-r.y,a.z=s.z-r.z,l.x=o.y*a.z-o.z*a.y,l.y=o.z*a.x-o.x*a.z,l.z=o.x*a.y-o.y*a.x,l.normalize(),h.x=i[3*_],h.y=i[3*_+1],h.z=i[3*_+2],u.x=i[3*p],u.y=i[3*p+1],u.z=i[3*p+2],c.x=i[3*v],c.y=i[3*v+1],c.z=i[3*v+2],h.x+=l.x,h.y+=l.y,h.z+=l.z,h=h,u.x+=l.x,u.y+=l.y,u.z+=l.z,u=u,c.x+=l.x,c.y+=l.y,c.z+=l.z,c=c,i[3*_]=h.x,i[3*_+1]=h.y,i[3*_+2]=h.z,i[3*p]=u.x,i[3*p+1]=u.y,i[3*p+2]=u.z,i[3*v]=c.x,i[3*v+1]=c.y,i[3*v+2]=c.z}for(var g=i.length/3|0,x=0;g>x;){var y=x++
h.x=i[3*y],h.y=i[3*y+1],h.z=i[3*y+2],h.normalize(),i[3*y]=h.x,i[3*y+1]=h.y,i[3*y+2]=h.z}},Ze._ComputeSides=function(e,t,i,n,r){null==e&&(e=0)
var s=i.length,o=n.length
switch(e){case 0:break
case 1:for(var a=0,l=0;s>l;)a=i[l],i[l]=i[l+2],i[l+2]=a,l+=3
for(var h=0;o>h;){var u=h++
n[u]=-n[u]}break
case 2:for(var c=t.length,f=c/3|0,d=0;c>d;){var m=d++
t[c+m]=t[m]}for(var _=0;s>_;)i[_+s]=i[_+2]+f,i[_+1+s]=i[_+1]+f,i[_+2+s]=i[_]+f,_+=3
for(var p=0;o>p;){var v=p++
n[o+v]=-n[v]}for(var g=r.length,x=0;g>x;){var y=x++
r[y+g]=r[y]}}},Ze.prototype={positions:null,normals:null,uvs:null,uv2s:null,colors:null,matricesIndices:null,matricesWeights:null,indices:null,set:function(e,t){switch(t){case"position":this.positions=e
break
case"normal":this.normals=e
break
case"uv":this.uvs=e
break
case"uv2":this.uv2s=e
break
case"color":this.colors=e
break
case"matricesIndices":this.matricesIndices=e
break
case"matricesWeights":this.matricesWeights=e}},applyToMesh:function(e,t){null==t&&(t=!1),this._applyTo(e,t)},applyToGeometry:function(e,t){null==t&&(t=!1),this._applyTo(e,t)},updateMesh:function(e,t,i){null==i&&(i=!1),this._update(e)},updateGeometry:function(e,t,i){null==i&&(i=!1),this._update(e)},_applyTo:function(e,t){null==t&&(t=!1),null!=this.positions&&e.setVerticesData(Qe.PositionKind,this.positions,t),null!=this.normals&&e.setVerticesData(Qe.NormalKind,this.normals,t),null!=this.uvs&&e.setVerticesData(Qe.UVKind,this.uvs,t),null!=this.uv2s&&e.setVerticesData(Qe.UV2Kind,this.uv2s,t),null!=this.colors&&e.setVerticesData(Qe.ColorKind,this.colors,t),null!=this.matricesIndices&&e.setVerticesData(Qe.MatricesIndicesKind,this.matricesIndices,t),null!=this.matricesWeights&&e.setVerticesData(Qe.MatricesWeightsKind,this.matricesWeights,t),null!=this.indices&&e.setIndices(this.indices)},_update:function(e,t,i){null==i&&(i=!1),null!=this.positions&&e.updateVerticesData(Qe.PositionKind,this.positions,t,i),null!=this.normals&&e.updateVerticesData(Qe.NormalKind,this.normals,t,i),null!=this.uvs&&e.updateVerticesData(Qe.UVKind,this.uvs,t,i),null!=this.uv2s&&e.updateVerticesData(Qe.UV2Kind,this.uv2s,t,i),null!=this.colors&&e.updateVerticesData(Qe.ColorKind,this.colors,t,i),null!=this.matricesIndices&&e.updateVerticesData(Qe.MatricesIndicesKind,this.matricesIndices,t,i),null!=this.matricesWeights&&e.updateVerticesData(Qe.MatricesWeightsKind,this.matricesWeights,t,i),null!=this.indices&&e.setIndices(this.indices)},transform:function(e){var t=new W(0,0,0)
if(null!=this.positions)for(var i=new W(0,0,0),n=0;n<this.positions.length;)W.FromArrayToRef(this.positions,n,i),W.TransformCoordinatesToRef(i,e,t),this.positions[n]=t.x,this.positions[n+1]=t.y,this.positions[n+2]=t.z,n+=3
if(null!=this.normals)for(var r=new W(0,0,0),s=0;s<this.normals.length;)W.FromArrayToRef(this.normals,s,r),t.x=r.x*e.m[0]+r.y*e.m[4]+r.z*e.m[8],t.y=r.x*e.m[1]+r.y*e.m[5]+r.z*e.m[9],t.z=r.x*e.m[2]+r.y*e.m[6]+r.z*e.m[10],this.normals[s]=t.x,this.normals[s+1]=t.y,this.normals[s+2]=t.z,s+=3},merge:function(e){if(null!=e.indices){null==this.indices&&(this.indices=[])
var t
t=0|(null==this.positions?this.positions.length/3:0)
for(var i=0,n=e.indices.length;n>i;){var r=i++
this.indices.push(e.indices[r]+t)}}if(null!=e.positions){null==this.positions&&(this.positions=[])
for(var s=0,o=e.positions.length;o>s;){var a=s++
this.positions.push(e.positions[a])}}if(null!=e.normals){null==this.normals&&(this.normals=[])
for(var l=0,h=e.normals.length;h>l;){var u=l++
this.normals.push(e.normals[u])}}if(null!=e.uvs){null==this.uvs&&(this.uvs=[])
for(var c=0,f=e.uvs.length;f>c;){var d=c++
this.uvs.push(e.uvs[d])}}if(null!=e.uv2s){null==this.uv2s&&(this.uv2s=[])
for(var m=0,_=e.uv2s.length;_>m;){var p=m++
this.uv2s.push(e.uv2s[p])}}if(null!=e.matricesIndices){null==this.matricesIndices&&(this.matricesIndices=[])
for(var v=0,g=e.matricesIndices.length;g>v;){var x=v++
this.matricesIndices.push(e.matricesIndices[x])}}if(null!=e.matricesWeights){null==this.matricesWeights&&(this.matricesWeights=[])
for(var y=0,b=e.matricesWeights.length;b>y;){var w=y++
this.matricesWeights.push(e.matricesWeights[w])}}if(null!=e.colors){null==this.colors&&(this.colors=[])
for(var S=0,M=e.colors.length;M>S;){var T=S++
this.colors.push(e.colors[T])}}},__class__:Ze}
var qe=t.BABYLON.Mesh=function(e,t,i,n,r){if(null==r&&(r=!1),this.cap=0,this._areNormalsFrozen=!1,this._sideOrientation=0,this._preActivateId=-1,this._instancesBufferSize=2048,this._batchCache=new Ot,this._renderIdForInstances=[],this._onAfterRenderCallbacks=[],this._onBeforeRenderCallbacks=[],this._LODLevels=[],this.instances=[],this.delayLoadState=0,je.call(this,e,t),null!=n){if(null!=n._geometry&&n._geometry.applyToMesh(this),qe._deepCopy(n,this),!r)for(var s=0,o=t.meshes.length;o>s;){var a=s++,l=t.meshes[a]
if(l.parent==n){l.clone(e+"."+l.name,this,r)}}for(var h=0,u=t.particleSystems.length;u>h;){var c=h++,f=t.particleSystems[c]
f.emitter==n&&f.clone(f.name,this)}this.computeWorldMatrix(!0)}null!=i&&(this.parent=i)}
s["com.babylonhx.mesh.Mesh"]=qe,qe.__name__=["com","babylonhx","mesh","Mesh"],qe.__interfaces__=[Ke],qe._deepCopy=function(e,t){t.__smartArrayFlags=e.__smartArrayFlags.slice(),t._LODLevels=e._LODLevels.slice(),t._absolutePosition=e._absolutePosition.clone(),t._batchCache=e._batchCache,t._boundingInfo=e._boundingInfo,t._cache=e._cache,t._checkCollisions=e._checkCollisions,t._childrenFlag=e._childrenFlag,t._collider=e._collider,t.instances=e.instances.slice(),t._collisionsScalingMatrix=e._collisionsScalingMatrix.clone(),t._collisionsTransformMatrix=e._collisionsTransformMatrix.clone(),t._diffPositionForCollisions=e._diffPositionForCollisions.clone(),t._geometry=e._geometry,t._instancesBufferSize=e._instancesBufferSize,t._intersectionsInProgress=e._intersectionsInProgress.slice(),t._isBlocked=e._isBlocked,t._isDirty=e._isDirty,t._isDisposed=e._isDisposed,t._isEnabled=e._isEnabled,t._isPickable=e._isPickable,t._isReady=e._isReady,t._localBillboard=e._localBillboard.clone(),t._localPivotScaling=e._localPivotScaling.clone(),t._localRotation=e._localRotation.clone(),t._localScaling=e._localScaling.clone(),t._localTranslation=e._localTranslation.clone(),t._localWorld=e._localWorld,t._masterMesh=e._masterMesh,t._material=e._material,t._newPositionForCollisions=e._newPositionForCollisions.clone(),t._oldPositionForCollisions=e._oldPositionForCollisions.clone(),t._onAfterRenderCallbacks=e._onAfterRenderCallbacks,t._onAfterWorldMatrixUpdate=e._onAfterWorldMatrixUpdate,t._onBeforeRenderCallbacks=e._onBeforeRenderCallbacks,t._parentRenderId=e._parentRenderId,t._physicImpostor=e._physicImpostor,t._physicRestitution=e._physicRestitution,t._physicsFriction=e._physicsFriction,t._physicsMass=e._physicsMass,t._pivotMatrix=e._pivotMatrix.clone(),null!=e._positions&&(t._positions=e._positions.slice()),t._preActivateId=e._preActivateId,t._receiveShadows=e._receiveShadows,t._renderId=e._renderId,t._renderIdForInstances=e._renderIdForInstances.slice(),t._rotateYByPI=e._rotateYByPI.clone(),t._savedMaterial=e._savedMaterial,t._scene=e._scene,t._shouldGenerateFlatShading=e._shouldGenerateFlatShading,t._submeshesOctree=e._submeshesOctree,t._visibility=e._visibility,t._visibleInstances=e._visibleInstances,t._waitingActions=e._waitingActions,t._waitingParentId=e._waitingParentId,t._worldMatricesInstancesBuffer=e._worldMatricesInstancesBuffer,t._worldMatrix=e._worldMatrix.clone(),t.definedFacingForward=e.definedFacingForward,t.position=e.position.clone(),t.rotation=e.rotation.clone(),null!=e.rotationQuaternion&&(t.rotationQuaternion=e.rotationQuaternion.clone()),t.scaling=e.scaling.clone(),t.billboardMode=e.billboardMode,t.alphaIndex=e.alphaIndex,t.infiniteDistance=e.infiniteDistance,t.isVisible=e.isVisible,t.showBoundingBox=e.showBoundingBox,t.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,t.onDispose=e.onDispose,t.isBlocker=e.isBlocker,t.renderingGroupId=e.renderingGroupId,t.actionManager=e.actionManager,t.renderOutline=e.renderOutline,t.outlineColor=e.outlineColor.clone(),t.outlineWidth=e.outlineWidth,t.renderOverlay=e.renderOverlay,t.overlayColor=e.overlayColor.clone(),t.overlayAlpha=e.overlayAlpha,t.hasVertexAlpha=e.hasVertexAlpha,t.useVertexColors=e.useVertexColors,t.applyFog=e.applyFog,t.useOctreeForRenderingSelection=e.useOctreeForRenderingSelection,t.useOctreeForPicking=e.useOctreeForPicking,t.useOctreeForCollisions=e.useOctreeForCollisions,t.layerMask=e.layerMask,t.ellipsoid=e.ellipsoid.clone(),t.ellipsoidOffset=e.ellipsoidOffset.clone()},qe.CreateRibbon=function(e,t,i,n,r,s,o,a,l){if(null==a&&(a=0),null==o&&(o=!1),null==n&&(n=!1),null==i&&(i=!1),null!=l){var h=function(e){var i,n=t[0].length,r=0
i=2==l._sideOrientation?2:1
for(var s=1,o=i+1;o>s;)for(var a=(s++,0),h=t.length;h>a;){var u=a++,c=t[u],f=c.length
n=f>n?n:f
for(var d=0;n>d;)e[r]=c[d].x,e[r+1]=c[d].y,e[r+2]=c[d].z,d++,r+=3}},u=!l._areNormalsFrozen
return l.updateMeshPositions(h,u),l}var c=new qe(e,s)
c._sideOrientation=a
var f=Ze.CreateRibbon(t,i,n,r,a)
return f.applyToMesh(c,o),c},qe.CreateDisc=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=!1)
var o=new qe(e,n),a=Ze.CreateDisc(t,i,s)
return a.applyToMesh(o,r),o},qe.CreateBox=function(e,t,i,n,r){null==r&&(r=0),null==n&&(n=!1)
var s=new qe(e,i),o=Ze.CreateBox(t,r)
return o.applyToMesh(s,n),s},qe.CreateSphere=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=!1)
var o=new qe(e,n),a=Ze.CreateSphere(t,i,s)
return a.applyToMesh(o,r),o},qe.CreateCylinder=function(e,t,i,n,r,s,o,a,l){null==l&&(l=0),null==a&&(a=!1)
var h=new qe(e,o),u=Ze.CreateCylinder(t,i,n,r,s,l)
return u.applyToMesh(h,a),h},qe.CreateTorus=function(e,t,i,n,r,s,o){null==o&&(o=0),null==s&&(s=!1)
var a=new qe(e,r),l=Ze.CreateTorus(t,i,n,o)
return l.applyToMesh(a,s),a},qe.CreateTorusKnot=function(e,t,i,n,r,s,o,a,l,h){null==h&&(h=0),null==l&&(l=!1)
var u=new qe(e,a),c=Ze.CreateTorusKnot(t,i,n,r,s,o,h)
return c.applyToMesh(u,l),u},qe.CreateLines=function(e,t,i,n,r){if(null==n&&(n=!1),null!=r){var s=function(e){var t=function(t){for(var i=0,n=0,r=e.length;r>n;){var s=n++
t[i]=e[s].x,t[i+1]=e[s].y,t[i+2]=e[s].z,i+=3}}
return t},o=s(t)
return r.updateMeshPositions(o,!1),r}var a=new Rt(e,i,n),l=Ze.CreateLines(t)
return l.applyToMesh(a,n),a},qe.ExtrudeShape=function(e,t,i,n,r,s,o,a,l,h){null==l&&(l=0),null==a&&(a=!1),null==s&&(s=0),null==r&&(r=0),null==n&&(n=1)
var u=qe._ExtrudeShapeGeneric(e,t,i,n,r,null,null,!1,!1,s,!1,o,a,l,h)
return u},qe.ExtrudeShapeCustom=function(e,t,i,n,r,s,o,a,l,h,u,c){null==u&&(u=0),null==h&&(h=!1),null==a&&(a=0),null==o&&(o=!1),null==s&&(s=!1)
var f=qe._ExtrudeShapeGeneric(e,t,i,null,null,n,r,s,o,a,!0,l,h,u,c)
return f},qe._ExtrudeShapeGeneric=function(e,t,i,n,r,s,o,a,l,h,u,c,f,d,m){var _=function(e,t,i,n,r,s,o,a,l,h){var u,c=i.getTangents(),f=i.getNormals(),d=i.getBinormals(),m=i.getDistances(),_=0,p=function(){return r},v=function(){return s}
u=h?a:v
var g
g=h?o:p
for(var x=0,y=0,b=t.length;b>y;){for(var w=y++,S=[],M=u(w,m[w]),T=g(w,m[w]),C=0,A=e.length;A>C;){var I=C++,P=U.RotationAxis(c[w],_),E=c[w].scale(e[I].z).add(f[w].scale(e[I].x)).add(d[w].scale(e[I].y)),D=W.TransformCoordinates(E,P).scaleInPlace(T).add(t[w])
S.push(D)}n[x]=S,_+=M,x++}var L=function(e){for(var t=[],i=new W(0,0,0),n=0,r=e.length;r>n;){var s=n++
i.addInPlace(e[s])}i.scaleInPlace(1/e.length)
for(var o=0,a=e.length;a>o;){o++
t.push(i)}return t}
switch(l){case 0:break
case 1:n.unshift(L(n[0]))
break
case 2:n.push(L(n[n.length-1]))
break
case 3:n.unshift(L(n[0])),n.push(L(n[n.length-1]))}return n}
if(null!=m){var p=(m.path3D.update(i),_(t,i,m.path3D,m.pathArray,n,r,s,o,m.cap,u))
return m=qe.CreateRibbon(null,p,null,null,null,null,null,null,m)}var v=new At(i),g=[]
h=0>h||h>3?0:h
var x=_(t,i,v,g,n,r,s,o,h,u),y=qe.CreateRibbon(e,x,a,l,0,c,f,d)
return y.pathArray=x,y.path3D=v,y.cap=h,y},qe.CreateLathe=function(e,t,i,n,r,s,o){null==o&&(o=0),null==s&&(s=!1),null==n&&(n=0),null==i&&(i=1),n=n>0?n:60*i|0
for(var a=2*Math.PI,l=(Tt.Y,[]),h=0;0==t[h].x;)h++
for(var u=t[h],c=0,f=t.length;f>c;){var d=c++
l.push(t[d].subtract(u))}for(var m=a/n,_=null,p=[],v=0;n>v;){var g=v++
_=new W(Math.cos(g*m)*i,0,Math.sin(g*m)*i),p.push(_)}p.push(p[0])
var x=function(e,t){return null==t&&(t=0),null==e&&(e=0),1},y=function(e,t){return null==t&&(t=0),null==e&&(e=0),0},b=qe.ExtrudeShapeCustom(e,l,p,x,y,!0,!1,0,r,s,o)
return b},qe.CreatePlane=function(e,t,i,n,r){null==r&&(r=0),null==n&&(n=!1)
var s=new qe(e,i),o=Ze.CreatePlane(t,r)
return o.applyToMesh(s,n),s},qe.CreateGround=function(e,t,i,n,r,s){null==s&&(s=!1)
var o=new Lt(e,r)
o._setReady(!1),o.set_subdivisions(n)
var a=Ze.CreateGround(t,i,n)
return a.applyToMesh(o,s),o._setReady(!0),o},qe.CreateTiledGround=function(e,t,i,n,r,s,o,a,l){null==l&&(l=!1)
var h=new qe(e,a),u=Ze.CreateTiledGround(t,i,n,r,s,o)
return u.applyToMesh(h,l),h},qe.CreateGroundFromHeightMap=function(e,t,i,n,r,s,o,a,l,h){null==l&&(l=!1)
var u=new Lt(e,a)
u.set_subdivisions(r),u._setReady(!1)
var c=function(e){var t=Ze.CreateGroundFromHeightMap(i,n,r,s,o,e.data,e.width,e.height)
t.applyToMesh(u,l),u._setReady(!0),null!=h&&h(u)}
return Oe.LoadImage(t,c),u},qe.CreateTube=function(e,t,i,n,r,s,o,a,l,h){null==l&&(l=0),null==a&&(a=!1)
var u=function(e,t,i,n,r,s,o){var a,l=t.getTangents(),h=t.getNormals(),u=t.getDistances(),c=2*Math.PI,f=c/r,d=function(){return n}
a=null!=s?s:d
for(var m,_=[],p=0,v=new W(0,0,0),g=new W(0,0,0),x=0,y=0,b=e.length;b>y;){var w=y++
p=a(w,u[w]),_=[],v=h[w]
for(var S=0;r>S;){var M=S++
m=U.RotationAxis(l[w],f*M),g=W.TransformCoordinates(v,m).scaleInPlace(p).add(e[w]),_.push(g)}_.push(_[0]),i[x]=_,x++}var T=function(t,i){for(var n=[],r=0;t>r;){r++
n.push(e[i])}return n}
switch(o){case 0:break
case 1:i.unshift(T(r+1,0))
break
case 2:i.push(T(r+1,e.length-1))
break
case 3:i.unshift(T(r+1,0)),i.push(T(r+1,e.length-1))}return i}
if(null!=h){var c=h.path3D.update(t),f=u(t,c,h.pathArray,i,h.tessellation,r,h.cap)
return h=qe.CreateRibbon(null,f,null,null,null,null,null,null,h)}var d=new At(t),m=[]
s=0>s||s>3?0:s
var _=u(t,d,m,i,n,r,s),p=qe.CreateRibbon(e,_,!1,!0,0,o,a,l)
return p.pathArray=_,p.path3D=d,p.tessellation=n,p.cap=s,p},qe.CreateDecal=function(e,t,i,n,r,s){if(null==s&&(s=0),qe.CreateDecal_indices=t.getIndices(),qe.CreateDecal_positions=t.getVerticesData(Qe.PositionKind),qe.CreateDecal_normals=t.getVerticesData(Qe.NormalKind),null==n){var o=t._scene.activeCamera
qe.CreateDecal_cameraWorldTarget=W.TransformCoordinates(qe.CreateDecal_target,o.getWorldMatrix()),n=o.get_globalPosition().subtract(qe.CreateDecal_cameraWorldTarget)}var a=-Math.atan2(n.z,n.x)-Math.PI/2,l=Math.sqrt(n.x*n.x+n.z*n.z),h=Math.atan2(n.y,l)
qe.decalWorldMatrix=U.RotationYawPitchRoll(a,h,s).multiply(U.Translation(i.x,i.y,i.z)),qe.inverseDecalWorldMatrix=U.Invert(qe.decalWorldMatrix),qe.CreateDecal_meshWorldMatrix=t.getWorldMatrix(),qe.CreateDecal_transformMatrix=qe.CreateDecal_meshWorldMatrix.multiply(qe.inverseDecalWorldMatrix),qe.CreateDecal_vertexData.indices=[],qe.CreateDecal_vertexData.positions=[],qe.CreateDecal_vertexData.normals=[],qe.CreateDecal_vertexData.uvs=[]
for(var u=0,c=function(e){var t=qe.CreateDecal_indices[e],i=new It
return i.position=new W(qe.CreateDecal_positions[3*t],qe.CreateDecal_positions[3*t+1],qe.CreateDecal_positions[3*t+2]),i.position=W.TransformCoordinates(i.position,qe.CreateDecal_transformMatrix),i.normal=new W(qe.CreateDecal_normals[3*t],qe.CreateDecal_normals[3*t+1],qe.CreateDecal_normals[3*t+2]),i},f=function(e,t){if(0==e.length)return e
for(var i=.5*Math.abs(r.x*t.x+r.y*t.y+r.z*t.z),n=function(e,n){var r=W.GetClipFactor(e.position,n.position,t,i)
return new It(W.Lerp(e.position,n.position,r),W.Lerp(e.normal,n.normal,r))},s=[],o=!1,a=!1,l=!1,h=0,u=null,c=null,f=null,d=null,m=0,_=0,p=0,v=0;v<e.length;){switch(m=W.Dot(e[v].position,t)-i,_=W.Dot(e[v+1].position,t)-i,p=W.Dot(e[v+2].position,t)-i,o=m>0,a=_>0,l=p>0,h=(o?1:0)+(a?1:0)+(l?1:0)){case 0:s.push(e[v]),s.push(e[v+1]),s.push(e[v+2])
break
case 1:o&&(u=e[v+1],c=e[v+2],f=n(e[v],u),d=n(e[v],c)),a?(u=e[v],c=e[v+2],f=n(e[v+1],u),d=n(e[v+1],c),s.push(f),s.push(c.clone()),s.push(u.clone()),s.push(c.clone()),s.push(f.clone()),s.push(d)):(l&&(u=e[v],c=e[v+1],f=n(e[v+2],u),d=n(e[v+2],c)),s.push(u.clone()),s.push(c.clone()),s.push(f),s.push(d),s.push(f.clone()),s.push(c.clone()))
break
case 2:o||(u=e[v].clone(),c=n(u,e[v+1]),f=n(u,e[v+2]),s.push(u),s.push(c),s.push(f)),a||(u=e[v+1].clone(),c=n(u,e[v+2]),f=n(u,e[v]),s.push(u),s.push(c),s.push(f)),l||(u=e[v+2].clone(),c=n(u,e[v]),f=n(u,e[v+1]),s.push(u),s.push(c),s.push(f))
break
case 3:}v+=3}return s},d=[],m=0;m<qe.CreateDecal_indices.length;)if(d=[],d.push(c(m)),d.push(c(m+1)),d.push(c(m+2)),d=f(d,new W(1,0,0)),d=f(d,new W(-1,0,0)),d=f(d,new W(0,1,0)),d=f(d,new W(0,-1,0)),d=f(d,new W(0,0,1)),d=f(d,new W(0,0,-1)),0!=d.length){for(var _=(U.RotationYawPitchRoll(a,h,s),null),p=0,v=d.length;v>p;){var g=p++
_=d[g],qe.CreateDecal_vertexData.indices.push(u),_.position.toArray(qe.CreateDecal_vertexData.positions,3*u),_.normal.toArray(qe.CreateDecal_vertexData.normals,3*u),qe.CreateDecal_vertexData.uvs.push(.5+_.position.x/r.x),qe.CreateDecal_vertexData.uvs.push(.5+_.position.y/r.y),u++}m+=3}else m+=3
var x=new qe(e,t._scene)
return qe.CreateDecal_vertexData.applyToMesh(x),x.position=new W(i.x,i.y,i.z),x.rotation=new W(h,a,s),x},qe.MinMax=function(e){for(var t=null,i=null,n=0;n<e.length;){var r=e[n];++n
var s=r,o=s.getBoundingInfo().boundingBox
null!=t?(t.MinimizeInPlace(o.minimumWorld),i.MaximizeInPlace(o.maximumWorld)):(t=o.minimumWorld,i=o.maximumWorld)}return{minimum:t,maximum:i}},qe.Center=function(e){var t
return t=null!=e.min?e:qe.MinMax(e),W.Center(t.minimum,t.maximum)},qe.MergeMeshes=function(e,t,i,n){if(null==i&&(i=!1),null==t&&(t=!0),!i)for(var r=0,s=0,o=e.length;o>s;){var a=s++
if(null!=e[a]&&(r+=e[a].getTotalVertices(),r>65536))return Ei.trace("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices",{fileName:"Mesh.hx",lineNumber:1935,className:"com.babylonhx.mesh.Mesh",methodName:"MergeMeshes"}),null}for(var l=null,h=null,u=null,c=0,f=e.length;f>c;){var d=c++
null!=e[d]&&(e[d].computeWorldMatrix(!0),h=Ze.ExtractFromMesh(e[d],!0),h.transform(e[d].getWorldMatrix()),null!=l?l.merge(h):(l=h,u=e[d]))}if(null==n&&(n=new qe(u.name+"_merged",u._scene)),l.applyToMesh(n),n.set_material(u.get_material()),n.set_checkCollisions(u.get_checkCollisions()),t)for(var m=0,_=e.length;_>m;){var p=m++
null!=e[p]&&e[p].dispose()}return n},qe.__super__=je,qe.prototype=i(je.prototype,{delayLoadState:null,instances:null,delayLoadingFile:null,_binaryInfo:null,_LODLevels:null,onLODLevelSelection:null,_geometry:null,_onBeforeRenderCallbacks:null,_onAfterRenderCallbacks:null,_delayInfo:null,_delayLoadingFunction:null,_visibleInstances:null,_renderIdForInstances:null,_batchCache:null,_worldMatricesInstancesBuffer:null,_worldMatricesInstancesArray:null,_instancesBufferSize:null,_shouldGenerateFlatShading:null,_preActivateId:null,_sideOrientation:null,_areNormalsFrozen:null,cap:null,rigidBody:null,path3D:null,pathArray:null,tessellation:null,get_hasLODLevels:function(){return this._LODLevels.length>0},_sortLODLevels:function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},addLODLevel:function(e,t){if(null!=t&&null!=t._masterMesh)return Ei.trace("You cannot use a mesh as LOD level twice",{fileName:"Mesh.hx",lineNumber:248,className:"com.babylonhx.mesh.Mesh",methodName:"addLODLevel"}),this
var i=new zt(e,t)
return this._LODLevels.push(i),null!=t&&(t._masterMesh=this),this._sortLODLevels(),this},getLODLevelAtDistance:function(e){for(var t=0,i=this._LODLevels.length;i>t;){var n=t++,r=this._LODLevels[n]
if(r.distance==e)return r.mesh}return null},removeLODLevel:function(e){for(var t=0,i=this._LODLevels.length;i>t;){var n=t++
this._LODLevels[n].mesh==e&&(this._LODLevels.splice(n,1),null!=e&&(e._masterMesh=null))}return this._sortLODLevels(),this},getLOD:function(e,t){if(null==this._LODLevels||0==this._LODLevels.length)return this
var i=(null!=t?t:this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.position).length()
if(this._LODLevels[this._LODLevels.length-1].distance>i)return null!=this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this
for(var n=0,r=this._LODLevels.length;r>n;){var s=n++,o=this._LODLevels[s]
if(o.distance<i)return null!=o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache())),null!=this.onLODLevelSelection&&this.onLODLevelSelection(i,this,o.mesh),o.mesh}return null!=this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},getTotalVertices:function(){return null==this._geometry?0:this._geometry.getTotalVertices()},getVerticesData:function(e,t){return null==t&&(t=!1),null==this._geometry?null:this._geometry.getVerticesData(e,t)},getVertexBuffer:function(e){return null==this._geometry?null:this._geometry.getVertexBuffer(e)},isVerticesDataPresent:function(e){return null==this._geometry?null!=this._delayInfo?-1!=c.indexOf(this._delayInfo,e,0):!1:this._geometry.isVerticesDataPresent(e)},getVerticesDataKinds:function(){if(null==this._geometry){var e=[]
if(null!=this._delayInfo)for(var t=0,i=this._delayInfo;t<i.length;){var n=i[t];++t,e.push(n)}return e}return this._geometry.getVerticesDataKinds()},getTotalIndices:function(){return null==this._geometry?0:this._geometry.getTotalIndices()},getIndices:function(e){return null==e&&(e=!1),null==this._geometry?[]:this._geometry.getIndices(e)},get_isBlocked:function(){return null!=this._masterMesh},isReady:function(){return 2==this.delayLoadState?!1:je.prototype.isReady.call(this)},isDisposed:function(){return this._isDisposed},get_sideOrientation:function(){return this._sideOrientation},get_areNormalsFrozen:function(){return this._areNormalsFrozen},set_sideOrientation:function(e){return this._sideOrientation=e,e},freezeNormals:function(){this._areNormalsFrozen=!0},unfreezeNormals:function(){this._areNormalsFrozen=!1},_preActivate:function(){var e=this._scene._renderId
this._preActivateId!=e&&(this._preActivateId=e,this._visibleInstances=null)},_registerInstanceForRenderId:function(e,t){null==this._visibleInstances&&(this._visibleInstances=new kt(t,this._renderId)),this._visibleInstances.map.h.hasOwnProperty(t)||(this._visibleInstances.map.h[t]=[]),this._visibleInstances.map.h[t].push(e)},refreshBoundingInfo:function(){var e=this.getVerticesData(Qe.PositionKind)
if(null!=e){var t=Oe.ExtractMinAndMax(e,0,this.getTotalVertices())
this._boundingInfo=new le(t.minimum,t.maximum)}if(null!=this.subMeshes)for(var i=0,n=this.subMeshes.length;n>i;){var r=i++
this.subMeshes[r].refreshBoundingInfo()}null==this._boundingInfo?this._boundingInfo=new le(this.get_absolutePosition(),this.get_absolutePosition()):this._boundingInfo=this._boundingInfo,this._boundingInfo._update(this.get_worldMatrixFromCache()),this._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache())},_createGlobalSubMesh:function(){var e=this.getTotalVertices()
return 0==e||null==this.getIndices()?null:(this.releaseSubMeshes(),new Je(0,0,e,0,this.getTotalIndices(),this))},subdivide:function(e){if(!(1>e)){for(var t=this.getTotalIndices(),i=t/e|0,n=0;i%3!=0;)i++
this.releaseSubMeshes()
for(var r=0;e>r;){r++
if(n>=t)break
Je.CreateFromIndices(0,n,g["int"](Math.min(i,t-n)),this),n+=i}this.synchronizeInstances()}},setVerticesData:function(e,t,i,n){if(null==i&&(i=!1),null==this._geometry){var r=new Ze
r.set(t,e)
var s=this._scene
new it(it.RandomId(),s,r,i,this)}else this._geometry.setVerticesData(e,t,i,n)},updateVerticesData:function(e,t,i,n){null==n&&(n=!1),null==i&&(i=!1),null!=this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i))},updateVerticesDataDirectly:function(e,t,i,n){null==n&&(n=!1),null==i&&(i=0),null!=this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(e,t,i,!1)):this._geometry.updateVerticesDataDirectly(e,t,i))},updateMeshPositions:function(e,t){null==t&&(t=!0)
var i=this.getVerticesData(Qe.PositionKind)
if(e(i),this.updateVerticesData(Qe.PositionKind,i,!1,!1),t){var n=this.getIndices(),r=this.getVerticesData(Qe.NormalKind)
Ze.ComputeNormals(i,n,r),this.updateVerticesData(Qe.NormalKind,r,!1,!1)}},makeGeometryUnique:function(){if(null!=this._geometry){var e=this._geometry.copy(it.RandomId())
e.applyToMesh(this)}},setIndices:function(e,t){if(null==t&&(t=-1),null==this._geometry){var i=new Ze
i.indices=e
var n=this._scene
new it(it.RandomId(),n,i,!1,this)}else this._geometry.setIndices(e)},_bind:function(e,t,i){var n=this._scene._engine,r=null
switch(i){case 2:r=null
break
case 1:r=e.getLinesIndexBuffer(this.getIndices(),n)
break
case 0:r=this._geometry.getIndexBuffer()
break
default:r=this._geometry.getIndexBuffer()}n.bindMultiBuffers(this._geometry.getVertexBuffers(),r,t)},_draw:function(e,t,i){if(null!=this._geometry&&null!=this._geometry.getVertexBuffers()&&null!=this._geometry.getIndexBuffer()){var n=this._scene._engine
switch(t){case 2:n.drawPointClouds(e.verticesStart,e.verticesCount,i)
break
case 1:n.draw(!1,0,e.linesIndexCount,i)
break
default:n.draw(!0,e.indexStart,e.indexCount,i)}}},registerBeforeRender:function(e){this._onBeforeRenderCallbacks.push(e)},unregisterBeforeRender:function(e){var t=c.indexOf(this._onBeforeRenderCallbacks,e,0)
t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},registerAfterRender:function(e){this._onAfterRenderCallbacks.push(e)},unregisterAfterRender:function(e){var t=c.indexOf(this._onAfterRenderCallbacks,e,0)
t>-1&&this._onAfterRenderCallbacks.splice(t,1)},_getInstancesRenderList:function(e){var t=this._scene
if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,null!=this._visibleInstances){var i=t._renderId
this._batchCache.visibleInstances[e]=this._visibleInstances.map.h[i]
var n=this._renderId
if(null==this._batchCache.visibleInstances[e]&&this._visibleInstances.defaultRenderId>0&&(this._batchCache.visibleInstances[e]=this._visibleInstances.map.h[this._visibleInstances.defaultRenderId],i=this._visibleInstances.defaultRenderId,n=this._visibleInstances.selfDefaultRenderId),null!=this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length>0){if(this._renderIdForInstances[e]==i)return this._batchCache.mustReturn=!0,this._batchCache
i!=n&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},_renderWithInstances:function(e,t,i,n,r){for(var s=i.visibleInstances[e._id],o=s.length+1,a=16*o*4;this._instancesBufferSize<a;)this._instancesBufferSize*=2;(null==this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(null!=this._worldMatricesInstancesBuffer&&r.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=r.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4|0))
var l=0,h=0,u=this.getWorldMatrix()
if(i.renderSelf[e._id]&&(u.copyToArray(this._worldMatricesInstancesArray,l),l+=16,h++),null!=s)for(var c=0,f=s.length;f>c;){var d=c++,m=s[d]
m.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,l),l+=16,h++}var _=n.getAttributeLocationByName("world0"),p=n.getAttributeLocationByName("world1"),v=n.getAttributeLocationByName("world2"),g=n.getAttributeLocationByName("world3"),x=[_,p,v,g]
r.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,x),this._draw(e,t,h),r.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,x)},_processRendering:function(e,t,i,n,r,s){var o=this._scene,a=o._engine
if(r)this._renderWithInstances(e,i,n,t,a)
else if(n.renderSelf[e._id]&&(null!=s&&s(!1,this.getWorldMatrix()),this._draw(e,i)),null!=n.visibleInstances[e._id])for(var l=0,h=n.visibleInstances[e._id].length;h>l;){var u=l++,c=n.visibleInstances[e._id][u],f=c.getWorldMatrix()
null!=s&&s(!0,f),this._draw(e,i)}},render:function(e){var t=this._scene,i=this._getInstancesRenderList(e._id)
if(!i.mustReturn&&null!=this._geometry&&null!=this._geometry.getVertexBuffers()&&null!=this._geometry.getIndexBuffer()){for(var n=0,r=this._onBeforeRenderCallbacks.length;r>n;){var s=n++
this._onBeforeRenderCallbacks[s](this)}var o=t._engine,a=null!=o.getCaps().instancedArrays&&null!=i.visibleInstances[e._id]&&i.visibleInstances.length>e._id&&null!=i.visibleInstances[e._id],l=e.getMaterial()
if(null!=l&&l.isReady(this,a)){var h=o._depthCullingState.get_depthMask()
this.renderOutline&&(o._depthCullingState.set_depthMask(!1),t._outlineRenderer.render(e,i),o._depthCullingState.set_depthMask(h)),l._preBind()
var u,c=l.getEffect()
u=t.forcePointsCloud?Le.PointFillMode:t.forceWireframe?Le.WireFrameFillMode:l.get_fillMode(),this._bind(e,c,u)
var f=this.getWorldMatrix()
if(l.bind(f,this),this._processRendering(e,c,u,i,a,function(e,t){e&&l.bindOnlyWorldMatrix(t)}),l.unbind(),this.renderOutline&&h&&(o._depthCullingState.set_depthMask(!0),En.context.colorMask(!1,!1,!1,!1),t._outlineRenderer.render(e,i),En.context.colorMask(!0,!0,!0,!0)),this.renderOverlay){var d=o._alphaMode
switch(o._depthCullingState.set_depthMask(!1),o._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),o._alphaState.set_alphaBlend(!0),o._alphaMode=2,t._outlineRenderer.render(e,i,!0),d){case 0:o._depthCullingState.set_depthMask(!0),o._alphaState.set_alphaBlend(!1)
break
case 2:o._depthCullingState.set_depthMask(!1),o._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),o._alphaState.set_alphaBlend(!0)
break
case 1:o._depthCullingState.set_depthMask(!1),o._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),o._alphaState.set_alphaBlend(!0)}o._alphaMode=d}for(var m=0,_=this._onAfterRenderCallbacks.length;_>m;){var p=m++
this._onAfterRenderCallbacks[p](this)}}}},getEmittedParticleSystems:function(){for(var e=[],t=0,i=this._scene.particleSystems.length;i>t;){var n=t++,r=this._scene.particleSystems[n]
r.emitter==this&&e.push(r)}return e},getHierarchyEmittedParticleSystems:function(){var e=[],t=this.getDescendants()
t.push(this)
for(var i=0,n=this._scene.particleSystems.length;n>i;){var r=i++,s=this._scene.particleSystems[r];-1!=function(){var e,i=s.emitter
return e=c.indexOf(t,i,0)}(this)&&e.push(s)}return e},getChildren:function(){for(var e=[],t=0,i=this._scene.meshes.length;i>t;){var n=t++,r=this._scene.meshes[n]
r.parent==this&&e.push(r)}return e},_checkDelayState:function(){var e=this,t=this._scene
if(null!=this._geometry)this._geometry.load(t)
else if(4==e.delayLoadState){e.delayLoadState=2,t._addPendingData(e);-1!=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")}},isInFrustum:function(e){return 2==this.delayLoadState?!1:je.prototype.isInFrustum.call(this,e)?(this._checkDelayState(),!0):!1},setMaterialByID:function(e){for(var t=this._scene.materials,i=0,n=t.length;n>i;){var r=i++
if(t[r].id==e)return void this.set_material(t[r])}for(var s=this._scene.multiMaterials,o=0,a=s.length;a>o;){var l=o++
if(s[l].id==e)return void this.set_material(s[l])}},getAnimatables:function(){var e=[]
return null!=this.get_material()&&e.push(this.get_material()),null!=this.get_skeleton()&&e.push(this.get_skeleton()),e},bakeTransformIntoVertices:function(e){if(this.isVerticesDataPresent(Qe.PositionKind)){this._positions=null
for(var t=this.getVerticesData(Qe.PositionKind),i=[],n=0;n<t.length;)W.TransformCoordinates(new W(t[n],t[n+1],t[n+2]),e).toArray(i,n),n+=3
if(this.setVerticesData(Qe.PositionKind,i,this.getVertexBuffer(Qe.PositionKind).isUpdatable()),this.isVerticesDataPresent(Qe.NormalKind)){for(t=this.getVerticesData(Qe.NormalKind),i=[],n=0;n<t.length;)W.TransformNormal(new W(t[n],t[n+1],t[n+2]),e).toArray(i,n),n+=3
this.setVerticesData(Qe.NormalKind,i,this.getVertexBuffer(Qe.NormalKind).isUpdatable())}}},_resetPointsArrayCache:function(){this._positions=null},_generatePointsArray:function(){if(null!=this._positions)return!0
this._positions=[]
var e=this.getVerticesData(Qe.PositionKind)
if(null==e)return!1
for(var t=0;t<e.length;)this._positions.push(new W(e[t],e[t+1],e[t+2])),t+=3
return!0},clone:function(e,t,i){return null==i&&(i=!1),new qe(e,this._scene,t,this,i)},dispose:function(e){for(null==e&&(e=!1),null!=this._geometry&&this._geometry.releaseForMesh(this,!0),null!=this._worldMatricesInstancesBuffer&&(this._scene._engine.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length>0;)this.instances[0].dispose()
je.prototype.dispose.call(this,e)},applyDisplacementMap:function(e,t,i,n){var r=this,s=(this._scene,function(e){r.applyDisplacementMapFromBuffer(e.data,e.width,e.height,t,i),null!=n&&n(r)})
Oe.LoadImage(e,s)},applyDisplacementMapFromBuffer:function(e,t,i,n,r){if(!this.isVerticesDataPresent(Qe.PositionKind)||!this.isVerticesDataPresent(Qe.NormalKind)||!this.isVerticesDataPresent(Qe.UVKind))return void Ei.trace("Cannot call applyDisplacementMap:Given mesh is not complete. Position, Normal or UV are missing",{fileName:"Mesh.hx",lineNumber:1057,className:"com.babylonhx.mesh.Mesh",methodName:"applyDisplacementMapFromBuffer"})
for(var s=this.getVerticesData(Qe.PositionKind),o=this.getVerticesData(Qe.NormalKind),a=this.getVerticesData(Qe.UVKind),l=new W(0,0,0),h=new W(0,0,0),u=new Et(0,0),c=0;c<s.length;){l.x=s[c],l.y=s[c+1],l.z=s[c+2],h.x=o[c],h.y=o[c+1],h.z=o[c+2],Et.FromArrayToRef(a,c/3*2|0,u)
var f=g["int"](Math.abs(u.x)*t%t),d=g["int"](Math.abs(u.y)*i%i),m=4*(f+d*t)|0,_=e[m]/255,p=e[m+1]/255,v=e[m+2]/255,x=.3*_+.59*p+.11*v
h.normalize(),h.scaleInPlace(n+(r-n)*x),l=new W(l.x+h.x,l.y+h.y,l.z+h.z),s[c]=l.x,s[c+1]=l.y,s[c+2]=l.z,c+=3}Ze.ComputeNormals(s,this.getIndices(),o),this.updateVerticesData(Qe.PositionKind,s),this.updateVerticesData(Qe.NormalKind,o)},convertToFlatShadedMesh:function(){for(var e=this.getVerticesDataKinds(),t=new Bi,i=new Bi,n=new Bi,r=!1,s=0;s<e.length;){var o=e[s],a=this.getVertexBuffer(o)
if(o!=Qe.NormalKind){null!=Os[o]?t.setReserved(o,a):t.h[o]=a
var l=(null!=Os[o]?t.getReserved(o):t.h[o]).getData()
null!=Os[o]?i.setReserved(o,l):i.h[o]=l
var h=[]
null!=Os[o]?n.setReserved(o,h):n.h[o]=h,s++}else r=a._updatable,e.splice(s,1),s--}for(var u=this.subMeshes.slice(0),c=this.getIndices(),f=this.getTotalIndices(),d=0;f>d;)for(var m=d++,_=c[m],p=0,v=e.length;v>p;)for(var g=p++,x=e[g],y=(null!=Os[x]?t.getReserved(x):t.h[x]).getStrideSize(),b=0;y>b;){var w=b++;(null!=Os[x]?n.getReserved(x):n.h[x]).push((null!=Os[x]?i.getReserved(x):i.h[x])[_*y+w])}for(var S=[],M=n.get(Qe.PositionKind),T=0;f>T;){c[T]=T,c[T+1]=T+1,c[T+2]=T+2
for(var C=W.FromArray(M,3*T),A=W.FromArray(M,3*(T+1)),I=W.FromArray(M,3*(T+2)),P=new W(C.x-A.x,C.y-A.y,C.z-A.z),E=new W(I.x-A.x,I.y-A.y,I.z-A.z),D=W.Normalize(W.Cross(P,E)),L=0;3>L;){L++
S.push(D.x),S.push(D.y),S.push(D.z)}T+=3}this.setIndices(c),this.setVerticesData(Qe.NormalKind,S,r)
for(var F=0,R=e.length;R>F;){var z=F++,B=e[z]
this.setVerticesData(B,null!=Os[B]?n.getReserved(B):n.h[B],(null!=Os[B]?t.getReserved(B):t.h[B]).isUpdatable())}this.releaseSubMeshes()
for(var O=0,k=u.length;k>O;){var V=O++,N=u[V]
new Je(N.materialIndex,N.indexStart,N.indexCount,N.indexStart,N.indexCount,this)}this.synchronizeInstances()},createInstance:function(e){return new Ft(e,this)},synchronizeInstances:function(){for(var e=0,t=this.instances.length;t>e;){var i=e++,n=this.instances[i]
n._syncSubMeshes()}},simplify:function(e,t,i,n){null==i&&(i=0),null==t&&(t=!0),this._scene.simplificationQueue.addTask(new Kt(e,i,this,n,t))},optimizeIndices:function(e){for(var t=this,i=this.getIndices(),n=this.getVerticesData(Qe.PositionKind),r=[],s=0;s<n.length;)r.push(new W(n[s],n[s+1],n[s+2])),s+=3
var o=[]
_i.SyncAsyncForLoop(r.length,40,function(e){for(var t=r.length-1-e,i=r[t],n=0;t>n;){var s=n++,a=r[s]
if(null!=a&&i.x==a.x&&i.y==a.y&&i.z==a.z){o[t]=s
break}}},function(){for(var n=0,r=i.length;r>n;){var s=n++
i[s]=o[i[s]]}var a=t.subMeshes.slice(0)
t.setIndices(i),t.subMeshes=a,null!=e&&e(t)})},__class__:qe,__properties__:i(je.prototype.__properties__,{get_hasLODLevels:"get_hasLODLevels",get_areNormalsFrozen:"get_areNormalsFrozen",set_sideOrientation:"set_sideOrientation",get_sideOrientation:"get_sideOrientation"})})
var Qe=t.BABYLON.VertexBuffer=function(e,t,i,n,r,s){if(null==r&&(r=!1),this._engine=e,this._updatable=n,this._data=t,r||this.create(),this._kind=i,null!=s)return void(this._strideSize=s)
switch(i){case"position":this._strideSize=3
break
case"normal":this._strideSize=3
break
case"uv":this._strideSize=2
break
case"uv2":this._strideSize=2
break
case"color":this._strideSize=4
break
case"matricesIndices":this._strideSize=4
break
case"matricesWeights":this._strideSize=4}}
s["com.babylonhx.mesh.VertexBuffer"]=Qe,Qe.__name__=["com","babylonhx","mesh","VertexBuffer"],Qe.prototype={_mesh:null,_engine:null,_buffer:null,_data:null,_updatable:null,_kind:null,_strideSize:null,isUpdatable:function(){return this._updatable},getData:function(){return this._data},getBuffer:function(){return this._buffer},getStrideSize:function(){return this._strideSize},create:function(e){(null!=e||null==this._buffer)&&(e=null!=e?e:this._data,null==this._buffer&&(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(4*e.length):this._buffer=this._engine.createVertexBuffer(e)),this._updatable&&(En.context.bindBuffer(34962,this._buffer.buffer),e instanceof Array&&null==e.__enum__?En.bufferSubData(34962,0,new Float32Array(e)):En.bufferSubData(34962,0,e),En.context.bindBuffer(34962,null),this._engine._cachedVertexBuffers=null,this._data=e))},update:function(e){this.create(e)},updateDirectly:function(e,t){null!=this._buffer&&this._updatable&&(En.context.bindBuffer(34962,this._buffer.buffer),e instanceof Array&&null==e.__enum__?En.bufferSubData(34962,t,new Float32Array(e)):En.bufferSubData(34962,t,e),En.context.bindBuffer(34962,null),this._engine._cachedVertexBuffers=null,this._data=null)},dispose:function(){null!=this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},__class__:Qe}
var Je=t.BABYLON.SubMesh=function(e,t,i,n,r,s,o,a){null==a&&(a=!0),this._renderId=0,this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=n,this.indexCount=r,this._mesh=s,null!=o?this._renderingMesh=o:this._renderingMesh=Me.__cast(s,qe),s.subMeshes.push(this),this._id=s.subMeshes.length-1,a&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}
s["com.babylonhx.mesh.SubMesh"]=Je,Je.__name__=["com","babylonhx","mesh","SubMesh"],Je.CreateFromIndices=function(e,t,i,n,r){var s=1/0,o=-(1/0)
r=null!=r?r:Me.__cast(n,qe)
for(var a=r.getIndices(),l=t,h=t+i;h>l;){var u=l++,c=a[u]
s>c&&(s=c),c>o&&(o=c)}return new Je(e,0|s,o-s+1|0,t,i,n,r)},Je.prototype={linesIndexCount:null,_mesh:null,_renderingMesh:null,_boundingInfo:null,_linesIndexBuffer:null,_lastColliderWorldVertices:null,_trianglePlanes:null,_lastColliderTransformMatrix:null,__smartArrayFlags:null,_renderId:null,_alphaIndex:null,_distanceToCamera:null,_id:null,materialIndex:null,verticesStart:null,verticesCount:null,indexStart:null,indexCount:null,getBoundingInfo:function(){return this._boundingInfo},getMesh:function(){return this._mesh},getRenderingMesh:function(){return this._renderingMesh},getMaterial:function(){var e=this._renderingMesh.get_material()
if(null!=e&&Me.__instanceof(e,Xe)){var t=e
return t.getSubMaterial(this.materialIndex)}return null==e?this._mesh._scene.defaultMaterial:e},refreshBoundingInfo:function(){var e=this._renderingMesh.getVerticesData(Qe.PositionKind)
if(null==e)return void(this._boundingInfo=this._mesh._boundingInfo)
var t=this._renderingMesh.getIndices(),i={minimum:-1,maximum:-1}
i=0==this.indexStart&&this.indexCount==t.length?Oe.ExtractMinAndMax(e,this.verticesStart,this.verticesCount):Oe.ExtractMinAndMaxIndexed(e,t,this.indexStart,this.indexCount),this._boundingInfo=new le(i.minimum,i.maximum)},_checkCollision:function(e){return this._boundingInfo._checkCollision(e)},updateBoundingInfo:function(e){null==this._boundingInfo&&this.refreshBoundingInfo(),this._boundingInfo._update(e)},isInFrustum:function(e){return this._boundingInfo.isInFrustum(e)},render:function(){this._renderingMesh.render(this)},getLinesIndexBuffer:function(e,t){if(null==this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;)i.push(e[n]),i.push(e[n+1]),i.push(e[n+1]),i.push(e[n+2]),i.push(e[n+2]),i.push(e[n]),n+=3
this._linesIndexBuffer=t.createIndexBuffer(i),this.linesIndexCount=i.length}return this._linesIndexBuffer},canIntersects:function(e){return e.intersectsBox(this._boundingInfo.boundingBox)},intersects:function(e,t,i,n){null==n&&(n=!1)
for(var r=null,s=this.indexStart;s<this.indexStart+this.indexCount;){var o=t[i[s]],a=t[i[s+1]],l=t[i[s+2]],h=e.intersectsTriangle(o,a,l)
if(null!=h){if(h.distance<0)continue
if((n||null==r||h.distance<r.distance)&&(r=h,r.faceId=s/3|0,n))break}s+=3}return r},clone:function(e,t){var i=new Je(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1)
return i._boundingInfo=new le(this._boundingInfo.minimum,this._boundingInfo.maximum),i},dispose:function(){null!=this._linesIndexBuffer&&(this._mesh._scene._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),c.remove(this._mesh.subMeshes,this)},__class__:Je}
var $e=t.BABYLON.PhysicsBodyCreationOptions=function(e,t,i,n){null==n&&(n=""),this.name="",""!=n?this.name=n:this.name=Oe.uuid(),this.mass=e,this.friction=t,this.restitution=i}
s["com.babylonhx.physics.PhysicsBodyCreationOptions"]=$e,$e.__name__=["com","babylonhx","physics","PhysicsBodyCreationOptions"],$e.prototype={name:null,mass:null,friction:null,restitution:null,__class__:$e}
var et=t.BABYLON.ParticleSystem=function(e,t,i,n){this._actualFrame=0,this._stopped=!1,this._started=!1,this._alive=!0,this._currentRenderId=-1,this._scaledGravity=new W(0,0,0),this._scaledDirection=new W(0,0,0),this._colorDiff=new tt(0,0,0,0),this._scaledColorStep=new tt(0,0,0,0),this._newPartsExcess=0,this._stockParticles=[],this._vertexStrideSize=44,this._vertexDeclaration=[3,4,4],this.particles=[],this.textureMask=new tt(1,1,1,1),this.colorDead=new tt(0,0,0,1),this.color2=new tt(1,1,1,1),this.color1=new tt(1,1,1,1),this.maxEmitBox=new W(.5,.5,.5),this.minEmitBox=new W(-.5,-.5,-.5),this.direction2=new W(0,1,0),this.direction1=new W(0,1,0),this.gravity=new W(0,0,0),this.forceDepthWrite=!1,this.blendMode=et.BLENDMODE_ONEONE,this.maxAngularSpeed=0,this.minAngularSpeed=0,this.maxSize=1,this.minSize=1,this.maxLifeTime=1,this.minLifeTime=1,this.maxEmitPower=1,this.minEmitPower=1,this.disposeOnStop=!1,this.targetStopDuration=0,this.updateSpeed=.01,this.manualEmitCount=-1,this.emitRate=10,this.emitter=null,this.renderingGroupId=0
var r=this
this.name=e,this.id=e,this._capacity=t,this._scene=i,this._customEffect=n,i.particleSystems.push(this),this._vertexBuffer=i._engine.createDynamicVertexBuffer(t*this._vertexStrideSize*4)
for(var s=[],o=0,a=0;t>a;){a++
s.push(o),s.push(o+1),s.push(o+2),s.push(o),s.push(o+2),s.push(o+3),o+=4}this._indexBuffer=i._engine.createIndexBuffer(s),this._vertices=new Float32Array(t*this._vertexStrideSize),this.startDirectionFunction=function(e,t,i){var n=r.randomNumber(r.direction1.x,r.direction2.x),s=r.randomNumber(r.direction1.y,r.direction2.y),o=r.randomNumber(r.direction1.z,r.direction2.z)
W.TransformNormalFromFloatsToRef(n*e,s*e,o*e,t,i)},this.startPositionFunction=function(e,t){var i=r.randomNumber(r.minEmitBox.x,r.maxEmitBox.x),n=r.randomNumber(r.minEmitBox.y,r.maxEmitBox.y),s=r.randomNumber(r.minEmitBox.z,r.maxEmitBox.z)
W.TransformCoordinatesFromFloatsToRef(i,n,s,e,t)},this.updateFunction=function(e){for(var t=0;t<e.length;){var i=e[t]
i.age+=r._scaledUpdateSpeed,i.age>=i.lifeTime?(e.splice(t,1),r._stockParticles.push(i)):(i.colorStep.scaleToRef(r._scaledUpdateSpeed,r._scaledColorStep),i.color.addInPlace(r._scaledColorStep),i.color.a<0&&(i.color.a=0),i.angle+=i.angularSpeed*r._scaledUpdateSpeed,i.direction.scaleToRef(r._scaledUpdateSpeed,r._scaledDirection),i.position.addInPlace(r._scaledDirection),r.gravity.scaleToRef(r._scaledUpdateSpeed,r._scaledGravity),i.direction.addInPlace(r._scaledGravity),t++)}}}
s["com.babylonhx.particles.ParticleSystem"]=et,et.__name__=["com","babylonhx","particles","ParticleSystem"],et.__interfaces__=[A,C],et.prototype={name:null,id:null,renderingGroupId:null,emitter:null,emitRate:null,manualEmitCount:null,updateSpeed:null,targetStopDuration:null,disposeOnStop:null,__smartArrayFlags:null,minEmitPower:null,maxEmitPower:null,minLifeTime:null,maxLifeTime:null,minSize:null,maxSize:null,minAngularSpeed:null,maxAngularSpeed:null,particleTexture:null,onDispose:null,updateFunction:null,blendMode:null,forceDepthWrite:null,gravity:null,direction1:null,direction2:null,minEmitBox:null,maxEmitBox:null,color1:null,color2:null,colorDead:null,textureMask:null,startDirectionFunction:null,startPositionFunction:null,particles:null,particle:null,_capacity:null,_scene:null,_vertexDeclaration:null,_vertexStrideSize:null,_stockParticles:null,_newPartsExcess:null,_vertexBuffer:null,_indexBuffer:null,_vertices:null,_effect:null,_customEffect:null,_cachedDefines:null,_scaledColorStep:null,_colorDiff:null,_scaledDirection:null,_scaledGravity:null,_currentRenderId:null,_alive:null,_started:null,_stopped:null,_actualFrame:null,_scaledUpdateSpeed:null,getCapacity:function(){return this._capacity},isAlive:function(){return this._alive},isStarted:function(){return this._started},start:function(){this._started=!0,this._stopped=!1,this._actualFrame=0},stop:function(){this._stopped=!0},_appendParticleVertex:function(e,t,i,n){var r=11*e
this._vertices[r]=t.position.x,this._vertices[r+1]=t.position.y,this._vertices[r+2]=t.position.z,this._vertices[r+3]=t.color.r,this._vertices[r+4]=t.color.g,this._vertices[r+5]=t.color.b,this._vertices[r+6]=t.color.a,this._vertices[r+7]=t.angle,this._vertices[r+8]=t.size,this._vertices[r+9]=i,this._vertices[r+10]=n},_update:function(e){this._alive=this.particles.length>0,this.updateFunction(this.particles)
var t=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
t=null!=this.emitter.position?this.emitter.getWorldMatrix():U.Translation(this.emitter.x,this.emitter.y,this.emitter.z)
for(var i=0;e>i;){i++
if(this.particles.length==this._capacity)break
0!=this._stockParticles.length?(this.particle=this._stockParticles.pop(),this.particle.age=0):this.particle=new Zt,this.particles.push(this.particle)
var n=this.randomNumber(this.minEmitPower,this.maxEmitPower)
this.startDirectionFunction(n,t,this.particle.direction),this.particle.lifeTime=this.randomNumber(this.minLifeTime,this.maxLifeTime),this.particle.size=this.randomNumber(this.minSize,this.maxSize),this.particle.angularSpeed=this.randomNumber(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(t,this.particle.position)
var r=this.randomNumber(0,1)
tt.LerpToRef(this.color1,this.color2,r,this.particle.color),this.colorDead.subtractToRef(this.particle.color,this._colorDiff),this._colorDiff.scaleToRef(1/this.particle.lifeTime,this.particle.colorStep)}},_getEffect:function(){if(null!=this._customEffect)return this._customEffect
var e=[]
null!=this._scene.clipPlane&&e.push("#define CLIPPLANE")
var t=e.join("\n")
return this._cachedDefines!=t&&(this._cachedDefines=t,this._effect=this._scene._engine.createEffect("particles",["position","color","options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],t)),this._effect},animate:function(){if(this._started){var e=this._getEffect()
if(null!=this.emitter&&e._isReady&&null!=this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!=this._scene._renderId){this._currentRenderId=this._scene._renderId,this._scaledUpdateSpeed=this.updateSpeed*this._scene._animationRatio
var t=0
this.manualEmitCount>-1?(t=this.manualEmitCount,this.manualEmitCount=0):t=this.emitRate
var i=t*this._scaledUpdateSpeed|0
this._newPartsExcess+=t*this._scaledUpdateSpeed-i,this._newPartsExcess>1&&(i+=this._newPartsExcess,this._newPartsExcess-=this._newPartsExcess),this._alive=!1,this._stopped?i=0:(this._actualFrame+=this._scaledUpdateSpeed,0!=this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(i),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)))
for(var n=0,r=0,s=this.particles.length;s>r;){var o=r++,a=this.particles[o]
this._appendParticleVertex(n++,a,0,0),this._appendParticleVertex(n++,a,1,0),this._appendParticleVertex(n++,a,1,1),this._appendParticleVertex(n++,a,0,1)}var l=this._scene._engine
l.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,null)}}},render:function(){var e=this._getEffect()
if(null==this.emitter||!e._isReady||null==this.particleTexture||!this.particleTexture.isReady())return 0
var t=this._scene._engine
t.enableEffect(e),0!=t._depthCullingState.get_cull()&&t._depthCullingState.set_cull(!1),t._depthCullingState.set_zOffset(0)
var i=this._scene._viewMatrix
if(e._engine.setTexture(c.indexOf(e._samplers,"diffuseSampler",0),this.particleTexture),e._engine.setMatrix(e._uniforms[c.indexOf(e._uniformsNames,"view",0)],i),e._engine.setMatrix(e._uniforms[c.indexOf(e._uniformsNames,"projection",0)],this._scene._projectionMatrix),e.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),null!=this._scene.clipPlane){var n=this._scene.clipPlane,r=U.FromValues(i.m[0],i.m[1],i.m[2],i.m[3],i.m[4],i.m[5],i.m[6],i.m[7],i.m[8],i.m[9],i.m[10],i.m[11],i.m[12],i.m[13],i.m[14],i.m[15])
r.invert(),e._engine.setMatrix(e._uniforms[c.indexOf(e._uniformsNames,"invView",0)],r),e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}return t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,e),this.blendMode==et.BLENDMODE_ONEONE?(t._depthCullingState.set_depthMask(!1),t._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),t._alphaState.set_alphaBlend(!0),t._alphaMode=1):(t._depthCullingState.set_depthMask(!1),t._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),t._alphaState.set_alphaBlend(!0),t._alphaMode=2),this.forceDepthWrite&&t._depthCullingState.set_depthMask(!0),t.draw(!0,0,6*this.particles.length),t._depthCullingState.set_depthMask(!0),t._alphaState.set_alphaBlend(!1),t._alphaMode=0,this.particles.length},dispose:function(e){null==e&&(e=!1),null!=this._vertexBuffer&&(this._scene._engine._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this._indexBuffer&&(this._scene._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),null!=this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),c.remove(this._scene.particleSystems,this),null!=this.onDispose&&this.onDispose()},clone:function(e,t){var i=new et(e,this._capacity,this._scene)
return Oe.DeepCopy(this,i,["particles"],["_vertexDeclaration","_vertexStrideSize"]),null==t&&(t=this.emitter),i.emitter=t,null!=this.particleTexture&&(i.particleTexture=new Ve(this.particleTexture.url,this._scene)),i.start(),i},randomNumber:function(e,t){if(e==t)return e
var i=Math.random()
return i*(t-e)+e},__class__:et}
var tt=t.BABYLON.Color4=function(e,t,i,n){null==n&&(n=1),this.r=e,this.g=t,this.b=i,this.a=n}
s["com.babylonhx.math.Color4"]=tt,tt.__name__=["com","babylonhx","math","Color4"],tt.Lerp=function(e,t,i){var n=new tt(0,0,0,0)
return tt.LerpToRef(e,t,i,n),n},tt.LerpToRef=function(e,t,i,n){return n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i,n},tt.FromArray=function(e,t){return null==t&&(t=0),new tt(e[t],e[t+1],e[t+2],e[t+3])},tt.FromInts=function(e,t,i,n){return new tt(e/255,t/255,i/255,n/255)},tt.prototype={r:null,g:null,b:null,a:null,addInPlace:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},asArray:function(){var e=[]
return this.toArray(e,0),e},toArray:function(e,t){return null==t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},add:function(e){return new tt(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},subtract:function(e){return new tt(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},subtractToRef:function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},scale:function(e){return new tt(this.r*e,this.g*e,this.b*e,this.a*e)},scaleToRef:function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},toString:function(){return"{R:"+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},clone:function(){return new tt(this.r,this.g,this.b,this.a)},copyFrom:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},__class__:tt}
var it=t.BABYLON.Geometry=function(e,t,i,n,r){null==n&&(n=!1),this._delayInfo=[],this._isDisposed=!1,this._indices=[],this._totalVertices=0,this.delayLoadState=0,this.id=e,this._engine=t._engine,this._meshes=[],this._scene=t,null!=i?this.setAllVerticesData(i,n):(this._totalVertices=0,this._indices=[]),null!=r&&this.applyToMesh(r)}
s["com.babylonhx.mesh.Geometry"]=it,it.__name__=["com","babylonhx","mesh","Geometry"],it.__interfaces__=[Ke],it.ExtractFromMesh=function(e,t){var i=e._geometry
return null==i?null:i.copy(t)},it.RandomId=function(e){null==e&&(e=32)
for(var t=it.UID_CHARS.length,i=new x,n=0;e>n;){n++
i.add(it.UID_CHARS.charAt(g["int"](Math.random()*t)))}return i.b},it.prototype={id:null,delayLoadState:null,delayLoadingFile:null,onGeometryUpdated:null,_scene:null,_engine:null,_meshes:null,_totalVertices:null,_indices:null,_vertexBuffers:null,_isDisposed:null,_delayInfo:null,_indexBuffer:null,_boundingInfo:null,_delayLoadingFunction:null,getScene:function(){return this._scene},getEngine:function(){return this._engine},isReady:function(){return 1==this.delayLoadState||0==this.delayLoadState},setAllVerticesData:function(e,t){null==t&&(t=!1),e.applyToGeometry(this,t),this.notifyUpdate()},setVerticesData:function(e,t,i,n){null==i&&(i=!1),null!=this._vertexBuffers?this._vertexBuffers=this._vertexBuffers:this._vertexBuffers=new Bi,this._vertexBuffers.exists(e)&&this._vertexBuffers.get(e).dispose()
var r=new Qe(this._engine,t,e,i,0==this._meshes.length,n)
if(this._vertexBuffers.set(e,r),e==Qe.PositionKind){n=this._vertexBuffers.get(e).getStrideSize(),this._totalVertices=t.length/n
for(var s=Oe.ExtractMinAndMax(t,0,this._totalVertices),o=this._meshes,a=o.length,l=0;a>l;){var h=l++,u=o[h]
u._positions=null,u._boundingInfo=new le(s.minimum,s.maximum),u._createGlobalSubMesh(),u.computeWorldMatrix(!0)}}this.notifyUpdate()},updateVerticesDataDirectly:function(e,t,i){var n=this.getVertexBuffer(e)
null!=n&&(null!=n._buffer&&n._updatable&&(En.context.bindBuffer(34962,n._buffer.buffer),t instanceof Array&&null==t.__enum__?En.bufferSubData(34962,i,new Float32Array(t)):En.bufferSubData(34962,i,t),En.context.bindBuffer(34962,null),n._engine._cachedVertexBuffers=null,n._data=null),this.notifyUpdate())},updateVerticesData:function(e,t,i,n){null==n&&(n=!1),null==i&&(i=!1)
var r=this.getVertexBuffer(e)
if(null!=r){if(r.create(t),e==Qe.PositionKind){var s=null,o=r._strideSize
this._totalVertices=t.length/o,i&&(s=Oe.ExtractMinAndMax(t,0,this._totalVertices))
for(var a=this._meshes,l=a.length,h=0;l>h;){var u=h++,c=a[u]
if(c._positions=null,i){c._boundingInfo=new le(s.minimum,s.maximum)
for(var f=0,d=c.subMeshes.length;d>f;){var m=f++,_=c.subMeshes[m]
_.refreshBoundingInfo()}}}}this.notifyUpdate()}},getTotalVertices:function(){return 1!=this.delayLoadState&&0!=this.delayLoadState?0:this._totalVertices},getVerticesData:function(e,t){null==t&&(t=!1)
var i=this.getVertexBuffer(e)
if(null==i)return null
var n=i._data
if(t&&1!=this._meshes.length){for(var r=n.length,s=[],o=0;r>o;){var a=o++
s.push(n[a])}return s}return n},getVertexBuffer:function(e){return 1!=this.delayLoadState&&0!=this.delayLoadState?null:this._vertexBuffers.get(e)},getVertexBuffers:function(){return 1!=this.delayLoadState&&0!=this.delayLoadState?null:this._vertexBuffers},isVerticesDataPresent:function(e){return null==this._vertexBuffers?null!=this._delayInfo?-1!=c.indexOf(this._delayInfo,e,0):!1:null!=this._vertexBuffers.get(e)},getVerticesDataKinds:function(){var e=[]
if(null==this._vertexBuffers&&null!=this._delayInfo)for(var t=0,i=this._delayInfo;t<i.length;){var n=i[t];++t,e.push(n)}else for(var r=this._vertexBuffers.keys();r.hasNext();){var s=r.next()
e.push(s)}return e},setIndices:function(e,t){null==t&&(t=-1),null!=this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!=this._meshes.length&&null!=this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),-1!=t&&(this._totalVertices=t)
for(var i=this._meshes,n=i.length,r=0;n>r;){var s=r++
i[s]._createGlobalSubMesh()}this.notifyUpdate()},getTotalIndices:function(){return 1!=this.delayLoadState&&0!=this.delayLoadState?0:this._indices.length},getIndices:function(e){if(null==e&&(e=!1),1!=this.delayLoadState&&0!=this.delayLoadState)return null
var t=this._indices
if(e&&1!=this._meshes.length){for(var i=t.length,n=[],r=0;i>r;){var s=r++
n.push(t[s])}return n}return t},getIndexBuffer:function(){return 1!=this.delayLoadState&&0!=this.delayLoadState?null:this._indexBuffer},releaseForMesh:function(e,t){null==t&&(t=!1)
var i=this._meshes,n=c.indexOf(i,e,0)
if(-1!=n){for(var r=this._vertexBuffers.keys();r.hasNext();){var s=r.next()
this._vertexBuffers.get(s).dispose()}null!=this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(n,1),e._geometry=null,0==i.length&&t&&this.dispose()}},applyToMesh:function(e){if(e._geometry!=this){var t=e._geometry
null!=t&&t.releaseForMesh(e)
var i=this._meshes
e._geometry=this,this._scene.pushGeometry(this),i.push(e),1==this.delayLoadState||0==this.delayLoadState?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},_applyToMesh:function(e){for(var t=this._meshes.length,i=this._vertexBuffers.keys();i.hasNext();){var n=i.next()
if(1==t&&this._vertexBuffers.get(n).create(),this._vertexBuffers.get(n)._buffer.references=t,n==Qe.PositionKind){e._positions=null
var r=Oe.ExtractMinAndMax(this._vertexBuffers.get(n).getData(),0,this._totalVertices)
e._boundingInfo=new le(r.minimum,r.maximum),e._createGlobalSubMesh(),null==e._boundingInfo?e._boundingInfo=new le(e.get_absolutePosition(),e.get_absolutePosition()):e._boundingInfo=e._boundingInfo,e._boundingInfo._update(e.get_worldMatrixFromCache()),e._updateSubMeshesBoundingInfo(e.get_worldMatrixFromCache())}}1==t&&null!=this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),null!=this._indexBuffer&&(this._indexBuffer.references=t)},notifyUpdate:function(e){null!=this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},load:function(e,t){if(2!=this.delayLoadState){if(1==this.delayLoadState||0==this.delayLoadState)return void(null!=t&&t())
this.delayLoadState=2,e._addPendingData(this)}},isDisposed:function(){return this._isDisposed},dispose:function(){for(var e=this._meshes,t=e.length,i=0;t>i;){var n=i++
this.releaseForMesh(e[n])}this._meshes=[]
for(var r=this._vertexBuffers.keys();r.hasNext();){var s=r.next()
this._vertexBuffers.get(s).dispose()}this._vertexBuffers=new Bi,this._totalVertices=0,null!=this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},copy:function(e){var t=new Ze
t.indices=[]
for(var i=this.getIndices(),n=0,r=i.length;r>n;){var s=n++
t.indices.push(i[s])}for(var o=!1,a=!1,l=this._vertexBuffers.keys();l.hasNext();){var h=l.next()
t.set(function(e){var t,i=e.getVerticesData(h)
return t=i.slice()}(this),h),a||(o=this.getVertexBuffer(h).isUpdatable(),a=!o)}var u=new it(e,this._scene,t,o,null)
u.delayLoadState=this.delayLoadState,u.delayLoadingFile=this.delayLoadingFile,u._delayLoadingFunction=this._delayLoadingFunction
for(var c=0,f=this._delayInfo;c<f.length;){var d=f[c];++c,null!=u._delayInfo?u._delayInfo=u._delayInfo:u._delayInfo=[],u._delayInfo.push(d)}var m=Oe.ExtractMinAndMax(this.getVerticesData(Qe.PositionKind),0,this.getTotalVertices())
return u._boundingInfo=new le(m.minimum,m.maximum),u},__class__:it}
var nt=t.BABYLON._Primitive=function(e,t,i,n,r){null==n&&(n=!1),this._beingRegenerated=!0,this._canBeRegenerated=n,it.call(this,e,t,i,!1,r),this._beingRegenerated=!1}
s["com.babylonhx.mesh.primitives._Primitive"]=nt,nt.__name__=["com","babylonhx","mesh","primitives","_Primitive"],nt.__super__=it,nt.prototype=i(it.prototype,{_beingRegenerated:null,_canBeRegenerated:null,canBeRegenerated:function(){return this._canBeRegenerated},regenerate:function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},asNewGeometry:function(e){return it.prototype.copy.call(this,e)},setAllVerticesData:function(e,t){null==t&&(t=!1),this._beingRegenerated&&it.prototype.setAllVerticesData.call(this,e,!1)},setVerticesData:function(e,t,i,n){null==i&&(i=!1),this._beingRegenerated&&it.prototype.setVerticesData.call(this,e,t,!1,n)},_regenerateVertexData:function(){throw new Wi("Abstract method")},copy:function(){throw new Wi("Must be overriden in sub-classes.")},__class__:nt})
var rt=t.BABYLON.Box=function(e,t,i,n,r,s){null==s&&(s=0),this.size=i,this.side=s,nt.call(this,e,t,this._regenerateVertexData(),n,r)}
s["com.babylonhx.mesh.primitives.Box"]=rt,rt.__name__=["com","babylonhx","mesh","primitives","Box"],rt.__super__=nt,rt.prototype=i(nt.prototype,{size:null,side:null,_regenerateVertexData:function(){return Ze.CreateBox(this.size,this.side)},copy:function(e){return new rt(e,this._scene,this.size,this.canBeRegenerated(),null,this.side)},__class__:rt})
var st=t.BABYLON.Sphere=function(e,t,i,n,r,s,o){null==o&&(o=0),this.segments=i,this.diameter=n,this.side=o,nt.call(this,e,t,this._regenerateVertexData(),r,s)}
s["com.babylonhx.mesh.primitives.Sphere"]=st,st.__name__=["com","babylonhx","mesh","primitives","Sphere"],st.__super__=nt,st.prototype=i(nt.prototype,{segments:null,diameter:null,side:null,_regenerateVertexData:function(){return Ze.CreateSphere(this.segments,this.diameter,this.side)},copy:function(e){return new st(e,this._scene,this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},__class__:st})
var ot=t.BABYLON.Cylinder=function(e,t,i,n,r,s,o,a,l,h){null==h&&(h=0),null==o&&(o=1),this.height=i,this.diameterTop=n,this.diameterBottom=r,this.tessellation=s,this.subdivisions=o,this.side=h,nt.call(this,e,t,this._regenerateVertexData(),a,l)}
s["com.babylonhx.mesh.primitives.Cylinder"]=ot,ot.__name__=["com","babylonhx","mesh","primitives","Cylinder"],ot.__super__=nt,ot.prototype=i(nt.prototype,{height:null,diameterTop:null,diameterBottom:null,tessellation:null,subdivisions:null,side:null,_regenerateVertexData:function(){return Ze.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},copy:function(e){return new ot(e,this._scene,this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},__class__:ot})
var at=t.BABYLON.Torus=function(e,t,i,n,r,s,o,a){null==a&&(a=0),this.diameter=i,this.thickness=n,this.tessellation=r,this.side=a,nt.call(this,e,t,this._regenerateVertexData(),s,o)}
s["com.babylonhx.mesh.primitives.Torus"]=at,at.__name__=["com","babylonhx","mesh","primitives","Torus"],at.__super__=nt,at.prototype=i(nt.prototype,{diameter:null,thickness:null,tessellation:null,side:null,_regenerateVertexData:function(){return Ze.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},copy:function(e){return new at(e,this._scene,this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},__class__:at})
var lt=t.BABYLON.Ground=function(e,t,i,n,r,s,o){this.width=i,this.height=n,this.subdivisions=r,nt.call(this,e,t,this._regenerateVertexData(),s,o)}
s["com.babylonhx.mesh.primitives.Ground"]=lt,lt.__name__=["com","babylonhx","mesh","primitives","Ground"],lt.__super__=nt,lt.prototype=i(nt.prototype,{width:null,height:null,subdivisions:null,_regenerateVertexData:function(){return Ze.CreateGround(this.width,this.height,this.subdivisions)},copy:function(e){return new lt(e,this._scene,this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},__class__:lt})
var ht=t.BABYLON.Plane=function(e,t,i,n,r,s){null==s&&(s=0),this.size=i,this.side=s,nt.call(this,e,t,this._regenerateVertexData(),n,r)}
s["com.babylonhx.mesh.primitives.Plane"]=ht,ht.__name__=["com","babylonhx","mesh","primitives","Plane"],ht.__super__=nt,ht.prototype=i(nt.prototype,{size:null,side:null,_regenerateVertexData:function(){return Ze.CreatePlane(this.size,this.side)},copy:function(e){return new ht(e,this._scene,this.size,this.canBeRegenerated(),null,this.side)},__class__:ht})
var ut=t.BABYLON.TorusKnot=function(e,t,i,n,r,s,o,a,l,h,u){null==u&&(u=0),this.radius=i,this.tube=n,this.side=u,this.radialSegments=r,this.tubularSegments=s,this.p=o,this.q=a,nt.call(this,e,t,this._regenerateVertexData(),l,h)}
s["com.babylonhx.mesh.primitives.TorusKnot"]=ut,ut.__name__=["com","babylonhx","mesh","primitives","TorusKnot"],ut.__super__=nt,ut.prototype=i(nt.prototype,{radius:null,tube:null,side:null,radialSegments:null,tubularSegments:null,p:null,q:null,_regenerateVertexData:function(){return Ze.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},copy:function(e){return new ut(e,this._scene,this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},__class__:ut})
var ct=t.BABYLON.PostProcess=function(e,t,i,n,r,s,o,a,l,h){null==h&&(h=""),null==l&&(l=!1),null==o&&(o=1),this._currentRenderTextureInd=0,this._textures=new pi(2),this._reusable=!1,this.height=-1,this.width=-1,null!=s?(this._camera=s,this._scene=s._scene,s.attachPostProcess(this),this._engine=this._scene._engine):this._engine=a,this.name=e,this._renderRatio=r,this.renderTargetSamplingMode=o,this._reusable=l,n=null!=n?n:[],n.push("textureSampler"),this._effect=this._engine.createEffect({vertex:"postprocess",fragment:t},["position"],null!=i?i:[],n,h)}
s["com.babylonhx.postprocess.PostProcess"]=ct,ct.__name__=["com","babylonhx","postprocess","PostProcess"],ct.prototype={name:null,onApply:null,onBeforeRender:null,onSizeChanged:null,onActivate:null,width:null,height:null,renderTargetSamplingMode:null,clearColor:null,_camera:null,_scene:null,_engine:null,_renderRatio:null,_reusable:null,_textures:null,_currentRenderTextureInd:null,_effect:null,isReusable:function(){return this._reusable},activate:function(e,t){e=null!=e?e:this._camera
var i,n=e._scene,r=e._scene._engine.getCaps().maxTextureSize
i=(null!=t?t._width:this._engine.getRenderWidth())*this._renderRatio
var s
if(s=(null!=t?t._height:this._engine.getRenderHeight())*this._renderRatio,i=Oe.GetExponantOfTwo(0|i,r),s=Oe.GetExponantOfTwo(0|s,r),this.width!=i||this.height!=s){if(this._textures.length>0){for(var o=0,a=this._textures.length;a>o;){var l=o++
this._engine._releaseTexture(this._textures.data[l])}this._textures.reset()}this.width=i,this.height=s,this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:c.indexOf(e._postProcesses,this,0)==e._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode})),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:c.indexOf(e._postProcesses,this,0)==e._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode})),null!=this.onSizeChanged&&this.onSizeChanged()}this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]),null!=this.onActivate&&this.onActivate(e),null!=this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(n.clearColor,n.autoClear||n.forceWireframe,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},apply:function(){return this._effect._isReady?(this._engine.enableEffect(this._effect),this._engine.setState(!1,null,null),this._engine.setAlphaMode(0),this._engine._depthCullingState.set_depthTest(!1),this._engine._depthCullingState.set_depthMask(!1),this._textures.length>0&&this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),null!=this.onApply&&this.onApply(this._effect),this._effect):null},dispose:function(e){if(e=null!=e?e:this._camera,this._textures.length>0){for(var t=0,i=this._textures.length;i>t;){var n=t++
this._engine._releaseTexture(this._textures.data[n])}this._textures.reset()}if(null!=e){e.detachPostProcess(this)
var r=c.indexOf(e._postProcesses,this,0)
r==e._postProcessesTakenIndices[0]&&e._postProcessesTakenIndices.length>0&&(this._camera._postProcesses[e._postProcessesTakenIndices[0]].width=-1)}},__class__:ct}
var ft=t.BABYLON.PassPostProcess=function(e,t,i,n,r,s){null==s&&(s=!1),ct.call(this,e,"pass",null,null,t,i,n,r,s)}
s["com.babylonhx.postprocess.PassPostProcess"]=ft,ft.__name__=["com","babylonhx","postprocess","PassPostProcess"],ft.__super__=ct,ft.prototype=i(ct.prototype,{__class__:ft})
var dt=t.BABYLON.AnaglyphPostProcess=function(e,t,i,n,r,s){null==s&&(s=!1),ct.call(this,e,"anaglyph",null,["leftSampler"],t,i,n,r,s)}
s["com.babylonhx.postprocess.AnaglyphPostProcess"]=dt,dt.__name__=["com","babylonhx","postprocess","AnaglyphPostProcess"],dt.__super__=ct,dt.prototype=i(ct.prototype,{__class__:dt})
var mt=t.BABYLON.Vector4=function(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}
s["com.babylonhx.math.Vector4"]=mt,mt.__name__=["com","babylonhx","math","Vector4"],mt.FromArray=function(e,t){return null==t&&(t=0),new mt(e[t],e[t+1],e[t+2],e[t+3])},mt.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},mt.FromFloatArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},mt.FromFloatsToRef=function(e,t,i,n,r){r.x=e,r.y=t,r.z=i,r.w=n},mt.Zero=function(){return new mt(0,0,0,0)},mt.Normalize=function(e){var t=new mt(0,0,0,0)
return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.normalize(),t},mt.NormalizeToRef=function(e,t){t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.normalize()},mt.Minimize=function(e,t){var i=new mt(e.x,e.y,e.z,e.w)
return t.x<i.x&&(i.x=t.x),t.y<i.y&&(i.y=t.y),t.z<i.z&&(i.z=t.z),t.w<i.w&&(i.w=t.w),i},mt.Maximize=function(e,t){var i=new mt(e.x,e.y,e.z,e.w)
return t.x>i.x&&(i.x=t.x),t.y>i.y&&(i.y=t.y),t.z>i.z&&(i.z=t.z),t.w>i.w&&(i.w=t.w),i},mt.Distance=function(e,t){return Math.sqrt(mt.DistanceSquared(e,t))},mt.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,s=e.w-t.w
return i*i+n*n+r*r+s*s},mt.Center=function(e,t){var i=new mt(e.x+t.x,e.y+t.y,e.z+t.z,e.w+t.w)
return i.x*=.5,i.y*=.5,i.z*=.5,i.w*=.5,i},mt.prototype={x:null,y:null,z:null,w:null,toString:function(){return"{X:"+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},asArray:function(){var e=[]
return e[0]=this.x,e[1]=this.y,e[2]=this.z,e[3]=this.w,e},toArray:function(e,t){return null==t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},addInPlace:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},add:function(e){return new mt(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},addToRef:function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},subtractInPlace:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},subtract:function(e){return new mt(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},subtractToRef:function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},subtractFromFloats:function(e,t,i,n){return new mt(this.x-e,this.y-t,this.z-i,this.w-n)},subtractFromFloatsToRef:function(e,t,i,n,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,r.w=this.w-n,this},negate:function(){return new mt(-this.x,-this.y,-this.z,-this.w)},scaleInPlace:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},scale:function(e){return new mt(this.x*e,this.y*e,this.z*e,this.w*e)},scaleToRef:function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},equals:function(e){return null!=e&&this.x==e.x&&this.y==e.y&&this.z==e.z&&this.w==e.w},equalsWithEpsilon:function(e){return Math.abs(this.x-e.x)<M.Epsilon&&Math.abs(this.y-e.y)<M.Epsilon&&Math.abs(this.z-e.z)<M.Epsilon&&Math.abs(this.w-e.w)<M.Epsilon},equalsToFloats:function(e,t,i,n){return this.x==e&&this.y==t&&this.z==i&&this.w==n},multiplyInPlace:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},multiply:function(e){return new mt(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},multiplyToRef:function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},multiplyByFloats:function(e,t,i,n){return new mt(this.x*e,this.y*t,this.z*i,this.w*n)},divide:function(e){return new mt(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},divideToRef:function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},MinimizeInPlace:function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},MaximizeInPlace:function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)
if(0==e)return this
var t=1/e
return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},clone:function(){return new mt(this.x,this.y,this.z,this.w)},copyFrom:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},copyFromFloats:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},__class__:mt}
var _t=t.BABYLON.BabylonFileLoader=function(){}
s["com.babylonhx.loading.plugins.BabylonFileLoader"]=_t,_t.__name__=["com","babylonhx","loading","plugins","BabylonFileLoader"],_t.__properties__={get_plugin:"get_plugin"},_t.get_plugin=function(){return _t._plugin},_t.checkColors4=function(e,t){if(e.length==3*t){for(var i=[],n=0;n<e.length;){var r=n/3*4|0
i[r]=e[n],i[r+1]=e[n+1],i[r+2]=e[n+2],i[r+3]=1,n+=3}return i}return e},_t.loadCubeTexture=function(e,t,i){var n=new Ne(e+g.string(t.name),i)
return n.name=t.name,n.hasAlpha=t.hasAlpha,n.level=t.level,n.coordinatesMode=t.coordinatesMode,n},_t.loadTexture=function(e,t,i){if(null!=t.name&&1==t.isRenderTarget)return null
if(null!=t.isCube&&1==t.isCube)return _t.loadCubeTexture(e,t,i)
var n=null
if(null!=t.mirrorPlane?(n=new We(t.name,t.renderTargetSize,i,!0),Me.__cast(n,We)._waitingRenderList=t.renderList,Me.__cast(n,We).mirrorPlane=Ye.FromArray(t.mirrorPlane)):t.isRenderTarget?(n=new Ue(t.name,t.renderTargetSize,i,!0),Me.__cast(n,Ue)._waitingRenderList=t.renderList):n=new Ve(e+g.string(t.name),i),n.name=t.name,n.hasAlpha=t.hasAlpha,n.getAlphaFromRGB=t.getAlphaFromRGB,n.level=t.level,n.coordinatesIndex=t.coordinatesIndex,n.coordinatesMode=t.coordinatesMode,n.uOffset=t.uOffset,n.vOffset=t.vOffset,n.uScale=t.uScale,n.vScale=t.vScale,n.uAng=t.uAng,n.vAng=t.vAng,n.wAng=t.wAng,n.wrapU=t.wrapU,n.wrapV=t.wrapV,null!=t.animations)for(var r=0,s=t.animations.length;s>r;){var o=r++,a=t.animations[o]
n.animations.push(_t.parseAnimation(a))}return n},_t.parseSkeleton=function(e,t){var i=new K(e.name,e.id,t)
try{for(var n=0,r=e.bones.length;r>n;){var s=n++,o=e.bones[s],a=null
o.parentBoneIndex>-1&&(a=i.bones[o.parentBoneIndex])
var l=new j(o.name,i,a,U.FromArray(o.matrix,null))
null!=o.animation&&l.animations.push(_t.parseAnimation(o.animation))}}catch(h){h instanceof Wi&&(h=h.val),Ei.trace(h,{fileName:"BabylonFileLoader.hx",lineNumber:506,className:"com.babylonhx.loading.plugins.BabylonFileLoader",methodName:"parseSkeleton"})}return i},_t.parseFresnelParameters=function(e){var t=new He
return t.isEnabled=e.isEnabled,t.leftColor=Re.FromArray(e.leftColor),t.rightColor=Re.FromArray(e.rightColor),t.bias=e.bias,null!=e.power?t.power=e.power:t.power=1,t},_t.parseMaterial=function(e,t,i){var n=new Fe(e.name,t)
return n.ambientColor=Re.FromArray(e.ambient),n.diffuseColor=Re.FromArray(e.diffuse),n.specularColor=Re.FromArray(e.specular),n.specularPower=e.specularPower,n.emissiveColor=Re.FromArray(e.emissive),n.alpha=e.alpha,n.id=e.id,ze.AddTagsTo(n,e.tags),n.backFaceCulling=e.backFaceCulling,n.set_wireframe(e.wireframe),null!=e.diffuseTexture&&(n.diffuseTexture=_t.loadTexture(i,e.diffuseTexture,t)),null!=e.diffuseFresnelParameters&&(n.diffuseFresnelParameters=_t.parseFresnelParameters(e.diffuseFresnelParameters)),null!=e.ambientTexture&&(n.ambientTexture=_t.loadTexture(i,e.ambientTexture,t)),null!=e.opacityTexture&&(n.opacityTexture=_t.loadTexture(i,e.opacityTexture,t)),null!=e.opacityFresnelParameters&&(n.opacityFresnelParameters=_t.parseFresnelParameters(e.opacityFresnelParameters)),null!=e.reflectionTexture&&(n.reflectionTexture=_t.loadTexture(i,e.reflectionTexture,t)),null!=e.reflectionFresnelParameters&&(n.reflectionFresnelParameters=_t.parseFresnelParameters(e.reflectionFresnelParameters)),null!=e.emissiveTexture&&(n.emissiveTexture=_t.loadTexture(i,e.emissiveTexture,t)),null!=e.emissiveFresnelParameters&&(n.emissiveFresnelParameters=_t.parseFresnelParameters(e.emissiveFresnelParameters)),null!=e.specularTexture&&(n.specularTexture=_t.loadTexture(i,e.specularTexture,t)),null!=e.bumpTexture&&(n.bumpTexture=_t.loadTexture(i,e.bumpTexture,t)),n},_t.parseMaterialById=function(e,t,i,n){for(var r=0,s=t.materials.length;s>r;){var o=r++,a=t.materials[o]
if(a.id==e)return _t.parseMaterial(a,i,n)}return null},_t.parseMultiMaterial=function(e,t){var i=new Xe(e.name,t)
i.id=e.id,ze.AddTagsTo(i,e.tags)
for(var n=0,r=e.materials.length;r>n;){var s=n++,o=e.materials[s]
i.subMaterials.push(null!=o?t.getMaterialByID(o):null)}return i},_t.parseLensFlareSystem=function(e,t,i){var n=t.getLastEntryByID(e.emitterId),r=new _e("lensFlareSystem#"+g.string(e.emitterId),n,t)
r.borderLimit=e.borderLimit
for(var s=0,o=e.flares.length;o>s;){var a=s++,l=e.flares[a]
new me(l.size,l.position,Re.FromArray(l.color),i+l.textureName,r)}return r},_t.parseParticleSystem=function(e,t,i){var n=t.getLastMeshByID(e.emitterId),r=new et("particles#"+n.name,e.capacity,t)
return null!=e.textureName&&""!=e.textureName&&(r.particleTexture=new Ve(i+g.string(e.textureName),t),r.particleTexture.name=e.textureName),r.minAngularSpeed=e.minAngularSpeed,r.maxAngularSpeed=e.maxAngularSpeed,r.minSize=e.minSize,r.maxSize=e.maxSize,r.minLifeTime=e.minLifeTime,r.maxLifeTime=e.maxLifeTime,r.emitter=n,r.emitRate=e.emitRate,r.minEmitBox=W.FromArray(e.minEmitBox,null),r.maxEmitBox=W.FromArray(e.maxEmitBox,null),r.gravity=W.FromArray(e.gravity,null),r.direction1=W.FromArray(e.direction1,null),r.direction2=W.FromArray(e.direction2,null),r.color1=tt.FromArray(e.color1),r.color2=tt.FromArray(e.color2),r.colorDead=tt.FromArray(e.colorDead),r.updateSpeed=e.updateSpeed,r.targetStopDuration=e.targetStopFrame,r.textureMask=tt.FromArray(e.textureMask),r.blendMode=e.blendMode,r.start(),r},_t.parseShadowGenerator=function(e,t){for(var i=t.getLightByID(e.lightId),n=new we(e.mapSize,i),r=0,s=e.renderList.length;s>r;){var o=r++,a=t.getMeshByID(e.renderList[o])
n.getShadowMap().renderList.push(a)}return null!=e.usePoissonSampling?n.set_usePoissonSampling(!0):null!=e.useVarianceShadowMap?n.set_useVarianceShadowMap(!0):null!=e.useBlurVarianceShadowMap&&(n.set_useBlurVarianceShadowMap(!0),null!=e.blurScale&&(n.blurScale=e.blurScale),null!=e.blurBoxOffset&&n.set_blurBoxOffset(e.blurBoxOffset)),null!=e.bias&&n.set_bias(e.bias),n},_t.parseAnimation=function(e){for(var t=new G(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,n=[],r=0,s=e.keys.length;s>r;){var o=r++,a=e.keys[o],l=null
switch(i){case 0:l=a.values[0]
break
case 2:l=N.FromArray(a.values,null)
break
case 3:l=U.FromArray(a.values,null)
break
case 1:l=W.FromArray(a.values,null)
break
default:l=W.FromArray(a.values,null)}n.push({frame:a.frame,value:l})}return t.setKeys(n),t},_t.parseLight=function(e,t){var i=null,n=e.type
switch(n){case 0:i=new ye(e.name,W.FromArray(e.position,null),t)
break
case 1:i=new ge(e.name,W.FromArray(e.direction,null),t),Me.__cast(i,ge).position=W.FromArray(e.position,null)
break
case 2:i=new be(e.name,W.FromArray(e.position,null),W.FromArray(e.direction,null),e.angle,e.exponent,t)
break
case 3:i=new xe(e.name,W.FromArray(e.direction,null),t),Me.__cast(i,xe).groundColor=Re.FromArray(e.groundColor)}if(i.id=e.id,null!=e.tags&&ze.AddTagsTo(i,e.tags),null!=e.intensity&&(i.intensity=e.intensity),null!=e.range&&(i.range=e.range),i.diffuse=Re.FromArray(e.diffuse),i.specular=Re.FromArray(e.specular),null!=e.excludedMeshesIds&&e.excludedMeshesIds.length>0&&(i._excludedMeshesIds=e.excludedMeshesIds),null!=e.parentId&&(i._waitingParentId=e.parentId),null!=e.includedOnlyMeshesIds&&e.includedOnlyMeshesIds.length>0&&(i._includedOnlyMeshesIds=e.includedOnlyMeshesIds),null!=e.animations)for(var r=0,s=e.animations.length;s>r;){var o=r++,a=e.animations[o]
i.animations.push(_t.parseAnimation(a))}return null!=e.autoAnimate&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,1),i},_t.parseCamera=function(e,t){var i,n=null,r=W.FromArray(e.position,null)
if(i=null!=e.lockedTargetId?t.getLastMeshByID(e.lockedTargetId):null,"AnaglyphArcRotateCamera"==e.type||"ArcRotateCamera"==e.type){var s=e.alpha,o=e.beta,a=e.radius
if("AnaglyphArcRotateCamera"==e.type){var l=e.eye_space
n=new Q(e.name,s,o,a,i,l,t)}else n=new q(e.name,s,o,a,i,t)}else if("AnaglyphFreeCamera"==e.type){var h=e.eye_space
n=new ee(e.name,r,h,t)}else"DeviceOrientationCamera"==e.type||("FollowCamera"==e.type?(n=new te(e.name,r,t),Me.__cast(n,te).heightOffset=e.heightOffset,Me.__cast(n,te).radius=e.radius,Me.__cast(n,te).rotationOffset=e.rotationOffset,null!=i&&(Me.__cast(n,te).target=i)):n=new $(e.name,r,t))
if(null!=i&&Me.__instanceof(n,$)&&(Me.__cast(n,$).lockedTarget=i),n.id=e.id,ze.AddTagsTo(n,e.tags),null!=e.parentId&&(n._waitingParentId=e.parentId),null!=e.target?Me.__instanceof(n,$)?Me.__cast(n,$).setTarget(W.FromArray(e.target,null)):Me.__cast(n,q).target=W.FromArray(e.target,null):Me.__cast(n,$).rotation=W.FromArray(e.rotation,null),n.fov=e.fov,n.minZ=e.minZ,n.maxZ=e.maxZ,Me.__cast(n,$).speed=e.speed,Me.__cast(n,$).inertia=e.inertia,Me.__cast(n,$).checkCollisions=e.checkCollisions,Me.__cast(n,$).applyGravity=e.applyGravity,null!=e.ellipsoid&&(Me.__cast(n,$).ellipsoid=W.FromArray(e.ellipsoid,null)),null!=e.animations)for(var u=0,c=e.animations.length;c>u;){var f=u++,d=e.animations[f]
n.animations.push(_t.parseAnimation(d))}return null!=e.autoAnimate&&t.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,1),null!=e.layerMask?n.layerMask=g["int"](Math.abs(g["int"](e.layerMask))):n.layerMask=-1,n},_t.parseGeometry=function(e,t){var i=e.id
return t.getGeometryByID(i)},_t.parseBox=function(e,t){if(null!=_t.parseGeometry(e,t))return null
var i=new rt(e.id,t,e.size,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseSphere=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new st(e.id,t,e.segments,e.diameter,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseCylinder=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new ot(e.id,t,e.height,e.diameterTop,e.diameterBottom,e.tessellation,e.subdivisions,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseTorus=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new at(e.id,t,e.diameter,e.thickness,e.tessellation,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseGround=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new lt(e.id,t,e.width,e.height,e.subdivisions,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parsePlane=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new ht(e.id,t,e.size,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseTorusKnot=function(e,t){if(null==_t.parseGeometry(e,t))return null
var i=new ut(e.id,t,e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.canBeRegenerated,null)
return ze.AddTagsTo(i,e.tags),t.pushGeometry(i,!0),i},_t.parseVertexData=function(e,t,i){if(null==_t.parseGeometry(e,t))return null
var n=new it(e.id,t)
return ze.AddTagsTo(n,e.tags),null!=e.delayLoadingFile&&""!=e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+g.string(e.delayLoadingFile),n._boundingInfo=new le(W.FromArray(e.boundingBoxMinimum,null),W.FromArray(e.boundingBoxMaximum,null)),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(Qe.UVKind),e.hasUVs2&&n._delayInfo.push(Qe.UV2Kind),e.hasColors&&n._delayInfo.push(Qe.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(Qe.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(Qe.MatricesWeightsKind),n._delayLoadingFunction=_t.importVertexData):_t.importVertexData(e,n),t.pushGeometry(n,!0),n},_t.parseMesh=function(e,t,i){var n=new qe(e.name,t)
if(n.id=e.id,ze.AddTagsTo(n,e.tags),n.position=W.FromArray(e.position,null),null!=e.rotationQuaternion?n.rotationQuaternion=N.FromArray(e.rotationQuaternion,null):null!=e.rotation&&(n.rotation=W.FromArray(e.rotation,null)),n.scaling=W.FromArray(e.scaling,null),null!=e.localMatrix?n.setPivotMatrix(U.FromArray(e.localMatrix,null)):null!=e.pivotMatrix&&n.setPivotMatrix(U.FromArray(e.pivotMatrix,null)),n.setEnabled(e.isEnabled),n.isVisible=e.isVisible,n.infiniteDistance=e.infiniteDistance,n.showBoundingBox=e.showBoundingBox,n.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,null!=e.applyFog&&e.applyFog&&(n.applyFog=e.applyFog),null!=e.pickable&&n.set_isPickable(e.pickable),null!=e.alphaIndex&&(n.alphaIndex=e.alphaIndex),n.set_receiveShadows(e.receiveShadows),n.billboardMode=e.billboardMode,null!=e.visibility&&n.set_visibility(e.visibility),n.set_checkCollisions(e.checkCollisions),n._shouldGenerateFlatShading=e.useFlatShading,null!=e.parentId&&(n._waitingParentId=e.parentId),null!=e.actions&&(n._waitingActions=e.actions),n.hasVertexAlpha=e.hasVertexAlpha,null!=e.delayLoadingFile&&1==e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+g.string(e.delayLoadingFile),n._boundingInfo=new le(W.FromArray(e.boundingBoxMinimum,null),W.FromArray(e.boundingBoxMaximum,null)),null!=e._binaryInfo&&(n._binaryInfo=e._binaryInfo),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(Qe.UVKind),e.hasUVs2&&n._delayInfo.push(Qe.UV2Kind),e.hasColors&&n._delayInfo.push(Qe.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(Qe.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(Qe.MatricesWeightsKind),n._delayLoadingFunction=_t.importGeometry,Se.get_ForceFullSceneLoadingForIncremental()&&n._checkDelayState()):_t.importGeometry(e,n),null!=e.materialId?n.setMaterialByID(e.materialId):n.set_material(null),e.skeletonId>-1&&n.set_skeleton(t.getLastSkeletonByID(e.skeletonId)),null!=e.physicsImpostor){null==t._physicsEngine&&t.enablePhysics()
var r=new $e
r.mass=e.physicsMass,r.friction=e.physicsFriction,r.restitution=e.physicsRestitution,n.setPhysicsState(e.physicsImpostor,r)}if(null!=e.animations)for(var s=0,o=e.animations.length;o>s;){var a=s++,l=e.animations[a]
n.animations.push(_t.parseAnimation(l))}if(null!=e.autoAnimate&&t.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,1),null!=e.layerMask?n.layerMask=g["int"](Math.abs(e.layerMask)):n.layerMask=-1,null!=e.instances)for(var h=0,u=e.instances.length;u>h;){var c=h++,f=e.instances[c],d=n.createInstance(f.name)
if(ze.AddTagsTo(d,f.tags),d.position=W.FromArray(f.position,null),null!=f.rotationQuaternion?d.rotationQuaternion=N.FromArray(f.rotationQuaternion,null):null!=f.rotation&&(d.rotation=W.FromArray(f.rotation,null)),d.scaling=W.FromArray(f.scaling,null),d.set_checkCollisions(n.get_checkCollisions()),null!=e.animations)for(var m=0,_=e.animations.length;_>m;){var p=m++,v=e.animations[p]
d.animations.push(_t.parseAnimation(v))}}return n},_t.parseActions=function(e,t,i){var n=new R(i)
null==t?i.actionManager=n:t.actionManager=n
var r,s=function(e,t){var i=null
switch(e){case"InterpolateValueAction":i=w.createInstance(B,t)
break
case"PlayAnimationAction":i=w.createInstance(O,t)
break
case"PlaySoundAction":}return i},o=function(e,t,i,n){if(null==n){var r=parseFloat(t)
return"true"==t||"false"==t?"true"==t:isNaN(r)?t:r}for(var s=n.split("."),o=t.split(","),a=0,l=s.length;l>a;){var h=a++
i=v.field(i,s[h])}if("boolean"==typeof i)return"true"==o[0]
if("string"==typeof i)return o[0]
for(var u=[],c=0,f=o.length;f>c;){var d=c++
u.push(parseFloat(o[d]))}return Me.__instanceof(i,W)?new W(u[0],u[1],u[2]):Me.__instanceof(i,mt)?new mt(u[0],u[1],u[2],u[3]):Me.__instanceof(i,Re)?Re.FromArray(u):Me.__instanceof(i,tt)?tt.FromArray(u):parseFloat(o[0])},a=null
a=function(e,t,r,l,h){if(null==e.detached||1!=e.detached){var u=[],c=null,f="",d=null!=e.combine&&e.combine.length>0
if(u.push(2==e.type?n:t),d){for(var m=[],_=0,p=e.combine.length;p>_;){var g=_++
a(e.combine[g],R.NothingTrigger,r,l,m)}u.push(m)}else for(var x=0,y=e.properties.length;y>x;){var b=x++,w=e.properties[b].value,S=e.properties[b].name,M=e.properties[b].targetType
if("target"==S)w=c=null!=M&&"SceneProperties"==M?i:i.getNodeByName(w)
else if("parent"==S)w=i.getNodeByName(w)
else{if("sound"==S)continue
"propertyPath"!=S?w=2==e.type&&"operator"==S?v.field(k,w):o(S,w,c,"value"==S?f:null):f=w}u.push(w)}if(u.push(null==h?r:null),"InterpolateValueAction"==e.name){var T=u[u.length-2]
u[u.length-1]=T,u[u.length-2]=r}var C=s(e.name,u)
null!=C&&(Me.__instanceof(C,z)?(r=C,C=l):(r=null,null!=l?l.then(C):n.registerAction(C)))
for(var A=0,I=e.children.length;I>A;){var P=A++
a(e.children[P],t,r,C)}}},r=a
for(var l=0,h=e.children.length;h>l;){var u,c=l++,f=e.children[c]
if(f.properties.length>0){var d,m=Me.__cast(f.properties,Array)[0].value
d=null==Me.__cast(f.properties,Array)[0].targetType?m:i.getMeshByName(m),u={trigger:v.field(R,f.name),parameter:d}}else u=v.field(R,f.name)
for(var _=0,p=f.children.length;p>_;){var g=_++
f.detached||r(Me.__cast(f.children,Array)[g],u,null,null)}}},_t.isDescendantOf=function(e,t,i){var n
n=t instanceof Array&&null==t.__enum__?t:[t]
for(var r=0;r<n.length;){var s=n[r]
if(++r,e.name==s)return i.push(e.id),!0}return null!=e.parentId&&-1!=function(){var t,n=e.parentId
return t=c.indexOf(i,n,0)}(this)?(i.push(e.id),!0):!1},_t.importVertexData=function(e,t){var i=new Ze,n=e.positions
null!=n&&i.set(n,Qe.PositionKind)
var r=e.normals
null!=r&&i.set(r,Qe.NormalKind)
var s=e.uvs
null!=s&&i.set(s,Qe.UVKind)
var o=e.uv2s
null!=o&&i.set(o,Qe.UV2Kind)
var a=e.colors
null!=a&&i.set(_t.checkColors4(a,n.length/3|0),Qe.ColorKind)
var l=e.matricesIndices
null!=l&&i.set(l,Qe.MatricesIndicesKind)
var h=e.matricesWeights
null!=h&&i.set(h,Qe.MatricesWeightsKind)
var u=e.indices
null!=u&&(i.indices=u),t.setAllVerticesData(i,e.updatable)},_t.importGeometry=function(e,t){var i=t._scene,n=e.geometryId
if(null!=n){var r=i.getGeometryByID(n)
null!=r&&r.applyToMesh(t)}else if(null!=e.positions&&null!=e.normals&&null!=e.indices){if(t.setVerticesData(Qe.PositionKind,e.positions,!1),t.setVerticesData(Qe.NormalKind,e.normals,!1),null!=e.uvs&&t.setVerticesData(Qe.UVKind,e.uvs,!1),null!=e.uvs2&&t.setVerticesData(Qe.UV2Kind,e.uvs2,!1),null!=e.colors&&t.setVerticesData(Qe.ColorKind,_t.checkColors4(e.colors,e.positions.length/3|0),!1),null!=e.matricesIndices)if(e.matricesIndices._isExpanded)e.matricesIndices._isExpanded=null,t.setVerticesData(Qe.MatricesIndicesKind,e.matricesIndices,!1)
else{for(var s=[],o=0,a=e.matricesIndices.length;a>o;){var l=o++,h=e.matricesIndices[l]
s.push(255&h),s.push((65280&h)>>8),s.push((16711680&h)>>16),s.push(h>>24)}t.setVerticesData(Qe.MatricesIndicesKind,s,!1)}if(null!=e.matricesWeights&&t.setVerticesData(Qe.MatricesWeightsKind,e.matricesWeights,!1),t.setIndices(e.indices),null!=e.subMeshes){t.subMeshes=[]
for(var u=0,c=e.subMeshes.length;c>u;){var f=u++,d=e.subMeshes[f]
new Je(d.materialIndex,d.verticesStart,d.verticesCount,d.indexStart,d.indexCount,t)}}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),null!=i._selectionOctree&&i._selectionOctree.addMesh(t)}
var pt=t.BABYLON.Effect=function(e,t,i,n,r,s,o,a,l){this._compilationError="",this._isReady=!1
var h=this
this._engine=r,this.name=e,this.defines=s,this._uniformsNames=i.concat(n),this._samplers=n,this._attributesNames=t,this.onError=l,this.onCompiled=a
var u
u=Object.prototype.hasOwnProperty.call(e,"vertex")?e.vertex:e
var c
c=Object.prototype.hasOwnProperty.call(e,"fragment")?e.fragment:e
var f=""
f="."==u.charAt(0)?u:M.ShadersRepository+u
var d=""
d="."==c.charAt(0)?c:M.ShadersRepository+c
var m="",_=function(e){h._prepareEffect(m,e,t,s,o),h._valueCache=new Bi},p=function(){var e=""
xt.Shaders.exists(c+".fragment")?(e=xt.Shaders.get(c+".fragment"),_(e)):Oe.LoadFile(d+".fragment.fx",function(t){e=t,_(e)},"text")}
xt.Shaders.exists(u+".vertex")?(m=xt.Shaders.get(u+".vertex"),p()):Oe.LoadFile(f+".vertex.fx",function(e){m=e,p()},"text")}
s["com.babylonhx.materials.Effect"]=pt,pt.__name__=["com","babylonhx","materials","Effect"],pt.prototype={name:null,defines:null,onCompiled:null,onError:null,onBind:null,_engine:null,_uniformsNames:null,_samplers:null,_isReady:null,_compilationError:null,_attributesNames:null,_attributes:null,_uniforms:null,_key:null,_program:null,_valueCache:null,isReady:function(){return this._isReady},getProgram:function(){return this._program},getAttributesNames:function(){return this._attributesNames},getAttributeLocation:function(e){return this._attributes[e]},getAttributeLocationByName:function(e){var t=c.indexOf(this._attributesNames,e,0)
return this._attributes[t]},getAttributesCount:function(){return this._attributes.length},getUniformIndex:function(e){return c.indexOf(this._uniformsNames,e,0)},getUniform:function(e){return this._uniforms[c.indexOf(this._uniformsNames,e,0)]},getSamplers:function(){return this._samplers},getCompilationError:function(){return this._compilationError},_loadVertexShader:function(e,t){return xt.Shaders.exists(e+"VertexShader")?void t(xt.Shaders.get(e+"VertexShader")):void Oe.LoadFile("assets/shaders/"+e+".vertex.fx",t,"text")},_loadFragmentShader:function(e,t){return xt.Shaders.exists(e+"PixelShader")?void t(xt.Shaders.get(e+"PixelShader")):void Oe.LoadFile("assets/shaders/"+e+".fragment.fx",t,"text")},_prepareEffect:function(e,t,i,n,r){try{var s=this._engine
s.getCaps().highPrecisionShaderSupported||(e=y.replace(e,"precision highp float","precision mediump float"),t=y.replace(t,"precision highp float","precision mediump float")),this._program=s.createShaderProgram(e,t,n),this._uniforms=s.getUniforms(this._program,this._uniformsNames),this._attributes=s.getAttributes(this._program,i)
for(var o=0;o<this._samplers.length;){var a=this._uniforms[c.indexOf(this._uniformsNames,this._samplers[o],0)]
null==a&&(this._samplers.splice(o,1),o--),o++}s.bindSamplers(this),this._isReady=!0,null!=this.onCompiled&&this.onCompiled(this)}catch(l){if(l instanceof Wi&&(l=l.val),Ei.trace(l,{fileName:"Effect.hx",lineNumber:213,className:"com.babylonhx.materials.Effect",methodName:"_prepareEffect"}),-1!=l.message.indexOf("highp"))return e=y.replace(e,"precision highp float","precision mediump float"),t=y.replace(t,"precision highp float","precision mediump float"),void this._prepareEffect(e,t,i,n,r)
null!=r&&r.get_isMoreFallbacks()?(n=r.reduce(n),this._prepareEffect(e,t,i,n,r)):(Ei.trace("Unable to compile effect: "+g.string(this.name),{fileName:"Effect.hx",lineNumber:230,className:"com.babylonhx.materials.Effect",methodName:"_prepareEffect"}),Ei.trace("Defines: "+n,{fileName:"Effect.hx",lineNumber:231,className:"com.babylonhx.materials.Effect",methodName:"_prepareEffect"}),Ei.trace("Error: "+g.string(l),{fileName:"Effect.hx",lineNumber:232,className:"com.babylonhx.materials.Effect",methodName:"_prepareEffect"}),this._compilationError=l,null!=this.onError&&this.onError(this,this._compilationError))}},_bindTexture:function(e,t){this._engine._bindTexture(c.indexOf(this._samplers,e,0),t)},setTexture:function(e,t){this._engine.setTexture(c.indexOf(this._samplers,e,0),t)},setTextureFromPostProcess:function(e,t){this._engine.setTextureFromPostProcess(c.indexOf(this._samplers,e,0),t)},_cacheFloat2:function(e,t,i){if(this._valueCache.exists(e))this._valueCache.get(e)[0]=t,this._valueCache.get(e)[1]=i
else{var n=[t,i]
this._valueCache.set(e,n)}},_cacheFloat3:function(e,t,i,n){if(this._valueCache.exists(e))this._valueCache.get(e)[0]=t,this._valueCache.get(e)[1]=i,this._valueCache.get(e)[2]=n
else{var r=[t,i,n]
this._valueCache.set(e,r)}},_cacheFloat4:function(e,t,i,n,r){if(this._valueCache.exists(e))this._valueCache.get(e)[0]=t,this._valueCache.get(e)[1]=i,this._valueCache.get(e)[2]=n,this._valueCache.get(e)[3]=r
else{var s=[t,i,n,r]
this._valueCache.set(e,s)}},setArray:function(e,t){return this._engine.setArray(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setArray2:function(e,t){return this._engine.setArray2(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setArray3:function(e,t){return this._engine.setArray3(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setArray4:function(e,t){return this._engine.setArray4(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setMatrices:function(e,t){return this._engine.setMatrices(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setMatrix:function(e,t){return this._engine.setMatrix(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t),this},setFloat:function(e,t){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t||(this._valueCache.set(e,[t]),this._engine.setFloat(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t)),this},setBool:function(e,t){if(!this._valueCache.exists(e)||this._valueCache.get(e)[0]!=(t?1:0)){var i
i=t?[1]:[0],this._valueCache.set(e,i),this._engine.setBool(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t)}return this},setVector2:function(e,t){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t.x&&this._valueCache.get(e)[1]==t.y||(this._cacheFloat2(e,t.x,t.y),this._engine.setFloat2(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t.x,t.y)),this},setFloat2:function(e,t,i){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t&&this._valueCache.get(e)[1]==i||(this._cacheFloat2(e,t,i),this._engine.setFloat2(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t,i)),this},setVector3:function(e,t){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t.x&&this._valueCache.get(e)[1]==t.y&&this._valueCache.get(e)[2]==t.z?this:(this._cacheFloat3(e,t.x,t.y,t.z),this._engine.setFloat3(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t.x,t.y,t.z),this)},setFloat3:function(e,t,i,n){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t&&this._valueCache.get(e)[1]==i&&this._valueCache.get(e)[2]==n||(this._cacheFloat3(e,t,i,n),this._engine.setFloat3(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t,i,n)),this},setFloat4:function(e,t,i,n,r){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t&&this._valueCache.get(e)[1]==i&&this._valueCache.get(e)[2]==n&&this._valueCache.get(e)[3]==r||(this._cacheFloat4(e,t,i,n,r),this._engine.setFloat4(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t,i,n,r)),this},setColor3:function(e,t){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t.r&&this._valueCache.get(e)[1]==t.g&&this._valueCache.get(e)[2]==t.b||(this._cacheFloat3(e,t.r,t.g,t.b),this._engine.setColor3(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t)),this},setColor4:function(e,t,i){return this._valueCache.exists(e)&&this._valueCache.get(e)[0]==t.r&&this._valueCache.get(e)[1]==t.g&&this._valueCache.get(e)[2]==t.b&&this._valueCache.get(e)[3]==i||(this._cacheFloat4(e,t.r,t.g,t.b,i),this._engine.setColor4(this._uniforms[c.indexOf(this._uniformsNames,e,0)],t,i)),this},__class__:pt}
var vt=t.BABYLON.EffectFallbacks=function(){this._maxRank=-1,this._currentRank=32,this._defines=[]}
s["com.babylonhx.materials.EffectFallbacks"]=vt,vt.__name__=["com","babylonhx","materials","EffectFallbacks"],vt.prototype={_defines:null,_currentRank:null,_maxRank:null,addFallback:function(e,t){null==this._defines[e]&&(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=[]),this._defines[e].push(t)},reduce:function(e){for(var t=this._defines[this._currentRank],i=0,n=t.length;n>i;){var r=i++
e=y.replace(e,"#define "+t[r],"")}return this._currentRank++,e},get_isMoreFallbacks:function(){return this._currentRank<=this._maxRank},__class__:vt,__properties__:{get_isMoreFallbacks:"get_isMoreFallbacks"}}
var gt=t.BABYLON.ShaderMaterial=function(e,t,i,n){this._cachedWorldViewMatrix=new U,this._matrices=new Bi,this._vectors3=new Bi,this._vectors2=new Bi,this._colors4=new Bi,this._colors3=new Bi,this._floatsArrays=new Bi,this._floats=new Bi,this._textures=new Bi,Le.call(this,e,t),this._shaderPath=i,null!=n.needAlphaBlending?n.needAlphaBlending=n.needAlphaBlending:n.needAlphaBlending=!1,null!=n.needAlphaTesting?n.needAlphaTesting=n.needAlphaTesting:n.needAlphaTesting=!1,null!=n.attributes?n.attributes=n.attributes:n.attributes=["position","normal","uv"],null!=n.uniforms?n.uniforms=n.uniforms:n.uniforms=["worldViewProjection"],null!=n.samplers?n.samplers=n.samplers:n.samplers=[],this._options=n}
s["com.babylonhx.materials.ShaderMaterial"]=gt,gt.__name__=["com","babylonhx","materials","ShaderMaterial"],gt.__super__=Le,gt.prototype=i(Le.prototype,{_shaderPath:null,_options:null,_textures:null,_floats:null,_floatsArrays:null,_colors3:null,_colors4:null,_vectors2:null,_vectors3:null,_matrices:null,_cachedWorldViewMatrix:null,_renderId:null,needAlphaBlending:function(){return this._options.needAlphaBlending},needAlphaTesting:function(){return this._options.needAlphaTesting},_checkUniform:function(e){-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e)},setTexture:function(e,t){return-1==c.indexOf(this._options.samplers,e,0)&&this._options.samplers.push(e),this._textures.set(e,t),this},setFloat:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._floats.set(e,t),this},setFloats:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._floatsArrays.set(e,t),this},setColor3:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._colors3.set(e,t),this},setColor4:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._colors4.set(e,t),this},setVector2:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._vectors2.set(e,t),this},setVector3:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._vectors3.set(e,t),this},setMatrix:function(e,t){return-1==c.indexOf(this._options.uniforms,e,0)&&this._options.uniforms.push(e),this._matrices.set(e,t),this},isReady:function(e,t){null==t&&(t=!1)
var i=this.getScene(),n=i._engine
if(!this.checkReadyOnEveryCall&&this._renderId==i._renderId)return!0
var r=[],s=new vt
t&&r.push("#define INSTANCES"),null!=e&&e.get_useBones()&&(r.push("#define BONES"),r.push("#define BonesPerMesh "+(e.get_skeleton().bones.length+1)),r.push("#define BONES4"),s.addFallback(0,"BONES4")),n._alphaTest&&r.push("#define ALPHATEST")
var o=this._effect,a=r.join("\n")
return this._effect=n.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,a,s,this.onCompiled,this.onError),this._effect._isReady?(o!=this._effect&&(i._cachedMaterial=null),this._renderId=i._renderId,!0):!1},bindOnlyWorldMatrix:function(e){var t=this.getScene();-1!=c.indexOf(this._options.uniforms,"world",0)&&this._effect.setMatrix("world",e),-1!=c.indexOf(this._options.uniforms,"worldView",0)&&(e.multiplyToRef(t._viewMatrix,this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!=c.indexOf(this._options.uniforms,"worldViewProjection",0)&&this._effect.setMatrix("worldViewProjection",e.multiply(t._transformMatrix))},bind:function(e,t){if(this.bindOnlyWorldMatrix(e),this.getScene().getCachedMaterial()!=this){-1!=c.indexOf(this._options.uniforms,"view",0)&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!=c.indexOf(this._options.uniforms,"projection",0)&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!=c.indexOf(this._options.uniforms,"viewProjection",0)&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),null!=t&&t.get_useBones()&&this._effect.setMatrices("mBones",t.get_skeleton().getTransformMatrices())
for(var i=this._textures.keys();i.hasNext();){var n=i.next()
this._effect.setTexture(n,this._textures.get(n))}for(var r=this._floats.keys();r.hasNext();){var s=r.next()
this._effect.setFloat(s,this._floats.get(s))}for(var o=this._floatsArrays.keys();o.hasNext();){var a=o.next()
this._effect.setArray(a,this._floatsArrays.get(a))}for(var l=this._colors3.keys();l.hasNext();){var h=l.next()
this._effect.setColor3(h,this._colors3.get(h))}for(var u=this._colors4.keys();u.hasNext();){var f=u.next(),d=this._colors4.get(f)
this._effect.setFloat4(f,d.r,d.g,d.b,d.a)}for(var m=this._vectors2.keys();m.hasNext();){var _=m.next()
this._effect.setVector2(_,this._vectors2.get(_))}for(var p=this._vectors3.keys();p.hasNext();){var v=p.next()
this._effect.setVector3(v,this._vectors3.get(v))}for(var g=this._matrices.keys();g.hasNext();){var x=g.next()
this._effect.setMatrix(x,this._matrices.get(x))}}Le.prototype.bind.call(this,e,null)},dispose:function(e){null==e&&(e=!1)
for(var t=this._textures.keys();t.hasNext();){var i=t.next()
this._textures.get(i).dispose()}this._textures=null,Le.prototype.dispose.call(this,e)},__class__:gt})
var xt=t.BABYLON.ShadersStore=function(){}
s["com.babylonhx.materials.ShadersStore"]=xt,xt.__name__=["com","babylonhx","materials","ShadersStore"]
var yt=t.BABYLON.VideoTexture=function(e){ke.call(this,e)}
s["com.babylonhx.materials.textures.VideoTexture"]=yt,yt.__name__=["com","babylonhx","materials","textures","VideoTexture"],yt.__super__=ke,yt.prototype=i(ke.prototype,{__class__:yt})
var bt=t.BABYLON.WebGLTexture=function(e,t){this.noMipmap=!0,this.url=e,this.data=t,this.generateMipMaps=!1,this.isCube=!1,this.samplingMode=3,this._size=null,this._width=1,this._height=1,this._baseHeight=1,this._baseWidth=1,this._cachedWrapU=-1,this._cachedWrapV=-1,this._framebuffer=null,this._depthBuffer=null,this._cachedCoordinatesMode=-1,this._isDisabled=!1,this.isReady=!1,this.noMipmap=!1,this.references=0}
s["com.babylonhx.materials.textures.WebGLTexture"]=bt,bt.__name__=["com","babylonhx","materials","textures","WebGLTexture"],bt.__interfaces__=[A],bt.prototype={data:null,_framebuffer:null,_depthBuffer:null,generateMipMaps:null,isCube:null,isReady:null,noMipmap:null,references:null,url:null,samplingMode:null,_size:null,_baseHeight:null,_baseWidth:null,_cachedWrapU:null,_cachedWrapV:null,_width:null,_height:null,_cachedCoordinatesMode:null,_isDisabled:null,__smartArrayFlags:null,__class__:bt}
var wt=t.BABYLON.ProceduralTexture=function(e,t,i,n,r,s){null==s&&(s=!0),this._fallbackTextureUsed=!1,this._matrices=new Bi,this._vectors3=new Bi,this._vectors2=new Bi,this._colors4=new Bi,this._colors3=new Bi,this._floatsArrays=new Bi,this._floats=new Bi,this._textures=new Bi,this._samplers=[],this._uniforms=[],this._vertexStrideSize=8,this._vertexDeclaration=[2],this._refreshRate=1,this._currentRefreshId=-1,Ve.call(this,null,n,!s),n._proceduralTextures.push(this),this.name=e,this.isRenderTarget=!0,this._size=t,this._generateMipMaps=s,this.setFragment(i),this._fallbackTexture=r,this._texture=n._engine.createRenderTargetTexture(t,s)
var o=[]
o.push(1),o.push(1),o.push(-1),o.push(1),o.push(-1),o.push(-1),o.push(1),o.push(-1),this._vertexBuffer=n._engine.createVertexBuffer(o)
var a=[]
a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=n._engine.createIndexBuffer(a)}
s["com.babylonhx.materials.textures.procedurals.ProceduralTexture"]=wt,wt.__name__=["com","babylonhx","materials","textures","procedurals","ProceduralTexture"],wt.__super__=Ve,wt.prototype=i(Ve.prototype,{_size:null,_generateMipMaps:null,_doNotChangeAspectRatio:null,_currentRefreshId:null,_refreshRate:null,_vertexBuffer:null,_indexBuffer:null,_effect:null,_vertexDeclaration:null,_vertexStrideSize:null,_uniforms:null,_samplers:null,_fragment:null,_textures:null,_floats:null,_floatsArrays:null,_colors3:null,_colors4:null,_vectors2:null,_vectors3:null,_matrices:null,_fallbackTexture:null,_fallbackTextureUsed:null,reset:function(){if(null!=this._effect){var e=this.getScene().getEngine()
e._releaseEffect(this._effect)}},isReady:function(){var e=this,t=this.getScene().getEngine(),i=null
return null==this._fragment?!1:this._fallbackTextureUsed?!0:(i=null!=this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=t.createEffect(i,["position"],this._uniforms,this._samplers,"",null,null,function(){e.releaseInternalTexture(),null!=e._fallbackTexture&&(e._texture=e._fallbackTexture._texture,e._texture.references++),e._fallbackTextureUsed=!0}),this._effect._isReady)},resetRefreshCounter:function(){this._currentRefreshId=-1},setFragment:function(e){this._fragment=e},get_refreshRate:function(){return this._refreshRate},set_refreshRate:function(e){return this._refreshRate=e,this.resetRefreshCounter(),e},_shouldRender:function(){return this.isReady()&&null!=this._texture?this._fallbackTextureUsed?!1:-1==this._currentRefreshId?(this._currentRefreshId=1,!0):this.get_refreshRate()==this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1},getRenderSize:function(){return this._size},resize:function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t))},_checkUniform:function(e){-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e)},setTexture:function(e,t){return-1==c.indexOf(this._samplers,e,0)&&this._samplers.push(e),this._textures.set(e,t),this},setFloat:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._floats.set(e,t),this},setFloats:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._floatsArrays.set(e,t),this},setColor3:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._colors3.set(e,t),this},setColor4:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._colors4.set(e,t),this},setVector2:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._vectors2.set(e,t),this},setVector3:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._vectors3.set(e,t),this},setMatrix:function(e,t){return-1==c.indexOf(this._uniforms,e,0)&&this._uniforms.push(e),this._matrices.set(e,t),this},render:function(e){null==e&&(e=!1)
var t=this.getScene(),i=t._engine
i.bindFramebuffer(this._texture),i.clear(t.clearColor,!0,!0),i.enableEffect(this._effect),0!=i._depthCullingState.get_cull()&&i._depthCullingState.set_cull(!1),i._depthCullingState.set_zOffset(0)
for(var n=this._textures.keys();n.hasNext();){var r=n.next()
this._effect.setTexture(r,this._textures.get(r))}for(var s=this._floats.keys();s.hasNext();){var o=s.next()
this._effect.setFloat(o,this._floats.get(o))}for(var a=this._floatsArrays.keys();a.hasNext();){var l=a.next()
this._effect.setArray(l,this._floatsArrays.get(l))}for(var h=this._colors3.keys();h.hasNext();){var u=h.next()
this._effect.setColor3(u,this._colors3.get(u))}for(var c=this._colors4.keys();c.hasNext();){var f=c.next(),d=this._colors4.get(f)
this._effect.setFloat4(f,d.r,d.g,d.b,d.a)}for(var m=this._vectors2.keys();m.hasNext();){var _=m.next()
this._effect.setVector2(_,this._vectors2.get(_))}for(var p=this._vectors3.keys();p.hasNext();){var v=p.next()
this._effect.setVector3(v,this._vectors3.get(v))}for(var g=this._matrices.keys();g.hasNext();){var x=g.next()
this._effect.setMatrix(x,this._matrices.get(x))}i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),i.draw(!0,0,6),i.unBindFramebuffer(this._texture)},clone:function(){var e=this.getSize(),t=new wt(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps)
return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t},dispose:function(){var e,t=this.getScene()._proceduralTextures
e=c.indexOf(t,this,0),e>=0&&this.getScene()._proceduralTextures.splice(e,1),Ve.prototype.dispose.call(this)},__class__:wt,__properties__:{set_refreshRate:"set_refreshRate",get_refreshRate:"get_refreshRate"}})
var St=function(e,t,i,n,r){this._woodColor=new Re(.32,.17,.09),this._ampScale=100,wt.call(this,e,t,"wood",i,n,r),this.updateShaderUniforms(),this.set_refreshRate(0)}
s["com.babylonhx.materials.textures.procedurals.standard.WoodProceduralTexture"]=St,St.__name__=["com","babylonhx","materials","textures","procedurals","standard","WoodProceduralTexture"],St.__super__=wt,St.prototype=i(wt.prototype,{_ampScale:null,_woodColor:null,updateShaderUniforms:function(){this.setFloat("ampScale",this._ampScale),this.setColor3("woodColor",this._woodColor)},get_ampScale:function(){return this._ampScale},set_ampScale:function(e){return this._ampScale=e,this.updateShaderUniforms(),e},get_woodColor:function(){return this._woodColor},set_woodColor:function(e){return this._woodColor=e,this.updateShaderUniforms(),e},__class__:St,__properties__:i(wt.prototype.__properties__,{set_woodColor:"set_woodColor",get_woodColor:"get_woodColor",set_ampScale:"set_ampScale",get_ampScale:"get_ampScale"})})
var Mt=s["com.babylonhx.math.Space"]={__ename__:!0,__constructs__:["LOCAL","WORLD"]}
Mt.LOCAL=["LOCAL",0],Mt.LOCAL.toString=o,Mt.LOCAL.__enum__=Mt,Mt.WORLD=["WORLD",1],Mt.WORLD.toString=o,Mt.WORLD.__enum__=Mt
var Tt=t.BABYLON.Axis=function(){}
s["com.babylonhx.math.Axis"]=Tt,Tt.__name__=["com","babylonhx","math","Axis"]
var Ct=t.BABYLON.Frustum=function(){}
s["com.babylonhx.math.Frustum"]=Ct,Ct.__name__=["com","babylonhx","math","Frustum"],Ct.GetPlanes=function(e){for(var t=[],i=0;6>i;){i++
t.push(new Ye(0,0,0,0))}return t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize(),t},Ct.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[10]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()}
var At=t.BABYLON.Path3D=function(e,t){this._binormals=[],this._normals=[],this._tangents=[],this._distances=[],this._curve=[]
for(var i=0,n=e.length;n>i;){var r=i++
this._curve[r]=e[r].clone()}this._compute(t)}
s["com.babylonhx.math.Path3D"]=At,At.__name__=["com","babylonhx","math","Path3D"],At.prototype={path:null,_curve:null,_distances:null,_tangents:null,_normals:null,_binormals:null,getCurve:function(){return this._curve},getTangents:function(){return this._tangents},getNormals:function(){return this._normals},getBinormals:function(){return this._binormals},getDistances:function(){return this._distances},update:function(e,t){for(var i=0,n=e.length;n>i;){var r=i++
this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z}return this._compute(t),this},_compute:function(e){var t=this._curve.length
this._tangents[0]=this._getFirstNonNullVector(0),this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._tangents[t-1].normalize()
var i=this._tangents[0],n=this._normalVector(this._curve[0],i,e)
this._normals[0]=n,this._normals[0].normalize(),this._binormals[0]=W.Cross(i,this._normals[0]),this._binormals[0].normalize(),this._distances[0]=0
for(var r=new W(0,0,0),s=new W(0,0,0),o=new W(0,0,0),a=new W(0,0,0),l=new W(0,0,0),h=1;t>h;){var u=h++
r=this._getLastNonNullVector(u),t-1>u&&(s=this._getFirstNonNullVector(u),this._tangents[u]=new W(r.x+s.x,r.y+s.y,r.z+s.z),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z),o=this._tangents[u],a=this._normals[u-1],l=this._binormals[u-1],this._normals[u]=W.Cross(l,o),this._normals[u].normalize(),this._binormals[u]=W.Cross(o,this._normals[u]),this._binormals[u].normalize()}},_getFirstNonNullVector:function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0==Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e])
return i},_getLastNonNullVector:function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0==Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t])
return i},_normalVector:function(e,t,i){var n=new W(0,0,0)
if(null==i){var r=new W(0,0,0)
1!=t.y?r=new W(0,-1,0):1!=t.x?r=new W(1,0,0):1!=t.z&&(r=new W(0,0,1)),n=W.Cross(t,r)}else n=W.Cross(t,i),n.x=n.y*t.z-n.z*t.y,n.y=n.z*t.x-n.x*t.z,n.z=n.x*t.y-n.y*t.x
return n.normalize(),n},__class__:At}
var It=function(e,t){null!=e?this.position=e:this.position=new W(0,0,0),null!=t?this.normal=t:this.normal=new W(0,1,0)}
s["com.babylonhx.math.PositionNormalVertex"]=It,It.__name__=["com","babylonhx","math","PositionNormalVertex"],It.prototype={position:null,normal:null,clone:function(){return new It(this.position.clone(),this.normal.clone())},__class__:It}
var Pt=t.BABYLON.Ray=function(e,t,i){this.origin=e,this.direction=t,null!=i?this.length=i:this.length=1/0}
s["com.babylonhx.math.Ray"]=Pt,Pt.__name__=["com","babylonhx","math","Ray"],Pt.CreateNew=function(e,t,i,n,r,s,o){var a=W.Unproject(new W(e,t,0),i,n,r,s,o),l=W.Unproject(new W(e,t,1),i,n,r,s,o),h=new W(l.x-a.x,l.y-a.y,l.z-a.z)
return h.normalize(),new Pt(a,h)},Pt.CreateNewFromTo=function(e,t,i){null==i&&(i=U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))
var n=new W(t.x-e.x,t.y-e.y,t.z-e.z),r=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z)
return n.normalize(),Pt.Transform(new Pt(e,n,r),i)},Pt.Transform=function(e,t){var i=W.TransformCoordinates(e.origin,t),n=W.TransformNormal(e.direction,t)
return new Pt(i,n)},Pt.prototype={origin:null,direction:null,length:null,_edge1:null,_edge2:null,_pvec:null,_tvec:null,_qvec:null,intersectsBoxMinMax:function(e,t){var i=0,n=1/0
if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else{var r=1/this.direction.x,s=(e.x-this.origin.x)*r,o=(t.x-this.origin.x)*r
if(o==-(1/0)&&(o=1/0),s>o){var a=s
s=o,o=a}if(i=Math.max(s,i),n=Math.min(o,n),i>n)return!1}if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else{var l=1/this.direction.y,h=(e.y-this.origin.y)*l,u=(t.y-this.origin.y)*l
if(u==-(1/0)&&(u=1/0),h>u){var c=h
h=u,u=c}if(i=Math.max(h,i),n=Math.min(u,n),i>n)return!1}if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else{var f=1/this.direction.z,d=(e.z-this.origin.z)*f,m=(t.z-this.origin.z)*f
if(m==-(1/0)&&(m=1/0),d>m){var _=d
d=m,m=_}if(i=Math.max(d,i),n=Math.min(m,n),i>n)return!1}return!0},intersectsBox:function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},intersectsSphere:function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,n=e.center.z-this.origin.z,r=t*t+i*i+n*n,s=e.radius*e.radius
if(s>=r)return!0
var o=t*this.direction.x+i*this.direction.y+n*this.direction.z
if(0>o)return!1
var a=r-o*o
return s>=a},intersectsTriangle:function(e,t,i){null==this._edge1&&(this._edge1=new W(0,0,0),this._edge2=new W(0,0,0),this._pvec=new W(0,0,0),this._tvec=new W(0,0,0),this._qvec=new W(0,0,0)),t.subtractToRef(e,this._edge1),i.subtractToRef(e,this._edge2),W.CrossToRef(this.direction,this._edge2,this._pvec)
var n=W.Dot(this._edge1,this._pvec)
if(0==n)return null
var r=1/n
this.origin.subtractToRef(e,this._tvec)
var s=W.Dot(this._tvec,this._pvec)*r
if(0>s||s>1)return null
W.CrossToRef(this._tvec,this._edge1,this._qvec)
var o=W.Dot(this.direction,this._qvec)*r
return 0>o||s+o>1?null:new se(s,o,W.Dot(this._edge2,this._qvec)*r)},__class__:Pt}
var Et=t.BABYLON.Vector2=function(e,t){this.x=e,this.y=t}
s["com.babylonhx.math.Vector2"]=Et,Et.__name__=["com","babylonhx","math","Vector2"],Et.Zero=function(){return new Et(0,0)},Et.FromArray=function(e,t){return null==t&&(t=0),new Et(e[t],e[t+1])},Et.FromArrayToRef=function(e,t,i){return i.x=e[t],i.y=e[t+1],i},Et.CatmullRom=function(e,t,i,n,r){var s=r*r,o=r*s,a=.5*(2*t.x+(-e.x+i.x)*r+(2*e.x-5*t.x+4*i.x-n.x)*s+(-e.x+3*t.x-3*i.x+n.x)*o),l=.5*(2*t.y+(-e.y+i.y)*r+(2*e.y-5*t.y+4*i.y-n.y)*s+(-e.y+3*t.y-3*i.y+n.y)*o)
return new Et(a,l)},Et.Clamp=function(e,t,i){var n=e.x
n=n>i.x?i.x:n,n=n<t.x?t.x:n
var r=e.y
return r=r>i.y?i.y:r,r=r<t.y?t.y:r,new Et(n,r)},Et.Hermite=function(e,t,i,n,r){var s=r*r,o=r*s,a=2*o-3*s+1,l=-2*o+3*s,h=o-2*s+r,u=o-s,c=e.x*a+i.x*l+t.x*h+n.x*u,f=e.y*a+i.y*l+t.y*h+n.y*u
return new Et(c,f)},Et.Lerp=function(e,t,i){var n=e.x+(t.x-e.x)*i,r=e.y+(t.y-e.y)*i
return new Et(n,r)},Et.Dot=function(e,t){return e.x*t.x+e.y*t.y},Et.Normalize=function(e){var t=new Et(e.x,e.y)
return t.normalize(),t},Et.Minimize=function(e,t){var i
i=e.x<t.x?e.x:t.x
var n
return n=e.y<t.y?e.y:t.y,new Et(i,n)},Et.Maximize=function(e,t){var i
i=e.x>t.x?e.x:t.x
var n
return n=e.y>t.y?e.y:t.y,new Et(i,n)},Et.Transform=function(e,t){var i=e.x*t.m[0]+e.y*t.m[4],n=e.x*t.m[1]+e.y*t.m[5]
return new Et(i,n)},Et.Distance=function(e,t){return Math.sqrt(Et.DistanceSquared(e,t))},Et.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y
return i*i+n*n},Et.prototype={x:null,y:null,toString:function(){return"{X:"+this.x+" Y:"+this.y+"}"},toArray:function(e,t){return null==t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},asArray:function(){var e=[]
return this.toArray(e,0),e},copyFrom:function(e){return this.x=e.x,this.y=e.y,this},copyFromFloats:function(e,t){return this.x=e,this.y=t,this},add:function(e){return new Et(this.x+e.x,this.y+e.y)},addVector3:function(e){return new Et(this.x+e.x,this.y+e.y)},subtract:function(e){return new Et(this.x-e.x,this.y-e.y)},subtractInPlace:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyInPlace:function(e){return this.x*=e.x,this.y*=e.y,this},multiply:function(e){return new Et(this.x*e.x,this.y*e.y)},multiplyToRef:function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},multiplyByFloats:function(e,t){return new Et(this.x*e,this.y*t)},divide:function(e){return new Et(this.x/e.x,this.y/e.y)},divideToRef:function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},negate:function(){return new Et(-this.x,-this.y)},scaleInPlace:function(e){return this.x*=e,this.y*=e,this},scale:function(e){return new Et(this.x*e,this.y*e)},equals:function(e){return null!=e&&this.x==e.x&&this.y==e.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y)
if(0==e)return this
var t=1/e
return this.x*=t,this.y*=t,this},clone:function(){return new Et(this.x,this.y)},__class__:Et}
var Dt=t.BABYLON.Viewport=function(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}
s["com.babylonhx.math.Viewport"]=Dt,Dt.__name__=["com","babylonhx","math","Viewport"],Dt.prototype={x:null,y:null,width:null,height:null,toGlobal:function(e){var t=e.getRenderWidth(),i=e.getRenderHeight()
return new Dt(this.x*t,this.y*i,this.width*t,this.height*i)},__class__:Dt}
var Lt=t.BABYLON.GroundMesh=function(e,t){this._worldInverse=new U,this.generateOctree=!1,qe.call(this,e,t)}
s["com.babylonhx.mesh.GroundMesh"]=Lt,Lt.__name__=["com","babylonhx","mesh","GroundMesh"],Lt.__super__=qe,Lt.prototype=i(qe.prototype,{generateOctree:null,_worldInverse:null,_subdivisions:null,get_subdivisions:function(){return this._subdivisions},set_subdivisions:function(e){return this._subdivisions=e,this._subdivisions},optimize:function(){this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(32,null)},getHeightAtCoordinates:function(e,t){var i=new Pt(new W(e,this.getBoundingInfo().boundingBox.maximumWorld.y+1,t),new W(0,-1,0))
this.getWorldMatrix().invertToRef(this._worldInverse),i=Pt.Transform(i,this._worldInverse)
var n=this.intersects(i)
return n.hit?n.pickedPoint.y:0},__class__:Lt,__properties__:i(qe.prototype.__properties__,{set_subdivisions:"set_subdivisions",get_subdivisions:"get_subdivisions"})})
var Ft=t.BABYLON.InstancedMesh=function(e,t){je.call(this,e,t._scene),t.instances.push(this),this._sourceMesh=t,this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scaling.copyFrom(t.scaling),null!=t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.infiniteDistance=t.infiniteDistance,this._pivotMatrix=t._pivotMatrix,this._cache.pivotMatrixUpdated=!0,this.refreshBoundingInfo(),this._syncSubMeshes()}
s["com.babylonhx.mesh.InstancedMesh"]=Ft,Ft.__name__=["com","babylonhx","mesh","InstancedMesh"],Ft.__super__=je,Ft.prototype=i(je.prototype,{_sourceMesh:null,_currentLOD:null,get_receiveShadows:function(){return this._sourceMesh.get_receiveShadows()},get_material:function(){return this._sourceMesh.get_material()},get_visibility:function(){return this._sourceMesh.get_visibility()},get_skeleton:function(){return this._sourceMesh.get_skeleton()},getTotalVertices:function(){return this._sourceMesh.getTotalVertices()},sourceMesh:null,get_sourceMesh:function(){return this._sourceMesh},getVerticesData:function(e,t){return null==t&&(t=!1),this._sourceMesh.getVerticesData(e,t)},isVerticesDataPresent:function(e){return this._sourceMesh.isVerticesDataPresent(e)},getIndices:function(e){return null==e&&(e=!1),this._sourceMesh.getIndices(e)},get_positions:function(){return this._sourceMesh._positions},refreshBoundingInfo:function(){var e=this._sourceMesh.getVerticesData(Qe.PositionKind)
if(null!=e){var t=Oe.ExtractMinAndMax(e,0,this._sourceMesh.getTotalVertices())
this._boundingInfo=new le(t.minimum,t.maximum)}null==this._boundingInfo?this._boundingInfo=new le(this.get_absolutePosition(),this.get_absolutePosition()):this._boundingInfo=this._boundingInfo,this._boundingInfo._update(this.get_worldMatrixFromCache()),this._updateSubMeshesBoundingInfo(this.get_worldMatrixFromCache())},_preActivate:function(){null!=this._currentLOD&&this._currentLOD._preActivate()},_activate:function(e){null!=this._currentLOD&&this.get_sourceMesh()._registerInstanceForRenderId(this,e)},getLOD:function(){return this._currentLOD=this.get_sourceMesh().getLOD(this._scene.activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD==this.get_sourceMesh()?this:this._currentLOD},_syncSubMeshes:function(){if(this.releaseSubMeshes(),null!=this._sourceMesh.subMeshes)for(var e=0,t=this._sourceMesh.subMeshes.length;t>e;){var i=e++
this._sourceMesh.subMeshes[i].clone(this,this._sourceMesh)}},_generatePointsArray:function(){return this._sourceMesh._generatePointsArray()},clone:function(e,t,i){null==i&&(i=!1),Ei.trace("InstancedMesh:clone()",{fileName:"InstancedMesh.hx",lineNumber:140,className:"com.babylonhx.mesh.InstancedMesh",methodName:"clone"})
var n=this._sourceMesh.createInstance(e)
if(Oe.DeepCopy(this,n,["name"],[]),this.refreshBoundingInfo(),null!=t&&(n.parent=t),!i)for(var r=0,s=this._scene.meshes.length;s>r;){var o=r++,a=this._scene.meshes[o]
a.parent==this&&a.clone(a.name,n)}return n.computeWorldMatrix(!0),n},dispose:function(e){null==e&&(e=!1),c.remove(this._sourceMesh.instances,this),je.prototype.dispose.call(this,e)},__class__:Ft,__properties__:i(je.prototype.__properties__,{get_sourceMesh:"get_sourceMesh"})})
var Rt=t.BABYLON.LinesMesh=function(e,t,i){null==i&&(i=!1),this._indices=[],this.alpha=1,this.color=new Re(1,1,1),qe.call(this,e,t),this._colorShader=new gt("colorShader",t,"color",{attributes:["position"],uniforms:["worldViewProjection","color"],needAlphaBlending:!0})}
s["com.babylonhx.mesh.LinesMesh"]=Rt,Rt.__name__=["com","babylonhx","mesh","LinesMesh"],Rt.__super__=qe,Rt.prototype=i(qe.prototype,{color:null,alpha:null,_colorShader:null,_ib:null,_indicesLength:null,_indices:null,get_material:function(){return this._colorShader},get_isPickable:function(){return!1},get_checkCollisions:function(){return!1},_bind:function(){var e=this._scene._engine,t=this._geometry.getIndexBuffer()
e.bindBuffers(this._geometry.getVertexBuffer(Qe.PositionKind).getBuffer(),t,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},_draw:function(e){if(null!=this._geometry&&null!=this._geometry.getVertexBuffers()&&null!=this._geometry.getIndexBuffer()){var t=this._scene._engine
t.draw(!1,e.indexStart,e.indexCount)}},intersects:function(e,t){return null==t&&(t=!1),null},dispose:function(e){null==e&&(e=!1),this._colorShader.dispose(),qe.prototype.dispose.call(this,e)},__class__:Rt})
var zt=t.BABYLON.MeshLODLevel=function(e,t){this.distance=e,this.mesh=t}
s["com.babylonhx.mesh.MeshLODLevel"]=zt,zt.__name__=["com","babylonhx","mesh","MeshLODLevel"],zt.prototype={mesh:null,distance:null,__class__:zt}
var Bt=t.BABYLON.WebGLBuffer=function(e){this.is32Bits=!1,this.capacity=0,this.buffer=e,this.references=1}
s["com.babylonhx.mesh.WebGLBuffer"]=Bt,Bt.__name__=["com","babylonhx","mesh","WebGLBuffer"],Bt.prototype={buffer:null,references:null,capacity:null,is32Bits:null,__class__:Bt}
var Ot=t.BABYLON._InstancesBatch=function(){this.renderSelf=[],this.visibleInstances=[],this.mustReturn=!1,this.mustReturn=!1,this.visibleInstances=[],this.renderSelf=[]}
s["com.babylonhx.mesh._InstancesBatch"]=Ot,Ot.__name__=["com","babylonhx","mesh","_InstancesBatch"],Ot.prototype={mustReturn:null,visibleInstances:null,renderSelf:null,__class__:Ot}
var kt=t.BABYLON._VisibleInstances=function(e,t){this.map=new Fi,this.defaultRenderId=e,this.selfDefaultRenderId=t}
s["com.babylonhx.mesh._VisibleInstances"]=kt,kt.__name__=["com","babylonhx","mesh","_VisibleInstances"],kt.prototype={map:null,defaultRenderId:null,selfDefaultRenderId:null,__class__:kt}
var Vt=t.BABYLON.DecimationTriangle=function(e){this.error=[],this.deleted=!1,this.isDirty=!1,this.borderFactor=0,this.vertices=e,this.deletePending=!1}
s["com.babylonhx.mesh.simplification.DecimationTriangle"]=Vt,Vt.__name__=["com","babylonhx","mesh","simplification","DecimationTriangle"],Vt.prototype={vertices:null,normal:null,error:null,deleted:null,isDirty:null,borderFactor:null,deletePending:null,originalOffset:null,__class__:Vt}
var Nt=t.BABYLON.DecimationVertex=function(e,t){this.id=t,this.position=e,this.isBorder=!0,this.q=new Yt,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}
s["com.babylonhx.mesh.simplification.DecimationVertex"]=Nt,Nt.__name__=["com","babylonhx","mesh","simplification","DecimationVertex"],Nt.prototype={id:null,position:null,q:null,isBorder:null,triangleStart:null,triangleCount:null,originalOffsets:null,updatePosition:function(e){this.position.copyFrom(e)},__class__:Nt}
var Ut=t.BABYLON.ISimplificationSettings=function(){}
s["com.babylonhx.mesh.simplification.ISimplificationSettings"]=Ut,Ut.__name__=["com","babylonhx","mesh","simplification","ISimplificationSettings"],Ut.prototype={quality:null,distance:null,optimizeMesh:null,__class__:Ut}
var Wt=t.BABYLON.ISimplifier=function(){}
s["com.babylonhx.mesh.simplification.ISimplifier"]=Wt,Wt.__name__=["com","babylonhx","mesh","simplification","ISimplifier"],Wt.prototype={simplify:null,__class__:Wt}
var Gt=t.BABYLON.QuadraticErrorSimplification=function(){this.syncIterations=5e3,this.initialised=!1,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=M.Epsilon}
s["com.babylonhx.mesh.simplification.QuadraticErrorSimplification"]=Gt,Gt.__name__=["com","babylonhx","mesh","simplification","QuadraticErrorSimplification"],Gt.__interfaces__=[Wt],Gt.prototype={triangles:null,vertices:null,references:null,initialised:null,_reconstructedMesh:null,syncIterations:null,aggressiveness:null,decimationIterations:null,boundingBoxEpsilon:null,_mesh:null,simplify:function(e,t){var i=this
this.initDecimatedMesh(),_i.Run(this._mesh.subMeshes.length,function(t){i.initWithMesh(t.index,function(){i.runDecimation(e,t.index,function(){t.executeNext()})})},function(){Oe.delay(function(){t(i._reconstructedMesh)},0)})},isTriangleOnBoundingBox:function(e){for(var t=0,i=0,n=e.vertices;i<n.length;){var r=n[i];++i
var s=0,o=r.position,a=this._mesh.getBoundingInfo().boundingBox;(a.maximum.x-o.x<this.boundingBoxEpsilon||o.x-a.minimum.x>this.boundingBoxEpsilon)&&++s,(a.maximum.y==o.y||o.y==a.minimum.y)&&++s,(a.maximum.z==o.z||o.z==a.minimum.z)&&++s,s>1&&++t}return t>1&&(Ei.trace(e,{fileName:"QuadraticErrorSimplification.hx",lineNumber:82,className:"com.babylonhx.mesh.simplification.QuadraticErrorSimplification",methodName:"isTriangleOnBoundingBox"}),Ei.trace(t,{fileName:"QuadraticErrorSimplification.hx",lineNumber:83,className:"com.babylonhx.mesh.simplification.QuadraticErrorSimplification",methodName:"isTriangleOnBoundingBox"})),t>1},runDecimation:function(e,t,i){var n=this,s=this.triangles.length*e.quality|0,o=0,a=this.triangles.length,l=function(e,t){Oe.delay(function(){e%5==0&&n.updateMesh(0==e)
for(var i=0,r=n.triangles.length;r>i;){var l=i++
n.triangles[l].isDirty=!1}var h=1e-9*Math.pow(e+3,n.aggressiveness),u=function(e){var t=(n.triangles.length/2+e)%n.triangles.length|0,i=n.triangles[t]
if(null!=i&&!(i.error[3]>h||i.deleted||i.isDirty))for(var r=0;3>r;){var s=r++
if(i.error[s]<h){var a=[],l=[],u=i.vertices[s],f=i.vertices[(s+1)%3]
if(u.isBorder!=f.isBorder)continue
var d=new W(0,0,0),m=new W(0,0,0),_=new Et(0,0),p=new tt(0,0,0,1)
n.calculateError(u,f,d,m,_,p)
var v=[]
if(n.isFlipped(u,f,d,a,i.borderFactor,v))continue
if(n.isFlipped(f,u,d,l,i.borderFactor,v))continue
if(c.indexOf(a,!0,0)<0||c.indexOf(l,!0,0)<0)continue
for(var g=[],x=0;x<v.length;){var y=v[x];++x,-1==c.indexOf(g,y,0)&&(y.deletePending=!0,g.push(y))}if(g.length%2!=0)continue
u.q=f.q.add(u.q),u.updatePosition(d)
var b=n.references.length
o=n.updateTriangles(u,u,a,o),o=n.updateTriangles(u,f,l,o)
var w=n.references.length-b
if(w<=u.triangleCount){if(w>0)for(var S=0;w>S;){var M=S++
n.references[u.triangleStart+M]=n.references[b+M]}}else u.triangleStart=b
u.triangleCount=w
break}}}
_i.SyncAsyncForLoop(n.triangles.length,n.syncIterations,u,t,function(){return s>=a-o})},0)}
_i.Run(this.decimationIterations,function(e){s>=a-o?e.breakLoop():l(e.index,r(e,e.executeNext))},function(){Oe.delay(function(){n.reconstructMesh(t),i()},0)})},initWithMesh:function(e,t,i){null==i&&(i=!1)
var n=this
this.vertices=[],this.triangles=[]
var r=this._mesh.getVerticesData(Qe.PositionKind),s=this._mesh.getIndices(),o=this._mesh.subMeshes[e],a=function(e){if(i)for(var t=0,r=n.vertices.length;r>t;){var s=t++
if(n.vertices[s].position.equals(e))return n.vertices[s]}return null},l=[],h=function(e){var t=e+o.verticesStart,i=W.FromArray(r,3*t),s=a(i)
null==s&&(s=new Nt(i,n.vertices.length)),s.originalOffsets.push(t),s.id==n.vertices.length&&n.vertices.push(s),l.push(s.id)},u=o.verticesCount
_i.SyncAsyncForLoop(u,this.syncIterations/4|0,h,function(){var e=function(e){var t=o.indexStart/3+e,i=3*t|0,r=s[i],a=s[i+1],h=s[i+2],u=n.vertices[l[r-o.verticesStart]],c=n.vertices[l[a-o.verticesStart]],f=n.vertices[l[h-o.verticesStart]],d=new Vt([u,c,f])
d.originalOffset=i,n.triangles.push(d)}
_i.SyncAsyncForLoop(s.length/3|0,n.syncIterations,e,function(){n.init(t)})})},init:function(e){var t=this,i=function(e){var i=t.triangles[e]
i.normal=W.Cross(i.vertices[1].position.subtract(i.vertices[0].position),i.vertices[2].position.subtract(i.vertices[0].position)).normalize()
for(var n=0;3>n;){var r=n++
i.vertices[r].q.addArrayInPlace(Yt.DataFromNumbers(i.normal.x,i.normal.y,i.normal.z,-W.Dot(i.normal,i.vertices[0].position)))}}
_i.SyncAsyncForLoop(this.triangles.length,this.syncIterations,i,function(){var i=function(e){for(var i=t.triangles[e],n=0;3>n;){var r=n++
i.error[r]=t.calculateError(i.vertices[r],i.vertices[(r+1)%3])}i.error[3]=Math.min(i.error[0],i.error[1]),i.error[3]=Math.min(i.error[3],i.error[2])}
_i.SyncAsyncForLoop(t.triangles.length,t.syncIterations,i,function(){t.initialised=!0,e()})})},reconstructMesh:function(e){for(var t=[],i=0,n=this.vertices.length;n>i;){var r=i++
this.vertices[r].triangleCount=0}for(var s=null,o=0,a=this.triangles.length;a>o;){var l=o++
if(!this.triangles[l].deleted){s=this.triangles[l]
for(var h=0;3>h;){var u=h++
s.vertices[u].triangleCount=1}t.push(s)}}var f=this._reconstructedMesh.getVerticesData(Qe.PositionKind)
null==f&&(f=[])
var d=this._reconstructedMesh.getVerticesData(Qe.NormalKind)
null==d&&(d=[])
var m=this._reconstructedMesh.getVerticesData(Qe.UVKind)
null==m&&(m=[])
var _=this._reconstructedMesh.getVerticesData(Qe.ColorKind)
null==_&&(_=[])
for(var p=this._mesh.getVerticesData(Qe.NormalKind),v=this._mesh.getVerticesData(Qe.UVKind),g=this._mesh.getVerticesData(Qe.ColorKind),x=0,y=0,b=this.vertices.length;b>y;){var w=y++,S=this.vertices[w]
if(S.id=x,S.triangleCount>0)for(var M=0,T=S.originalOffsets;M<T.length;){var C=T[M];++M,f.push(S.position.x),f.push(S.position.y),f.push(S.position.z),d.push(p[3*C]),d.push(p[3*C+1]),d.push(p[3*C+2]),null!=v&&v.length>0?(m.push(v[2*C]),m.push(v[2*C+1])):null!=g&&g.length>0&&(_.push(g[4*C]),_.push(g[4*C+1]),_.push(g[4*C+2]),_.push(g[4*C+3])),++x}}var A=this._reconstructedMesh.getTotalIndices(),I=this._reconstructedMesh.getTotalVertices(),P=this._reconstructedMesh.subMeshes
this._reconstructedMesh.subMeshes=[]
for(var E=this._reconstructedMesh.getIndices(),D=this._mesh.getIndices(),L=0,F=t.length;F>L;)for(var R=L++,z=t[R],B=0,O=[0,1,2];B<O.length;){var k=O[B];++B
var V=D[z.originalOffset+k],N=c.indexOf(z.vertices[k].originalOffsets,V,0)
0>N&&(N=0),E.push(z.vertices[k].id+N+I)}this._reconstructedMesh.setIndices(E),this._reconstructedMesh.setVerticesData(Qe.PositionKind,f),this._reconstructedMesh.setVerticesData(Qe.NormalKind,d),m.length>0&&this._reconstructedMesh.setVerticesData(Qe.UVKind,m),_.length>0&&this._reconstructedMesh.setVerticesData(Qe.ColorKind,_)
var U=this._mesh.subMeshes[e]
if(e>0){this._reconstructedMesh.subMeshes=[]
for(var W=0;W<P.length;){var G=P[W];++W,new Je(G.materialIndex,G.verticesStart,G.verticesCount,G.indexStart,G.indexCount,G._mesh)}new Je(U.materialIndex,I,x,A,3*t.length,this._reconstructedMesh)}},initDecimatedMesh:function(){this._reconstructedMesh=new qe(this._mesh.name+"Decimated",this._mesh._scene),this._reconstructedMesh.set_material(this._mesh.get_material()),this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},isFlipped:function(e,t,i,n,r,s){for(var o=0,a=e.triangleCount;a>o;){var l=o++,h=this.triangles[this.references[e.triangleStart+l].triangleId]
if(!h.deleted){var u=this.references[e.triangleStart+l].vertexId,c=h.vertices[(u+1)%3],f=h.vertices[(u+2)%3]
if(c!=t&&f!=t){var d=c.position.subtract(i)
d=d.normalize()
var m=f.position.subtract(i)
if(m=m.normalize(),Math.abs(d.x*m.x+d.y*m.y+d.z*m.z)>.999)return!0
var _=W.Cross(d,m).normalize()
if(n[l]=!1,W.Dot(_,h.normal)<.2)return!0}else n[l]=!0,s.push(h)}}return!1},updateTriangles:function(e,t,i,n){for(var r=n,s=0,o=t.triangleCount;o>s;){var a=s++,l=this.references[t.triangleStart+a],h=this.triangles[l.triangleId]
h.deleted||(i[a]&&h.deletePending?(h.deleted=!0,r++):(h.vertices[l.vertexId]=e,h.isDirty=!0,h.error[0]=this.calculateError(h.vertices[0],h.vertices[1])+h.borderFactor/2,h.error[1]=this.calculateError(h.vertices[1],h.vertices[2])+h.borderFactor/2,h.error[2]=this.calculateError(h.vertices[2],h.vertices[0])+h.borderFactor/2,h.error[3]=Math.min(h.error[0],h.error[1]),h.error[3]=Math.min(h.error[3],h.error[2]),this.references.push(l)))}return r},identifyBorder:function(){for(var e=0,t=this.vertices.length;t>e;){for(var i=e++,n=[],r=[],s=this.vertices[i],o=0,a=s.triangleCount;a>o;)for(var l=o++,h=this.triangles[this.references[s.triangleStart+l].triangleId],u=0;3>u;){for(var c=u++,f=0,d=h.vertices[c];f<n.length&&r[f]!=d.id;)++f
f==n.length?(n.push(1),r.push(d.id)):n[f]++}for(var m=0,_=n.length;_>m;){var p=m++
1==n[p]?this.vertices[r[p]].isBorder=!0:this.vertices[r[p]].isBorder=!1}}},updateMesh:function(e){if(null==e&&(e=!1),!e){for(var t=[],i=0,n=this.triangles.length;n>i;){var r=i++
this.triangles[r].deleted||t.push(this.triangles[r])}this.triangles=t}for(var s=0,o=this.vertices.length;o>s;){var a=s++
this.vertices[a].triangleCount=0,this.vertices[a].triangleStart=0}for(var l=null,h=null,u=0,c=this.triangles.length;c>u;){var f=u++
l=this.triangles[f]
for(var d=0;3>d;){var m=d++
h=l.vertices[m],h.triangleCount++}}for(var _=0,p=0,v=this.vertices.length;v>p;){var g=p++
this.vertices[g].triangleStart=_,_+=this.vertices[g].triangleCount,this.vertices[g].triangleCount=0}for(var x=[],y=0,b=this.triangles.length;b>y;){var w=y++
l=this.triangles[w]
for(var S=0;3>S;){var M=S++
h=l.vertices[M],x[h.triangleStart+h.triangleCount]=new Ht(M,w),h.triangleCount++}}this.references=x,e&&this.identifyBorder()},vertexError:function(e,t){var i=t.x,n=t.y,r=t.z
return e.data[0]*i*i+2*e.data[1]*i*n+2*e.data[2]*i*r+2*e.data[3]*i+e.data[4]*n*n+2*e.data[5]*n*r+2*e.data[6]*n+e.data[7]*r*r+2*e.data[8]*r+e.data[9]},calculateError:function(e,t,i){var n=e.q.add(t.q),r=e.isBorder&&t.isBorder,s=0,o=n.det(0,1,2,1,4,5,2,5,7)
if(0==o||r){var a=e.position.add(t.position).divide(new W(2,2,2)),l=this.vertexError(n,e.position),h=this.vertexError(n,t.position),u=this.vertexError(n,a)
s=Math.min(l,h),s=Math.min(s,u),s==l?null!=i&&i.copyFrom(e.position):s==h?null!=i&&i.copyFrom(t.position):null!=i&&(i.x=a.x,i.y=a.y,i.z=a.z)}else null==i&&(i=new W(0,0,0)),i.x=-1/o*n.det(1,2,3,4,5,6,5,7,8),i.y=1/o*n.det(0,2,3,1,5,6,2,7,8),i.z=-1/o*n.det(0,1,3,1,4,6,2,5,8),s=this.vertexError(n,i)
return s},__class__:Gt}
var Yt=t.BABYLON.QuadraticMatrix=function(e){if(this.data=[],null!=e)for(var t=0;10>t;){var i=t++
i<=e.length?this.data[i]=e[i]:this.data[i]=0}}
s["com.babylonhx.mesh.simplification.QuadraticMatrix"]=Yt,Yt.__name__=["com","babylonhx","mesh","simplification","QuadraticMatrix"],Yt.FromData=function(e,t,i,n){return new Yt(Yt.DataFromNumbers(e,t,i,n))},Yt.DataFromNumbers=function(e,t,i,n){return[e*e,e*t,e*i,e*n,t*t,t*i,t*n,i*i,i*n,n*n]},Yt.prototype={data:null,det:function(e,t,i,n,r,s,o,a,l){var h=this.data[e]*this.data[r]*this.data[l]+this.data[i]*this.data[n]*this.data[a]+this.data[t]*this.data[s]*this.data[o]-this.data[i]*this.data[r]*this.data[o]-this.data[e]*this.data[s]*this.data[a]-this.data[t]*this.data[n]*this.data[l]
return h},addInPlace:function(e){for(var t=0;10>t;){var i=t++
this.data[i]+=e.data[i]}},addArrayInPlace:function(e){for(var t=0;10>t;){var i=t++
this.data[i]+=e[i]}},add:function(e){for(var t=new Yt,i=0;10>i;){var n=i++
t.data[n]=this.data[n]+e.data[n]}return t},__class__:Yt}
var Ht=t.BABYLON.Reference=function(e,t){this.vertexId=e,this.triangleId=t}
s["com.babylonhx.mesh.simplification.Reference"]=Ht,Ht.__name__=["com","babylonhx","mesh","simplification","Reference"],Ht.prototype={vertexId:null,triangleId:null,__class__:Ht}
var Xt=t.BABYLON.SimplificationQueue=function(){this.running=!1,this._simplificationArray=[]}
s["com.babylonhx.mesh.simplification.SimplificationQueue"]=Xt,Xt.__name__=["com","babylonhx","mesh","simplification","SimplificationQueue"],Xt.prototype={_simplificationArray:null,running:null,addTask:function(e){this._simplificationArray.push(e)},executeNext:function(){var e=this._simplificationArray.pop()
null!=e?(this.running=!0,this.runSimplification(e)):this.running=!1},runSimplification:function(e){var t=this
if(e.parallelProcessing)for(var i=0,n=e.settings;i<n.length;){var r=[n[i]];++i
var s=this.getSimplifier(e)
s.simplify(r[0],function(i){return function(n){e.mesh.addLODLevel(i[0].distance,n),n.isVisible=!0,i[0].quality==e.settings[e.settings.length-1].quality&&null!=e.successCallback&&e.successCallback(),t.executeNext()}}(r))}else{var o=this.getSimplifier(e),a=function(t,i){o.simplify(t,function(n){e.mesh.addLODLevel(t.distance,n),n.isVisible=!0,i()})}
_i.Run(e.settings.length,function(t){a(e.settings[t.index],function(){t.executeNext()})},function(){null!=e.successCallback&&e.successCallback(),t.executeNext()})}},getSimplifier:function(e){var t=e.simplificationType
switch(t){case 0:return new Gt(e.mesh)
default:return new Gt(e.mesh)}return null},__class__:Xt}
var jt=t.BABYLON.SimplificationSettings=function(e,t,i){null==i&&(i=!1),this.quality=e,this.distance=t,this.optimizeMesh=i}
s["com.babylonhx.mesh.simplification.SimplificationSettings"]=jt,jt.__name__=["com","babylonhx","mesh","simplification","SimplificationSettings"],jt.__interfaces__=[Ut],jt.prototype={quality:null,distance:null,optimizeMesh:null,__class__:jt}
var Kt=t.BABYLON.SimplificationTask=function(e,t,i,n,r){null==r&&(r=!1),this.settings=e,this.simplificationType=t,this.mesh=i,this.successCallback=n,this.parallelProcessing=r}
s["com.babylonhx.mesh.simplification.SimplificationTask"]=Kt,Kt.__name__=["com","babylonhx","mesh","simplification","SimplificationTask"],Kt.prototype={settings:null,simplificationType:null,mesh:null,successCallback:null,parallelProcessing:null,__class__:Kt}
var Zt=t.BABYLON.Particle=function(){this.angularSpeed=0,this.angle=0,this.size=0,this.age=0,this.lifeTime=1,this.colorStep=new tt(0,0,0,0),this.color=new tt(0,0,0,0),this.direction=new W(0,0,0),this.position=new W(0,0,0)}
s["com.babylonhx.particles.Particle"]=Zt,Zt.__name__=["com","babylonhx","particles","Particle"],Zt.prototype={position:null,direction:null,color:null,colorStep:null,lifeTime:null,age:null,size:null,angle:null,angularSpeed:null,__class__:Zt}
var qt=t.BABYLON.IPhysicsEnginePlugin=function(){}
s["com.babylonhx.physics.IPhysicsEnginePlugin"]=qt,qt.__name__=["com","babylonhx","physics","IPhysicsEnginePlugin"],qt.prototype={initialize:null,setGravity:null,runOneStep:null,registerMesh:null,registerMeshesAsCompound:null,unregisterMesh:null,applyImpulse:null,createLink:null,dispose:null,isSupported:null,updateBodyPosition:null,__class__:qt}
var Qt=t.BABYLON.PhysicsCompoundBodyPart=function(){}
s["com.babylonhx.physics.PhysicsCompoundBodyPart"]=Qt,Qt.__name__=["com","babylonhx","physics","PhysicsCompoundBodyPart"],Qt.prototype={mesh:null,impostor:null,__class__:Qt}
var Jt=t.BABYLON.PhysicsEngine=function(e){null!=e?this._currentPlugin=e:this._currentPlugin=new ti}
s["com.babylonhx.physics.PhysicsEngine"]=Jt,Jt.__name__=["com","babylonhx","physics","PhysicsEngine"],Jt.prototype={gravity:null,_currentPlugin:null,_initialize:function(e){this._currentPlugin.initialize(),this._setGravity(e)},_runOneStep:function(e){e>.1?e=.1:0>=e&&(e=.016666666666666666),this._currentPlugin.runOneStep(e)},_setGravity:function(e){null!=e?this.gravity=e:this.gravity=new W(0,-9.82,0),this._currentPlugin.setGravity(this.gravity)},_registerMesh:function(e,t,i){return this._currentPlugin.registerMesh(e,t,i)},_registerMeshesAsCompound:function(e,t){return this._currentPlugin.registerMeshesAsCompound(e,t)},_unregisterMesh:function(e){this._currentPlugin.unregisterMesh(e)},_applyImpulse:function(e,t,i){this._currentPlugin.applyImpulse(e,t,i)},_createLink:function(e,t,i,n,r){return this._currentPlugin.createLink(e,t,i,n,r)},_updateBodyPosition:function(e){this._currentPlugin.updateBodyPosition(e)},dispose:function(){this._currentPlugin.dispose()},isSupported:function(){return this._currentPlugin.isSupported()},__class__:Jt}
var $t=function(e){var t
if(t=null!=e?e:{},null!=t.world){this.parent=t.world,null!=t.name?this.name=t.name:this.name=""
var i
i=null!=t.move?t.move:!1
var n
n=null!=t.noSleep?t.noSleep:!1
var r
r=null!=t.pos?t.pos:[0,0,0],r[0]*=.01,r[1]*=.01,r[2]*=.01
var s
s=null!=t.size?t.size:[1,1,1],s[0]*=.01,s[1]*=.01,s[2]*=.01
var o
o=null!=t.rot?t.rot:[0,0,0]
var a=[],l=$t.EulerToAxis(o[0],o[1],o[2])
a.push(l[0]),a.push(l[1]),a.push(l[2]),a.push(l[3])
var h
h=null!=t.sc?t.sc:new Qr,null!=t.config&&(null!=t.config[0]?h.density=t.config[0]:h.density=1,null!=t.config[1]?h.friction=t.config[1]:h.friction=.4,null!=t.config[2]?h.restitution=t.config[2]:h.restitution=.2,null!=t.config[3]?h.belongsTo=t.config[3]:h.belongsTo=1,null!=t.config[4]?h.collidesWith=t.config[4]:h.collidesWith=-1),null!=t.massPos&&(t.massPos=t.massPos.map(function(e){return.01*e}),h.relativePosition.init(t.massPos[0],t.massPos[1],t.massPos[2])),null!=t.massRot&&(t.massRot=t.massRot.map(function(e){return e*Ms.TO_RAD}),h.relativeRotation=$t.EulerToMatrix(t.massRot[0],t.massRot[1],t.massRot[2])),this.body=new Ss(r[0],r[1],r[2],a[0],a[1],a[2],a[3])
var u,c=null
switch(u=null!=t.type?t.type:"box"){case"sphere":c=new Jr(h,s[0])
break
case"cylinder":c=new Zr(h,s[0],s[1],s[2])
break
case"box":c=new Zr(h,s[0],s[1],s[2])}this.body.addShape(c),i?(null!=t.massPos||null!=t.massRot?this.body.setupMass(1,!1):this.body.setupMass(1,!0),n?this.body.allowSleep=!1:this.body.allowSleep=!0):this.body.setupMass(2,!1),this.body.name=this.name,this.sleeping=this.body.sleeping,this.parent.addRigidBody(this.body)}}
s["com.babylonhx.physics.plugins.Body"]=$t,$t.__name__=["com","babylonhx","physics","plugins","Body"],$t.EulerToAxis=function(e,t,i){var n=Math.cos(.5*t),r=Math.sin(.5*t),s=Math.cos(.5*i),o=Math.sin(.5*i),a=Math.cos(.5*e),l=Math.sin(.5*e),h=n*s,u=r*o,c=h*a-u*l,f=h*l+u*a,d=r*s*a+n*o*l,m=n*o*a-r*s*l,_=2*Math.acos(c),p=f*f+d*d+m*m
return.001>p?(f=1,d=m=0):(p=Math.sqrt(p),f/=p,d/=p,m/=p),[_,f,d,m]},$t.EulerToMatrix=function(e,t,i){var n=Math.cos(t),r=Math.sin(t),s=Math.cos(i),o=Math.sin(i),a=Math.cos(e),l=Math.sin(e),h=new Cr
return h.elements[0]=n*s,h.elements[1]=r*l-n*o*a,h.elements[2]=n*o*l+r*a,h.elements[3]=o,h.elements[4]=s*a,h.elements[5]=-s*l,h.elements[6]=-r*s,h.elements[7]=r*o*a+n*l,h.elements[8]=-r*o*l+n*a,h},$t.prototype={body:null,parent:null,name:null,sleeping:null,setPosition:function(e,t,i){this.body.position.x=e,this.body.position.y=t,this.body.position.z=i},setRotation:function(e){this.body.setRotation(e)},getPosition:function(){return this.body.position},getSleep:function(){return this.body.sleeping},resetPosition:function(e,t,i){this.body.position.x=e,this.body.position.y=t,this.body.position.z=i},awake:function(){this.body.awake()},remove:function(){this.parent.removeRigidBody(this.body)},checkContact:function(e){this.parent.checkContact(this.name,e)},__class__:$t}
var ei=function(e){if(null!=e.world){this.parent=e.world,null!=e.name?this.name=e.name:this.name=""
var t
t=null!=e.type?e.type:"jointHinge"
var i
i=null!=e.axe1?e.axe1:[1,0,0]
var n
n=null!=e.axe2?e.axe2:[1,0,0]
var r
r=null!=e.pos1?e.pos1:[0,0,0]
var s
s=null!=e.pos2?e.pos2:[0,0,0],r=r.map(function(e){return.01*e}),s=s.map(function(e){return.01*e})
var o,a
"jointDistance"==t?(o=null!=e.min?e.min:0,a=null!=e.max?e.max:10,o=.01*o,a=.01*a):(o=null!=e.min?e.min:57.29578,a=null!=e.max?e.max:0,o*=Ms.TO_RAD,a*=Ms.TO_RAD)
var l=e.limit,h=e.spring,u=e.motor,c=new cs
switch(null!=e.collision?c.allowCollision=e.collision:c.allowCollision=!1,c.localAxis1.init(i[0],i[1],i[2]),c.localAxis2.init(n[0],n[1],n[2]),c.localAnchorPoint1.init(r[0],r[1],r[2]),c.localAnchorPoint2.init(s[0],s[1],s[2]),c.body1=e.body1,c.body2=e.body2,t){case"jointDistance":this.joint=new hs(c,o,a),null!=h&&Me.__cast(this.joint,hs).limitMotor.setSpring(h[0],h[1]),null!=u&&Me.__cast(this.joint,hs).limitMotor.setSpring(u[0],u[1])
break
case"jointHinge":this.joint=new us(c,o,a),null!=h&&Me.__cast(this.joint,us).limitMotor.setSpring(h[0],h[1]),null!=u&&Me.__cast(this.joint,us).limitMotor.setSpring(u[0],u[1])
break
case"jointPrisme":this.joint=new ms(c,o,a)
break
case"jointSlide":this.joint=new _s(c,o,a)
break
case"jointBall":this.joint=new ls(c)
break
case"jointWheel":this.joint=new ps(c),null!=l&&Me.__cast(this.joint,ps).rotationalLimitMotor1.setLimit(l[0],l[1]),null!=h&&Me.__cast(this.joint,ps).rotationalLimitMotor1.setSpring(h[0],h[1]),null!=u&&Me.__cast(this.joint,ps).rotationalLimitMotor1.setSpring(u[0],u[1])}this.parent.addJoint(this.joint)}}
s["com.babylonhx.physics.plugins.Link"]=ei,ei.__name__=["com","babylonhx","physics","plugins","Link"],ei.prototype={parent:null,name:null,joint:null,remove:function(){this.parent.removeJoint(this.joint)},awake:function(){this.joint.awake()},__class__:ei}
var ti=function(){this.mtx=null,this.m=[],this.oimoContactPoint=new Pr,this.oimoForce=new Pr,this._registeredMeshes=[]}
s["com.babylonhx.physics.plugins.OimoPlugin"]=ti,ti.__name__=["com","babylonhx","physics","plugins","OimoPlugin"],ti.__interfaces__=[qt],ti.prototype={_world:null,_registeredMeshes:null,_checkWithEpsilon:function(e){return.001>e?.001:e},initialize:function(){this._world=new Ms,this._world.clear()},setGravity:function(e){this._world.gravity=new Pr(e.x,e.y,e.z)},registerMesh:function(e,t,i){var n=e.rotation.clone()
e.rotation=new W(0,0,0)
var r=null
this.unregisterMesh(e),e.computeWorldMatrix(!0)
var s=null
null!=e.rotationQuaternion&&(s=e.rotationQuaternion.clone(),e.rotationQuaternion=new N(0,0,0,1),e.computeWorldMatrix(!0))
var o=e.getBoundingInfo().boundingBox,a=e.position.subtract(o.center)
if(null!=s){var l=new U
s.toRotationMatrix(l),a=W.TransformCoordinates(a,l)}switch(t){case 1:var h=o.maximumWorld.x-o.minimumWorld.x,u=o.maximumWorld.y-o.minimumWorld.y,c=o.maximumWorld.z-o.minimumWorld.z,f=Math.max(this._checkWithEpsilon(h),this._checkWithEpsilon(u))
f=Math.max(f,this._checkWithEpsilon(c))/2,r=new $t({name:i.name,type:"sphere",size:[f],pos:[o.center.x,o.center.y,o.center.z],rot:[n.x,n.y,n.z],move:0!=i.mass,config:[i.mass,i.friction,i.restitution],world:this._world})
break
case 3:case 7:case 2:var d=o.minimumWorld,m=o.maximumWorld,_=new W(m.x-d.x,m.y-d.y,m.z-d.z),p=this._checkWithEpsilon(_.x),v=this._checkWithEpsilon(_.y),g=this._checkWithEpsilon(_.z)
r=new $t({name:i.name,type:"box",size:[p,v,g],pos:[o.center.x,o.center.y,o.center.z],rot:[n.x,n.y,n.z],move:0!=i.mass,config:[i.mass,i.friction,i.restitution],world:this._world})}return null!=s&&(r.body.orientation=new Ir(s.w,s.x,s.y,s.z),r.body.syncShapes()),this._registeredMeshes.push({mesh:e,body:r,delta:a}),Me.__cast(e,qe).rigidBody=r.body,r},registerMeshesAsCompound:function(e,t){for(var i=[],n=[],r=[],s=[],o=e[0].mesh,a=0,l=e.length;l>a;){var h=a++,u=e[h],c=this._createBodyAsCompound(u,t,o)
i.push(c.type),n.push(c.size),r.push(c.pos),s.push(c.rot)}var f=new $t({type:i,size:n,pos:r,rot:s,move:0!=t.mass,config:[t.mass,t.friction,t.restitution],world:this._world})
return this._registeredMeshes.push({mesh:o,body:f}),f},_createBodyAsCompound:function(e){var t={type:"",size:[],pos:[],rot:[]},i=e.mesh,n=i.rotation.clone()
i.rotation=new W(0,0,0),i.computeWorldMatrix()
var r=e.impostor
switch(r){case 1:var s=i.getBoundingInfo().boundingBox,o=s.maximumWorld.x-s.minimumWorld.x,a=s.maximumWorld.y-s.minimumWorld.y,l=s.maximumWorld.z-s.minimumWorld.z,h=Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(a))
h=Math.max(h,this._checkWithEpsilon(l))/2,t={type:"sphere",size:[h,-1,-1],pos:[i.position.x,i.position.y,i.position.z],rot:[n.x,n.y,n.z]}
break
case 3:case 2:var u=i.getBoundingInfo().boundingBox,c=u.minimumWorld,f=u.maximumWorld,d=new W(f.x-c.x,f.y-c.y,f.z-c.z),m=this._checkWithEpsilon(d.x),_=this._checkWithEpsilon(d.y),p=this._checkWithEpsilon(d.z),v=i.position
t={type:"box",size:[m,_,p],pos:[v.x,v.y,v.z],rot:[n.x,n.y,n.z]}}return t},unregisterMesh:function(e){for(var t=0,i=this._registeredMeshes.length;i>t;){var n=t++,r=this._registeredMeshes[n]
if(r.mesh==e||r.mesh==e.parent)return null!=r.body&&(this._world.removeRigidBody(r.body.body),this._unbindBody(r.body)),void this._registeredMeshes.splice(n,1)}},_unbindBody:function(e){for(var t=0,i=this._registeredMeshes.length;i>t;){var n=t++,r=this._registeredMeshes[n]
r.body==e&&(r.body=null)}},updateBodyPosition:function(e){for(var t=0,i=this._registeredMeshes.length;i>t;){var n=t++,r=this._registeredMeshes[n]
if(r.mesh==e||r.mesh==e.parent){var s=r.body
e.computeWorldMatrix(!0)
var o=e.getBoundingInfo().boundingBox.center
return void s.setPosition(o.x,o.y,o.z)}if(r.mesh.parent==e){e.computeWorldMatrix(!0),r.mesh.computeWorldMatrix(!0)
var a=r.mesh.getAbsolutePosition(),l=(e.rotation,r.body)
return void l.setPosition(a.x,a.y,a.z)}}},oimoForce:null,oimoContactPoint:null,applyImpulse:function(e,t,i){for(var n=0,r=this._registeredMeshes.length;r>n;){var s=n++,o=this._registeredMeshes[s]
if(o.mesh==e||o.mesh==e.parent){var a=o.body.body.mass,l=new W(.01*i.x,.01*i.y,.01*i.z),h=t.scale(.01*a)
return this.oimoForce.x=h.x,this.oimoForce.y=h.y,this.oimoForce.z=h.z,this.oimoContactPoint.init(l.x,l.y,l.z),void o.body.body.applyImpulse(this.oimoContactPoint,this.oimoForce)}}},createLink:function(e,t,i,n,r){for(var s=null,o=null,a=0,l=this._registeredMeshes.length;l>a;){var h=a++,u=this._registeredMeshes[h]
u.mesh==e?s=u.body.body:u.mesh==t&&(o=u.body.body)}return null==s||null==o?!1:(null==r&&(r={}),new ei({type:r.type,body1:s,body2:o,min:r.min,max:r.max,axe1:r.axe1,axe2:r.axe2,pos1:[i.x,i.y,i.z],pos2:[n.x,n.y,n.z],collision:r.collision,spring:r.spring,world:this._world}),!0)},dispose:function(){for(this._world.clear();this._registeredMeshes.length>0;)this.unregisterMesh(this._registeredMeshes[0].mesh)},isSupported:function(){return!0},_getLastShape:function(e){for(var t=e.shapes;null!=t.next;)t=t.next
return t},m:null,mtx:null,runOneStep:function(e){this._world.step(e)
for(var t=this._registeredMeshes.length;t-->0;){var i=this._registeredMeshes[t].body.body,n=this._registeredMeshes[t].mesh,r=this._registeredMeshes[t].delta
if(!i.sleeping)if(null!=i.shapes){var s=i
n.position.x=100*s.position.x,n.position.y=100*s.position.y,n.position.z=100*s.position.z,this.mtx=U.FromArray(i.getMatrix(),null),null==n.rotationQuaternion&&(n.rotationQuaternion=new N(0,0,0,1)),n.rotationQuaternion.fromRotationMatrix(this.mtx),n.computeWorldMatrix()}else{this.m=i.getMatrix(),this.mtx=U.FromArray(this.m,null)
var o=this.mtx.m[12],a=this.mtx.m[13],l=this.mtx.m[14]
null==r?(n.position.x=o,n.position.y=a,n.position.z=l):(n.position.x=o+r.x,n.position.y=a+r.y,n.position.z=l+r.z),null==n.rotationQuaternion&&(n.rotationQuaternion=new N(0,0,0,1)),N.FromRotationMatrixToRef(this.mtx,n.rotationQuaternion),n.computeWorldMatrix()}}},__class__:ti}
var ii=t.BABYLON.DisplayPassPostProcess=function(e,t,i,n,r,s){null==s&&(s=!1),ct.call(this,e,"displayPass",["passSampler"],["passSampler"],t,i,n,r,s)}
s["com.babylonhx.postprocess.DisplayPassPostProcess"]=ii,ii.__name__=["com","babylonhx","postprocess","DisplayPassPostProcess"],ii.__super__=ct,ii.prototype=i(ct.prototype,{__class__:ii})
var ni=t.BABYLON.PostProcessManager=function(e){this._vertexStrideSize=8,this._vertexDeclaration=[2],this._scene=e}
s["com.babylonhx.postprocess.PostProcessManager"]=ni,ni.__name__=["com","babylonhx","postprocess","PostProcessManager"],ni.prototype={_scene:null,_indexBuffer:null,_vertexDeclaration:null,_vertexStrideSize:null,_vertexBuffer:null,_prepareBuffers:function(){if(null==this._vertexBuffer){var e=[]
e.push(1),e.push(1),e.push(-1),e.push(1),e.push(-1),e.push(-1),e.push(1),e.push(-1),this._vertexBuffer=this._scene._engine.createVertexBuffer(e)
var t=[]
t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene._engine.createIndexBuffer(t)}},_prepareFrame:function(e){var t=this._scene.activeCamera._postProcesses,i=this._scene.activeCamera._postProcessesTakenIndices
return 0!=i.length&&this._scene.postProcessesEnabled?(t[this._scene.activeCamera._postProcessesTakenIndices[0]].activate(this._scene.activeCamera,e),!0):!1},directRender:function(e,t){for(var i=this._scene._engine,n=0,r=e.length;r>n;){var s=n++
s<e.length-1?e[s+1].activate(this._scene.activeCamera,t):null!=t?i.bindFramebuffer(t):(En.context.bindFramebuffer(36160,null),i.setViewport(i._cachedViewport,null,null),i.wipeCaches())
var o=e[s],a=o.apply()
null!=a&&(null!=o.onBeforeRender&&o.onBeforeRender(a),this._prepareBuffers(),i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,a),i.draw(!0,0,6))}i._depthCullingState.set_depthTest(!0),i._depthCullingState.set_depthMask(!0)},_finalizeFrame:function(e,t,i){null==e&&(e=!1),null==i&&(i=this._scene.activeCamera._postProcesses)
var n=this._scene.activeCamera._postProcessesTakenIndices
if(0!=n.length&&this._scene.postProcessesEnabled){for(var r=this._scene._engine,s=0,o=n.length;o>s;){var a=s++
if(a<n.length-1?i[n[a+1]].activate(this._scene.activeCamera):null!=t?r.bindFramebuffer(t):(En.context.bindFramebuffer(36160,null),r.setViewport(r._cachedViewport,null,null),r.wipeCaches()),e)break
var l=i[n[a]],h=l.apply()
null!=h&&(null!=l.onBeforeRender&&l.onBeforeRender(h),this._prepareBuffers(),r.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,h),r.draw(!0,0,6))}r._depthCullingState.set_depthTest(!0),r._depthCullingState.set_depthMask(!0)}},dispose:function(){null!=this._vertexBuffer&&(this._scene._engine._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this._indexBuffer&&(this._scene._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},__class__:ni}
var ri=t.BABYLON.VolumetricLightScatteringPostProcess=function(e,t,i,n,r,s,o,a){null==s&&(s=2),null==r&&(r=100),this.density=.926,this.weight=.58767,this.decay=.96815,this.exposure=.3,this.excludedMeshes=[],this.useDiffuseColor=!1,this.invert=!0,this.useCustomMeshPosition=!1,this._screenCoordinates=new Et(0,0)
var l=this
ct.call(this,e,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],null!=t.postProcessRatio?t.postProcessRatio:t,i,s,o,a,"#define NUM_SAMPLES "+r)
var h=i._scene
this._viewPort=new Dt(0,0,1,1).toGlobal(h._engine),null!=n?this.mesh=n:this.mesh=ri.CreateDefaultMesh("VolumetricLightScatteringMesh",h),this._createPass(h,null!=t.passRatio?t.passRatio:t),this.onApply=function(e){l._updateMeshScreenCoordinates(h),e._engine.setTexture(c.indexOf(e._samplers,"lightScatteringSampler",0),l._volumetricLightScatteringRTT),e.setFloat("exposure",l.exposure),e.setFloat("decay",l.decay),e.setFloat("weight",l.weight),e.setFloat("density",l.density),e.setVector2("meshPositionOnScreen",l._screenCoordinates)}}
s["com.babylonhx.postprocess.VolumetricLightScatteringPostProcess"]=ri,ri.__name__=["com","babylonhx","postprocess","VolumetricLightScatteringPostProcess"],ri.CreateDefaultMesh=function(e,t){var i=qe.CreatePlane(e,1,t)
return i.billboardMode=je.BILLBOARDMODE_ALL,i.set_material(new Fe(e+"Material",t)),i},ri.__super__=ct,ri.prototype=i(ct.prototype,{_volumetricLightScatteringPass:null,_volumetricLightScatteringRTT:null,_viewPort:null,_screenCoordinates:null,_cachedDefines:null,_customMeshPosition:null,useCustomMeshPosition:null,invert:null,mesh:null,useDiffuseColor:null,excludedMeshes:null,exposure:null,decay:null,weight:null,density:null,isReady:function(e,t){var i=e._mesh,n=[],r=[Qe.PositionKind],s=e.getMaterial(),o=!1
i==this.mesh&&(n.push(this.useDiffuseColor?"#define DIFFUSE_COLOR_RENDER":"#define BASIC_RENDER"),n.push("#define NEED_UV"),o=!0),null!=s&&(s.needAlphaTesting()&&n.push("#define ALPHATEST"),null!=Me.__cast(s,Fe).opacityTexture&&(n.push("#define OPACITY"),Me.__cast(s,Fe).opacityTexture.getAlphaFromRGB&&n.push("#define OPACITYRGB"),o||n.push("#define NEED_UV")),i.isVerticesDataPresent(Qe.UVKind)&&(r.push(Qe.UVKind),n.push("#define UV1")),i.isVerticesDataPresent(Qe.UV2Kind)&&(r.push(Qe.UV2Kind),n.push("#define UV2"))),i.get_useBones()&&(r.push(Qe.MatricesIndicesKind),r.push(Qe.MatricesWeightsKind),n.push("#define BONES"),n.push("#define BonesPerMesh "+(i.get_skeleton().bones.length+1))),t&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"))
var a=n.join("\n")
return this._cachedDefines!=a&&(this._cachedDefines=a,this._volumetricLightScatteringPass=i._scene._engine.createEffect({vertex:"depth",fragment:"volumetricLightScatteringPass"},r,["world","mBones","viewProjection","diffuseMatrix","opacityLevel","color"],["diffuseSampler","opacitySampler"],a)),this._volumetricLightScatteringPass._isReady},setCustomMeshPosition:function(e){this._customMeshPosition=e},getCustomMeshPosition:function(){return this._customMeshPosition},dispose:function(e){var t=c.indexOf(e._scene.customRenderTargets,this._volumetricLightScatteringRTT,0);-1!=t&&e._scene.customRenderTargets.splice(t,1),this._volumetricLightScatteringRTT.dispose(),ct.prototype.dispose.call(this,e)},getPass:function(){return this._volumetricLightScatteringRTT},_meshExcluded:function(e){return this.excludedMeshes.length>0&&-1!=c.indexOf(this.excludedMeshes,e,0)?!0:!1},_createPass:function(e){var t=this,i=e._engine
this._volumetricLightScatteringRTT=new Ue("volumetricLightScatteringMap",{width:i.getRenderWidth(),height:i.getRenderHeight()},e,!1,!0,0),this._volumetricLightScatteringRTT.wrapU=0,this._volumetricLightScatteringRTT.wrapV=0,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,e.customRenderTargets.push(this._volumetricLightScatteringRTT)
var n=function(e){var i=e._renderingMesh
if(!t._meshExcluded(i)){var n=i._scene,r=n._engine
r.setState(e.getMaterial().backFaceCulling,null,null)
var s=i._getInstancesRenderList(e._id)
if(!s.mustReturn){var o=null!=r.getCaps().instancedArrays&&null!=s.visibleInstances[e._id]
if(t.isReady(e,o)){r.enableEffect(t._volumetricLightScatteringPass),i._bind(e,t._volumetricLightScatteringPass,Le.TriangleFillMode)
var a=e.getMaterial()
if(t._volumetricLightScatteringPass.setMatrix("viewProjection",n._transformMatrix),null!=a&&(i==t.mesh||a.needAlphaTesting()||null!=Me.__cast(a,Fe).opacityTexture)){var l=a.getAlphaTestTexture()
t.useDiffuseColor&&i==t.mesh?t._volumetricLightScatteringPass.setColor3("color",Me.__cast(a,Fe).diffuseColor):(t._volumetricLightScatteringPass.setTexture("diffuseSampler",l),null!=l&&t._volumetricLightScatteringPass.setMatrix("diffuseMatrix",l.getTextureMatrix())),null!=Me.__cast(a,Fe).opacityTexture&&(t._volumetricLightScatteringPass.setTexture("opacitySampler",Me.__cast(a,Fe).opacityTexture),t._volumetricLightScatteringPass.setFloat("opacityLevel",Me.__cast(a,Fe).opacityTexture.level))}i.get_useBones()&&t._volumetricLightScatteringPass.setMatrices("mBones",i.get_skeleton().getTransformMatrices()),i._processRendering(e,t._volumetricLightScatteringPass,Le.TriangleFillMode,s,o,function(e,i){t._volumetricLightScatteringPass.setMatrix("world",i)})}}}},r=new tt(0,0,0,1),s=new tt(0,0,0,1)
this._volumetricLightScatteringRTT.onBeforeRender=function(){r.r=e.clearColor.r,r.g=e.clearColor.g,r.b=e.clearColor.b,e.clearColor.r=s.r,e.clearColor.g=s.g,e.clearColor.b=s.b},this._volumetricLightScatteringRTT.onAfterRender=function(){e.clearColor.r=r.r,e.clearColor.g=r.g,e.clearColor.b=r.b},this._volumetricLightScatteringRTT.customRenderFunction=function(t,i,r){for(var s=e._engine,o=0,a=t.length;a>o;){var l=o++
n(t.data[l])}s._alphaTest=!0
for(var h=0,u=i.length;u>h;){var c=h++
n(i.data[c])}if(s._alphaTest=!1,null!=r&&r.length>0){for(var f=0,d=r.length;d>f;){var m=f++,_=r.data[m]
_._alphaIndex=_._mesh.alphaIndex,_._distanceToCamera=_._boundingInfo.boundingSphere.centerWorld.subtract(e.activeCamera.position).length()}var p=r.data.slice(0,r.length)
p.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),s._depthCullingState.set_depthMask(!1),s._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),s._alphaState.set_alphaBlend(!0),s._alphaMode=2
for(var v=0,g=p.length;g>v;){var x=v++
n(p[x])}s._depthCullingState.set_depthMask(!0),s._alphaState.set_alphaBlend(!1),s._alphaMode=0}}},_updateMeshScreenCoordinates:function(e){var t=e._transformMatrix,i=W.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,U.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t,this._viewPort)
this._screenCoordinates.x=i.x/this._viewPort.width,this._screenCoordinates.y=i.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},__class__:ri})
var si=t.BABYLON.PostProcessRenderEffect=function(e,t,i,n){null==n&&(n=!0),this._engine=e,this._name=t,this._singleInstance=n,this._getPostProcess=i,this._cameras=new Bi,this._indicesForCamera=new Bi,this._postProcesses=new Bi,this._renderPasses=new Bi,this._renderEffectAsPasses=new Bi}
s["com.babylonhx.postprocess.renderpipeline.PostProcessRenderEffect"]=si,si.__name__=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderEffect"],si.prototype={_engine:null,_postProcesses:null,_getPostProcess:null,_singleInstance:null,_cameras:null,_indicesForCamera:null,_renderPasses:null,_renderEffectAsPasses:null,_name:null,applyParameters:null,_update:function(){for(var e=this._renderPasses.keys();e.hasNext();){var t=e.next()
this._renderPasses.get(t)._update()}},addPass:function(e){this._renderPasses.set(e._name,e),this._linkParameters()},removePass:function(e){this._renderPasses.set(e._name,null),this._renderPasses.remove(e._name),this._linkParameters()},addRenderEffectAsPass:function(e){this._renderEffectAsPasses.set(e._name,e),this._linkParameters()},getPass:function(e){for(var t=this._renderPasses.keys();t.hasNext();){var i=t.next()
if(i==e)return this._renderPasses.get(e)}return null},emptyPasses:function(){this._renderPasses=new Bi,this._linkParameters()},_attachCameras:function(e){for(var t="",i=Oe.MakeArray(null!=e?e:this._cameras),n=0;n<i.length;){var r=i[n];++n
var s=r,o=s.name
t=this._singleInstance?"0":o
var a
a=this._postProcesses.exists(t)?this._postProcesses.get(t):this._getPostProcess(),this._postProcesses.set(t,a)
var l=s.attachPostProcess(this._postProcesses.get(t))
this._indicesForCamera.exists(o)||this._indicesForCamera.set(o,[]),this._indicesForCamera.get(o).push(l),this._cameras.exists(s.name)||this._cameras.set(o,s)
for(var h=this._renderPasses.keys();h.hasNext();){var u=h.next()
this._renderPasses.get(u)._incRefCount()}}this._linkParameters()},_detachCameras:function(e){for(var t=Oe.MakeArray(null!=e?e:this._cameras),i=0;i<t.length;){var n=t[i];++i
var r=n,s=r.name
r.detachPostProcess(this._postProcesses.get(this._singleInstance?"0":s),this._indicesForCamera.get(s)),this._cameras.remove(s),this._indicesForCamera.remove(s)
for(var o=this._renderPasses.keys();o.hasNext();){var a=o.next()
this._renderPasses.get(a)._decRefCount()}}},_enable:function(e){for(var t=Oe.MakeArray(null!=e?e:this._cameras),i=0;i<t.length;){var n=t[i];++i
for(var r=n,s=r.name,o=0,a=this._indicesForCamera.get(s).length;a>o;){var l=o++
null==r._postProcesses[this._indicesForCamera.get(s)[l]]&&n.attachPostProcess(this._postProcesses.get(this._singleInstance?"0":s),this._indicesForCamera.get(s)[l])}for(var h=this._renderPasses.keys();h.hasNext();){var u=h.next()
this._renderPasses.get(u)._incRefCount()}}},_disable:function(e){for(var t=Oe.MakeArray(null!=e?e:this._cameras),i=0;i<t.length;){var n=t[i];++i
var r=n,s=n.name
r.detachPostProcess(this._postProcesses.get(this._singleInstance?"0":s),this._indicesForCamera.get(s))
for(var o=this._renderPasses.keys();o.hasNext();){var a=o.next()
this._renderPasses.get(a)._decRefCount()}}},getPostProcess:function(e){return this._postProcesses.get(this._singleInstance?"0":e.name)},_linkParameters:function(){for(var e=this,t=this._postProcesses.keys();t.hasNext();){var i=t.next()
null!=this.applyParameters&&this.applyParameters(this._postProcesses.get(i)),this._postProcesses.get(i).onBeforeRender=function(t){e._linkTextures(t)}}},_linkTextures:function(e){for(var t=this._renderPasses.keys();t.hasNext();){var i=t.next()
e.setTexture(i,this._renderPasses.get(i).getRenderTexture())}for(var n=this._renderEffectAsPasses.keys();n.hasNext();){var r=n.next()
e.setTextureFromPostProcess(r+"Sampler",this._renderEffectAsPasses.get(r).getPostProcess())}},__class__:si}
var oi=t.BABYLON.PostProcessRenderPass=function(e,t,i,n,r,s){this._refCount=0,this._enabled=!0,this._name=t,this._renderTexture=new Ue(t,i,e),this.setRenderList(n),this._renderTexture.onBeforeRender=r,this._renderTexture.onAfterRender=s,this._scene=e,this._renderList=n}
s["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPass"]=oi,oi.__name__=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPass"],oi.prototype={_enabled:null,_renderList:null,_renderTexture:null,_scene:null,_refCount:null,_name:null,_incRefCount:function(){return 0==this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},_decRefCount:function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(c.indexOf(this._scene.customRenderTargets,this._renderTexture,0),1),this._refCount},_update:function(){this.setRenderList(this._renderList)},setRenderList:function(e){this._renderTexture.renderList=e},getRenderTexture:function(){return this._renderTexture},__class__:oi}
var ai=t.BABYLON.PostProcessRenderPipeline=function(e,t){this._engine=e,this._name=t,this._renderEffects=new Bi,this._renderEffectsForIsolatedPass=new Bi,this._cameras=new Bi}
s["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPipeline"]=ai,ai.__name__=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPipeline"],ai.prototype={_engine:null,_renderEffects:null,_renderEffectsForIsolatedPass:null,_cameras:null,_name:null,addEffect:function(e){this._renderEffects.set(e._name,e)},_enableEffect:function(e,t){var i=this._renderEffects.get(e)
null!=i&&i._enable(null!=t?t:this._cameras)},_disableEffect:function(e,t){var i=this._renderEffects.get(e)
null!=i&&i._disable(Oe.MakeArray(null!=t?t:this._cameras))},_attachCameras:function(e,t){for(var i=Oe.MakeArray(null!=e?e:this._cameras),n=[],r=0,s=i.length;s>r;){var o=r++,a=i[o],l=a.name
this._cameras.exists(l)?t&&n.push(o):this._cameras.set(l,a)}for(var h=0,u=n.length;u>h;){var c=h++
i.splice(n[c],1)}for(var f=this._renderEffects.keys();f.hasNext();){var d=f.next()
this._renderEffects.get(d)._attachCameras(i)}},_detachCameras:function(e){for(var t=Oe.MakeArray(null!=e?e:this._cameras),i=this._renderEffects.keys();i.hasNext();){var n=i.next()
this._renderEffects.get(n)._detachCameras(t)}for(var r=0;r<t.length;){var s=t[r];++r
var o=s.name
this._cameras.remove(o)}},_enableDisplayOnlyPass:function(e,t){for(var i=this,n=Oe.MakeArray(null!=t?t:this._cameras),r=null,s=this._renderEffects.keys();s.hasNext();){var o=s.next()
if(r=this._renderEffects.get(o).getPass(e),null!=r)break}if(null!=r){for(var a=this._renderEffects.keys();a.hasNext();){var l=a.next()
this._renderEffects.get(l)._disable(n)}r._name="passSampler"
for(var h=0;h<n.length;){var u=n[h];++h
var c,f=u,d=u.name
c=null!=this._renderEffectsForIsolatedPass.get(d)?this._renderEffectsForIsolatedPass.get(d):new si(this._engine,"passEffect",function(){return new ii("passEffect",1,null,null,i._engine,!0)}),this._renderEffectsForIsolatedPass.set(d,c),this._renderEffectsForIsolatedPass.get(d).emptyPasses(),this._renderEffectsForIsolatedPass.get(d).addPass(r),this._renderEffectsForIsolatedPass.get(d)._attachCameras(f)}}},_disableDisplayOnlyPass:function(e){for(var t=this,i=Oe.MakeArray(null!=e?e:this._cameras),n=0;n<i.length;){var r=i[n];++n
var s,o=r,a=r.name
s=null!=this._renderEffectsForIsolatedPass.get(a)?this._renderEffectsForIsolatedPass.get(a):new si(this._engine,"passEffect",function(){return new ii("passEffect",1,null,null,t._engine,!0)}),this._renderEffectsForIsolatedPass.set(a,s),this._renderEffectsForIsolatedPass.get(a)._disable(o)}for(var l=this._renderEffects.keys();l.hasNext();){var h=l.next()
this._renderEffects.get(h)._enable(i)}},_update:function(){for(var e=this._renderEffects.keys();e.hasNext();){var t=e.next()
this._renderEffects.get(t)._update()}for(var i=this._cameras.keys();i.hasNext();){var n=i.next(),r=this._cameras.get(n).name
this._renderEffectsForIsolatedPass.exists(r)&&this._renderEffectsForIsolatedPass.get(r)._update()}},__class__:ai}
var li=t.BABYLON.PostProcessRenderPipelineManager=function(){this._renderPipelines=new Bi}
s["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPipelineManager"]=li,li.__name__=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPipelineManager"],li.prototype={_renderPipelines:null,addPipeline:function(e){this._renderPipelines.set(e._name,e)},attachCamerasToRenderPipeline:function(e,t,i){null==i&&(i=!1)
var n=this._renderPipelines.get(e)
null!=n&&n._attachCameras(t,i)},detachCamerasFromRenderPipeline:function(e,t){var i=this._renderPipelines.get(e)
null!=i&&i._detachCameras(t)},enableEffectInPipeline:function(e,t,i){var n=this._renderPipelines.get(e)
null!=n&&n._enableEffect(t,i)},disableEffectInPipeline:function(e,t,i){var n=this._renderPipelines.get(e)
null!=n&&n._disableEffect(t,i)},enableDisplayOnlyPassInPipeline:function(e,t,i){var n=this._renderPipelines.get(e)
null!=n&&n._enableDisplayOnlyPass(t,i)},disableDisplayOnlyPassInPipeline:function(e,t){var i=this._renderPipelines.get(e)
null!=i&&i._disableDisplayOnlyPass(t)},update:function(){for(var e=this._renderPipelines.keys();e.hasNext();){var t=e.next()
this._renderPipelines.get(t)._update()}},__class__:li}
var hi=t.BABYLON.BoundingBoxRenderer=function(e){this.renderList=new pi(32),this.showBackLines=!0,this.backColor=new Re(.1,.1,.1),this.frontColor=new Re(1,1,1),this._scene=e}
s["com.babylonhx.rendering.BoundingBoxRenderer"]=hi,hi.__name__=["com","babylonhx","rendering","BoundingBoxRenderer"],hi.prototype={frontColor:null,backColor:null,showBackLines:null,renderList:null,_scene:null,_colorShader:null,_vb:null,_ib:null,_prepareRessources:function(){if(null==this._colorShader){this._colorShader=new gt("colorShader",this._scene,"color",{attributes:["position"],uniforms:["worldViewProjection","color"]})
var e=this._scene._engine,t=Ze.CreateBox(1)
this._vb=new Qe(e,t.positions,Qe.PositionKind,!1),this._ib=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},reset:function(){this.renderList.reset()},render:function(){if(0!=this.renderList.length&&this._colorShader.isReady()&&(this._prepareRessources(),this._colorShader.isReady())){var e=this._scene._engine
e._depthCullingState.set_depthMask(!1),this._colorShader._preBind()
for(var t=0,i=this.renderList.length;i>t;){var n=t++,r=this.renderList.data[n],s=r.minimum,o=r.maximum,a=o.subtract(s),l=s.add(a.scale(.5)),h=U.Scaling(a.x,a.y,a.z).multiply(U.Translation(l.x,l.y,l.z)).multiply(r.getWorldMatrix())
e.bindBuffers(this._vb._buffer,this._ib,[3],12,this._colorShader.getEffect()),this.showBackLines&&(e._depthCullingState.set_depthFunc(518),this._scene._cachedMaterial=null,this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(h),e.draw(!1,0,24)),e._depthCullingState.set_depthFunc(513),this._scene._cachedMaterial=null,this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(h),e.draw(!1,0,24)}this._colorShader.unbind(),e._depthCullingState.set_depthFunc(515),e._depthCullingState.set_depthMask(!0)}},dispose:function(){null!=this._colorShader&&(this._colorShader.dispose(),this._vb.dispose(),this._scene._engine._releaseBuffer(this._ib))},__class__:hi}
var ui=t.BABYLON.DepthRenderer=function(e,t){null==t&&(t=1),this._worldViewProjection=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._transformMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._projectionMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this._viewMatrix=U.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
var i=this
this._scene=e
var n=e._engine
this._depthMap=new Ue("depthMap",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,t),this._depthMap.wrapU=0,this._depthMap.wrapV=0,this._depthMap.set_refreshRate(1),this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(e){e.clear(new tt(1,1,1,1),!0,!0)}
var r=function(e){var t=e._renderingMesh,n=i._scene,r=n._engine
r.setState(e.getMaterial().backFaceCulling,null,null)
var s=t._getInstancesRenderList(e._id)
if(!s.mustReturn){var o=null!=r.getCaps().instancedArrays&&null!=s.visibleInstances[e._id]
if(i.isReady(e,o)){r.enableEffect(i._effect),t._bind(e,i._effect,Le.TriangleFillMode)
var a=e.getMaterial()
if(i._effect.setMatrix("viewProjection",n._transformMatrix),i._effect.setFloat("far",n.activeCamera.maxZ),null!=a&&a.needAlphaTesting()){var l=a.getAlphaTestTexture()
i._effect.setTexture("diffuseSampler",l),i._effect.setMatrix("diffuseMatrix",l.getTextureMatrix())}t.get_useBones()&&i._effect.setMatrices("mBones",t.get_skeleton().getTransformMatrices()),t._processRendering(e,i._effect,Le.TriangleFillMode,s,o,function(e,t){i._effect.setMatrix("world",t)})}}}
this._depthMap.customRenderFunction=function(e,t){for(var i=0,n=e.length;n>i;){var s=i++
r(e.data[s])}for(var o=0,a=t.length;a>o;){var l=o++
r(t.data[l])}}}
s["com.babylonhx.rendering.DepthRenderer"]=ui,ui.__name__=["com","babylonhx","rendering","DepthRenderer"],ui.prototype={_scene:null,_depthMap:null,_effect:null,_viewMatrix:null,_projectionMatrix:null,_transformMatrix:null,_worldViewProjection:null,_cachedDefines:null,isReady:function(e,t){var i=[],n=[Qe.PositionKind],r=e._mesh,s=r._scene,o=e.getMaterial()
null!=o&&o.needAlphaTesting()&&(i.push("#define ALPHATEST"),r.isVerticesDataPresent(Qe.UVKind)&&(n.push(Qe.UVKind),i.push("#define UV1")),r.isVerticesDataPresent(Qe.UV2Kind)&&(n.push(Qe.UV2Kind),i.push("#define UV2"))),null!=r.get_skeleton()&&s.skeletonsEnabled&&r.isVerticesDataPresent(Qe.MatricesIndicesKind)&&r.isVerticesDataPresent(Qe.MatricesWeightsKind)&&(n.push(Qe.MatricesIndicesKind),n.push(Qe.MatricesWeightsKind),i.push("#define BONES"),i.push("#define BonesPerMesh "+(r.get_skeleton().bones.length+1))),t&&(i.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"))
var a=i.join("\n")
return this._cachedDefines!=a&&(this._cachedDefines=a,this._effect=this._scene._engine.createEffect("depth",n,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],a)),this._effect._isReady},getDepthMap:function(){return this._depthMap},dispose:function(){this._depthMap.dispose()},__class__:ui}
var ci=t.BABYLON.OutlineRenderer=function(e){this._scene=e}
s["com.babylonhx.rendering.OutlineRenderer"]=ci,ci.__name__=["com","babylonhx","rendering","OutlineRenderer"],ci.prototype={_scene:null,_effect:null,_cachedDefines:null,render:function(e,t,i){null==i&&(i=!1)
var n=this._scene,r=this._scene._engine,s=null!=r.getCaps().instancedArrays&&null!=t.visibleInstances[e._id]
if(this.isReady(e,s)){var o=e._renderingMesh,a=e.getMaterial()
r.enableEffect(this._effect),this._effect.setFloat("offset",o.outlineWidth),this._effect.setFloat("offset",i?0:o.outlineWidth),this._effect.setColor4("color",i?o.overlayColor:o.outlineColor,i?o.overlayAlpha:1),this._effect.setMatrix("viewProjection",n._transformMatrix)
var l=null!=o.get_skeleton()&&n.skeletonsEnabled&&o.isVerticesDataPresent(Qe.MatricesIndicesKind)&&o.isVerticesDataPresent(Qe.MatricesWeightsKind)
if(l&&this._effect.setMatrices("mBones",o.get_skeleton().getTransformMatrices()),o._bind(e,this._effect,Le.TriangleFillMode),null!=a&&a.needAlphaTesting()){var h=a.getAlphaTestTexture()
this._effect.setTexture("diffuseSampler",h),this._effect.setMatrix("diffuseMatrix",h.getTextureMatrix())}if(s)o._renderWithInstances(e,Le.TriangleFillMode,t,this._effect,r)
else if(t.renderSelf.length>e._id&&(this._effect.setMatrix("world",o.getWorldMatrix()),o._draw(e,Le.TriangleFillMode)),null!=t.visibleInstances[e._id])for(var u=0,c=t.visibleInstances[e._id].length;c>u;){var f=u++,d=t.visibleInstances[e._id][f]
this._effect.setMatrix("world",d.getWorldMatrix()),o._draw(e,Le.TriangleFillMode)}}},isReady:function(e,t){var i=[],n=[Qe.PositionKind,Qe.NormalKind],r=e._mesh,s=e.getMaterial()
null!=s&&s.needAlphaTesting()&&(i.push("#define ALPHATEST"),r.isVerticesDataPresent(Qe.UVKind)&&(n.push(Qe.UVKind),i.push("#define UV1")),r.isVerticesDataPresent(Qe.UV2Kind)&&(n.push(Qe.UV2Kind),i.push("#define UV2"))),null!=r.get_skeleton()&&r.isVerticesDataPresent(Qe.MatricesIndicesKind)&&r.isVerticesDataPresent(Qe.MatricesWeightsKind)&&(n.push(Qe.MatricesIndicesKind),n.push(Qe.MatricesWeightsKind),i.push("#define BONES"),i.push("#define BonesPerMesh "+(r.get_skeleton().bones.length+1))),t&&(i.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"))
var o=i.join("\n")
return this._cachedDefines!=o&&(this._cachedDefines=o,this._effect=this._scene._engine.createEffect("outline",n,["world","mBones","viewProjection","diffuseMatrix","offset","color"],["diffuseSampler"],o)),this._effect._isReady},__class__:ci}
var fi=t.BABYLON.RenderingGroup=function(e,t){this._activeVertices=0,this._alphaTestSubMeshes=new pi,this._transparentSubMeshes=new pi,this._opaqueSubMeshes=new pi,this._scene=t,this.index=e}
s["com.babylonhx.rendering.RenderingGroup"]=fi,fi.__name__=["com","babylonhx","rendering","RenderingGroup"],fi.prototype={index:null,_scene:null,_opaqueSubMeshes:null,_transparentSubMeshes:null,_alphaTestSubMeshes:null,_activeVertices:null,render:function(e){if(null!=e)return e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0
if(0==this._opaqueSubMeshes.length&&0==this._alphaTestSubMeshes.length&&0==this._transparentSubMeshes.length)return!1
for(var t=this._scene._engine,i=null,n=0,r=this._opaqueSubMeshes.length;r>n;){var s=n++
i=this._opaqueSubMeshes.data[s],i.render()}t._alphaTest=!0
for(var o=0,a=this._alphaTestSubMeshes.length;a>o;){var l=o++
i=this._alphaTestSubMeshes.data[l],i.render()}if(t._alphaTest=!1,this._transparentSubMeshes.length>0){for(var h=0,u=this._transparentSubMeshes.length;u>h;){var c=h++
i=this._transparentSubMeshes.data[c],i._alphaIndex=i._mesh.alphaIndex,i._distanceToCamera=i._boundingInfo.boundingSphere.centerWorld.subtract(this._scene.activeCamera.position).length()}var f=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length)
f.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),t._depthCullingState.set_depthMask(!1),t._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),t._alphaState.set_alphaBlend(!0),t._alphaMode=2
for(var d=0,m=f.length;m>d;){var _=d++
i=f[_],i.render()}t._depthCullingState.set_depthMask(!0),t._alphaState.set_alphaBlend(!1),t._alphaMode=0}return!0},prepare:function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},dispatch:function(e){var t=e.getMaterial(),i=e._mesh
t.needAlphaBlending()||i.get_visibility()<1||i.hasVertexAlpha?this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},__class__:fi}
var di=t.BABYLON.Sprite=function(e,t){this._time=0,this._frameCount=0,this._direction=1,this._delay=0,this._toIndex=0,this._fromIndex=0,this._loopAnimation=!1,this._animationStarted=!1,this.animations=[],this.invertV=!1,this.invertU=!1,this.cellIndex=0,this.angle=0,this.height=1,this.width=1,this.color=new tt(1,1,1,1),this.name=e,this._manager=t,this._manager.sprites.push(this),this.position=new W(0,0,0)}
s["com.babylonhx.sprites.Sprite"]=di,di.__name__=["com","babylonhx","sprites","Sprite"],di.prototype={name:null,position:null,color:null,width:null,height:null,angle:null,cellIndex:null,invertU:null,invertV:null,disposeWhenFinishedAnimating:null,animations:null,_animationStarted:null,_loopAnimation:null,_fromIndex:null,_toIndex:null,_delay:null,_direction:null,_frameCount:null,_manager:null,_time:null,get_size:function(){return this.width},set_size:function(e){return this.width=e,this.height=e,e},playAnimation:function(e,t,i,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=n,this._animationStarted=!0,t>e?this._direction=1:this._direction=-1,this.cellIndex=e,this._time=0},stopAnimation:function(){this._animationStarted=!1},_animate:function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},dispose:function(){for(var e=0,t=this._manager.sprites.length;t>e;){var i=e++
this._manager.sprites[i]==this&&this._manager.sprites.splice(i,1)}},__class__:di,__properties__:{set_size:"set_size",get_size:"get_size"}}
var mi=t.BABYLON.SpriteManager=function(e,t,i,n,r,s,o){null==o&&(o=3),this._vertexStrideSize=64,this._vertexDeclaration=[4,4,4,4],this.fogEnabled=!0,this.renderingGroupId=0,this.sprites=[],this.name=e,this.cellSize=n,this._capacity=i,this._spriteTexture=new Ve(t,r,!0,!1,o),this._spriteTexture.wrapU=0,this._spriteTexture.wrapV=0,null==s?this._epsilon=.01:this._epsilon=s,1==o&&(this._spriteTexture.anisotropicFilteringLevel=1),this._scene=r,this._scene.spriteManagers.push(this),this._vertexBuffer=r._engine.createDynamicVertexBuffer(i*this._vertexStrideSize*4)
for(var a=[],l=0,h=0;i>h;){h++
a.push(l),a.push(l+1),a.push(l+2),a.push(l),a.push(l+2),a.push(l+3),l+=4}this._indexBuffer=r._engine.createIndexBuffer(a),this._vertices=new Float32Array(i*this._vertexStrideSize),this._effectBase=this._scene._engine.createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene._engine.createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}
s["com.babylonhx.sprites.SpriteManager"]=mi,mi.__name__=["com","babylonhx","sprites","SpriteManager"],mi.prototype={name:null,sprites:null,renderingGroupId:null,onDispose:null,fogEnabled:null,cellSize:null,_capacity:null,_spriteTexture:null,_epsilon:null,_scene:null,_vertexDeclaration:null,_vertexStrideSize:null,_vertexBuffer:null,_indexBuffer:null,_vertices:null,_effectBase:null,_effectFog:null,_appendSpriteVertex:function(e,t,i,n,r){var s=16*e
0==i?i=this._epsilon:1==i&&(i=1-this._epsilon),0==n?n=this._epsilon:1==n&&(n=1-this._epsilon),this._vertices[s]=t.position.x,this._vertices[s+1]=t.position.y,this._vertices[s+2]=t.position.z,this._vertices[s+3]=t.angle,this._vertices[s+4]=t.width,this._vertices[s+5]=t.height,this._vertices[s+6]=i,this._vertices[s+7]=n,t.invertU?this._vertices[s+8]=1:this._vertices[s+8]=0,t.invertV?this._vertices[s+9]=1:this._vertices[s+9]=0
var o=t.cellIndex/r|0
this._vertices[s+10]=t.cellIndex-o*r,this._vertices[s+11]=o,this._vertices[s+12]=t.color.r,this._vertices[s+13]=t.color.g,this._vertices[s+14]=t.color.b,this._vertices[s+15]=t.color.a},render:function(){if(this._effectBase._isReady&&this._effectFog._isReady&&null!=this._spriteTexture&&this._spriteTexture.isReady()){for(var e=this._scene._engine,t=this._spriteTexture.getBaseSize(),i=e.deltaTime,n=Math.min(this._capacity,this.sprites.length),r=t.width/this.cellSize,s=0,o=0;n>o;){var a=o++,l=this.sprites[a]
null!=l&&(l._animationStarted&&(l._time+=i,l._time>l._delay&&(l._time=l._time%l._delay,l.cellIndex+=l._direction,l.cellIndex==l._toIndex&&(l._loopAnimation?l.cellIndex=l._fromIndex:(l._animationStarted=!1,l.disposeWhenFinishedAnimating&&l.dispose())))),this._appendSpriteVertex(s++,l,0,0,r),this._appendSpriteVertex(s++,l,1,0,r),this._appendSpriteVertex(s++,l,1,1,r),this._appendSpriteVertex(s++,l,0,1,r))}e.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices,null)
var h=this._effectBase
this._scene.fogMode!=P.FOGMODE_NONE&&this.fogEnabled&&(h=this._effectFog),e.enableEffect(h)
var u=this._scene._viewMatrix
h._engine.setTexture(c.indexOf(h._samplers,"diffuseSampler",0),this._spriteTexture),h._engine.setMatrix(h._uniforms[c.indexOf(h._uniformsNames,"view",0)],u),h._engine.setMatrix(h._uniforms[c.indexOf(h._uniformsNames,"projection",0)],this._scene._projectionMatrix),h.setFloat2("textureInfos",this.cellSize/t.width,this.cellSize/t.height),this._scene.fogMode!=P.FOGMODE_NONE&&this.fogEnabled&&(h.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),h.setColor3("vFogColor",this._scene.fogColor)),e.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,h),e._depthCullingState.set_depthFunc(515),h.setBool("alphaTest",!0),En.context.colorMask(!1,!1,!1,!1),e.draw(!0,0,6*n),En.context.colorMask(!0,!0,!0,!0),h.setBool("alphaTest",!1),e._depthCullingState.set_depthMask(!1),e._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),e._alphaState.set_alphaBlend(!0),e._alphaMode=2,e.draw(!0,0,6*n),e._depthCullingState.set_depthMask(!0),e._alphaState.set_alphaBlend(!1),e._alphaMode=0}},dispose:function(){null!=this._vertexBuffer&&(this._scene._engine._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this._indexBuffer&&(this._scene._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),null!=this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null),c.remove(this._scene.spriteManagers,this),null!=this.onDispose&&this.onDispose()},__class__:mi}
var _i=t.BABYLON.AsyncLoop=function(e,t,i,n){null==n&&(n=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=n-1,this._done=!1}
s["com.babylonhx.tools.AsyncLoop"]=_i,_i.__name__=["com","babylonhx","tools","AsyncLoop"],_i.Run=function(e,t,i,n){null==n&&(n=0)
var r=new _i(e,t,i,n)
return r.executeNext(),r},_i.SyncAsyncForLoop=function(e,t,i,n,r,s){null==s&&(s=0),_i.Run(Math.ceil(e/t),function(n){null!=r&&r()?n.breakLoop():Oe.delay(function(){for(var s=0;t>s;){var o=s++,a=n.index*t+o
if(a>=e)break
if(i(a),null!=r&&r()){n.breakLoop()
break}}n.executeNext()},s)},n)},_i.prototype={iterations:null,index:null,_done:null,_fn:null,_successCallback:null,executeNext:function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},breakLoop:function(){this._done=!0,this._successCallback()},__class__:_i}
var pi=t.BABYLON.SmartArray=function(e){null==e&&(e=256),this._duplicateId=0,this.length=0,this.data=[],this._id=pi._GlobalId++}
s["com.babylonhx.tools.SmartArray"]=pi,pi.__name__=["com","babylonhx","tools","SmartArray"],pi.prototype={data:null,length:null,__smartArrayFlags:null,_id:null,_duplicateId:null,push:function(e){this.data[this.length++]=e,null==e.__smartArrayFlags&&(e.__smartArrayFlags=[]),e.__smartArrayFlags[this._id]=this._duplicateId},pushNoDuplicate:function(e){(null==e.__smartArrayFlags||e.__smartArrayFlags[this._id]!=this._duplicateId)&&(this.data[this.length++]=e,null==e.__smartArrayFlags&&(e.__smartArrayFlags=[]),e.__smartArrayFlags[this._id]=this._duplicateId)},sort:function(e){this.data.sort(e)},reset:function(){this.length=0,this._duplicateId++},concat:function(e){if(0!=e.length)for(var t=0,i=e.length;i>t;){var n=t++
this.data[this.length++]=(null!=e.data?e.data:e)[n]}},concatWithNoDuplicate:function(e){if(0!=e.length)for(var t=0,i=e.length;i>t;){var n=t++,r=(null!=e.data?e.data:e)[n]
this.pushNoDuplicate(r)}},indexOf:function(e){var t,i=e
return t=c.indexOf(this.data,i,0),t>=this.length?-1:t},__class__:pi}
var vi=function(e,t,i){this.width=0,this.height=0,this.width=t,this.height=i,null!=e?this.data=e:this.data=new Us(t*i*4)}
s["com.babylonhx.utils.Image"]=vi,vi.__name__=["com","babylonhx","utils","Image"],vi.prototype={data:null,height:null,width:null,__class__:vi}
var gi=function(){}
s["com.babylonhx.utils.Scancodes"]=gi,gi.__name__=["com","babylonhx","utils","Scancodes"],gi.$name=function(e){var t=null
return e>=0&&e<gi.scancode_names.length&&(t=gi.scancode_names[e]),null!=t?t:""}
var xi=function(){}
s["com.babylonhx.utils.Keycodes"]=xi,xi.__name__=["com","babylonhx","utils","Keycodes"],xi.from_scan=function(e){return e|gi.MASK},xi.to_scan=function(e){if(0!=(e&gi.MASK))return e&~gi.MASK
switch(e){case 13:return gi.enter
case 27:return gi.escape
case 8:return gi.backspace
case 9:return gi.tab
case 32:return gi.space
case 47:return gi.slash
case 48:return gi.key_0
case 49:return gi.key_1
case 50:return gi.key_2
case 51:return gi.key_3
case 52:return gi.key_4
case 53:return gi.key_5
case 54:return gi.key_6
case 55:return gi.key_7
case 56:return gi.key_8
case 57:return gi.key_9
case 59:return gi.semicolon
case 61:return gi.equals
case 91:return gi.leftbracket
case 92:return gi.backslash
case 93:return gi.rightbracket
case 96:return gi.grave
case 97:return gi.key_a
case 98:return gi.key_b
case 99:return gi.key_c
case 100:return gi.key_d
case 101:return gi.key_e
case 102:return gi.key_f
case 103:return gi.key_g
case 104:return gi.key_h
case 105:return gi.key_i
case 106:return gi.key_j
case 107:return gi.key_k
case 108:return gi.key_l
case 109:return gi.key_m
case 110:return gi.key_n
case 111:return gi.key_o
case 112:return gi.key_p
case 113:return gi.key_q
case 114:return gi.key_r
case 115:return gi.key_s
case 116:return gi.key_t
case 117:return gi.key_u
case 118:return gi.key_v
case 119:return gi.key_w
case 120:return gi.key_x
case 121:return gi.key_y
case 122:return gi.key_z}return gi.unknown},xi.$name=function(e){if(0!=(e&gi.MASK))return gi.$name(e&~gi.MASK)
switch(e){case 13:return gi.$name(gi.enter)
case 27:return gi.$name(gi.escape)
case 8:return gi.$name(gi.backspace)
case 9:return gi.$name(gi.tab)
case 32:return gi.$name(gi.space)
case 127:return gi.$name(gi["delete"])
default:var t=new Di
return t.__b+=String.fromCharCode(e),t.__b}}
var yi=function(e){this.tokens=[],this.setLine(e)}
s["com.babylonhxext.loaders.obj.Line"]=yi,yi.__name__=["com","babylonhxext","loaders","obj","Line"],yi.prototype={tokens:null,setLine:function(e){var t=" ",i="	"
this.tokens=e.split(t),this.tokens.concat(e.split(i))},toFloat:function(){return parseFloat(this.tokens[1])},toVector2:function(){return new Et(parseFloat(this.tokens[1]),parseFloat(this.tokens[2]))},toVector3:function(){return new W(parseFloat(this.tokens[1]),parseFloat(this.tokens[2]),parseFloat(this.tokens[3]))},toColor3:function(){return new Re(parseFloat(this.tokens[1]),parseFloat(this.tokens[2]),parseFloat(this.tokens[3]))},toString:function(){return this.tokens.join(" ")},get_isValid:function(){return this.tokens.length>0},get_isComment:function(){return y.startsWith(this.tokens[0],"#")},get_blockSeparator:function(){return"_*_"},__class__:yi,__properties__:{get_blockSeparator:"get_blockSeparator",get_isComment:"get_isComment",get_isValid:"get_isValid"}}
var bi=s["com.babylonhxext.loaders.obj.MtlHeader"]={__ename__:!0,__constructs__:["None","Comment","Material","DiffuseColor","DiffuseTexture","SpecularColor","SpecularTexture","SpecularPower","EmissiveColor","Alpha","IlluminationModel","BumpTexture","ReflectionTexture","TransparencyTexture","AmbientTexture","AmbientColor","RefractionIndex","Transparency","TransmissionFiter"]}
bi.None=["None",0],bi.None.toString=o,bi.None.__enum__=bi,bi.Comment=["Comment",1],bi.Comment.toString=o,bi.Comment.__enum__=bi,bi.Material=["Material",2],bi.Material.toString=o,bi.Material.__enum__=bi,bi.DiffuseColor=["DiffuseColor",3],bi.DiffuseColor.toString=o,bi.DiffuseColor.__enum__=bi,bi.DiffuseTexture=["DiffuseTexture",4],bi.DiffuseTexture.toString=o,bi.DiffuseTexture.__enum__=bi,bi.SpecularColor=["SpecularColor",5],bi.SpecularColor.toString=o,bi.SpecularColor.__enum__=bi,bi.SpecularTexture=["SpecularTexture",6],bi.SpecularTexture.toString=o,bi.SpecularTexture.__enum__=bi,bi.SpecularPower=["SpecularPower",7],bi.SpecularPower.toString=o,bi.SpecularPower.__enum__=bi,bi.EmissiveColor=["EmissiveColor",8],bi.EmissiveColor.toString=o,bi.EmissiveColor.__enum__=bi,bi.Alpha=["Alpha",9],bi.Alpha.toString=o,bi.Alpha.__enum__=bi,bi.IlluminationModel=["IlluminationModel",10],bi.IlluminationModel.toString=o,bi.IlluminationModel.__enum__=bi,bi.BumpTexture=["BumpTexture",11],bi.BumpTexture.toString=o,bi.BumpTexture.__enum__=bi,bi.ReflectionTexture=["ReflectionTexture",12],bi.ReflectionTexture.toString=o,bi.ReflectionTexture.__enum__=bi,bi.TransparencyTexture=["TransparencyTexture",13],bi.TransparencyTexture.toString=o,bi.TransparencyTexture.__enum__=bi,bi.AmbientTexture=["AmbientTexture",14],bi.AmbientTexture.toString=o,bi.AmbientTexture.__enum__=bi,bi.AmbientColor=["AmbientColor",15],bi.AmbientColor.toString=o,bi.AmbientColor.__enum__=bi,bi.RefractionIndex=["RefractionIndex",16],bi.RefractionIndex.toString=o,bi.RefractionIndex.__enum__=bi,bi.Transparency=["Transparency",17],bi.Transparency.toString=o,bi.Transparency.__enum__=bi,bi.TransmissionFiter=["TransmissionFiter",18],bi.TransmissionFiter.toString=o,bi.TransmissionFiter.__enum__=bi
var wi=function(e){yi.call(this,e)}
s["com.babylonhxext.loaders.obj.MtlLine"]=wi,wi.__name__=["com","babylonhxext","loaders","obj","MtlLine"],wi.__super__=yi,wi.prototype=i(yi.prototype,{get_blockSeparator:function(){return"newmtl"},get_header:function(){if(this.get_isComment())return bi.Comment
var e=this.tokens[0].toLowerCase()
switch(e){case"newmtl":return bi.Material
case"kd":return bi.DiffuseColor
case"map_kd":return bi.DiffuseTexture
case"ks":return bi.SpecularColor
case"ns":return bi.SpecularPower
case"map_ks":return bi.SpecularTexture
case"ke":return bi.EmissiveColor
case"d":return bi.Alpha
case"illum":return bi.IlluminationModel
case"ni":return bi.RefractionIndex
case"tr":return bi.Transparency
case"map_d":return bi.TransparencyTexture
case"tf":return bi.TransmissionFiter
case"ka":return bi.AmbientColor
case"map_ka":return bi.AmbientTexture
case"bump":case"map_bump":return bi.BumpTexture
case"map_refl":return bi.ReflectionTexture}return bi.None},__class__:wi,__properties__:i(yi.prototype.__properties__,{get_header:"get_header"})})
var Si=s["com.babylonhxext.loaders.obj.ObjHeader"]={__ename__:!0,__constructs__:["None","Shading","Comment","Object","Vertices","TextureCoordinates","Normals","Group","SmoothingGroup","Line","Faces","MaterialLibrary","Material"]}
Si.None=["None",0],Si.None.toString=o,Si.None.__enum__=Si,Si.Shading=["Shading",1],Si.Shading.toString=o,Si.Shading.__enum__=Si,Si.Comment=["Comment",2],Si.Comment.toString=o,Si.Comment.__enum__=Si,Si.Object=["Object",3],Si.Object.toString=o,Si.Object.__enum__=Si,Si.Vertices=["Vertices",4],Si.Vertices.toString=o,Si.Vertices.__enum__=Si,Si.TextureCoordinates=["TextureCoordinates",5],Si.TextureCoordinates.toString=o,Si.TextureCoordinates.__enum__=Si,Si.Normals=["Normals",6],Si.Normals.toString=o,Si.Normals.__enum__=Si,Si.Group=["Group",7],Si.Group.toString=o,Si.Group.__enum__=Si,Si.SmoothingGroup=["SmoothingGroup",8],Si.SmoothingGroup.toString=o,Si.SmoothingGroup.__enum__=Si,Si.Line=["Line",9],Si.Line.toString=o,Si.Line.__enum__=Si,Si.Faces=["Faces",10],Si.Faces.toString=o,Si.Faces.__enum__=Si,Si.MaterialLibrary=["MaterialLibrary",11],Si.MaterialLibrary.toString=o,Si.MaterialLibrary.__enum__=Si,Si.Material=["Material",12],Si.Material.toString=o,Si.Material.__enum__=Si
var Mi=function(e){yi.call(this,e)}
s["com.babylonhxext.loaders.obj.ObjLine"]=Mi,Mi.__name__=["com","babylonhxext","loaders","obj","ObjLine"],Mi.__super__=yi,Mi.prototype=i(yi.prototype,{get_blockSeparator:function(){return"v"},get_header:function(){if(this.get_isComment())return Si.Comment
var e=this.tokens[0].toLowerCase()
if(""!=y.trim(e)){switch(e){case"o":return Si.Object
case"v":return Si.Vertices
case"vt":return Si.TextureCoordinates
case"vn":return Si.Normals
case"g":return Si.Group
case"s":return Si.Shading
case"l":return Si.Line
case"f":return Si.Faces
case"mtllib":return Si.MaterialLibrary
case"usemtl":return Si.Material}Ei.trace("Unsuported line type: "+e,{fileName:"ObjLine.hx",lineNumber:94,className:"com.babylonhxext.loaders.obj.ObjLine",methodName:"get_header"})}return Si.None},__class__:Mi,__properties__:i(yi.prototype.__properties__,{get_header:"get_header"})})
var Ti=function(e){this._activeSubMesh=0,this._subMeshesIndices=[],this._meshes=[],this.materials=new Bi,this.defaultMaterial=null,this.textureCoordinatesIndexOffset=1,this.normalsIndexOffset=1,this.positionsIndexOffset=1,this.meshPartsNum=0,this.meshParts=new Bi,this.registeredVertices=new Bi,this.stagingIndices=[],this.stagingVertices=[],this.textureCoordinates=[],this.normals=[],this.positions=[],this.lastLine="",this.lines=[],this._subMeshesIndices.push([0,0]),this._scene=e}
s["com.babylonhxext.loaders.obj.ObjLoader"]=Ti,Ti.__name__=["com","babylonhxext","loaders","obj","ObjLoader"],Ti.prototype={lines:null,lastLine:null,positions:null,normals:null,textureCoordinates:null,stagingVertices:null,stagingIndices:null,registeredVertices:null,meshParts:null,meshPartsNum:null,positionsIndexOffset:null,normalsIndexOffset:null,textureCoordinatesIndexOffset:null,defaultMaterial:null,materials:null,_scene:null,_rootUrl:null,_file:null,_meshes:null,get_meshes:function(){return this._meshes},_subMeshesIndices:null,_activeSubMesh:null,load:function(e,t,i){var n=this
this._rootUrl=e,this._file=t,Oe.LoadFile(e+t,function(e){for(var t=e,r=t.split("\n"),s=(r.length,""),o=null,a=0;a<r.length;){var l=r[a];++a,n.lines.push(new Mi(l))}n.lines[0].tokens[0]==n.lines[0].get_blockSeparator()&&n.appendNewPart(s,o)
for(var h=0,u=n.lines;h<u.length;){var c=u[h];++h
var f=c.get_header()
switch(f[1]){case 4:n.positions.push(c.toVector3()),n.lastLine="vertices"
break
case 5:n.textureCoordinates.push(c.toVector2()),n.lastLine="texturecoords"
break
case 6:n.normals.push(c.toVector3()),n.lastLine="normals"
break
case 7:s=c.tokens.length>1?c.tokens[1]:"noname",n.lastLine="group"
break
case 10:n.appendFace(c),n.lastLine="faces"
break
case 11:n.importMaterialLibrary(c,n._scene),n.lastLine="matlib"
break
case 12:var d=c.tokens[1]
o=n.materials.get(d),"faces"==n.lastLine&&(n._subMeshesIndices.push([n._activeSubMesh,n._activeSubMesh]),++n._activeSubMesh),n.lastLine="mat"}}n.positions.length>0&&n.appendNewPart(s,o)
for(var m=n.meshParts.keys();m.hasNext();){var _=m.next(),p=n.meshParts.get(_).createMesh(n._scene)
n._meshes.push(p)}null!=i&&i(n._meshes)},"")},appendFace:function(e){if(3==e.tokens.length)return this.appendIndex(1,e),this.appendIndex(2,e),void this.appendIndex(2,e)
if(4!=e.tokens.length){if(5==e.tokens.length){for(var t=1;4>t;){var i=t++
this.appendIndex(i,e)}this.appendIndex(1,e),this.appendIndex(3,e),this.appendIndex(4,e)}}else for(var n=1;4>n;){var r=n++
this.appendIndex(r,e)}},appendIndex:function(e,t){var i=t.tokens[e].split("/"),n=g.parseInt(i[0])-this.positionsIndexOffset,r=-1,s=-1
i.length>1&&""!=i[1]&&(r=g.parseInt(i[1])-this.textureCoordinatesIndexOffset),i.length>2&&""!=i[2]&&(s=g.parseInt(i[2])-this.normalsIndexOffset)
var o=new Ci
o.Position=this.positions[n],r>=0&&(o.TextureCoordinates=this.textureCoordinates[r]),s>=0&&(o.Normal=this.normals[s])
var a=o.ToString(),l=0
this.registeredVertices.exists(a)?l=this.registeredVertices.get(a):(this.stagingVertices.push(o),l=this.stagingVertices.length-1,this.registeredVertices.set(a,l),this._subMeshesIndices[this._activeSubMesh][1]=l),this.stagingIndices.push(l)},appendNewPart:function(e,t){if(0!=this.stagingVertices.length){null==t&&(null==this.defaultMaterial&&(this.defaultMaterial=new Fe("empty",this._scene)),t=this.defaultMaterial)
var i=null
this.meshParts.exists(t.name)?i=this.meshParts.get(t.name):(i=new Ai(t==this.defaultMaterial?null:t),this.meshParts.set(t.name,i),this.meshPartsNum++),i.addPart(e,this.stagingVertices,this.stagingIndices),this.positionsIndexOffset+=this.positions.length,this.positions=[],this.normalsIndexOffset+=this.normals.length,this.normals=[],this.textureCoordinatesIndexOffset+=this.textureCoordinates.length,this.textureCoordinates=[],this.stagingVertices=[],this.stagingIndices=[],this.registeredVertices=new Bi}},importMaterialLibrary:function(e,t){for(var i=this,n=1,r=e.tokens.length;r>n;){var s=n++,o=e.tokens[s]
Oe.LoadFile(this._rootUrl+o,function(e){for(var n=e,r=n.split("\n"),s=[],o=0;o<r.length;){var a=r[o];++o,s.push(new wi(a))}for(var l=null,h=0;h<s.length;){var u=s[h];++h
var c=u.get_header()
switch(c[1]){case 2:l=new Fe(u.tokens[1],t),l.backFaceCulling=!0,i.materials.set(l.name,l)
break
case 3:l.diffuseColor=u.toColor3()
break
case 4:l.diffuseTexture=new Ve(i._rootUrl+u.tokens[1],t)
break
case 11:l.bumpTexture=new Ve(i._rootUrl+u.tokens[1],t)
break
case 14:l.ambientTexture=new Ve(i._rootUrl+u.tokens[1],t)
break
case 6:l.specularTexture=new Ve(i._rootUrl+u.tokens[1],t)
break
case 12:l.reflectionTexture=new Ve(i._rootUrl+u.tokens[1],t)
break
case 9:l.alpha=u.toFloat()
break
case 15:l.ambientColor=u.toColor3()
break
case 8:l.emissiveColor=u.toColor3()
break
case 5:l.specularColor=u.toColor3()
break
case 7:l.specularPower=u.toFloat()}}},"text")}},__class__:Ti,__properties__:{get_meshes:"get_meshes"}}
var Ci=function(){this.Normal=new W(0,0,0)}
s["com.babylonhxext.loaders.obj.PositionNormalTextured"]=Ci,Ci.__name__=["com","babylonhxext","loaders","obj","PositionNormalTextured"],Ci.prototype={pID:null,nID:null,tcID:null,Position:null,Normal:null,TextureCoordinates:null,ToString:function(){return"P:{"+g.string(this.Position)+"} N:{"+g.string(this.Normal)+"} TV:{"+g.string(this.TextureCoordinates)+"}"},GetPosition:function(){return this.Position},DumpPositions:function(e){null!=this.Position&&(e.push(this.Position.x),e.push(this.Position.y),e.push(this.Position.z))},DumpNormals:function(e){this.Normal.normalize(),e.push(this.Normal.x),e.push(this.Normal.y),e.push(this.Normal.z)},DumpUVs:function(e){null!=this.TextureCoordinates&&(e.push(this.TextureCoordinates.x),e.push(this.TextureCoordinates.y))},__class__:Ci}
var Ai=function(e){this.concatenatedName="",this.material=null,this.indices=[],this.vertices=[],this.material=e}
s["com.babylonhxext.loaders.obj.PreMesh"]=Ai,Ai.__name__=["com","babylonhxext","loaders","obj","PreMesh"],Ai.prototype={vertices:null,indices:null,material:null,concatenatedName:null,addPart:function(e,t,i){""==this.concatenatedName&&(this.concatenatedName+="#"),this.concatenatedName+=e
var n=this.vertices.length
this.vertices=this.vertices.concat(t)
for(var r=0;r<i.length;){var s=i[r];++r,this.indices.push(s+n)}},createMesh:function(e){var t=new qe(this.concatenatedName,e),i=new Ze
t.set_material(this.material)
for(var n=[],r=[],s=[],o=0,a=this.vertices.length;a>o;){var l=o++
this.vertices[l].DumpPositions(n),this.vertices[l].DumpNormals(r),this.vertices[l].DumpUVs(s)}return n.length>0&&(i.positions=n),r.length>0&&(i.normals=r),s.length>0&&(i.uvs=s),i.indices=this.indices,i.applyToMesh(t),t},__class__:Ai}
var Ii=function(){}
s["haxe.IMap"]=Ii,Ii.__name__=["haxe","IMap"],Ii.prototype={get:null,keys:null,__class__:Ii}
var Pi=function(e,t){this.high=e,this.low=t}
s["haxe._Int64.___Int64"]=Pi,Pi.__name__=["haxe","_Int64","___Int64"],Pi.prototype={high:null,low:null,__class__:Pi}
var Ei=function(){}
s["haxe.Log"]=Ei,Ei.__name__=["haxe","Log"],Ei.trace=function(e,t){Me.__trace(e,t)}
var Di=function(){this.__b=""}
s["haxe.Utf8"]=Di,Di.__name__=["haxe","Utf8"],Di.prototype={__b:null,__class__:Di}
var Li=function(e){for(var t=e.length,i=1;t>1<<i;)i++
if(i>8||t!=1<<i)throw new Wi("BaseCode : base length must be a power of two.")
this.base=e,this.nbits=i}
s["haxe.crypto.BaseCode"]=Li,Li.__name__=["haxe","crypto","BaseCode"],Li.prototype={base:null,nbits:null,encodeBytes:function(e){for(var t=this.nbits,i=this.base,n=8*e.length/t|0,r=Te.alloc(n+(8*e.length%t==0?0:1)),s=0,o=0,a=(1<<t)-1,l=0,h=0;n>h;){for(;t>o;)o+=8,s<<=8,s|=e.get(l++)
o-=t,r.set(h++,i.b[s>>o&a])}return o>0&&r.set(h++,i.b[s<<t-o&a]),r},__class__:Li}
var Fi=function(){this.h={}}
s["haxe.ds.IntMap"]=Fi,Fi.__name__=["haxe","ds","IntMap"],Fi.__interfaces__=[Ii],Fi.prototype={h:null,set:function(e,t){this.h[e]=t},get:function(e){return this.h[e]},exists:function(e){return this.h.hasOwnProperty(e)},keys:function(){var e=[]
for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t)
return c.iter(e)},__class__:Fi}
var Ri=function(){this.h={},this.h.__keys__={}}
s["haxe.ds.ObjectMap"]=Ri,Ri.__name__=["haxe","ds","ObjectMap"],Ri.__interfaces__=[Ii],Ri.prototype={h:null,set:function(e,t){var i=e.__id__||(e.__id__=++Ri.count)
this.h[i]=t,this.h.__keys__[i]=e},get:function(e){return this.h[e.__id__]},remove:function(e){var t=e.__id__
return null==this.h.__keys__[t]?!1:(delete this.h[t],delete this.h.__keys__[t],!0)},keys:function(){var e=[]
for(var t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t])
return c.iter(e)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var e=this.it.next()
return this.ref[e.__id__]}}},__class__:Ri}
var zi=function(e,t){this.map=e,this.keys=t,this.index=0,this.count=t.length}
s["haxe.ds._StringMap.StringMapIterator"]=zi,zi.__name__=["haxe","ds","_StringMap","StringMapIterator"],zi.prototype={map:null,keys:null,index:null,count:null,hasNext:function(){return this.index<this.count},next:function(){return this.map.get(this.keys[this.index++])},__class__:zi}
var Bi=function(){this.h={}}
s["haxe.ds.StringMap"]=Bi,Bi.__name__=["haxe","ds","StringMap"],Bi.__interfaces__=[Ii],Bi.prototype={h:null,rh:null,set:function(e,t){null!=Os[e]?this.setReserved(e,t):this.h[e]=t},get:function(e){return null!=Os[e]?this.getReserved(e):this.h[e]},exists:function(e){return null!=Os[e]?this.existsReserved(e):this.h.hasOwnProperty(e)},setReserved:function(e,t){null==this.rh&&(this.rh={}),this.rh["$"+e]=t},getReserved:function(e){return null==this.rh?null:this.rh["$"+e]},existsReserved:function(e){return null==this.rh?!1:this.rh.hasOwnProperty("$"+e)},remove:function(e){return null!=Os[e]?(e="$"+e,null!=this.rh&&this.rh.hasOwnProperty(e)?(delete this.rh[e],!0):!1):this.h.hasOwnProperty(e)?(delete this.h[e],!0):!1},keys:function(){var e=this.arrayKeys()
return c.iter(e)},arrayKeys:function(){var e=[]
for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(t)
if(null!=this.rh)for(var t in this.rh)36==t.charCodeAt(0)&&e.push(t.substr(1))
return e},iterator:function(){return new zi(this,this.arrayKeys())},__class__:Bi}
var Oi=function(){this.b=[]}
s["haxe.io.BytesBuffer"]=Oi,Oi.__name__=["haxe","io","BytesBuffer"],Oi.prototype={b:null,addBytes:function(e,t,i){if(0>t||0>i||t+i>e.length)throw new Wi(De.OutsideBounds)
for(var n=(this.b,e.b),r=t,s=t+i;s>r;){var o=r++
this.b.push(n[o])}},getBytes:function(){var e=new Te(new Us(this.b).buffer)
return this.b=null,e},__class__:Oi}
var ki=function(){}
s["haxe.io.Output"]=ki,ki.__name__=["haxe","io","Output"],ki.prototype={bigEndian:null,writeByte:function(){throw new Wi("Not implemented")},writeBytes:function(e,t,i){var n=i,r=e.b.bufferValue
if(0>t||0>i||t+i>e.length)throw new Wi(De.OutsideBounds)
for(;n>0;)this.writeByte(r[t]),t++,n--
return i},set_bigEndian:function(e){return this.bigEndian=e,e},write:function(e){for(var t=e.length,i=0;t>0;){var n=this.writeBytes(e,i,t)
if(0==n)throw new Wi(De.Blocked)
i+=n,t-=n}},writeFullBytes:function(e,t,i){for(;i>0;){var n=this.writeBytes(e,t,i)
t+=n,i-=n}},writeDouble:function(e){var t=Ui.doubleToI64(e)
this.bigEndian?(this.writeInt32(t.high),this.writeInt32(t.low)):(this.writeInt32(t.low),this.writeInt32(t.high))},writeInt8:function(e){if(-128>e||e>=128)throw new Wi(De.Overflow)
this.writeByte(255&e)},writeInt16:function(e){if(-32768>e||e>=32768)throw new Wi(De.Overflow)
this.writeUInt16(65535&e)},writeUInt16:function(e){if(0>e||e>=65536)throw new Wi(De.Overflow)
this.bigEndian?(this.writeByte(e>>8),this.writeByte(255&e)):(this.writeByte(255&e),this.writeByte(e>>8))},writeInt32:function(e){this.bigEndian?(this.writeByte(e>>>24),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)):(this.writeByte(255&e),this.writeByte(e>>8&255),this.writeByte(e>>16&255),this.writeByte(e>>>24))},writeString:function(e){var t=Te.ofString(e)
this.writeFullBytes(t,0,t.length)},__class__:ki,__properties__:{set_bigEndian:"set_bigEndian"}}
var Vi=function(){this.b=new Oi}
s["haxe.io.BytesOutput"]=Vi,Vi.__name__=["haxe","io","BytesOutput"],Vi.__super__=ki,Vi.prototype=i(ki.prototype,{b:null,writeByte:function(e){this.b.b.push(e)},writeBytes:function(e,t,i){return this.b.addBytes(e,t,i),i},getBytes:function(){return this.b.getBytes()},__class__:Vi})
var Ni=function(){}
s["haxe.io.Eof"]=Ni,Ni.__name__=["haxe","io","Eof"],Ni.prototype={toString:function(){return"Eof"},__class__:Ni}
var Ui=function(){}
s["haxe.io.FPHelper"]=Ui,Ui.__name__=["haxe","io","FPHelper"],Ui.i32ToFloat=function(e){var t=1-(e>>>31<<1),i=e>>>23&255,n=8388607&e
return 0==n&&0==i?0:t*(1+Math.pow(2,-23)*n)*Math.pow(2,i-127)},Ui.floatToI32=function(e){if(0==e)return 0
var t
t=0>e?-e:e
var i=Math.floor(Math.log(t)/.6931471805599453);-127>i?i=-127:i>128&&(i=128)
var n=8388607&Math.round(8388608*(t/Math.pow(2,i)-1))
return(0>e?-2147483648:0)|i+127<<23|n},Ui.i64ToDouble=function(e,t){var i=1-(t>>>31<<1),n=(t>>20&2047)-1023,r=4294967296*(1048575&t)+2147483648*(e>>>31)+(2147483647&e)
return 0==r&&-1023==n?0:i*(1+Math.pow(2,-52)*r)*Math.pow(2,n)},Ui.doubleToI64=function(e){var t=Ui.i64tmp
if(0==e)t.low=0,t.high=0
else{var i
i=0>e?-e:e
var n,r=Math.floor(Math.log(i)/.6931471805599453),s=4503599627370496*(i/Math.pow(2,r)-1)
n=Math.round(s)
var o=0|n,a=n/4294967296|0
t.low=o,t.high=(0>e?-2147483648:0)|r+1023<<20|a}return t}
var Wi=function(e){Error.call(this),this.val=e,Object.prototype.hasOwnProperty.call(e,"name")?this.name=v.field(e,"name"):this.name="Error",Object.prototype.hasOwnProperty.call(e,"message")?this.message=v.field(e,"message"):this.message=g.string(e),Error.captureStackTrace&&Error.captureStackTrace(this,Wi)}
s["js._Boot.HaxeError"]=Wi,Wi.__name__=["js","_Boot","HaxeError"],Wi.__super__=Error,Wi.prototype=i(Error.prototype,{val:null,__class__:Wi})
var Gi=function(){}
s["js.html._CanvasElement.CanvasUtil"]=Gi,Gi.__name__=["js","html","_CanvasElement","CanvasUtil"],Gi.getContextWebGL=function(e,t){for(var i=0,n=["webgl","experimental-webgl"];i<n.length;){var r=n[i];++i
var s=e.getContext(r,t)
if(null!=s)return s}return null}
var Yi=function(e){if(e instanceof Array&&null==e.__enum__)this.a=e,this.byteLength=e.length
else{var t=e
this.a=[]
for(var i=0;t>i;){var n=i++
this.a[n]=0}this.byteLength=t}}
s["js.html.compat.ArrayBuffer"]=Yi,Yi.__name__=["js","html","compat","ArrayBuffer"],Yi.sliceImpl=function(e,t){var i=new Us(this,e,null==t?null:t-e),n=new ks(i.byteLength),r=new Us(n)
return r.set(i),n},Yi.prototype={byteLength:null,a:null,slice:function(e,t){return new Yi(this.a.slice(e,t))},__class__:Yi}
var Hi=function(e,t,i){if(this.buf=e,null==t?this.offset=0:this.offset=t,null==i?this.length=e.byteLength-this.offset:this.length=i,this.offset<0||this.length<0||this.offset+this.length>e.byteLength)throw new Wi(De.OutsideBounds)}
s["js.html.compat.DataView"]=Hi,Hi.__name__=["js","html","compat","DataView"],Hi.prototype={buf:null,offset:null,length:null,getInt8:function(e){var t=this.buf.a[this.offset+e]
return t>=128?t-256:t},getUint8:function(e){return this.buf.a[this.offset+e]},getInt16:function(e,t){var i=this.getUint16(e,t)
return i>=32768?i-65536:i},getUint16:function(e,t){return t?this.buf.a[this.offset+e]|this.buf.a[this.offset+e+1]<<8:this.buf.a[this.offset+e]<<8|this.buf.a[this.offset+e+1]},getInt32:function(e,t){var i=this.offset+e,n=this.buf.a[i++],r=this.buf.a[i++],s=this.buf.a[i++],o=this.buf.a[i++]
return t?n|r<<8|s<<16|o<<24:o|s<<8|r<<16|n<<24},getUint32:function(e,t){var i=this.getInt32(e,t)
return 0>i?i+4294967296:i},getFloat32:function(e,t){return Ui.i32ToFloat(this.getInt32(e,t))},getFloat64:function(e,t){var i=this.getInt32(e,t),n=this.getInt32(e+4,t)
return Ui.i64ToDouble(t?i:n,t?n:i)},setInt8:function(e,t){0>t?this.buf.a[e+this.offset]=t+128&255:this.buf.a[e+this.offset]=255&t},setUint8:function(e,t){this.buf.a[e+this.offset]=255&t},setInt16:function(e,t,i){this.setUint16(e,0>t?t+65536:t,i)},setUint16:function(e,t,i){var n=e+this.offset
i?(this.buf.a[n]=255&t,this.buf.a[n++]=t>>8&255):(this.buf.a[n++]=t>>8&255,this.buf.a[n]=255&t)},setInt32:function(e,t,i){this.setUint32(e,t,i)},setUint32:function(e,t,i){var n=e+this.offset
i?(this.buf.a[n++]=255&t,this.buf.a[n++]=t>>8&255,this.buf.a[n++]=t>>16&255,this.buf.a[n++]=t>>>24):(this.buf.a[n++]=t>>>24,this.buf.a[n++]=t>>16&255,this.buf.a[n++]=t>>8&255,this.buf.a[n++]=255&t)},setFloat32:function(e,t,i){this.setUint32(e,Ui.floatToI32(t),i)},setFloat64:function(e,t,i){var n=Ui.doubleToI64(t)
i?(this.setUint32(e,n.low),this.setUint32(e,n.high)):(this.setUint32(e,n.high),this.setUint32(e,n.low))},__class__:Hi}
var Xi=function(){}
s["js.html.compat.Uint8Array"]=Xi,Xi.__name__=["js","html","compat","Uint8Array"],Xi._new=function(e,t,i){var n
if("number"==typeof e){n=[]
for(var r=0;e>r;){var s=r++
n[s]=0}n.byteLength=n.length,n.byteOffset=0,n.buffer=new Yi(n)}else if(Me.__instanceof(e,Yi)){var o=e
null==t&&(t=0),null==i&&(i=o.byteLength-t),n=0==t?o.a:o.a.slice(t,t+i),n.byteLength=n.length,n.byteOffset=t,n.buffer=o}else{if(!(e instanceof Array&&null==e.__enum__))throw new Wi("TODO "+g.string(e))
n=e.slice(),n.byteLength=n.length,n.byteOffset=0,n.buffer=new Yi(n)}return n.subarray=Xi._subarray,n.set=Xi._set,n},Xi._set=function(e,t){var i=this
if(Me.__instanceof(e.buffer,Yi)){var n=e
if(e.byteLength+t>i.byteLength)throw new Wi("set() outside of range")
for(var r=0,s=e.byteLength;s>r;){var o=r++
i[o+t]=n[o]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new Wi("TODO")
var a=e
if(a.length+t>i.byteLength)throw new Wi("set() outside of range")
for(var l=0,h=a.length;h>l;){var u=l++
i[u+t]=a[u]}}},Xi._subarray=function(e,t){var i=this,n=Xi._new(i.slice(e,t))
return n.byteOffset=e,n}
var ji=function(){this.enabled=!0,this.audio=new Bi,this.font=new Bi,this.image=new Bi}
s["lime.AssetCache"]=ji,ji.__name__=["lime","AssetCache"],ji.prototype={audio:null,enabled:null,image:null,font:null,clear:function(e){if(null==e)this.audio=new Bi,this.font=new Bi,this.image=new Bi
else{for(var t=this.audio.keys();t.hasNext();){var i=t.next()
y.startsWith(i,e)&&this.audio.remove(i)}for(var n=this.font.keys();n.hasNext();){var r=n.next()
y.startsWith(r,e)&&this.font.remove(r)}for(var s=this.image.keys();s.hasNext();){var o=s.next()
y.startsWith(o,e)&&this.image.remove(o)}}},__class__:ji}
var Ki=function(){}
s["lime.Assets"]=Ki,Ki.__name__=["lime","Assets"],Ki.exists=function(e,t){Ki.initialize(),null==t&&(t="BINARY")
var i,n=e.substring(0,e.indexOf(":")),r=e.indexOf(":")+1
i=c.substr(e,r,null)
var s=Ki.getLibrary(n)
return null!=s?s.exists(i,t):!1},Ki.getAudioBuffer=function(e,t){if(null==t&&(t=!0),Ki.initialize(),t&&Ki.cache.enabled&&Ki.cache.audio.exists(e)){var i=Ki.cache.audio.get(e)
if(Ki.isValidAudio(i))return i}var n,r=e.substring(0,e.indexOf(":")),s=e.indexOf(":")+1
n=c.substr(e,s,null)
var o=Ki.getLibrary(r)
if(null!=o)if(o.exists(n,"SOUND")){if(o.isLocal(n,"SOUND")){var a=o.getAudioBuffer(n)
return t&&Ki.cache.enabled&&Ki.cache.audio.set(e,a),a}Ei.trace('[Assets] Audio asset "'+e+'" exists, but only asynchronously',{fileName:"Assets.hx",lineNumber:115,className:"lime.Assets",methodName:"getAudioBuffer"})}else Ei.trace('[Assets] There is no audio asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:121,className:"lime.Assets",methodName:"getAudioBuffer"})
else Ei.trace('[Assets] There is no asset library named "'+r+'"',{fileName:"Assets.hx",lineNumber:127,className:"lime.Assets",methodName:"getAudioBuffer"})
return null},Ki.getBytes=function(e){Ki.initialize()
var t,i=e.substring(0,e.indexOf(":")),n=e.indexOf(":")+1
t=c.substr(e,n,null)
var r=Ki.getLibrary(i)
if(null!=r)if(r.exists(t,"BINARY")){if(r.isLocal(t,"BINARY"))return r.getBytes(t)
Ei.trace('[Assets] String or ByteArray asset "'+e+'" exists, but only asynchronously',{fileName:"Assets.hx",lineNumber:164,className:"lime.Assets",methodName:"getBytes"})}else Ei.trace('[Assets] There is no String or ByteArray asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:170,className:"lime.Assets",methodName:"getBytes"})
else Ei.trace('[Assets] There is no asset library named "'+i+'"',{fileName:"Assets.hx",lineNumber:176,className:"lime.Assets",methodName:"getBytes"})
return null},Ki.getFont=function(e,t){if(null==t&&(t=!0),Ki.initialize(),t&&Ki.cache.enabled&&Ki.cache.font.exists(e))return Ki.cache.font.get(e)
var i,n=e.substring(0,e.indexOf(":")),r=e.indexOf(":")+1
i=c.substr(e,r,null)
var s=Ki.getLibrary(n)
if(null!=s)if(s.exists(i,"FONT")){if(s.isLocal(i,"FONT")){var o=s.getFont(i)
return t&&Ki.cache.enabled&&Ki.cache.font.set(e,o),o}Ei.trace('[Assets] Font asset "'+e+'" exists, but only asynchronously',{fileName:"Assets.hx",lineNumber:227,className:"lime.Assets",methodName:"getFont"})}else Ei.trace('[Assets] There is no Font asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:233,className:"lime.Assets",methodName:"getFont"})
else Ei.trace('[Assets] There is no asset library named "'+n+'"',{fileName:"Assets.hx",lineNumber:239,className:"lime.Assets",methodName:"getFont"})
return null},Ki.getImage=function(e,t){if(null==t&&(t=!0),Ki.initialize(),t&&Ki.cache.enabled&&Ki.cache.image.exists(e)){var i=Ki.cache.image.get(e)
if(Ki.isValidImage(i))return i}var n,r=e.substring(0,e.indexOf(":")),s=e.indexOf(":")+1
n=c.substr(e,s,null)
var o=Ki.getLibrary(r)
if(null!=o)if(o.exists(n,"IMAGE")){if(o.isLocal(n,"IMAGE")){var a=o.getImage(n)
return t&&Ki.cache.enabled&&Ki.cache.image.set(e,a),a}Ei.trace('[Assets] Image asset "'+e+'" exists, but only asynchronously',{fileName:"Assets.hx",lineNumber:297,className:"lime.Assets",methodName:"getImage"})}else Ei.trace('[Assets] There is no Image asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:303,className:"lime.Assets",methodName:"getImage"})
else Ei.trace('[Assets] There is no asset library named "'+r+'"',{fileName:"Assets.hx",lineNumber:309,className:"lime.Assets",methodName:"getImage"})
return null},Ki.getLibrary=function(e){return(null==e||""==e)&&(e="default"),Ki.libraries.get(e)},Ki.getPath=function(e){Ki.initialize()
var t,i=e.substring(0,e.indexOf(":")),n=e.indexOf(":")+1
t=c.substr(e,n,null)
var r=Ki.getLibrary(i)
if(null!=r){if(r.exists(t,null))return r.getPath(t)
Ei.trace('[Assets] There is no asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:426,className:"lime.Assets",methodName:"getPath"})}else Ei.trace('[Assets] There is no asset library named "'+i+'"',{fileName:"Assets.hx",lineNumber:432,className:"lime.Assets",methodName:"getPath"})
return null},Ki.getText=function(e){Ki.initialize()
var t,i=e.substring(0,e.indexOf(":")),n=e.indexOf(":")+1
t=c.substr(e,n,null)
var r=Ki.getLibrary(i)
if(null!=r)if(r.exists(t,"TEXT")){if(r.isLocal(t,"TEXT"))return r.getText(t)
Ei.trace('[Assets] String asset "'+e+'" exists, but only asynchronously',{fileName:"Assets.hx",lineNumber:469,className:"lime.Assets",methodName:"getText"})}else Ei.trace('[Assets] There is no String asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:475,className:"lime.Assets",methodName:"getText"})
else Ei.trace('[Assets] There is no asset library named "'+i+'"',{fileName:"Assets.hx",lineNumber:481,className:"lime.Assets",methodName:"getText"})
return null},Ki.initialize=function(){Ki.initialized||(Ki.registerLibrary("default",new h),Ki.initialized=!0)},Ki.isLocal=function(e,t,i){if(null==i&&(i=!0),Ki.initialize(),i&&Ki.cache.enabled){if(("IMAGE"==t||null==t)&&Ki.cache.image.exists(e))return!0
if(("FONT"==t||null==t)&&Ki.cache.font.exists(e))return!0
if(("SOUND"==t||"MUSIC"==t||null==t)&&Ki.cache.audio.exists(e))return!0}var n,r=e.substring(0,e.indexOf(":")),s=e.indexOf(":")+1
n=c.substr(e,s,null)
var o=Ki.getLibrary(r)
return null!=o?o.isLocal(n,t):!1},Ki.isValidAudio=function(e){return null!=e},Ki.isValidImage=function(){return!0},Ki.list=function(e){Ki.initialize()
for(var t=[],i=Ki.libraries.iterator();i.hasNext();){var n=i.next(),r=n.list(e)
null!=r&&(t=t.concat(r))}return t},Ki.loadAudioBuffer=function(e,t,i){if(null==i&&(i=!0),Ki.initialize(),i&&Ki.cache.enabled&&Ki.cache.audio.exists(e)){var n=Ki.cache.audio.get(e)
if(Ki.isValidAudio(n))return void t(n)}var r,s=e.substring(0,e.indexOf(":")),o=e.indexOf(":")+1
r=c.substr(e,o,null)
var a=Ki.getLibrary(s)
if(null!=a){if(a.exists(r,"SOUND"))return void(i&&Ki.cache.enabled?a.loadAudioBuffer(r,function(i){var n=i
Ki.cache.audio.set(e,n),t(i)}):a.loadAudioBuffer(r,t))
Ei.trace('[Assets] There is no audio asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:666,className:"lime.Assets",methodName:"loadAudioBuffer"})}else Ei.trace('[Assets] There is no asset library named "'+s+'"',{fileName:"Assets.hx",lineNumber:672,className:"lime.Assets",methodName:"loadAudioBuffer"})
t(null)},Ki.loadBytes=function(e,t){Ki.initialize()
var i,n=e.substring(0,e.indexOf(":")),r=e.indexOf(":")+1
i=c.substr(e,r,null)
var s=Ki.getLibrary(n)
if(null!=s){if(s.exists(i,"BINARY"))return void s.loadBytes(i,t)
Ei.trace('[Assets] There is no String or ByteArray asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:702,className:"lime.Assets",methodName:"loadBytes"})}else Ei.trace('[Assets] There is no asset library named "'+n+'"',{fileName:"Assets.hx",lineNumber:708,className:"lime.Assets",methodName:"loadBytes"})
t(null)},Ki.loadImage=function(e,t,i){if(null==i&&(i=!0),Ki.initialize(),i&&Ki.cache.enabled&&Ki.cache.image.exists(e)){var n=Ki.cache.image.get(e)
if(Ki.isValidImage(n))return void t(n)}var r,s=e.substring(0,e.indexOf(":")),o=e.indexOf(":")+1
r=c.substr(e,o,null)
var a=Ki.getLibrary(s)
if(null!=a){if(a.exists(r,"IMAGE"))return void(i&&Ki.cache.enabled?a.loadImage(r,function(i){Ki.cache.image.set(e,i),t(i)}):a.loadImage(r,t))
Ei.trace('[Assets] There is no Image asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:765,className:"lime.Assets",methodName:"loadImage"})}else Ei.trace('[Assets] There is no asset library named "'+s+'"',{fileName:"Assets.hx",lineNumber:771,className:"lime.Assets",methodName:"loadImage"})
t(null)},Ki.loadLibrary=function(e,t){Ki.initialize()
var i=Ki.getText("libraries/"+e+".json")
if(null!=i&&""!=i){var n=JSON.parse(i),r=w.createInstance(w.resolveClass(n.type),n.args)
Ki.libraries.set(e,r),r.eventCallback=Ki.library_onEvent,r.load(t)}else Ei.trace('[Assets] There is no asset library named "'+e+'"',{fileName:"Assets.hx",lineNumber:800,className:"lime.Assets",methodName:"loadLibrary"})},Ki.loadText=function(e,t){Ki.initialize()
var i,n=e.substring(0,e.indexOf(":")),r=e.indexOf(":")+1
i=c.substr(e,r,null)
var s=Ki.getLibrary(n)
if(null!=s){if(s.exists(i,"TEXT"))return void s.loadText(i,t)
Ei.trace('[Assets] There is no String asset with an ID of "'+e+'"',{fileName:"Assets.hx",lineNumber:891,className:"lime.Assets",methodName:"loadText"})}else Ei.trace('[Assets] There is no asset library named "'+n+'"',{fileName:"Assets.hx",lineNumber:897,className:"lime.Assets",methodName:"loadText"})
t(null)},Ki.registerLibrary=function(e,t){Ki.libraries.exists(e)&&Ki.unloadLibrary(e),null!=t&&(t.eventCallback=Ki.library_onEvent),Ki.libraries.set(e,t)},Ki.unloadLibrary=function(e){Ki.initialize()
var t=Ki.libraries.get(e)
null!=t&&(Ki.cache.clear(e+":"),t.eventCallback=null),Ki.libraries.remove(e)},Ki.library_onEvent=function(e,t){"change"==t&&Ki.cache.clear()}
var Zi=function(e){this.parent=e,this.currentUpdate=0,this.lastUpdate=0,this.nextUpdate=0,this.framePeriod=-1,sn.init()}
s["lime._backend.html5.HTML5Application"]=Zi,Zi.__name__=["lime","_backend","html5","HTML5Application"],Zi.prototype={currentUpdate:null,deltaTime:null,framePeriod:null,lastUpdate:null,nextUpdate:null,parent:null,convertKeyCode:function(e){if(e>=65&&90>=e)return e+32
switch(e){case 16:return 1073742049
case 17:return 1073742048
case 18:return 1073742050
case 20:return 1073741881
case 144:return 1073741907
case 37:return 1073741904
case 38:return 1073741906
case 39:return 1073741903
case 40:return 1073741905
case 45:return 1073741897
case 46:return 127
case 36:return 1073741898
case 35:return 1073741901
case 33:return 1073741899
case 34:return 1073741902
case 112:return 1073741882
case 113:return 1073741883
case 114:return 1073741884
case 115:return 1073741885
case 116:return 1073741886
case 117:return 1073741887
case 118:return 1073741888
case 119:return 1073741889
case 120:return 1073741890
case 121:return 1073741891
case 122:return 1073741892
case 123:return 1073741893}return e},create:function(e){if(this.parent.config=e,null!=e){var t=new Qn(e),i=new yn(t)
this.parent.addWindow(t),this.parent.addRenderer(i),this.parent.init(i.context)}},exec:function(){window.addEventListener("keydown",r(this,this.handleKeyEvent),!1),window.addEventListener("keyup",r(this,this.handleKeyEvent),!1),window.addEventListener("focus",r(this,this.handleWindowEvent),!1),window.addEventListener("blur",r(this,this.handleWindowEvent),!1),window.addEventListener("resize",r(this,this.handleWindowEvent),!1),window.addEventListener("beforeunload",r(this,this.handleWindowEvent),!1)
for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"]
return window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+n)},n)
return e=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,this.lastUpdate=(new Date).getTime(),this.handleUpdateEvent(),0},getFrameRate:function(){return this.framePeriod<0?60:1e3==this.framePeriod?0:1e3/this.framePeriod},handleKeyEvent:function(e){if(null!=this.parent.windows[0]){var t,i=this.convertKeyCode(null!=e.keyCode?e.keyCode:e.which)
if(t=(e.shiftKey?3:0)|(e.ctrlKey?192:0)|(e.altKey?768:0)|(e.metaKey?3072:0),"keydown"==e.type){for(var n=this.parent.windows[0].onKeyDown.listeners,r=this.parent.windows[0].onKeyDown.repeat,s=n.length,o=0;s>o;)n[o](i,t),r[o]?o++:(this.parent.windows[0].onKeyDown.remove(n[o]),s--)
if(this.parent.windows[0].backend.getEnableTextEvents())for(var a=this.parent.windows[0].onTextInput.listeners,l=this.parent.windows[0].onTextInput.repeat,h=a.length,u=0;h>u;)a[u](String.fromCharCode(e.keyCode)),l[u]?u++:(this.parent.windows[0].onTextInput.remove(a[u]),h--)}else for(var c=this.parent.windows[0].onKeyUp.listeners,f=this.parent.windows[0].onKeyUp.repeat,d=c.length,m=0;d>m;)c[m](i,t),f[m]?m++:(this.parent.windows[0].onKeyUp.remove(c[m]),d--)}},handleUpdateEvent:function(){if(this.currentUpdate=(new Date).getTime(),this.currentUpdate>=this.nextUpdate){this.deltaTime=this.currentUpdate-this.lastUpdate
for(var e=this.parent.onUpdate.listeners,t=this.parent.onUpdate.repeat,i=e.length,n=0;i>n;)e[n](0|this.deltaTime),t[n]?n++:(this.parent.onUpdate.remove(e[n]),i--)
if(null!=this.parent.renderers[0]){for(var s=this.parent.renderers[0].onRender.listeners,o=this.parent.renderers[0].onRender.repeat,a=s.length,l=0;a>l;)s[l](this.parent.renderers[0].context),o[l]?l++:(this.parent.renderers[0].onRender.remove(s[l]),a--)
this.parent.renderers[0].flip()}this.framePeriod<0?(this.nextUpdate=this.currentUpdate,this.nextUpdate=this.currentUpdate):this.nextUpdate=this.currentUpdate+this.framePeriod,this.lastUpdate=this.currentUpdate}window.requestAnimationFrame(r(this,this.handleUpdateEvent))},handleWindowEvent:function(e){if(null!=this.parent.windows[0]){var t=e.type
switch(t){case"focus":for(var i=this.parent.windows[0].onWindowFocusIn.listeners,n=this.parent.windows[0].onWindowFocusIn.repeat,r=i.length,s=0;r>s;)i[s](),n[s]?s++:(this.parent.windows[0].onWindowFocusIn.remove(i[s]),r--)
for(var o=this.parent.windows[0].onWindowActivate.listeners,a=this.parent.windows[0].onWindowActivate.repeat,l=o.length,h=0;l>h;)o[h](),a[h]?h++:(this.parent.windows[0].onWindowActivate.remove(o[h]),l--)
break
case"blur":for(var u=this.parent.windows[0].onWindowFocusOut.listeners,c=this.parent.windows[0].onWindowFocusOut.repeat,f=u.length,d=0;f>d;)u[d](),c[d]?d++:(this.parent.windows[0].onWindowFocusOut.remove(u[d]),f--)
for(var m=this.parent.windows[0].onWindowDeactivate.listeners,_=this.parent.windows[0].onWindowDeactivate.repeat,p=m.length,v=0;p>v;)m[v](),_[v]?v++:(this.parent.windows[0].onWindowDeactivate.remove(m[v]),p--)
break
case"resize":var g=this.parent.windows[0].__width,x=this.parent.windows[0].__height
if(this.parent.windows[0].backend.handleResize(),this.parent.windows[0].__width!=g||this.parent.windows[0].__height!=x)for(var y=this.parent.windows[0].onWindowResize.listeners,b=this.parent.windows[0].onWindowResize.repeat,w=y.length,S=0;w>S;)y[S](this.parent.windows[0].__width,this.parent.windows[0].__height),b[S]?S++:(this.parent.windows[0].onWindowResize.remove(y[S]),w--)
break
case"beforeunload":for(var M=this.parent.windows[0].onWindowClose.listeners,T=this.parent.windows[0].onWindowClose.repeat,C=M.length,A=0;C>A;)M[A](),T[A]?A++:(this.parent.windows[0].onWindowClose.remove(M[A]),C--)}}},setFrameRate:function(e){return e>=60?this.framePeriod=-1:e>0?this.framePeriod=1e3/e:this.framePeriod=1e3,e},__class__:Zi}
var qi=function(e){this.parent=e}
s["lime._backend.html5.HTML5Renderer"]=qi,qi.__name__=["lime","_backend","html5","HTML5Renderer"],qi.prototype={parent:null,create:function(){this.createContext()
var e=this.parent.context
switch(e[1]){case 0:this.parent.window.backend.canvas.addEventListener("webglcontextlost",r(this,this.handleEvent),!1),this.parent.window.backend.canvas.addEventListener("webglcontextrestored",r(this,this.handleEvent),!1)}},createContext:function(){if(null!=this.parent.window.backend.div)this.parent.context=xn.DOM(this.parent.window.backend.div)
else if(null!=this.parent.window.backend.canvas){var e={alpha:!0,antialias:Object.prototype.hasOwnProperty.call(this.parent.window.config,"antialiasing")?this.parent.window.config.antialiasing>0:!1,depth:Object.prototype.hasOwnProperty.call(this.parent.window.config,"depthBuffer")?this.parent.window.config.depthBuffer:!0,premultipliedAlpha:!0,stencil:Object.prototype.hasOwnProperty.call(this.parent.window.config,"stencilBuffer")?this.parent.window.config.stencilBuffer:!0,preserveDrawingBuffer:!1},t=Gi.getContextWebGL(this.parent.window.backend.canvas,e)
null==t?this.parent.context=xn.CANVAS(this.parent.window.backend.canvas.getContext("2d")):(En.context=t,this.parent.context=xn.OPENGL(En.context))}},flip:function(){},handleEvent:function(e){var t=e.type
switch(t){case"webglcontextlost":e.preventDefault(),this.parent.context=null
for(var i=this.parent.onRenderContextLost.listeners,n=this.parent.onRenderContextLost.repeat,r=i.length,s=0;r>s;)i[s](),n[s]?s++:(this.parent.onRenderContextLost.remove(i[s]),r--)
break
case"webglcontextrestored":this.createContext()
for(var o=this.parent.onRenderContextRestored.listeners,a=this.parent.onRenderContextRestored.repeat,l=o.length,h=0;l>h;)o[h](this.parent.context),a[h]?h++:(this.parent.onRenderContextRestored.remove(o[h]),l--)}},render:function(){},__class__:qi}
var Qi=function(e){this.parent=e,null!=e.config&&Object.prototype.hasOwnProperty.call(e.config,"element")&&(this.element=e.config.element)}
s["lime._backend.html5.HTML5Window"]=Qi,Qi.__name__=["lime","_backend","html5","HTML5Window"],Qi.prototype={canvas:null,div:null,element:null,enableTextEvents:null,parent:null,setHeight:null,setWidth:null,close:function(){},create:function(){if(this.setWidth=this.parent.__width,this.setHeight=this.parent.__height,Me.__instanceof(this.element,HTMLCanvasElement)?this.canvas=this.element:this.canvas=window.document.createElement("canvas"),null!=this.canvas){var e=this.canvas.style
e.setProperty("-webkit-transform","translateZ(0)",null),e.setProperty("transform","translateZ(0)",null)}else if(null!=this.div){var t=this.div.style
t.setProperty("-webkit-transform","translate3D(0,0,0)",null),t.setProperty("transform","translate3D(0,0,0)",null),t.position="relative",t.overflow="hidden",t.setProperty("-webkit-user-select","none",null),t.setProperty("-moz-user-select","none",null),t.setProperty("-ms-user-select","none",null),t.setProperty("-o-user-select","none",null)}if(0==this.parent.__width&&0==this.parent.__height&&(null!=this.element?(this.parent.set_width(this.element.clientWidth),this.parent.set_height(this.element.clientHeight)):(this.parent.set_width(window.innerWidth),this.parent.set_height(window.innerHeight)),this.parent.set_fullscreen(!0)),null!=this.canvas?(this.canvas.width=this.parent.__width,this.canvas.height=this.parent.__height):(this.div.style.width=this.parent.__width+"px",this.div.style.height=this.parent.__height+"px"),this.handleResize(),null!=this.element){null!=this.canvas?this.element!=this.canvas&&this.element.appendChild(this.canvas):this.element.appendChild(this.div)
for(var i=["mousedown","mouseenter","mouseleave","mousemove","mouseup","wheel"],n=0;n<i.length;){var s=i[n];++n,this.element.addEventListener(s,r(this,this.handleMouseEvent),!0)}window.document.addEventListener("dragstart",function(e){return"img"==e.target.nodeName.toLowerCase()?(e.preventDefault(),!1):!0},!1),this.element.addEventListener("touchstart",r(this,this.handleTouchEvent),!0),this.element.addEventListener("touchmove",r(this,this.handleTouchEvent),!0),this.element.addEventListener("touchend",r(this,this.handleTouchEvent),!0)}},getEnableTextEvents:function(){return this.enableTextEvents},handleMouseEvent:function(e){var t=0,i=0
if("wheel"!=e.type){if(null!=this.element)if(null!=this.canvas){var n=this.canvas.getBoundingClientRect()
t=(e.clientX-n.left)*(this.parent.__width/n.width),i=(e.clientY-n.top)*(this.parent.__height/n.height)}else if(null!=this.div){var r=this.div.getBoundingClientRect()
t=e.clientX-r.left,i=e.clientY-r.top}else{var s=this.element.getBoundingClientRect()
t=(e.clientX-s.left)*(this.parent.__width/s.width),i=(e.clientY-s.top)*(this.parent.__height/s.height)}else t=e.clientX,i=e.clientY
var o=e.type
switch(o){case"mousedown":for(var a=this.parent.onMouseDown.listeners,l=this.parent.onMouseDown.repeat,h=a.length,u=0;h>u;)a[u](t,i,e.button),l[u]?u++:(this.parent.onMouseDown.remove(a[u]),h--)
break
case"mouseenter":for(var c=this.parent.onWindowEnter.listeners,f=this.parent.onWindowEnter.repeat,d=c.length,m=0;d>m;)c[m](),f[m]?m++:(this.parent.onWindowEnter.remove(c[m]),d--)
break
case"mouseleave":for(var _=this.parent.onWindowLeave.listeners,p=this.parent.onWindowLeave.repeat,v=_.length,g=0;v>g;)_[g](),p[g]?g++:(this.parent.onWindowLeave.remove(_[g]),v--)
break
case"mouseup":for(var x=this.parent.onMouseUp.listeners,y=this.parent.onMouseUp.repeat,b=x.length,w=0;b>w;)x[w](t,i,e.button),y[w]?w++:(this.parent.onMouseUp.remove(x[w]),b--)
break
case"mousemove":for(var S=this.parent.onMouseMove.listeners,M=this.parent.onMouseMove.repeat,T=S.length,C=0;T>C;)S[C](t,i),M[C]?C++:(this.parent.onMouseMove.remove(S[C]),T--)}}else for(var A=this.parent.onMouseWheel.listeners,I=this.parent.onMouseWheel.repeat,P=A.length,E=0;P>E;)A[E](e.deltaX,-e.deltaY),I[E]?E++:(this.parent.onMouseWheel.remove(A[E]),P--)},handleResize:function(){var e=this.parent.__fullscreen||0==this.setWidth&&0==this.setHeight
if(null!=this.element&&(null==this.div||null!=this.div&&e))if(e)(this.parent.__width!=this.element.clientWidth||this.parent.__height!=this.element.clientHeight)&&(this.parent.set_width(this.element.clientWidth),this.parent.set_height(this.element.clientHeight),null!=this.canvas?this.element!=this.canvas&&(this.canvas.width=this.element.clientWidth,this.canvas.height=this.element.clientHeight):(this.div.style.width=this.element.clientWidth+"px",this.div.style.height=this.element.clientHeight+"px"))
else{var t=this.element.clientWidth/this.setWidth,i=this.element.clientHeight/this.setHeight,n=Math.min(t,i)
null!=this.canvas?this.element!=this.canvas&&(this.canvas.style.width=this.setWidth*n+"px",this.canvas.style.height=this.setHeight*n+"px",this.canvas.style.marginLeft=(this.element.clientWidth-this.setWidth*n)/2+"px",this.canvas.style.marginTop=(this.element.clientHeight-this.setHeight*n)/2+"px"):(this.div.style.width=this.setWidth*n+"px",this.div.style.height=this.setHeight*n+"px",this.div.style.marginLeft=(this.element.clientWidth-this.setWidth*n)/2+"px",this.div.style.marginTop=(this.element.clientHeight-this.setHeight*n)/2+"px")}},handleTouchEvent:function(e){e.preventDefault()
var t=e.changedTouches[0],i=t.identifier,n=0,r=0
if(null!=this.element)if(null!=this.canvas){var s=this.canvas.getBoundingClientRect()
n=(t.clientX-s.left)*(this.parent.__width/s.width),r=(t.clientY-s.top)*(this.parent.__height/s.height)}else if(null!=this.div){var o=this.div.getBoundingClientRect()
n=t.clientX-o.left,r=t.clientY-o.top}else{var a=this.element.getBoundingClientRect()
n=(t.clientX-a.left)*(this.parent.__width/a.width),r=(t.clientY-a.top)*(this.parent.__height/a.height)}else n=t.clientX,r=t.clientY
var l=e.type
switch(l){case"touchstart":for(var h=this.parent.onTouchStart.listeners,u=this.parent.onTouchStart.repeat,c=h.length,f=0;c>f;)h[f](n,r,i),u[f]?f++:(this.parent.onTouchStart.remove(h[f]),c--)
break
case"touchmove":for(var d=this.parent.onTouchMove.listeners,m=this.parent.onTouchMove.repeat,_=d.length,p=0;_>p;)d[p](n,r,i),m[p]?p++:(this.parent.onTouchMove.remove(d[p]),_--)
break
case"touchend":for(var v=this.parent.onTouchEnd.listeners,g=this.parent.onTouchEnd.repeat,x=v.length,y=0;x>y;)v[y](n,r,i),g[y]?y++:(this.parent.onTouchEnd.remove(v[y]),x--)}},move:function(){},resize:function(){},setEnableTextEvents:function(e){return this.enableTextEvents=e},setFullscreen:function(){return!1},setIcon:function(){},setMinimized:function(){return!1},__class__:Qi}
var Ji=function(){this.listeners=[],this.priorities=[],this.repeat=[]}
s["lime.app.Event"]=Ji,Ji.__name__=["lime","app","Event"],Ji.prototype={listeners:null,repeat:null,priorities:null,add:function(e,t,i){null==i&&(i=0),null==t&&(t=!1)
for(var n=0,r=this.priorities.length;r>n;){var s=n++
if(i>this.priorities[s])return this.listeners.splice(s,0,e),this.priorities.splice(s,0,i),void this.repeat.splice(s,0,!t)}this.listeners.push(e),this.priorities.push(i),this.repeat.push(!t)},remove:function(e){var t=c.indexOf(this.listeners,e,0)
t>-1&&(this.listeners.splice(t,1),this.priorities.splice(t,1),this.repeat.splice(t,1))},__class__:Ji}
var $i=function(){this.total=0,this.loaded=0}
s["lime.app.Preloader"]=$i,$i.__name__=["lime","app","Preloader"],$i.prototype={complete:null,onComplete:null,loaded:null,total:null,create:function(){},load:function(e,t){for(var i=null,n=0,s=e.length;s>n;){var o=n++
i=e[o]
var a=t[o]
switch(a){case"IMAGE":var l=new Image
$i.images.set(i,l),l.onload=r(this,this.image_onLoad),l.src=i,this.total++
break
case"BINARY":var h=new kn
h.set_dataFormat(Vn.BINARY),$i.loaders.set(i,h),this.total++
break
case"TEXT":var u=new kn
$i.loaders.set(i,u),this.total++
break
case"FONT":this.total++,this.loadFont(i)}}for(var c=$i.loaders.keys();c.hasNext();){var f=c.next(),d=$i.loaders.get(f)
d.onComplete.add(r(this,this.loader_onComplete)),d.load(new Nn(f))}0==this.total&&this.start()},loadFont:function(e){var t=this
if(window.document.fonts&&(Ps=window.document.fonts,r(Ps,Ps.load)))window.document.fonts.load("1em '"+e+"'").then(function(){t.loaded++,t.update(t.loaded,t.total),t.loaded==t.total&&t.start()})
else{var i=window.document.createElement("span")
i.innerHTML="giItT1WQy@!-/#"
var n=i.style
n.position="absolute",n.left="-10000px",n.top="-10000px",n.fontSize="300px",n.fontFamily="sans-serif",n.fontVariant="normal",n.fontStyle="normal",n.fontWeight="normal",n.letterSpacing="0",window.document.body.appendChild(i)
var s=i.offsetWidth
n.fontFamily="'"+e+"', sans-serif"
var o=null,a=!1,l=function(){return i.offsetWidth!=s?a?(t.loaded++,null!=o&&window.clearInterval(o),i.parentNode.removeChild(i),i=null,t.update(t.loaded,t.total),t.loaded==t.total&&t.start(),!0):(a=!0,!1):!1}
l()||(o=window.setInterval(l,50))}},start:function(){null!=this.onComplete&&this.onComplete()},update:function(){},image_onLoad:function(){this.loaded++,this.update(this.loaded,this.total),this.loaded==this.total&&this.start()},loader_onComplete:function(){this.loaded++,this.update(this.loaded,this.total),this.loaded==this.total&&this.start()},__class__:$i}
var en=function(){this.EXPONENT_DISTANCE_CLAMPED=53254,this.EXPONENT_DISTANCE=53253,this.LINEAR_DISTANCE_CLAMPED=53252,this.LINEAR_DISTANCE=53251,this.INVERSE_DISTANCE_CLAMPED=53250,this.INVERSE_DISTANCE=53249,this.DISTANCE_MODEL=53248,this.DOPPLER_VELOCITY=49153,this.SPEED_OF_SOUND=49155,this.DOPPLER_FACTOR=49152,this.EXTENSIONS=45060,this.RENDERER=45059,this.VERSION=45058,this.VENDOR=45057,this.OUT_OF_MEMORY=40965,this.INVALID_OPERATION=40964,this.INVALID_VALUE=40963,this.INVALID_ENUM=40962,this.INVALID_NAME=40961,this.NO_ERROR=0,this.SIZE=8196,this.CHANNELS=8195,this.BITS=8194,this.FREQUENCY=8193,this.FORMAT_STEREO16=4355,this.FORMAT_STEREO8=4354,this.FORMAT_MONO16=4353,this.FORMAT_MONO8=4352,this.UNDETERMINED=4144,this.STREAMING=4137,this.STATIC=4136,this.SOURCE_TYPE=4135,this.BYTE_OFFSET=4134,this.SAMPLE_OFFSET=4133,this.SEC_OFFSET=4132,this.MAX_DISTANCE=4131,this.CONE_OUTER_GAIN=4130,this.ROLLOFF_FACTOR=4129,this.REFERENCE_DISTANCE=4128,this.BUFFERS_PROCESSED=4118,this.BUFFERS_QUEUED=4117,this.STOPPED=4116,this.PAUSED=4115,this.PLAYING=4114,this.INITIAL=4113,this.SOURCE_STATE=4112,this.ORIENTATION=4111,this.MAX_GAIN=4110,this.MIN_GAIN=4109,this.GAIN=4106,this.BUFFER=4105,this.LOOPING=4103,this.VELOCITY=4102,this.DIRECTION=4101,this.POSITION=4100,this.PITCH=4099,this.CONE_OUTER_ANGLE=4098,this.CONE_INNER_ANGLE=4097,this.SOURCE_RELATIVE=514,this.TRUE=1,this.FALSE=0,this.NONE=0}
s["lime.audio.ALAudioContext"]=en,en.__name__=["lime","audio","ALAudioContext"],en.prototype={NONE:null,FALSE:null,TRUE:null,SOURCE_RELATIVE:null,CONE_INNER_ANGLE:null,CONE_OUTER_ANGLE:null,PITCH:null,POSITION:null,DIRECTION:null,VELOCITY:null,LOOPING:null,BUFFER:null,GAIN:null,MIN_GAIN:null,MAX_GAIN:null,ORIENTATION:null,SOURCE_STATE:null,INITIAL:null,PLAYING:null,PAUSED:null,STOPPED:null,BUFFERS_QUEUED:null,BUFFERS_PROCESSED:null,REFERENCE_DISTANCE:null,ROLLOFF_FACTOR:null,CONE_OUTER_GAIN:null,MAX_DISTANCE:null,SEC_OFFSET:null,SAMPLE_OFFSET:null,BYTE_OFFSET:null,SOURCE_TYPE:null,STATIC:null,STREAMING:null,UNDETERMINED:null,FORMAT_MONO8:null,FORMAT_MONO16:null,FORMAT_STEREO8:null,FORMAT_STEREO16:null,FREQUENCY:null,BITS:null,CHANNELS:null,SIZE:null,NO_ERROR:null,INVALID_NAME:null,INVALID_ENUM:null,INVALID_VALUE:null,INVALID_OPERATION:null,OUT_OF_MEMORY:null,VENDOR:null,VERSION:null,RENDERER:null,EXTENSIONS:null,DOPPLER_FACTOR:null,SPEED_OF_SOUND:null,DOPPLER_VELOCITY:null,DISTANCE_MODEL:null,INVERSE_DISTANCE:null,INVERSE_DISTANCE_CLAMPED:null,LINEAR_DISTANCE:null,LINEAR_DISTANCE_CLAMPED:null,EXPONENT_DISTANCE:null,EXPONENT_DISTANCE_CLAMPED:null,bufferData:function(e,t,i,n,r){hn.bufferData(e,t,i,n,r)},buffer3f:function(e,t,i,n,r){hn.buffer3f(e,t,i,n,r)},buffer3i:function(e,t,i,n,r){hn.buffer3i(e,t,i,n,r)},bufferf:function(e,t,i){hn.bufferf(e,t,i)},bufferfv:function(e,t,i){hn.bufferfv(e,t,i)},bufferi:function(e,t,i){hn.bufferi(e,t,i)},bufferiv:function(e,t,i){hn.bufferiv(e,t,i)},deleteBuffer:function(e){hn.deleteBuffer(e)},deleteBuffers:function(e){hn.deleteBuffers(e)},deleteSource:function(e){hn.deleteSource(e)},deleteSources:function(e){hn.deleteSources(e)},disable:function(e){hn.disable(e)},distanceModel:function(e){hn.distanceModel(e)},dopplerFactor:function(e){hn.dopplerFactor(e)},dopplerVelocity:function(e){hn.dopplerVelocity(e)},enable:function(e){hn.enable(e)},genSource:function(){return hn.genSource()},genSources:function(e){return hn.genSources(e)},genBuffer:function(){return hn.genBuffer()},genBuffers:function(e){return hn.genBuffers(e)},getBoolean:function(e){return hn.getBoolean(e)},getBooleanv:function(e,t){return null==t&&(t=1),hn.getBooleanv(e,t)},getBuffer3f:function(e,t){return hn.getBuffer3f(e,t)},getBuffer3i:function(e,t){return hn.getBuffer3i(e,t)},getBufferf:function(e,t){return hn.getBufferf(e,t)},getBufferfv:function(e,t,i){return null==i&&(i=1),hn.getBufferfv(e,t,i)},getBufferi:function(e,t){return hn.getBufferi(e,t)},getBufferiv:function(e,t,i){return null==i&&(i=1),hn.getBufferiv(e,t,i)},getDouble:function(e){return hn.getDouble(e)},getDoublev:function(e,t){return null==t&&(t=1),hn.getDoublev(e,t)},getEnumValue:function(e){return hn.getEnumValue(e)},getError:function(){return hn.getError()},getErrorString:function(){return hn.getErrorString()},getFloat:function(e){return hn.getFloat(e)},getFloatv:function(e,t){return null==t&&(t=1),hn.getFloatv(e,t)},getInteger:function(e){return hn.getInteger(e)},getIntegerv:function(e,t){return null==t&&(t=1),hn.getIntegerv(e,t)},getListener3f:function(e){return hn.getListener3f(e)},getListener3i:function(e){return hn.getListener3i(e)},getListenerf:function(e){return hn.getListenerf(e)},getListenerfv:function(e,t){return null==t&&(t=1),hn.getListenerfv(e,t)},getListeneri:function(e){return hn.getListeneri(e)},getListeneriv:function(e,t){return null==t&&(t=1),hn.getListeneriv(e,t)},getProcAddress:function(e){return hn.getProcAddress(e)},getSource3f:function(e,t){return hn.getSource3f(e,t)},getSourcef:function(e,t){return hn.getSourcef(e,t)},getSource3i:function(e,t){return hn.getSource3i(e,t)},getSourcefv:function(e,t){return hn.getSourcefv(e,t)},getSourcei:function(e,t){return hn.getSourcei(e,t)},getSourceiv:function(e,t,i){return null==i&&(i=1),hn.getSourceiv(e,t,i)},getString:function(e){return hn.getString(e)},isBuffer:function(e){return hn.isBuffer(e)},isEnabled:function(e){return hn.isEnabled(e)},isExtensionPresent:function(e){return hn.isExtensionPresent(e)},isSource:function(e){return hn.isSource(e)},listener3f:function(e,t,i,n){hn.listener3f(e,t,i,n)},listener3i:function(e,t,i,n){hn.listener3i(e,t,i,n)},listenerf:function(e,t){hn.listenerf(e,t)},listenerfv:function(e,t){hn.listenerfv(e,t)},listeneri:function(e,t){hn.listeneri(e,t)},listeneriv:function(e,t){hn.listeneriv(e,t)},source3f:function(e,t,i,n,r){hn.source3f(e,t,i,n,r)},source3i:function(e,t,i,n,r){hn.source3i(e,t,i,n,r)},sourcef:function(e,t,i){hn.sourcef(e,t,i)},sourcefv:function(e,t,i){hn.sourcefv(e,t,i)},sourcei:function(e,t,i){hn.sourcei(e,t,i)},sourceiv:function(e,t,i){hn.sourceiv(e,t,i)},sourcePlay:function(e){hn.sourcePlay(e)},sourcePlayv:function(e){hn.sourcePlayv(e)},sourceStop:function(e){hn.sourceStop(e)},sourceStopv:function(e){hn.sourceStopv(e)},sourceRewind:function(e){hn.sourceRewind(e)},sourceRewindv:function(e){hn.sourceRewindv(e)},sourcePause:function(e){hn.sourcePause(e)},sourcePausev:function(e){hn.sourcePausev(e)},sourceQueueBuffer:function(e,t){hn.sourceQueueBuffer(e,t)},sourceQueueBuffers:function(e,t,i){hn.sourceQueueBuffers(e,t,i)},sourceUnqueueBuffer:function(e){return hn.sourceUnqueueBuffer(e)},sourceUnqueueBuffers:function(e,t){return hn.sourceUnqueueBuffers(e,t)},speedOfSound:function(e){hn.speedOfSound(e)},__class__:en}
var tn=function(){this.ALL_DEVICES_SPECIFIER=4115,this.DEFAULT_ALL_DEVICES_SPECIFIER=4114,this.ENUMERATE_ALL_EXT=1,this.EXTENSIONS=4102,this.DEVICE_SPECIFIER=4101,this.DEFAULT_DEVICE_SPECIFIER=4100,this.ALL_ATTRIBUTES=4099,this.ATTRIBUTES_SIZE=4098,this.OUT_OF_MEMORY=40965,this.INVALID_VALUE=40964,this.INVALID_ENUM=40963,this.INVALID_CONTEXT=40962,this.INVALID_DEVICE=40961,this.NO_ERROR=0,this.STEREO_SOURCES=4113,this.MONO_SOURCES=4112,this.SYNC=4105,this.REFRESH=4104,this.FREQUENCY=4103,this.TRUE=1,this.FALSE=0}
s["lime.audio.ALCAudioContext"]=tn,tn.__name__=["lime","audio","ALCAudioContext"],tn.prototype={FALSE:null,TRUE:null,FREQUENCY:null,REFRESH:null,SYNC:null,MONO_SOURCES:null,STEREO_SOURCES:null,NO_ERROR:null,INVALID_DEVICE:null,INVALID_CONTEXT:null,INVALID_ENUM:null,INVALID_VALUE:null,OUT_OF_MEMORY:null,ATTRIBUTES_SIZE:null,ALL_ATTRIBUTES:null,DEFAULT_DEVICE_SPECIFIER:null,DEVICE_SPECIFIER:null,EXTENSIONS:null,ENUMERATE_ALL_EXT:null,DEFAULT_ALL_DEVICES_SPECIFIER:null,ALL_DEVICES_SPECIFIER:null,closeDevice:function(e){return un.closeDevice(e)},createContext:function(e,t){return un.createContext(e,t)},destroyContext:function(e){un.destroyContext(e)},getContextsDevice:function(e){return un.getContextsDevice(e)},getCurrentContext:function(){return un.getCurrentContext()},getError:function(e){return un.getError(e)},getErrorString:function(e){return un.getErrorString(e)},getIntegerv:function(e,t,i){return null==i&&(i=1),un.getIntegerv(e,t,i)},getString:function(e,t){return un.getString(e,t)},makeContextCurrent:function(e){return un.makeContextCurrent(e)},openDevice:function(e){return un.openDevice(e)},processContext:function(e){un.processContext(e)},suspendContext:function(e){un.suspendContext(e)},__class__:tn}
var nn=function(){this.id=0}
s["lime.audio.AudioBuffer"]=nn,nn.__name__=["lime","audio","AudioBuffer"],nn.fromBytes=function(){return null},nn.fromFile=function(){return null},nn.fromURL=function(){},nn.prototype={bitsPerSample:null,channels:null,data:null,id:null,sampleRate:null,src:null,dispose:function(){},__class__:nn}
var rn=s["lime.audio.AudioContext"]={__ename__:!0,__constructs__:["OPENAL","HTML5","WEB","FLASH","CUSTOM"]}
rn.OPENAL=function(e,t){var i=["OPENAL",0,e,t]
return i.__enum__=rn,i.toString=o,i},rn.HTML5=function(e){var t=["HTML5",1,e]
return t.__enum__=rn,t.toString=o,t},rn.WEB=function(e){var t=["WEB",2,e]
return t.__enum__=rn,t.toString=o,t},rn.FLASH=function(e){var t=["FLASH",3,e]
return t.__enum__=rn,t.toString=o,t},rn.CUSTOM=function(e){var t=["CUSTOM",4,e]
return t.__enum__=rn,t.toString=o,t}
var sn=function(){}
s["lime.audio.AudioManager"]=sn,sn.__name__=["lime","audio","AudioManager"],sn.init=function(e){if(null==sn.context)if(null==e)try{window.AudioContext=window.AudioContext||window.webkitAudioContext,sn.context=rn.WEB(new AudioContext)}catch(t){t instanceof Wi&&(t=t.val),sn.context=rn.HTML5(new ln)}else sn.context=e},sn.resume=function(){if(null!=sn.context){var e=sn.context
switch(e[1]){case 0:var t=(e[3],e[2])
t.processContext(t.getCurrentContext())}}},sn.shutdown=function(){if(null!=sn.context){var e=sn.context
switch(e[1]){case 0:var t=(e[3],e[2]),i=t.getCurrentContext()
if(null!=i){var n=t.getContextsDevice(i)
t.makeContextCurrent(null),t.destroyContext(i),t.closeDevice(n)}}}},sn.suspend=function(){if(null!=sn.context){var e=sn.context
switch(e[1]){case 0:var t=(e[3],e[2])
t.suspendContext(t.getCurrentContext())}}}
var on=function(e,t,i,n){null==n&&(n=0),null==t&&(t=0),this.onComplete=new Ji,this.buffer=e,this.offset=t,null!=i&&0!=i&&this.set_length(i),this.loops=n,this.id=0,null!=e&&this.init()}
s["lime.audio.AudioSource"]=on,on.__name__=["lime","audio","AudioSource"],on.prototype={onComplete:null,buffer:null,loops:null,offset:null,id:null,playing:null,pauseTime:null,__length:null,dispose:function(){var e=sn.context
switch(e[1]){case 0:var t=e[3]
e[2]
0!=this.id&&t.deleteSource(this.id)}},init:function(){var e=sn.context
switch(e[1]){case 0:var t=e[3]
e[2]
if(0==this.buffer.id){this.buffer.id=t.genBuffer()
var i=0
1==this.buffer.channels?8==this.buffer.bitsPerSample?i=t.FORMAT_MONO8:16==this.buffer.bitsPerSample&&(i=t.FORMAT_MONO16):2==this.buffer.channels&&(8==this.buffer.bitsPerSample?i=t.FORMAT_STEREO8:16==this.buffer.bitsPerSample&&(i=t.FORMAT_STEREO16)),t.bufferData(this.buffer.id,i,this.buffer.data,this.buffer.data.length,this.buffer.sampleRate)}this.id=t.genSource(),t.sourcei(this.id,t.BUFFER,this.buffer.id)}},play:function(){},pause:function(){},stop:function(){},timer_onRun:function(){},get_currentTime:function(){return 0},set_currentTime:function(e){return this.pauseTime=e},get_gain:function(){return 1},set_gain:function(){return 1},get_length:function(){return null!=this.__length?this.__length:0},set_length:function(e){return this.__length=e},__class__:on,__properties__:{set_length:"set_length",get_length:"get_length",set_gain:"set_gain",get_gain:"get_gain",set_currentTime:"set_currentTime",get_currentTime:"get_currentTime"}}
var an=function(){}
s["lime.audio.FlashAudioContext"]=an,an.__name__=["lime","audio","FlashAudioContext"],an.prototype={createBuffer:function(){return null},getBytesLoaded:function(){return 0},getBytesTotal:function(){return 0},getID3:function(){return null},getIsBuffering:function(){return!1},getIsURLInaccessible:function(){return!1},getLength:function(){return 0},getURL:function(){return null},close:function(){},extract:function(e,t,i,n){return null==n&&(n=-1),0},load:function(){},loadCompressedDataFromByteArray:function(){},loadPCMFromByteArray:function(e,t,i,n,r,s){null==s&&(s=44100),null==r&&(r=!0)},play:function(e,t,i){return null==i&&(i=0),null==t&&(t=0),null},__class__:an}
var ln=function(){this.NETWORK_NO_SOURCE=3,this.NETWORK_LOADING=2,this.NETWORK_IDLE=1,this.NETWORK_EMPTY=0,this.HAVE_NOTHING=0,this.HAVE_METADATA=1,this.HAVE_FUTURE_DATA=3,this.HAVE_ENOUGH_DATA=4,this.HAVE_CURRENT_DATA=2}
s["lime.audio.HTML5AudioContext"]=ln,ln.__name__=["lime","audio","HTML5AudioContext"],ln.prototype={HAVE_CURRENT_DATA:null,HAVE_ENOUGH_DATA:null,HAVE_FUTURE_DATA:null,HAVE_METADATA:null,HAVE_NOTHING:null,NETWORK_EMPTY:null,NETWORK_IDLE:null,NETWORK_LOADING:null,NETWORK_NO_SOURCE:null,canPlayType:function(e,t){return null!=e.src?e.src.canPlayType(t):null},createBuffer:function(e){var t=new nn
return t.src=new Audio,t.src.src=e,t},getAutoplay:function(e){return null!=e.src?e.src.autoplay:!1},getBuffered:function(e){return null!=e.src?e.src.buffered:null},getCurrentSrc:function(e){return null!=e.src?e.src.currentSrc:null},getCurrentTime:function(e){return null!=e.src?e.src.currentTime:0},getDefaultPlaybackRate:function(e){return null!=e.src?e.src.defaultPlaybackRate:1},getDuration:function(e){return null!=e.src?e.src.duration:0},getEnded:function(e){return null!=e.src?e.src.ended:!1},getError:function(e){return null!=e.src?e.src.error:null},getLoop:function(e){return null!=e.src?e.src.loop:!1},getMuted:function(e){return null!=e.src?e.src.muted:!1},getNetworkState:function(e){return null!=e.src?e.src.networkState:0},getPaused:function(e){return null!=e.src?e.src.paused:!1},getPlaybackRate:function(e){return null!=e.src?e.src.playbackRate:1},getPlayed:function(e){return null!=e.src?e.src.played:null},getPreload:function(e){return null!=e.src?e.src.preload:null},getReadyState:function(e){return null!=e.src?e.src.readyState:0},getSeekable:function(e){return null!=e.src?e.src.seekable:null},getSeeking:function(e){return null!=e.src?e.src.seeking:!1},getSrc:function(e){return null!=e.src?e.src.src:null},getStartTime:function(e){return null!=e.src?e.src.playbackRate:0},getVolume:function(e){return null!=e.src?e.src.volume:1},load:function(e){return null!=e.src?e.src.load():void 0},pause:function(e){return null!=e.src?e.src.pause():void 0},play:function(e){return null!=e.src?e.src.play():void 0},setAutoplay:function(e,t){null!=e.src&&(e.src.autoplay=t)},setCurrentTime:function(e,t){null!=e.src&&(e.src.currentTime=t)},setDefaultPlaybackRate:function(e,t){null!=e.src&&(e.src.defaultPlaybackRate=t)},setLoop:function(e,t){null!=e.src&&(e.src.loop=t)},setMuted:function(e,t){null!=e.src&&(e.src.muted=t)},setPlaybackRate:function(e,t){null!=e.src&&(e.src.playbackRate=t)},setPreload:function(e,t){null!=e.src&&(e.src.preload=t)},setSrc:function(e,t){null!=e.src&&(e.src.src=t)},setVolume:function(e,t){null!=e.src&&(e.src.volume=t)},__class__:ln}
var hn=function(){}
s["lime.audio.openal.AL"]=hn,hn.__name__=["lime","audio","openal","AL"],hn.bufferData=function(){},hn.buffer3f=function(){},hn.buffer3i=function(){},hn.bufferf=function(){},hn.bufferfv=function(){},hn.bufferi=function(){},hn.bufferiv=function(){},hn.deleteBuffer=function(){},hn.deleteBuffers=function(){},hn.deleteSource=function(){},hn.deleteSources=function(){},hn.disable=function(){},hn.distanceModel=function(){},hn.dopplerFactor=function(){},hn.dopplerVelocity=function(){},hn.enable=function(){},hn.genSource=function(){return 0},hn.genSources=function(){return null},hn.genBuffer=function(){return 0},hn.genBuffers=function(){return null},hn.getBoolean=function(){return!1},hn.getBooleanv=function(e,t){return null==t&&(t=1),null},hn.getBuffer3f=function(){return null},hn.getBuffer3i=function(){return null},hn.getBufferf=function(){return 0},hn.getBufferfv=function(e,t,i){return null==i&&(i=1),null},hn.getBufferi=function(){return 0},hn.getBufferiv=function(e,t,i){return null==i&&(i=1),null},hn.getDouble=function(){return 0},hn.getDoublev=function(e,t){return null==t&&(t=1),null},hn.getEnumValue=function(){return 0},hn.getError=function(){return 0},hn.getErrorString=function(){var e=hn.getError()
switch(e){case 40961:return"INVALID_NAME: Invalid parameter name"
case 40962:return"INVALID_ENUM: Invalid enum value"
case 40963:return"INVALID_VALUE: Invalid parameter value"
case 40964:return"INVALID_OPERATION: Illegal operation or call"
case 40965:return"OUT_OF_MEMORY: OpenAL has run out of memory"
default:return""}},hn.getFloat=function(){return 0},hn.getFloatv=function(e,t){return null==t&&(t=1),null},hn.getInteger=function(){return 0},hn.getIntegerv=function(e,t){return null==t&&(t=1),null},hn.getListener3f=function(){return null},hn.getListener3i=function(){return null},hn.getListenerf=function(){return 0},hn.getListenerfv=function(e,t){return null==t&&(t=1),null},hn.getListeneri=function(){return 0},hn.getListeneriv=function(e,t){return null==t&&(t=1),null},hn.getProcAddress=function(){return null},hn.getSource3f=function(){return null},hn.getSourcef=function(){return 0},hn.getSource3i=function(){return null},hn.getSourcefv=function(){return null},hn.getSourcei=function(){return 0},hn.getSourceiv=function(e,t,i){return null==i&&(i=1),null},hn.getString=function(){return null},hn.isBuffer=function(){return!1},hn.isEnabled=function(){return!1},hn.isExtensionPresent=function(){return!1},hn.isSource=function(){return!1},hn.listener3f=function(){},hn.listener3i=function(){},hn.listenerf=function(){},hn.listenerfv=function(){},hn.listeneri=function(){},hn.listeneriv=function(){},hn.source3f=function(){},hn.source3i=function(){},hn.sourcef=function(){},hn.sourcefv=function(){},hn.sourcei=function(){},hn.sourceiv=function(){},hn.sourcePlay=function(){},hn.sourcePlayv=function(){},hn.sourceStop=function(){},hn.sourceStopv=function(){},hn.sourceRewind=function(){},hn.sourceRewindv=function(){},hn.sourcePause=function(){},hn.sourcePausev=function(){},hn.sourceQueueBuffer=function(){},hn.sourceQueueBuffers=function(){},hn.sourceUnqueueBuffer=function(){return 0},hn.sourceUnqueueBuffers=function(){return null},hn.speedOfSound=function(){}
var un=function(){}
s["lime.audio.openal.ALC"]=un,un.__name__=["lime","audio","openal","ALC"],un.closeDevice=function(){return!1},un.createContext=function(){return null},un.destroyContext=function(){},un.getContextsDevice=function(){return null},un.getCurrentContext=function(){return null},un.getError=function(){return 0},un.getErrorString=function(e){var t=un.getError(e)
switch(t){case 40961:return"INVALID_DEVICE: Invalid device (or no device?)"
case 40962:return"INVALID_CONTEXT: Invalid context (or no context?)"
case 40963:return"INVALID_ENUM: Invalid enum value"
case 40964:return"INVALID_VALUE: Invalid param value"
case 40965:return"OUT_OF_MEMORY: OpenAL has run out of memory"
default:return""}},un.getIntegerv=function(){return null},un.getString=function(){return null},un.makeContextCurrent=function(){return!1},un.openDevice=function(){return null},un.processContext=function(){},un.suspendContext=function(){}
var cn={}
s["lime.audio.openal._ALContext.ALContext_Impl_"]=cn,cn.__name__=["lime","audio","openal","_ALContext","ALContext_Impl_"],cn._new=function(e){return e}
var fn={}
s["lime.audio.openal._ALDevice.ALDevice_Impl_"]=fn,fn.__name__=["lime","audio","openal","_ALDevice","ALDevice_Impl_"],fn._new=function(e){return e}
var dn=function(){}
s["lime.graphics.ConsoleRenderContext"]=dn,dn.__name__=["lime","graphics","ConsoleRenderContext"],dn.prototype={clear:function(){},clearColor:function(){},clearDepth:function(){},clearStencil:function(){},__class__:dn}
var mn=function(){}
s["lime.graphics.FlashRenderContext"]=mn,mn.__name__=["lime","graphics","FlashRenderContext"],mn.prototype={accessibilityImplementation:null,accessibilityProperties:null,alpha:null,blendMode:null,blendShader:null,buttonMode:null,cacheAsBitmap:null,contextMenu:null,doubleClickEnabled:null,dropTarget:null,filters:null,focusRect:null,graphics:null,height:null,hitArea:null,loaderInfo:null,mask:null,mouseChildren:null,mouseEnabled:null,mouseX:null,mouseY:null,name:null,needsSoftKeyboard:null,numChildren:null,opaqueBackground:null,parent:null,root:null,rotation:null,rotationX:null,rotationY:null,rotationZ:null,scale9Grid:null,scaleX:null,scaleY:null,scaleZ:null,scrollRect:null,softKeyboardInputAreaOfInterest:null,soundTransform:null,stage:null,tabChildren:null,tabEnabled:null,tabIndex:null,textSnapshot:null,transform:null,useHandCursor:null,visible:null,width:null,x:null,y:null,z:null,addChild:function(){return null},addChildAt:function(){return null},addEventListener:function(e,t,i,n,r){null==r&&(r=!1),null==n&&(n=0),null==i&&(i=!1)},areInaccessibleObjectsUnderPoint:function(){return!1},contains:function(){return!1},dispatchEvent:function(){return!1},getBounds:function(){return null},getChildAt:function(){return null},getChildByName:function(){return null},getChildIndex:function(){return 0},getObjectsUnderPoint:function(){return null},getRect:function(){return null},globalToLocal:function(){return null},globalToLocal3D:function(){return null},hasEventListener:function(){return!1},hitTestObject:function(){return!1},hitTestPoint:function(e,t,i){return null==i&&(i=!1),!1},local3DToGlobal:function(){return null},localToGlobal:function(){return null},removeChild:function(){return null},removeChildAt:function(){return null},removeChildren:function(e,t){null==t&&(t=2147483647),null==e&&(e=0)},removeEventListener:function(e,t,i){null==i&&(i=!1)},requestSoftKeyboard:function(){return!1},setChildIndex:function(){},startDrag:function(e){null==e&&(e=!1)},startTouchDrag:function(e,t){null==t&&(t=!1)},stopAllMovieClips:function(){},stopDrag:function(){},stopTouchDrag:function(){},swapChildren:function(){},swapChildrenAt:function(){},toString:function(){return null},willTrigger:function(){return!1},__class__:mn}
var _n=function(e,t,i,n,r,s,o){if(null==r&&(r=-1),null==n&&(n=-1),null==i&&(i=0),null==t&&(t=0),this.offsetX=t,this.offsetY=i,this.width=n,this.height=r,null==o)if(null!=_.current&&null!=_.current.renderers[0]){var a=_.current.renderers[0].context
switch(a[1]){case 2:case 1:this.type=gn.CANVAS
break
case 3:this.type=gn.FLASH
break
default:this.type=gn.DATA}}else this.type=gn.DATA
else this.type=o
if(null==e){if(n>0&&r>0){var l=this.type
switch(l[1]){case 0:this.buffer=new pn(null,n,r),Dn.createCanvas(this,n,r),null!=s&&this.fillRect(new zn(0,0,n,r),s)
break
case 1:this.buffer=new pn(new Us(n*r*4),n,r),null!=s&&this.fillRect(new zn(0,0,n,r),s)
break
case 2:}}}else this.__fromImageBuffer(e)}
s["lime.graphics.Image"]=_n,_n.__name__=["lime","graphics","Image"],_n.fromBase64=function(e,t,i){if(null==e)return null
var n=new _n
return n.__fromBase64(e,t,i),n},_n.fromBitmapData=function(e){if(null==e)return null
var t=new pn(null,e.width,e.height)
return t.__srcBitmapData=e,new _n(t)},_n.fromBytes=function(e,t){if(null==e)return null
var i=new _n
return i.__fromBytes(e,t),i},_n.fromCanvas=function(e){if(null==e)return null
var t=new pn(null,e.width,e.height)
return t.set_src(e),new _n(t)},_n.fromFile=function(e,t,i){var n=new _n
return n.__fromFile(e,t,i),n},_n.fromImageElement=function(e){if(null==e)return null
var t=new pn(null,e.width,e.height)
return t.set_src(e),new _n(t)},_n.__base64Encode=function(e){var t,i=e.length%3
switch(i){case 1:t="=="
break
case 2:t="="
break
default:t=""}return null==_n.__base64Encoder&&(_n.__base64Encoder=new Li(Te.ofString(_n.__base64Chars))),""+_n.__base64Encoder.encodeBytes(Te.ofData(e.byteView))+t},_n.__isJPG=function(e){return e.position=0,255==e.readUnsignedByte()&&216==e.readUnsignedByte()},_n.__isPNG=function(e){return e.position=0,137==e.readUnsignedByte()&&80==e.readUnsignedByte()&&78==e.readUnsignedByte()&&71==e.readUnsignedByte()&&13==e.readUnsignedByte()&&10==e.readUnsignedByte()&&26==e.readUnsignedByte()&&10==e.readUnsignedByte()},_n.__isGIF=function(e){if(e.position=0,71==e.readUnsignedByte()&&73==e.readUnsignedByte()&&70==e.readUnsignedByte()&&56==e.readUnsignedByte()){var t=e.readUnsignedByte()
return(55==t||57==t)&&97==e.readUnsignedByte()}return!1},_n.prototype={buffer:null,dirty:null,height:null,offsetX:null,offsetY:null,rect:null,type:null,width:null,x:null,y:null,clone:function(){var e=new _n(this.buffer.clone(),this.offsetX,this.offsetY,this.width,this.height,null,this.type)
return e},colorTransform:function(e,t){if(e=this.__clipRect(e),null!=this.buffer&&null!=e){var i=this.type
switch(i[1]){case 0:Dn.colorTransform(this,e,t)
break
case 1:Dn.convertToData(this),Ln.colorTransform(this,e,t)
break
case 2:e.offset(this.offsetX,this.offsetY),this.buffer.__srcBitmapData.colorTransform(e.__toFlashRectangle(),Fn.__toFlashColorTransform(t))}}},copyChannel:function(e,t,i,n,r){if(t=this.__clipRect(t),null!=this.buffer&&null!=t&&(r!=vn.ALPHA||this.get_transparent())&&!(t.width<=0||t.height<=0)){t.x+t.width>e.width&&(t.width=e.width-t.x),t.y+t.height>e.height&&(t.height=e.height-t.y)
var s=this.type
switch(s[1]){case 0:Dn.copyChannel(this,e,t,i,n,r)
break
case 1:Dn.convertToData(this),Ln.copyChannel(this,e,t,i,n,r)
break
case 2:var o
switch(n[1]){case 0:o=1
break
case 1:o=2
break
case 2:o=4
break
case 3:o=8}var a
switch(r[1]){case 0:a=1
break
case 1:a=2
break
case 2:a=4
break
case 3:a=8}t.offset(e.offsetX,e.offsetY),i.offset(this.offsetX,this.offsetY),this.buffer.__srcBitmapData.copyChannel(e.buffer.get_src(),t.__toFlashRectangle(),i.__toFlashPoint(),o,a)}}},copyPixels:function(e,t,i,n,r,s){if(null==s&&(s=!1),null!=this.buffer&&null!=e&&!(t.width<=0||t.height<=0||this.width<=0||this.height<=0)){t.x+t.width>e.width&&(t.width=e.width-t.x),t.y+t.height>e.height&&(t.height=e.height-t.y),t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),i.x+t.width>this.width&&(t.width=this.width-i.x),i.y+t.height>this.height&&(t.height=this.height-i.y),i.x<0&&(t.width+=i.x,t.x=-i.x,i.x=0),i.y<0&&(t.height+=i.y,t.y=-i.y,i.y=0)
var o=this.type
switch(o[1]){case 0:Dn.convertToCanvas(this),Dn.copyPixels(this,e,t,i,n,r,s)
break
case 1:Dn.convertToData(this),Dn.convertToData(e),Ln.copyPixels(this,e,t,i,n,r,s)
break
case 2:t.offset(e.offsetX,e.offsetY),i.offset(this.offsetX,this.offsetY),null!=n&&null!=r&&r.offset(n.offsetX,n.offsetY),this.buffer.__srcBitmapData.copyPixels(e.buffer.__srcBitmapData,t.__toFlashRectangle(),i.__toFlashPoint(),null!=n?n.buffer.get_src():null,null!=r?r.__toFlashPoint():null,s)}}},encode:function(e,t){return null==t&&(t=90),null==e&&(e="png"),null},fillRect:function(e,t,i){if(e=this.__clipRect(e),null!=this.buffer&&null!=e){var n=this.type
switch(n[1]){case 0:Dn.fillRect(this,e,t,i)
break
case 1:Dn.convertToData(this),Ln.fillRect(this,e,t,i)
break
case 2:e.offset(this.offsetX,this.offsetY),(null==i||0==i)&&(t=(255&t)<<24|t>>8),this.buffer.__srcBitmapData.fillRect(e.__toFlashRectangle(),t)}}},floodFill:function(e,t,i,n){if(null!=this.buffer){var r=this.type
switch(r[1]){case 0:Dn.floodFill(this,e,t,i,n)
break
case 1:Dn.convertToData(this),Ln.floodFill(this,e,t,i,n)
break
case 2:(null==n||0==n)&&(i=(255&i)<<24|i>>8),this.buffer.__srcBitmapData.floodFill(e+this.offsetX,t+this.offsetY,i)}}},getColorBoundsRect:function(e,t,i,n){if(null==i&&(i=!0),null==this.buffer)return null
var r=this.type
switch(r[1]){case 0:return Dn.convertToData(this),Ln.getColorBoundsRect(this,e,t,i,n)
case 1:return Ln.getColorBoundsRect(this,e,t,i,n)
case 2:var s=this.buffer.__srcBitmapData.getColorBoundsRect(e,t,i)
return new zn(s.x,s.y,s.width,s.height)
default:return null}},getPixel:function(e,t,i){if(null==this.buffer||0>e||0>t||e>=this.width||t>=this.height)return 0
var n=this.type
switch(n[1]){case 0:return Dn.getPixel(this,e,t,i)
case 1:return Dn.convertToData(this),Ln.getPixel(this,e,t,i)
case 2:var r=this.buffer.__srcBitmapData.getPixel(e+this.offsetX,t+this.offsetY)
return null==i||0==i?(255&r)<<24|r>>8:r
default:return 0}},getPixel32:function(e,t,i){if(null==this.buffer||0>e||0>t||e>=this.width||t>=this.height)return 0
var n=this.type
switch(n[1]){case 0:return Dn.getPixel32(this,e,t,i)
case 1:return Dn.convertToData(this),Ln.getPixel32(this,e,t,i)
case 2:var r=this.buffer.__srcBitmapData.getPixel32(e+this.offsetX,t+this.offsetY)
return null==i||0==i?(255&r)<<24|r>>8:r
default:return 0}},getPixels:function(e,t){if(null==this.buffer)return null
var i=this.type
switch(i[1]){case 0:return Dn.getPixels(this,e,t)
case 1:return Dn.convertToData(this),Ln.getPixels(this,e,t)
case 2:e.offset(this.offsetX,this.offsetY)
var n=this.buffer.__srcBitmapData.getPixels(e.__toFlashRectangle())
if(null==t||0==t){for(var r,s=n.length/4|0,o=0;s>o;){o++
r=n.readUnsignedInt(),n.position-=4,n.writeUnsignedInt((255&r)<<24|r>>8)}n.position=0}return n
default:return null}},merge:function(e,t,i,n,r,s,o){if(null!=this.buffer&&null!=e){var a=this.type
switch(a[1]){case 0:Dn.convertToCanvas(this),Dn.merge(this,e,t,i,n,r,s,o)
break
case 1:Dn.convertToData(this),Dn.convertToData(e),Ln.merge(this,e,t,i,n,r,s,o)
break
case 2:t.offset(this.offsetX,this.offsetY),this.buffer.__srcBitmapData.merge(e.buffer.__srcBitmapData,t.__toFlashRectangle(),i.__toFlashPoint(),n,r,s,o)
break
default:return null}}},resize:function(e,t){var i=this.type
switch(i[1]){case 0:Dn.resize(this,e,t)
break
case 1:Ln.resize(this,e,t)
break
case 2:}this.buffer.width=e,this.buffer.height=t,this.offsetX=0,this.offsetY=0,this.width=e,this.height=t},setPixel:function(e,t,i,n){if(!(null==this.buffer||0>e||0>t||e>=this.width||t>=this.height)){var r=this.type
switch(r[1]){case 0:Dn.setPixel(this,e,t,i,n)
break
case 1:Dn.convertToData(this),Ln.setPixel(this,e,t,i,n)
break
case 2:(null==n||0==n)&&(i=(255&i)<<24|i>>8),this.buffer.__srcBitmapData.setPixel(e+this.offsetX,t+this.offsetX,i)}}},setPixel32:function(e,t,i,n){if(!(null==this.buffer||0>e||0>t||e>=this.width||t>=this.height)){var r=this.type
switch(r[1]){case 0:Dn.setPixel32(this,e,t,i,n)
break
case 1:Dn.convertToData(this),Ln.setPixel32(this,e,t,i,n)
break
case 2:(null==n||0==n)&&(i=(255&i)<<24|i>>8),this.buffer.__srcBitmapData.setPixel32(e+this.offsetX,t+this.offsetY,i)}}},setPixels:function(e,t,i){if(e=this.__clipRect(e),null!=this.buffer&&null!=e){var n=this.type
switch(n[1]){case 0:Dn.setPixels(this,e,t,i)
break
case 1:Dn.convertToData(this),Ln.setPixels(this,e,t,i)
break
case 2:if(e.offset(this.offsetX,this.offsetY),null==i||0==i){var r=t
t=new Jn
for(var s,o=t.length/4|0,a=0;o>a;){a++
s=r.readUnsignedInt(),t.writeUnsignedInt((255&s)<<24|s>>8)}r.position=0,t.position=0}this.buffer.__srcBitmapData.setPixels(e.__toFlashRectangle(),t)}}},__clipRect:function(e){return null==e?null:e.x<0&&(e.width-=-e.x,e.x=0,e.x+e.width<=0)?null:e.y<0&&(e.height-=-e.y,e.y=0,e.y+e.height<=0)?null:e.x+e.width>=this.width&&(e.width-=e.x+e.width-this.width,e.width<=0)?null:e.y+e.height>=this.height&&(e.height-=e.y+e.height-this.height,e.height<=0)?null:e},__fromBase64:function(e,t,i){var n=this,r=new Image,s=function(){n.buffer=new pn(null,r.width,r.height),n.buffer.__srcImage=r,n.offsetX=0,n.offsetY=0,n.width=n.buffer.width,n.height=n.buffer.height,null!=i&&i(n)}
r.addEventListener("load",s,!1),r.src="data:"+t+";base64,"+e},__fromBytes:function(e,t){var i=""
if(_n.__isPNG(e))i="image/png"
else if(_n.__isJPG(e))i="image/jpeg"
else{if(!_n.__isGIF(e))throw new Wi("Image tried to read a PNG/JPG ByteArray, but found an invalid header.")
i="image/gif"}this.__fromBase64(_n.__base64Encode(e),i,t)},__fromFile:function(e,t,i){var n=this,r=new Image
r.onload=function(){n.buffer=new pn(null,r.width,r.height),n.buffer.__srcImage=r,n.width=r.width,n.height=r.height,null!=t&&t(n)},r.onerror=function(){null!=i&&i()},r.src=e,r.complete},__fromImageBuffer:function(e){this.buffer=e,null!=e&&(-1==this.width&&(this.width=e.width),-1==this.height&&(this.height=e.height))},get_data:function(){return null==this.buffer.data&&this.buffer.width>0&&this.buffer.height>0&&(Dn.convertToCanvas(this),Dn.sync(this),Dn.createImageData(this)),this.buffer.data},set_data:function(e){return this.buffer.data=e},get_format:function(){return this.buffer.format},set_format:function(e){if(this.buffer.format!=e){var t=this.type
switch(t[1]){case 1:Ln.setFormat(this,e)}}return this.buffer.format=e},get_powerOfTwo:function(){return 0!=this.buffer.width&&(this.buffer.width&~this.buffer.width+1)==this.buffer.width&&0!=this.buffer.height&&(this.buffer.height&~this.buffer.height+1)==this.buffer.height},set_powerOfTwo:function(e){if(e!=this.get_powerOfTwo()){for(var t=1,i=1;t<this.buffer.width;)t<<=1
for(;i<this.buffer.height;)i<<=1
var n=this.type
switch(n[1]){case 0:break
case 1:Ln.resizeBuffer(this,t,i)
break
case 2:}}return e},get_premultiplied:function(){return this.buffer.premultiplied},set_premultiplied:function(e){if(e&&!this.buffer.premultiplied){var t=this.type
switch(t[1]){case 1:Dn.convertToData(this),Ln.multiplyAlpha(this)}}else if(!e&&this.buffer.premultiplied){var i=this.type
switch(i[1]){case 1:Dn.convertToData(this),Ln.unmultiplyAlpha(this)}}return e},get_rect:function(){return new zn(0,0,this.width,this.height)},get_src:function(){return this.buffer.get_src()},set_src:function(e){return this.buffer.set_src(e)},get_transparent:function(){return null==this.buffer?!1:this.buffer.transparent},set_transparent:function(e){return null==this.buffer?!1:this.buffer.transparent=e},__class__:_n,__properties__:{set_transparent:"set_transparent",get_transparent:"get_transparent",set_src:"set_src",get_src:"get_src",get_rect:"get_rect",set_premultiplied:"set_premultiplied",get_premultiplied:"get_premultiplied",set_powerOfTwo:"set_powerOfTwo",get_powerOfTwo:"get_powerOfTwo",set_format:"set_format",get_format:"get_format",set_data:"set_data",get_data:"get_data"}}
var pn=function(e,t,i,n,r){null==n&&(n=4),null==i&&(i=0),null==t&&(t=0),this.data=e,this.width=t,this.height=i,this.bitsPerPixel=n,null==r?this.format=0:this.format=r,this.transparent=!0}
s["lime.graphics.ImageBuffer"]=pn,pn.__name__=["lime","graphics","ImageBuffer"],pn.prototype={bitsPerPixel:null,data:null,format:null,height:null,premultiplied:null,transparent:null,width:null,__srcBitmapData:null,__srcCanvas:null,__srcContext:null,__srcCustom:null,__srcImage:null,__srcImageData:null,clone:function(){var e=new pn(this.data,this.width,this.height,this.bitsPerPixel)
if(null!=this.data){e.data=new Us(this.data.byteLength)
var t=new Us(this.data)
e.data.set(t)}else if(null!=this.__srcImageData){e.__srcCanvas=window.document.createElement("canvas"),e.__srcContext=e.__srcCanvas.getContext("2d"),e.__srcCanvas.width=this.__srcImageData.width,e.__srcCanvas.height=this.__srcImageData.height,e.__srcImageData=e.__srcContext.createImageData(this.__srcImageData.width,this.__srcImageData.height)
var i=new Uint8ClampedArray(this.__srcImageData.data)
e.__srcImageData.data.set(i)}else null!=this.__srcCanvas?(e.__srcCanvas=window.document.createElement("canvas"),e.__srcContext=e.__srcCanvas.getContext("2d"),e.__srcCanvas.width=this.__srcCanvas.width,e.__srcCanvas.height=this.__srcCanvas.height,e.__srcContext.drawImage(this.__srcCanvas,0,0)):e.__srcImage=this.__srcImage
return e.premultiplied=this.premultiplied,e.transparent=this.transparent,e},get_src:function(){return null!=this.__srcImage?this.__srcImage:this.__srcCanvas},set_src:function(e){return Me.__instanceof(e,Image)?this.__srcImage=e:Me.__instanceof(e,HTMLCanvasElement)&&(this.__srcCanvas=e,this.__srcContext=this.__srcCanvas.getContext("2d")),e},get_stride:function(){return 4*this.width},__class__:pn,__properties__:{get_stride:"get_stride",set_src:"set_src",get_src:"get_src"}}
var vn=s["lime.graphics.ImageChannel"]={__ename__:!0,__constructs__:["RED","GREEN","BLUE","ALPHA"]}
vn.RED=["RED",0],vn.RED.toString=o,vn.RED.__enum__=vn,vn.GREEN=["GREEN",1],vn.GREEN.toString=o,vn.GREEN.__enum__=vn,vn.BLUE=["BLUE",2],vn.BLUE.toString=o,vn.BLUE.__enum__=vn,vn.ALPHA=["ALPHA",3],vn.ALPHA.toString=o,vn.ALPHA.__enum__=vn
var gn=s["lime.graphics.ImageType"]={__ename__:!0,__constructs__:["CANVAS","DATA","FLASH","CUSTOM"]}
gn.CANVAS=["CANVAS",0],gn.CANVAS.toString=o,gn.CANVAS.__enum__=gn,gn.DATA=["DATA",1],gn.DATA.toString=o,gn.DATA.__enum__=gn,gn.FLASH=["FLASH",2],gn.FLASH.toString=o,gn.FLASH.__enum__=gn,gn.CUSTOM=["CUSTOM",3],gn.CUSTOM.toString=o,gn.CUSTOM.__enum__=gn
var xn=s["lime.graphics.RenderContext"]={__ename__:!0,__constructs__:["OPENGL","CANVAS","DOM","FLASH","CAIRO","CONSOLE","CUSTOM","NONE"]}
xn.OPENGL=function(e){var t=["OPENGL",0,e]
return t.__enum__=xn,t.toString=o,t},xn.CANVAS=function(e){var t=["CANVAS",1,e]
return t.__enum__=xn,t.toString=o,t},xn.DOM=function(e){var t=["DOM",2,e]
return t.__enum__=xn,t.toString=o,t},xn.FLASH=function(e){var t=["FLASH",3,e]
return t.__enum__=xn,t.toString=o,t},xn.CAIRO=function(e){var t=["CAIRO",4,e]
return t.__enum__=xn,t.toString=o,t},xn.CONSOLE=function(e){var t=["CONSOLE",5,e]
return t.__enum__=xn,t.toString=o,t},xn.CUSTOM=function(e){var t=["CUSTOM",6,e]
return t.__enum__=xn,t.toString=o,t},xn.NONE=["NONE",7],xn.NONE.toString=o,xn.NONE.__enum__=xn
var yn=function(e){this.onRender=new Ji,this.onRenderContextRestored=new Ji,this.onRenderContextLost=new Ji,this.window=e,this.backend=new qi(this),this.window.currentRenderer=this}
s["lime.graphics.Renderer"]=yn,yn.__name__=["lime","graphics","Renderer"],yn.prototype={context:null,onRenderContextLost:null,onRenderContextRestored:null,onRender:null,window:null,backend:null,create:function(){this.backend.create()},flip:function(){this.backend.flip()},render:function(){this.backend.render()},__class__:yn}
var bn=function(e){}
s["lime.graphics.cairo.Cairo"]=bn,bn.__name__=["lime","graphics","cairo","Cairo"],bn.__properties__={get_versionString:"get_versionString",get_version:"get_version"},bn.get_version=function(){return 0},bn.get_versionString=function(){return""},bn.prototype={target:null,userData:null,handle:null,recreate:function(){},arc:function(){},arcNegative:function(){},clip:function(){},clipExtents:function(){},clipPreserve:function(){},closePath:function(){},copyPage:function(){},curveTo:function(){},destroy:function(){},fill:function(){},fillExtents:function(){},fillPreserve:function(){},identityMatrix:function(){},inClip:function(){return!1},inFill:function(){return!1},inStroke:function(){return!1},lineTo:function(){},moveTo:function(){},mask:function(){},maskSurface:function(){},newPath:function(){},paint:function(){},paintWithAlpha:function(){},popGroup:function(){return null},popGroupToSource:function(){},pushGroup:function(){},pushGroupWithContent:function(){},rectangle:function(){},reference:function(){},relCurveTo:function(){},relLineTo:function(){},relMoveTo:function(){},resetClip:function(){},restore:function(){},save:function(){},setFontFace:function(){},setFontSize:function(){},getFontOptions:function(){return 0},setFontOptions:function(e){return e},setSourceRGB:function(){},setSourceRGBA:function(){},setSourceSurface:function(){},showPage:function(){},showText:function(){},status:function(){return 0},stroke:function(){},strokeExtents:function(){},strokePreserve:function(){},transform:function(){},rotate:function(){},scale:function(){},translate:function(){},get_antialias:function(){return 0},set_antialias:function(e){return e},get_currentPoint:function(){return null},get_dash:function(){return[]},set_dash:function(e){return e},get_dashCount:function(){return 0},get_fillRule:function(){return 0},set_fillRule:function(e){return e},get_groupTarget:function(){return 0},get_hasCurrentPoint:function(){return!1},get_lineCap:function(){return 0},set_lineCap:function(e){return e},get_lineJoin:function(){return 0},set_lineJoin:function(e){return e},get_lineWidth:function(){return 0},set_lineWidth:function(e){return e},get_matrix:function(){return null},set_matrix:function(e){return e},get_miterLimit:function(){return 0},set_miterLimit:function(e){return e},get_operator:function(){return 0},set_operator:function(e){return e},get_referenceCount:function(){return 0},get_source:function(){return 0},set_source:function(e){return e},get_target:function(){return 0},get_tolerance:function(){return 0},set_tolerance:function(e){return e},__class__:bn,__properties__:{set_tolerance:"set_tolerance",get_tolerance:"get_tolerance",get_target:"get_target",set_source:"set_source",get_source:"get_source",get_referenceCount:"get_referenceCount",set_operator:"set_operator",get_operator:"get_operator",set_miterLimit:"set_miterLimit",get_miterLimit:"get_miterLimit",set_matrix:"set_matrix",get_matrix:"get_matrix",set_lineWidth:"set_lineWidth",get_lineWidth:"get_lineWidth",set_lineJoin:"set_lineJoin",get_lineJoin:"get_lineJoin",set_lineCap:"set_lineCap",get_lineCap:"get_lineCap",get_hasCurrentPoint:"get_hasCurrentPoint",get_groupTarget:"get_groupTarget",set_fillRule:"set_fillRule",get_fillRule:"get_fillRule",get_dashCount:"get_dashCount",set_dash:"set_dash",get_dash:"get_dash",get_currentPoint:"get_currentPoint",set_antialias:"set_antialias",get_antialias:"get_antialias"}}
var wn=function(){}
s["lime.graphics.cairo.CairoFont"]=wn,wn.__name__=["lime","graphics","cairo","CairoFont"],wn.prototype={handle:null,font:null,destroy:function(){},__class__:wn}
var Sn=function(e){this.handle=e}
s["lime.graphics.cairo.CairoFontOptions"]=Sn,Sn.__name__=["lime","graphics","cairo","CairoFontOptions"],Sn.prototype={handle:null,get_antialias:function(){return 0},set_antialias:function(e){return e},get_subpixelOrder:function(){return 0},set_subpixelOrder:function(e){return e},get_hintStyle:function(){return 0},set_hintStyle:function(e){return e},get_hintMetrics:function(){return 0},set_hintMetrics:function(e){return e},__class__:Sn,__properties__:{set_hintMetrics:"set_hintMetrics",get_hintMetrics:"get_hintMetrics",set_hintStyle:"set_hintStyle",get_hintStyle:"get_hintStyle",set_subpixelOrder:"set_subpixelOrder",get_subpixelOrder:"get_subpixelOrder",set_antialias:"set_antialias",get_antialias:"get_antialias"}}
var Mn={}
s["lime.graphics.cairo._CairoPattern.CairoPattern_Impl_"]=Mn,Mn.__name__=["lime","graphics","cairo","_CairoPattern","CairoPattern_Impl_"],Mn.__properties__={set_matrix:"set_matrix",get_matrix:"get_matrix",set_filter:"set_filter",get_filter:"get_filter",set_extend:"set_extend",get_extend:"get_extend",get_colorStopCount:"get_colorStopCount"},Mn._new=function(e){return e},Mn.addColorStopRGB=function(){},Mn.addColorStopRGBA=function(){},Mn.createForSurface=function(){return 0},Mn.createLinear=function(){return 0},Mn.createRadial=function(){return 0},Mn.createRGB=function(){return 0},Mn.createRGBA=function(){return 0},Mn.destroy=function(){},Mn.get_colorStopCount=function(){return 0},Mn.get_extend=function(){return 0},Mn.set_extend=function(e,t){return t},Mn.get_filter=function(){return 0},Mn.set_filter=function(e,t){return t},Mn.get_matrix=function(){return null},Mn.set_matrix=function(e,t){return t}
var Tn={}
s["lime.graphics.cairo._CairoSurface.CairoSurface_Impl_"]=Tn,Tn.__name__=["lime","graphics","cairo","_CairoSurface","CairoSurface_Impl_"],Tn.__properties__={get_width:"get_width",get_height:"get_height"},Tn._new=function(){return 0},Tn.createForData=function(){return 0},Tn.destroy=function(){},Tn.flush=function(){},Tn.fromImage=function(){return null},Tn.get_height=function(){return 0},Tn.get_width=function(){return 0}
var Cn=function(){}
s["lime.graphics.format.BMP"]=Cn,Cn.__name__=["lime","graphics","format","BMP"],Cn.encode=function(e,t){null==t&&(t=An.RGB)
var i=14,n=40,r=e.width*e.height*4
if(null!=t)switch(t[1]){case 1:n=108
break
case 2:i=0,r+=e.width*e.height
break
case 0:r=3*e.width+3*e.width%4+3*e.height+3*e.height}var s=new Jn(i+n+r)
if(i>0&&(s.writeByte(66),s.writeByte(77),s.writeInt(s.length),s.writeShort(0),s.writeShort(0),s.writeInt(i+n)),s.writeInt(n),s.writeInt(e.width),s.writeInt(t==An.ICO?2*e.height:e.height),s.writeShort(1),s.writeShort(t==An.RGB?24:32),s.writeInt(t==An.BITFIELD?3:0),s.writeInt(r),s.writeInt(11824),s.writeInt(11824),s.writeInt(0),s.writeInt(0),t==An.BITFIELD){s.writeInt(16711680),s.writeInt(65280),s.writeInt(255),s.writeInt(-16777216),s.writeByte(32),s.writeByte(110),s.writeByte(105),s.writeByte(87)
for(var o=0;48>o;){o++
s.writeByte(0)}}var a,l,h,u,c=e.getPixels(new zn(0,0,e.width,e.height),1)
if(null!=t)switch(t[1]){case 1:for(var f=0,d=e.height;d>f;){var m=f++
c.position=4*(e.height-1-m)*e.width
for(var _=0,p=e.width;p>_;){_++
a=c.readByte(),l=c.readByte(),h=c.readByte(),u=c.readByte(),s.writeByte(u),s.writeByte(h),s.writeByte(l),s.writeByte(a)}}break
case 2:for(var v=new Jn(e.width*e.height),g=0,x=e.height;x>g;){var y=g++
c.position=4*(e.height-1-y)*e.width
for(var b=0,w=e.width;w>b;){b++
a=c.readByte(),l=c.readByte(),h=c.readByte(),u=c.readByte(),s.writeByte(u),s.writeByte(h),s.writeByte(l),s.writeByte(a),v.writeByte(0)}}s.writeBytes(v)
break
case 0:for(var S=0,M=e.height;M>S;){var T=S++
c.position=4*(e.height-1-T)*e.width
for(var C=0,A=e.width;A>C;){C++
a=c.readByte(),l=c.readByte(),h=c.readByte(),u=c.readByte(),s.writeByte(u),s.writeByte(h),s.writeByte(l)}for(var I=0,P=3*e.width%4;P>I;){I++
s.writeByte(0)}}}return s}
var An=s["lime.graphics.format.BMPType"]={__ename__:!0,__constructs__:["RGB","BITFIELD","ICO"]}
An.RGB=["RGB",0],An.RGB.toString=o,An.RGB.__enum__=An,An.BITFIELD=["BITFIELD",1],An.BITFIELD.toString=o,An.BITFIELD.__enum__=An,An.ICO=["ICO",2],An.ICO.toString=o,An.ICO.__enum__=An
var In=function(){}
s["lime.graphics.format.JPEG"]=In,In.__name__=["lime","graphics","format","JPEG"],In.encode=function(){return null}
var Pn=function(){}
s["lime.graphics.format.PNG"]=Pn,Pn.__name__=["lime","graphics","format","PNG"],Pn.encode=function(){return null}
var En=function(){}
s["lime.graphics.opengl.GL"]=En,En.__name__=["lime","graphics","opengl","GL"],En.__properties__={get_version:"get_version"},En.activeTexture=function(e){En.context.activeTexture(e)},En.attachShader=function(e,t){En.context.attachShader(e,t)},En.bindAttribLocation=function(e,t,i){En.context.bindAttribLocation(e,t,i)},En.bindBuffer=function(e,t){En.context.bindBuffer(e,t)},En.bindFramebuffer=function(e,t){En.context.bindFramebuffer(e,t)},En.bindRenderbuffer=function(e,t){En.context.bindRenderbuffer(e,t)},En.bindTexture=function(e,t){En.context.bindTexture(e,t)},En.blendColor=function(e,t,i,n){En.context.blendColor(e,t,i,n)},En.blendEquation=function(e){En.context.blendEquation(e)},En.blendEquationSeparate=function(e,t){En.context.blendEquationSeparate(e,t)},En.blendFunc=function(e,t){En.context.blendFunc(e,t)},En.blendFuncSeparate=function(e,t,i,n){En.context.blendFuncSeparate(e,t,i,n)},En.bufferData=function(e,t,i){En.context.bufferData(e,t,i)},En.bufferSubData=function(e,t,i){En.context.bufferSubData(e,t,i)},En.checkFramebufferStatus=function(e){return En.context.checkFramebufferStatus(e)},En.clear=function(e){En.context.clear(e)},En.clearColor=function(e,t,i,n){En.context.clearColor(e,t,i,n)},En.clearDepth=function(e){En.context.clearDepth(e)},En.clearStencil=function(e){En.context.clearStencil(e)},En.colorMask=function(e,t,i,n){En.context.colorMask(e,t,i,n)},En.compileShader=function(e){En.context.compileShader(e)},En.compressedTexImage2D=function(e,t,i,n,r,s,o){En.context.compressedTexImage2D(e,t,i,n,r,s,o)},En.compressedTexSubImage2D=function(e,t,i,n,r,s,o,a){En.context.compressedTexSubImage2D(e,t,i,n,r,s,o,a)},En.copyTexImage2D=function(e,t,i,n,r,s,o,a){En.context.copyTexImage2D(e,t,i,n,r,s,o,a)},En.copyTexSubImage2D=function(e,t,i,n,r,s,o,a){En.context.copyTexSubImage2D(e,t,i,n,r,s,o,a)},En.createBuffer=function(){return En.context.createBuffer()},En.createFramebuffer=function(){return En.context.createFramebuffer()},En.createProgram=function(){return En.context.createProgram()},En.createRenderbuffer=function(){return En.context.createRenderbuffer()},En.createShader=function(e){return En.context.createShader(e)},En.createTexture=function(){return En.context.createTexture()},En.cullFace=function(e){En.context.cullFace(e)},En.deleteBuffer=function(e){En.context.deleteBuffer(e)},En.deleteFramebuffer=function(e){En.context.deleteFramebuffer(e)},En.deleteProgram=function(e){En.context.deleteProgram(e)},En.deleteRenderbuffer=function(e){En.context.deleteRenderbuffer(e)},En.deleteShader=function(e){En.context.deleteShader(e)},En.deleteTexture=function(e){En.context.deleteTexture(e)},En.depthFunc=function(e){En.context.depthFunc(e)},En.depthMask=function(e){En.context.depthMask(e)},En.depthRange=function(e,t){En.context.depthRange(e,t)},En.detachShader=function(e,t){En.context.detachShader(e,t)},En.disable=function(e){En.context.disable(e)},En.disableVertexAttribArray=function(e){En.context.disableVertexAttribArray(e)},En.drawArrays=function(e,t,i){En.context.drawArrays(e,t,i)},En.drawElements=function(e,t,i,n){En.context.drawElements(e,t,i,n)},En.enable=function(e){En.context.enable(e)},En.enableVertexAttribArray=function(e){En.context.enableVertexAttribArray(e)},En.finish=function(){En.context.finish()},En.flush=function(){En.context.flush()},En.framebufferRenderbuffer=function(e,t,i,n){En.context.framebufferRenderbuffer(e,t,i,n)},En.framebufferTexture2D=function(e,t,i,n,r){En.context.framebufferTexture2D(e,t,i,n,r)},En.frontFace=function(e){En.context.frontFace(e)},En.generateMipmap=function(e){En.context.generateMipmap(e)},En.getActiveAttrib=function(e,t){return En.context.getActiveAttrib(e,t)},En.getActiveUniform=function(e,t){return En.context.getActiveUniform(e,t)},En.getAttachedShaders=function(e){return En.context.getAttachedShaders(e)},En.getAttribLocation=function(e,t){return En.context.getAttribLocation(e,t)},En.getBufferParameter=function(e,t){return En.context.getBufferParameter(e,t)},En.getContextAttributes=function(){return En.context.getContextAttributes()},En.getError=function(){return En.context.getError()},En.getExtension=function(e){return En.context.getExtension(e)},En.getFramebufferAttachmentParameter=function(e,t,i){return En.context.getFramebufferAttachmentParameter(e,t,i)},En.getParameter=function(e){return En.context.getParameter(e)},En.getProgramInfoLog=function(e){return En.context.getProgramInfoLog(e)},En.getProgramParameter=function(e,t){return En.context.getProgramParameter(e,t)},En.getRenderbufferParameter=function(e,t){return En.context.getRenderbufferParameter(e,t)},En.getShaderInfoLog=function(e){return En.context.getShaderInfoLog(e)},En.getShaderParameter=function(e,t){return En.context.getShaderParameter(e,t)},En.getShaderPrecisionFormat=function(e,t){return En.context.getShaderPrecisionFormat(e,t)},En.getShaderSource=function(e){return En.context.getShaderSource(e)},En.getSupportedExtensions=function(){return En.context.getSupportedExtensions()},En.getTexParameter=function(e,t){return En.context.getTexParameter(e,t)},En.getUniform=function(e,t){return En.context.getUniform(e,t)},En.getUniformLocation=function(e,t){return En.context.getUniformLocation(e,t)},En.getVertexAttrib=function(e,t){return En.context.getVertexAttrib(e,t)},En.getVertexAttribOffset=function(e,t){return En.context.getVertexAttribOffset(e,t)},En.hint=function(e,t){En.context.hint(e,t)},En.isBuffer=function(e){return En.context.isBuffer(e)},En.isContextLost=function(){return En.context.isContextLost()},En.isEnabled=function(e){return En.context.isEnabled(e)},En.isFramebuffer=function(e){return En.context.isFramebuffer(e)},En.isProgram=function(e){return En.context.isProgram(e)},En.isRenderbuffer=function(e){return En.context.isRenderbuffer(e)},En.isShader=function(e){return En.context.isShader(e)},En.isTexture=function(e){return En.context.isTexture(e)},En.lineWidth=function(e){En.context.lineWidth(e)},En.linkProgram=function(e){En.context.linkProgram(e)},En.pixelStorei=function(e,t){En.context.pixelStorei(e,t)},En.polygonOffset=function(e,t){En.context.polygonOffset(e,t)},En.readPixels=function(e,t,i,n,r,s,o){En.context.readPixels(e,t,i,n,r,s,o)},En.renderbufferStorage=function(e,t,i,n){En.context.renderbufferStorage(e,t,i,n)},En.sampleCoverage=function(e,t){En.context.sampleCoverage(e,t)},En.scissor=function(e,t,i,n){En.context.scissor(e,t,i,n)},En.shaderSource=function(e,t){En.context.shaderSource(e,t)},En.stencilFunc=function(e,t,i){En.context.stencilFunc(e,t,i)},En.stencilFuncSeparate=function(e,t,i,n){En.context.stencilFuncSeparate(e,t,i,n)},En.stencilMask=function(e){En.context.stencilMask(e)},En.stencilMaskSeparate=function(e,t){En.context.stencilMaskSeparate(e,t)},En.stencilOp=function(e,t,i){En.context.stencilOp(e,t,i)},En.stencilOpSeparate=function(e,t,i,n){En.context.stencilOpSeparate(e,t,i,n)},En.texImage2D=function(e,t,i,n,r,s,o,a,l){En.context.texImage2D(e,t,i,n,r,s,o,a,l)},En.texParameterf=function(e,t,i){En.context.texParameterf(e,t,i)},En.texParameteri=function(e,t,i){En.context.texParameteri(e,t,i)},En.texSubImage2D=function(e,t,i,n,r,s,o,a,l){En.context.texSubImage2D(e,t,i,n,r,s,o,a,l)},En.uniform1f=function(e,t){En.context.uniform1f(e,t)},En.uniform1fv=function(e,t){En.context.uniform1fv(e,t)},En.uniform1i=function(e,t){En.context.uniform1i(e,t)},En.uniform1iv=function(e,t){En.context.uniform1iv(e,t)},En.uniform2f=function(e,t,i){En.context.uniform2f(e,t,i)},En.uniform2fv=function(e,t){En.context.uniform2fv(e,t)},En.uniform2i=function(e,t,i){En.context.uniform2i(e,t,i)},En.uniform2iv=function(e,t){En.context.uniform2iv(e,t)},En.uniform3f=function(e,t,i,n){En.context.uniform3f(e,t,i,n)},En.uniform3fv=function(e,t){En.context.uniform3fv(e,t)},En.uniform3i=function(e,t,i,n){En.context.uniform3i(e,t,i,n)},En.uniform3iv=function(e,t){En.context.uniform3iv(e,t)},En.uniform4f=function(e,t,i,n,r){En.context.uniform4f(e,t,i,n,r)},En.uniform4fv=function(e,t){En.context.uniform4fv(e,t)},En.uniform4i=function(e,t,i,n,r){En.context.uniform4i(e,t,i,n,r)},En.uniform4iv=function(e,t){En.context.uniform4iv(e,t)},En.uniformMatrix2fv=function(e,t,i){En.context.uniformMatrix2fv(e,t,i)},En.uniformMatrix3fv=function(e,t,i){En.context.uniformMatrix3fv(e,t,i)},En.uniformMatrix4fv=function(e,t,i){En.context.uniformMatrix4fv(e,t,i)},En.useProgram=function(e){En.context.useProgram(e)},En.validateProgram=function(e){En.context.validateProgram(e)},En.vertexAttrib1f=function(e,t){En.context.vertexAttrib1f(e,t)},En.vertexAttrib1fv=function(e,t){En.context.vertexAttrib1fv(e,t)},En.vertexAttrib2f=function(e,t,i){En.context.vertexAttrib2f(e,t,i)},En.vertexAttrib2fv=function(e,t){En.context.vertexAttrib2fv(e,t)},En.vertexAttrib3f=function(e,t,i,n){En.context.vertexAttrib3f(e,t,i,n)},En.vertexAttrib3fv=function(e,t){En.context.vertexAttrib3fv(e,t)},En.vertexAttrib4f=function(e,t,i,n,r){En.context.vertexAttrib4f(e,t,i,n,r)},En.vertexAttrib4fv=function(e,t){En.context.vertexAttrib4fv(e,t)},En.vertexAttribPointer=function(e,t,i,n,r,s){En.context.vertexAttribPointer(e,t,i,n,r,s)},En.viewport=function(e,t,i,n){En.context.viewport(e,t,i,n)},En.get_version=function(){return 2}
var Dn=function(){}
s["lime.graphics.utils.ImageCanvasUtil"]=Dn,Dn.__name__=["lime","graphics","utils","ImageCanvasUtil"],Dn.colorTransform=function(e,t,i){Dn.convertToCanvas(e),Dn.createImageData(e),Ln.colorTransform(e,t,i)},Dn.convertToCanvas=function(e){var t=e.buffer
null!=t.__srcImage&&(null==t.__srcCanvas&&(Dn.createCanvas(e,t.__srcImage.width,t.__srcImage.height),t.__srcContext.drawImage(t.__srcImage,0,0)),t.__srcImage=null)},Dn.convertToData=function(e){null==e.buffer.data&&(Dn.convertToCanvas(e),Dn.sync(e),Dn.createImageData(e),e.buffer.__srcCanvas=null,e.buffer.__srcContext=null)},Dn.copyChannel=function(e,t,i,n,r,s){Dn.convertToCanvas(t),Dn.createImageData(t),Dn.convertToCanvas(e),Dn.createImageData(e),Ln.copyChannel(e,t,i,n,r,s)},Dn.copyPixels=function(e,t,i,n,r,s,o){if(null==o&&(o=!1),null!=r&&r.get_transparent()){null==s&&(s=new Bn)
var a=e.clone()
a.copyChannel(r,new zn(s.x,s.y,i.width,i.height),new Bn(i.x,i.y),vn.ALPHA,vn.ALPHA),t=a}Dn.sync(e),o||e.get_transparent()&&t.get_transparent()&&e.buffer.__srcContext.clearRect(n.x+e.offsetX,n.y+e.offsetY,i.width+e.offsetX,i.height+e.offsetY),Dn.sync(t),null!=t.buffer.get_src()&&e.buffer.__srcContext.drawImage(t.buffer.get_src(),i.x+t.offsetX|0,i.y+t.offsetY|0,0|i.width,0|i.height,n.x+e.offsetX|0,n.y+e.offsetY|0,0|i.width,0|i.height)},Dn.createCanvas=function(e,t,i){var n=e.buffer
null==n.__srcCanvas&&(n.__srcCanvas=window.document.createElement("canvas"),n.__srcCanvas.width=t,n.__srcCanvas.height=i,e.get_transparent()?n.__srcContext=n.__srcCanvas.getContext("2d"):(e.get_transparent()||n.__srcCanvas.setAttribute("moz-opaque","true"),n.__srcContext=n.__srcCanvas.getContext("2d",{alpha:!1})),n.__srcContext.mozImageSmoothingEnabled=!1,n.__srcContext.webkitImageSmoothingEnabled=!1,n.__srcContext.imageSmoothingEnabled=!1)},Dn.createImageData=function(e){var t=e.buffer
null==t.data&&(t.__srcImageData=t.__srcContext.getImageData(0,0,t.width,t.height),t.data=new Us(t.__srcImageData.data.buffer))},Dn.fillRect=function(e,t,i,n){if(Dn.convertToCanvas(e),Dn.sync(e),0==t.x&&0==t.y&&t.width==e.width&&t.height==e.height&&e.get_transparent()&&0==(255&i))return void(e.buffer.__srcCanvas.width=e.buffer.width)
var r,s,o,a
1==n?(r=i>>16&255,s=i>>8&255,o=255&i,a=e.get_transparent()?i>>24&255:255):(r=i>>24&255,s=i>>16&255,o=i>>8&255,a=e.get_transparent()?255&i:255),e.buffer.__srcContext.fillStyle="rgba("+r+", "+s+", "+o+", "+a/255+")",e.buffer.__srcContext.fillRect(t.x+e.offsetX,t.y+e.offsetY,t.width+e.offsetX,t.height+e.offsetY)},Dn.floodFill=function(e,t,i,n,r){Dn.convertToCanvas(e),Dn.createImageData(e),Ln.floodFill(e,t,i,n,r)},Dn.getPixel=function(e,t,i,n){return Dn.convertToCanvas(e),Dn.createImageData(e),Ln.getPixel(e,t,i,n)},Dn.getPixel32=function(e,t,i,n){return Dn.convertToCanvas(e),Dn.createImageData(e),Ln.getPixel32(e,t,i,n)},Dn.getPixels=function(e,t,i){return Dn.convertToCanvas(e),Dn.createImageData(e),Ln.getPixels(e,t,i)},Dn.merge=function(e,t,i,n,r,s,o,a){Dn.convertToCanvas(t),Dn.createImageData(t),Dn.convertToCanvas(e),Dn.createImageData(e),Ln.merge(e,t,i,n,r,s,o,a)},Dn.resize=function(e,t,i){var n=e.buffer
if(null==n.__srcCanvas)Dn.createCanvas(e,t,i),n.__srcContext.drawImage(n.get_src(),0,0,t,i)
else{Dn.sync(e)
var r=n.__srcCanvas
n.__srcCanvas=null,Dn.createCanvas(e,t,i),n.__srcContext.drawImage(r,0,0,t,i)}},Dn.setPixel=function(e,t,i,n,r){Dn.convertToCanvas(e),Dn.createImageData(e),Ln.setPixel(e,t,i,n,r)},Dn.setPixel32=function(e,t,i,n,r){Dn.convertToCanvas(e),Dn.createImageData(e),Ln.setPixel32(e,t,i,n,r)},Dn.setPixels=function(e,t,i,n){Dn.convertToCanvas(e),Dn.createImageData(e),Ln.setPixels(e,t,i,n)},Dn.sync=function(e){e.dirty&&e.type!=gn.DATA&&(e.buffer.__srcContext.putImageData(e.buffer.__srcImageData,0,0),e.buffer.data=null,e.dirty=!1)}
var Ln=function(){}
s["lime.graphics.utils.ImageDataUtil"]=Ln,Ln.__name__=["lime","graphics","utils","ImageDataUtil"],Ln.colorTransform=function(e,t,i){var n=e.buffer.data
if(null!=n){for(var r,s,o,a,l,h=4*e.buffer.width,u=g["int"](t.get_top()+e.offsetY),c=g["int"](t.get_bottom()+e.offsetY),f=g["int"](t.get_left()+e.offsetX),d=g["int"](t.get_right()+e.offsetX),m=0,_=u;c>_;)for(var p=_++,v=f;d>v;){var x=v++
r=p*h+4*x,l=n[r+3]*i[18]+255*i[19]|0,m=l>255?l-255:0,a=n[r+2]*i[12]+255*i[14]+m|0,m=a>255?a-255:0,o=n[r+1]*i[6]+255*i[9]+m|0,m=o>255?o-255:0,s=n[r]*i[0]+255*i[4]+m|0,s>255?n[r]=255:n[r]=s,o>255?n[r+1]=255:n[r+1]=o,a>255?n[r+2]=255:n[r+2]=a,l>255?n[r+3]=255:n[r+3]=l}e.dirty=!0}},Ln.copyChannel=function(e,t,i,n,r,s){var o
switch(s[1]){case 0:o=0
break
case 1:o=1
break
case 2:o=2
break
case 3:o=3}var a
switch(r[1]){case 0:a=0
break
case 1:a=1
break
case 2:a=2
break
case 3:a=3}var l=t.buffer.data,h=e.buffer.data
if(null!=l&&null!=h){for(var u=4*t.buffer.width|0,c=4*(i.x+t.offsetX)+u*(i.y+t.offsetY)+a|0,f=u-(4*(i.width+t.offsetX)|0),d=4*(i.x+t.offsetX+i.width)|0,m=t.buffer.data,_=4*e.buffer.width|0,p=4*(n.x+e.offsetX)+_*(n.y+e.offsetY)+o|0,v=_-(4*(i.width+e.offsetX)|0),g=4*(n.x+e.offsetX+i.width)|0,x=e.buffer.data,y=i.width*i.height|0,b=0;y>b;){b++
x[p]=m[c],c+=4,p+=4,c%u>d&&(c+=f),p%_>g&&(p+=v)}e.dirty=!0}},Ln.copyPixels=function(e,t,i,n,r,s,o){if(null==o&&(o=!1),null!=r&&r.get_transparent()){null==s&&(s=new Bn)
var a=e.clone()
a.copyChannel(r,new zn(s.x,s.y,i.width,i.height),new Bn(i.x,i.y),vn.ALPHA,vn.ALPHA),t=a}var l=n.y+e.offsetY-i.y-t.offsetY|0,h=n.x+e.offsetX-i.x-t.offsetY|0,u=t.buffer.data,c=4*t.buffer.width,f=0,d=e.buffer.data,m=4*e.buffer.width,_=0
if(o&&t.get_transparent())for(var p,v,x,y,b=g["int"](i.get_top()+t.offsetY),w=g["int"](i.get_bottom()+t.offsetY);w>b;)for(var S=b++,M=g["int"](i.get_left()+t.offsetX),T=g["int"](i.get_right()+t.offsetX);T>M;){var C=M++
f=S*c+4*C,_=(S+l)*m+4*(C+h),p=u[f+3]/255,v=d[_+3]/255,y=1-p,x=p+v*y
var A=Math.round((u[f]*p+d[_]*v*y)/x)
d[_]=Ln.__clamp[A]
var I=Math.round((u[f+1]*p+d[_+1]*v*y)/x)
d[_+1]=Ln.__clamp[I]
var P=Math.round((u[f+2]*p+d[_+2]*v*y)/x)
d[_+2]=Ln.__clamp[P]
var E=Math.round(255*x)
d[_+3]=Ln.__clamp[E]}else for(var D=g["int"](i.get_top()+t.offsetY),L=g["int"](i.get_bottom()+t.offsetY);L>D;)for(var F=D++,R=g["int"](i.get_left()+t.offsetX),z=g["int"](i.get_right()+t.offsetX);z>R;){var B=R++
f=F*c+4*B,_=(F+l)*m+4*(B+h),d[_]=u[f],d[_+1]=u[f+1],d[_+2]=u[f+2],d[_+3]=u[f+3]}e.dirty=!0},Ln.fillRect=function(e,t,i,n){var r,s,o,a
1==n?(a=e.get_transparent()?i>>24&255:255,r=i>>16&255,s=i>>8&255,o=255&i):(r=i>>24&255,s=i>>16&255,o=i>>8&255,a=e.get_transparent()?255&i:255)
var l=e.buffer.data
if(null!=l){if(t.width==e.buffer.width&&t.height==e.buffer.height&&0==t.x&&0==t.y&&0==e.offsetX&&0==e.offsetY)for(var h=e.buffer.width*e.buffer.height,u=0,c=0;h>c;){var f=c++
u=4*f,l[u]=r,l[u+1]=s,l[u+2]=o,l[u+3]=a}else for(var d,m=4*e.buffer.width,_=t.y+e.offsetY|0,p=g["int"](t.get_bottom()+e.offsetY),v=t.x+e.offsetX|0,x=g["int"](t.get_right()+e.offsetX),y=_;p>y;)for(var b=y++,w=v;x>w;){var S=w++
d=b*m+4*S,l[d]=r,l[d+1]=s,l[d+2]=o,l[d+3]=a}e.dirty=!0}},Ln.floodFill=function(e,t,i,n,r){var s=e.buffer.data
if(null!=s){1==r&&(n=(16777215&n)<<8|n>>24&255)
var o,a=4*(i+e.offsetY)*e.buffer.width+4*(t+e.offsetX),l=s[a],h=s[a+1],u=s[a+2]
o=e.get_transparent()?s[a+3]:255
var c,f=n>>24&255,d=n>>16&255,m=n>>8&255
if(c=e.get_transparent()?255&n:255,l!=f||h!=d||u!=m||o!=c){var _=[0,-1,1,0],p=[-1,0,0,1],v=-e.offsetX,g=-e.offsetY,x=v+e.width,y=g+e.height,b=[]
for(b.push(t),b.push(i);b.length>0;)for(var w=b.pop(),S=b.pop(),M=0;4>M;){var T=M++,C=S+_[T],A=w+p[T]
if(!(v>C||g>A||C>=x||A>=y)){var I=4*(A*e.width+C)
s[I]==l&&s[I+1]==h&&s[I+2]==u&&s[I+3]==o&&(s[I]=f,s[I+1]=d,s[I+2]=m,s[I+3]=c,b.push(C),b.push(A))}}e.dirty=!0}}},Ln.getColorBoundsRect=function(e,t,i,n,r){null==n&&(n=!0)
var s,o,a,l,h,u,c,f,d=e.width+1,m=0,_=e.height+1,p=0
1==r?(l=e.get_transparent()?i>>24&255:255,s=i>>16&255,o=i>>8&255,a=255&i,f=e.get_transparent()?t>>24&255:255,h=t>>16&255,u=t>>8&255,c=255&t):(s=i>>24&255,o=i>>16&255,a=i>>8&255,l=e.get_transparent()?255&i:255,h=t>>24&255,u=t>>16&255,c=t>>8&255,f=e.get_transparent()?255&t:255),i=s|o<<8|a<<16|l<<24,t=h|u<<8|c<<16|t<<24
for(var v,g=0,x=e.width;x>g;){for(var y=g++,b=!1,w=0,S=e.height;S>w;){var M=w++
if(v=e.getPixel32(y,M),b=n?(v&t)==i:(v&t)!=i){d>y&&(d=y)
break}}if(b)break}for(var T=0,C=e.width;C>T;){for(var A=T++,I=e.width-1-A,P=!1,E=0,D=e.height;D>E;){var L=E++
if(v=e.getPixel32(I,L),P=n?(v&t)==i:(v&t)!=i){I>m&&(m=I)
break}}if(P)break}for(var F=0,R=e.height;R>F;){for(var z=F++,B=!1,O=0,k=e.width;k>O;){var V=O++
if(v=e.getPixel32(V,z),B=n?(v&t)==i:(v&t)!=i){_>z&&(_=z)
break}}if(B)break}for(var N=0,U=e.height;U>N;){for(var W=N++,G=e.height-1-W,Y=!1,H=0,X=e.width;X>H;){var j=H++
if(v=e.getPixel32(j,G),Y=n?(v&t)==i:(v&t)!=i){G>p&&(p=G)
break}}if(Y)break}var K=m-d,Z=p-_
return K>0&&K++,Z>0&&Z++,0>K&&(K=0),0>Z&&(Z=0),d==m&&(K=1),_==p&&(Z=1),d>e.width&&(d=0),_>e.height&&(_=0),new zn(d,_,K,Z)},Ln.getPixel=function(e,t,i,n){var r,s=e.buffer.data,o=4*(i+e.offsetY)*e.buffer.width+4*(t+e.offsetX)
if(e.get_premultiplied()){var a=255/s[o+3]
r=Ln.__clamp[s[o]*a|0]<<24|Ln.__clamp[s[o+1]*a|0]<<16|Ln.__clamp[s[o+2]*a|0]<<8}else r=s[o]<<24|s[o+1]<<16|s[o+2]<<8
return 1==n?r>>8&16777215:r},Ln.getPixel32=function(e,t,i,n){var r,s=e.buffer.data,o=4*(i+e.offsetY)*e.buffer.width+4*(t+e.offsetX)
r=e.get_transparent()?s[o+3]:255
var a,l,h
if(e.get_premultiplied()&&0!=r){var u=255/r,c=Math.round(s[o]*u)
a=Ln.__clamp[c]
var f=Math.round(s[o+1]*u)
l=Ln.__clamp[f]
var d=Math.round(s[o+2]*u)
h=Ln.__clamp[d]}else a=s[o],l=s[o+1],h=s[o+2]
return 1==n?r<<24|a<<16|l<<8|h:a<<24|l<<16|h<<8|r},Ln.getPixels=function(e,t,i){if(null==e.buffer.data)return null
var n=t.width*t.height|0,r=new Jn(4*n)
r.position=0
var s=e.buffer.data,o=4*e.buffer.width|0,a=4*t.x+o*t.y|0,l=o-(4*t.width|0),h=4*(t.x+t.width)|0
if(r.set_length(4*n),1==i)for(var u=0;n>u;){var c=u++
r.__set(4*c+1,s[a++]),r.__set(4*c+2,s[a++]),r.__set(4*c+3,s[a++]),r.__set(4*c,s[a++]),a%o>h&&(a+=l)}else for(var f=0;n>f;){var d=f++
r.__set(4*d,s[a++]),r.__set(4*d+1,s[a++]),r.__set(4*d+2,s[a++]),r.__set(4*d+3,s[a++]),a%o>h&&(a+=l)}return r.position=0,r},Ln.merge=function(e,t,i,n,r,s,o,a){if(null!=e.buffer.data&&null!=t.buffer.data){for(var l=n.y+e.offsetY-i.y-t.offsetY|0,h=n.x+e.offsetX-i.x-t.offsetY|0,u=t.buffer.data,c=4*t.buffer.width,f=0,d=e.buffer.data,m=4*e.buffer.width,_=0,p=g["int"](i.get_top()+t.offsetY),v=g["int"](i.get_bottom()+t.offsetY);v>p;)for(var x=p++,y=g["int"](i.get_left()+t.offsetX),b=g["int"](i.get_right()+t.offsetX);b>y;){var w=y++
f=x*c+4*w,_=(x+l)*m+4*(w+h),d[_]=(u[_]*r+d[_]*(256-r))/256|0,d[_+1]=(u[_+1]*s+d[_+1]*(256-s))/256|0,d[_+2]=(u[_+2]*o+d[_+2]*(256-o))/256|0,d[_+3]=(u[_+3]*a+d[_+3]*(256-a))/256|0}e.dirty=!0}},Ln.multiplyAlpha=function(e){var t=e.buffer.data
if(null!=t&&e.buffer.transparent){for(var i,n,r=t.length/4|0,s=0;r>s;){var o=s++
i=4*o,n=Ln.__alpha16[t[i+3]],t[i]=t[i]*n>>16,t[i+1]=t[i+1]*n>>16,t[i+2]=t[i+2]*n>>16}e.buffer.premultiplied=!0,e.dirty=!0}},Ln.resize=function(e,t,i){var n=e.buffer
if(n.width!=t||n.height!=i){for(var r,s,o,a,l,h,u,c,f,d,m,_,p,v=new pn(new Us(t*i*4),t,i),g=e.width,x=e.height,y=e.get_data(),b=v.data,w=0;i>w;)for(var S=w++,M=0;t>M;){var T=M++
c=(T+.5)/t*g-.5,f=(S+.5)/i*x-.5,h=0|c,u=0|f,r=4*(u*g+h),s=g-1>h?r+4:r,o=x-1>u?r+4*g:r,a=s!=r?o+4:o,l=4*(S*t+T),d=c-h,m=f-u,_=1-d,p=1-m,b[l]=(y[r]*_+y[s]*d)*p+(y[o]*_+y[a]*d)*m|0,b[l+1]=(y[r+1]*_+y[s+1]*d)*p+(y[o+1]*_+y[a+1]*d)*m|0,b[l+2]=(y[r+2]*_+y[s+2]*d)*p+(y[o+2]*_+y[a+2]*d)*m|0,0==y[s+3]||0==y[o+3]||0==y[a+3]?b[l+3]=0:b[l+3]=y[r+3]}n.data=v.data,n.width=t,n.height=i}},Ln.resizeBuffer=function(e,t,i){for(var n,r,s=e.buffer,o=e.get_data(),a=new Us(t*i*4),l=0,h=s.height;h>l;)for(var u=l++,c=0,f=s.width;f>c;){var d=c++
n=4*(u*s.width+d),r=4*(u*t+d),a[r]=o[n],a[r+1]=o[n+1],a[r+2]=o[n+2],a[r+3]=o[n+3]}s.data=a,s.width=t,s.height=i},Ln.setFormat=function(e,t){var i=e.buffer.data
if(null!=i){var n,r,s,o,a,l,h,u,c,f,d,m,_,p=i.length/4|0,v=e.get_format()
switch(v){case 0:r=0,s=1,o=2,a=3
break
case 1:r=1,s=2,o=3,a=0
break
case 2:r=2,s=1,o=0,a=3}switch(t){case 0:l=0,h=1,u=2,c=3
break
case 1:l=1,h=2,u=3,c=0
break
case 2:l=2,h=1,u=0,c=3}for(var g=0;p>g;){var x=g++
n=4*x,f=i[n+r],d=i[n+s],m=i[n+o],_=i[n+a],i[n+l]=f,i[n+h]=d,i[n+u]=m,i[n+c]=_}e.buffer.format=t,e.dirty=!0}},Ln.setPixel=function(e,t,i,n,r){var s=e.buffer.data,o=4*(i+e.offsetY)*e.buffer.width+4*(t+e.offsetX)
0==r&&(n>>=8),s[o]=(16711680&n)>>>16,s[o+1]=(65280&n)>>>8,s[o+2]=255&n,e.get_transparent()&&(s[o+3]=255),e.dirty=!0},Ln.setPixel32=function(e,t,i,n,r){var s,o,a,l,h=e.buffer.data,u=4*(i+e.offsetY)*e.buffer.width+4*(t+e.offsetX)
if(1==r?(s=e.get_transparent()?n>>24&255:255,o=n>>16&255,a=n>>8&255,l=255&n):(o=n>>24&255,a=n>>16&255,l=n>>8&255,s=e.get_transparent()?255&n:255),e.get_transparent()&&e.get_premultiplied()){var c=Ln.__alpha16[s]
h[u]=o*c>>16,h[u+1]=a*c>>16,h[u+2]=l*c>>16,h[u+3]=s}else h[u]=o,h[u+1]=a,h[u+2]=l,h[u+3]=s
e.dirty=!0},Ln.setPixels=function(e,t,i,n){if(null!=e.buffer.data){var r,s=Math.round(t.width*t.height),o=e.buffer.data,a=Math.round(e.buffer.width*(t.y+e.offsetX)+(t.x+e.offsetY)),l=4*a,h=Math.round(t.x+t.width+e.offsetX),u=e.buffer.width
if(1==n)for(var c=0;s>c;){c++
l%(4*u)>=4*h&&(l+=4*(u-h)),r=i.readUnsignedInt(),o[l++]=(16711680&r)>>>16,o[l++]=(65280&r)>>>8,o[l++]=255&r,o[l++]=(-16777216&r)>>>24}else for(var f=0;s>f;){f++
l%(4*u)>=4*h&&(l+=4*(u-h)),r=i.readUnsignedInt(),o[l++]=(-16777216&r)>>>24,o[l++]=(16711680&r)>>>16,o[l++]=(65280&r)>>>8,o[l++]=255&r}e.dirty=!0}},Ln.unmultiplyAlpha=function(e){var t=e.buffer.data
if(null!=t){for(var i,n,r,s=t.length/4|0,o=0;s>o;){var a=o++
i=4*a,n=t[i+3],0!=n&&(r=255/n,t[i]=Ln.__clamp[t[i]*r|0],t[i+1]=Ln.__clamp[t[i+1]*r|0],t[i+2]=Ln.__clamp[t[i+2]*r|0])}e.buffer.premultiplied=!1,e.dirty=!0}}
var Fn={}
s["lime.math._ColorMatrix.ColorMatrix_Impl_"]=Fn,Fn.__name__=["lime","math","_ColorMatrix","ColorMatrix_Impl_"],Fn.__properties__={set_redOffset:"set_redOffset",get_redOffset:"get_redOffset",set_redMultiplier:"set_redMultiplier",get_redMultiplier:"get_redMultiplier",set_greenOffset:"set_greenOffset",get_greenOffset:"get_greenOffset",set_greenMultiplier:"set_greenMultiplier",get_greenMultiplier:"get_greenMultiplier",set_color:"set_color",get_color:"get_color",set_blueOffset:"set_blueOffset",get_blueOffset:"get_blueOffset",set_blueMultiplier:"set_blueMultiplier",get_blueMultiplier:"get_blueMultiplier",set_alphaOffset:"set_alphaOffset",get_alphaOffset:"get_alphaOffset",set_alphaMultiplier:"set_alphaMultiplier",get_alphaMultiplier:"get_alphaMultiplier"},Fn._new=function(e){var t
return t=null!=e&&20==e.length?e:new Float32Array(Fn.__identity)},Fn.clone=function(e){return Fn._new(new Float32Array(e))},Fn.concat=function(e,t){var i=e,n=i[0]+t[0]
i[0]=n
var r=e,s=r[6]+t[6]
r[6]=s
var o=e,a=o[12]+t[12]
o[12]=a
var l=e,h=l[18]+t[18]
l[18]=h},Fn.copyFrom=function(e,t){e.set(t)},Fn.identity=function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=1,e[7]=0,e[8]=0,e[9]=0,e[10]=0,e[11]=0,e[12]=1,e[13]=0,e[14]=0,e[15]=0,e[16]=0,e[17]=0,e[18]=1,e[19]=0},Fn.__toFlashColorTransform=function(){return null},Fn.get_alphaMultiplier=function(e){return e[18]},Fn.set_alphaMultiplier=function(e,t){return e[18]=t,t},Fn.get_alphaOffset=function(e){return 255*e[19]},Fn.set_alphaOffset=function(e,t){return e[19]=t/255,t},Fn.get_blueMultiplier=function(e){return e[12]},Fn.set_blueMultiplier=function(e,t){return e[12]=t,t},Fn.get_blueOffset=function(e){return 255*e[14]},Fn.set_blueOffset=function(e,t){return e[14]=t/255,t},Fn.get_color=function(e){return(255*e[4]|0)<<16|(255*e[9]|0)<<8|(255*e[14]|0)},Fn.set_color=function(e,t){var i=t>>16&255
e[4]=i/255
var n=t>>8&255
e[9]=n/255
var r=255&t
return e[14]=r/255,e[0]=0,e[6]=0,e[12]=0,Fn.get_color(e)},Fn.get_greenMultiplier=function(e){return e[6]},Fn.set_greenMultiplier=function(e,t){return e[6]=t,t},Fn.get_greenOffset=function(e){return 255*e[9]},Fn.set_greenOffset=function(e,t){return e[9]=t/255,t},Fn.get_redMultiplier=function(e){return e[0]},Fn.set_redMultiplier=function(e,t){return e[0]=t,t},Fn.get_redOffset=function(e){return 255*e[4]},Fn.set_redOffset=function(e,t){return e[4]=t/255,t},Fn.get=function(e,t){return e[t]},Fn.set=function(e,t,i){return e[t]=i,i}
var Rn=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=0),null==n&&(n=1),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1),this.a=e,this.b=t,this.c=i,this.d=n,this.tx=r,this.ty=s}
s["lime.math.Matrix3"]=Rn,Rn.__name__=["lime","math","Matrix3"],Rn.prototype={a:null,b:null,c:null,d:null,tx:null,ty:null,clone:function(){return new Rn(this.a,this.b,this.c,this.d,this.tx,this.ty)},concat:function(e){var t=this.a*e.a+this.b*e.c
this.b=this.a*e.b+this.b*e.d,this.a=t
var i=this.c*e.a+this.d*e.c
this.d=this.c*e.b+this.d*e.d,this.c=i
var n=this.tx*e.a+this.ty*e.c+e.tx
this.ty=this.tx*e.b+this.ty*e.d+e.ty,this.tx=n},copyColumnFrom:function(e,t){if(e>2)throw new Wi("Column "+e+" out of bounds (2)")
0==e?(this.a=t.x,this.c=t.y):1==e?(this.b=t.x,this.d=t.y):(this.tx=t.x,this.ty=t.y)},copyColumnTo:function(e,t){if(e>2)throw new Wi("Column "+e+" out of bounds (2)")
0==e?(t.x=this.a,t.y=this.c,t.z=0):1==e?(t.x=this.b,t.y=this.d,t.z=0):(t.x=this.tx,t.y=this.ty,t.z=1)},copyFrom:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty},copyRowFrom:function(e,t){if(e>2)throw new Wi("Row "+e+" out of bounds (2)")
0==e?(this.a=t.x,this.c=t.y):1==e?(this.b=t.x,this.d=t.y):(this.tx=t.x,this.ty=t.y)},copyRowTo:function(e,t){if(e>2)throw new Wi("Row "+e+" out of bounds (2)")
0==e?(t.x=this.a,t.y=this.b,t.z=this.tx):1==e?(t.x=this.c,t.y=this.d,t.z=this.ty):(t.x=0,t.y=0,t.z=1)},createBox:function(e,t,i,n,r){null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),this.a=e,this.d=t,this.b=i,this.tx=n,this.ty=r},createGradientBox:function(e,t,i,n,r){if(null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),this.a=e/1638.4,this.d=t/1638.4,0!=i){var s=Math.cos(i),o=Math.sin(i)
this.b=o*this.d,this.c=-o*this.a,this.a*=s,this.d*=s}else this.b=0,this.c=0
this.tx=n+e/2,this.ty=r+t/2},equals:function(e){return null!=e&&this.tx==e.tx&&this.ty==e.ty&&this.a==e.a&&this.b==e.b&&this.c==e.c&&this.d==e.d},deltaTransformVector2:function(e){return new Bn(e.x*this.a+e.y*this.c,e.x*this.b+e.y*this.d)},identity:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},invert:function(){var e=this.a*this.d-this.b*this.c
if(0==e)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty
else{e=1/e
var t=this.d*e
this.d=this.a*e,this.a=t,this.b*=-e,this.c*=-e
var i=-this.a*this.tx-this.c*this.ty
this.ty=-this.b*this.tx-this.d*this.ty,this.tx=i}return this},mult:function(e){var t=new Rn(this.a,this.b,this.c,this.d,this.tx,this.ty)
return t.concat(e),t},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=this.a*t-this.b*i
this.b=this.a*i+this.b*t,this.a=n
var r=this.c*t-this.d*i
this.d=this.c*i+this.d*t,this.c=r
var s=this.tx*t-this.ty*i
this.ty=this.tx*i+this.ty*t,this.tx=s},scale:function(e,t){this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.tx*=e,this.ty*=t},setRotation:function(e,t){null==t&&(t=1),this.a=Math.cos(e)*t,this.c=Math.sin(e)*t,this.b=-this.c,this.d=this.a},setTo:function(e,t,i,n,r,s){this.a=e,this.b=t,this.c=i,this.d=n,this.tx=r,this.ty=s},to3DString:function(e){return null==e&&(e=!1),e?"Matrix33d("+this.a+", "+this.b+", 0, 0, "+this.c+", "+this.d+", 0, 0, 0, 0, 1, 0, "+(0|this.tx)+", "+(0|this.ty)+", 0, 1)":"Matrix33d("+this.a+", "+this.b+", 0, 0, "+this.c+", "+this.d+", 0, 0, 0, 0, 1, 0, "+this.tx+", "+this.ty+", 0, 1)"},toMozString:function(){return"Matrix3("+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.tx+"px, "+this.ty+"px)"},toString:function(){return"Matrix3("+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.tx+", "+this.ty+")"},transformVector2:function(e){return new Bn(e.x*this.a+e.y*this.c+this.tx,e.x*this.b+e.y*this.d+this.ty)},translate:function(e,t){this.tx+=e,this.ty+=t},__cleanValues:function(){this.a=Math.round(1e3*this.a)/1e3,this.b=Math.round(1e3*this.b)/1e3,this.c=Math.round(1e3*this.c)/1e3,this.d=Math.round(1e3*this.d)/1e3,this.tx=Math.round(10*this.tx)/10,this.ty=Math.round(10*this.ty)/10},__transformX:function(e){return e.x*this.a+e.y*this.c+this.tx},__transformY:function(e){return e.x*this.b+e.y*this.d+this.ty},__translateTransformed:function(e){this.tx=e.x*this.a+e.y*this.c+this.tx,this.ty=e.x*this.b+e.y*this.d+this.ty},__class__:Rn}
var zn=function(e,t,i,n){null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.width=i,this.height=n}
s["lime.math.Rectangle"]=zn,zn.__name__=["lime","math","Rectangle"],zn.prototype={height:null,width:null,x:null,y:null,clone:function(){return new zn(this.x,this.y,this.width,this.height)},contains:function(e,t){return e>=this.x&&t>=this.y&&e<this.get_right()&&t<this.get_bottom()},containsPoint:function(e){return this.contains(e.x,e.y)},containsRect:function(e){return e.width<=0||e.height<=0?e.x>this.x&&e.y>this.y&&e.get_right()<this.get_right()&&e.get_bottom()<this.get_bottom():e.x>=this.x&&e.y>=this.y&&e.get_right()<=this.get_right()&&e.get_bottom()<=this.get_bottom()},copyFrom:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},equals:function(e){return null!=e&&this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height},inflate:function(e,t){this.x-=e,this.width+=2*e,this.y-=t,this.height+=2*t},inflatePoint:function(e){this.inflate(e.x,e.y)},intersection:function(e){var t
t=this.x<e.x?e.x:this.x
var i
if(i=this.get_right()>e.get_right()?e.get_right():this.get_right(),t>=i)return new zn
var n
n=this.y<e.y?e.y:this.y
var r
return r=this.get_bottom()>e.get_bottom()?e.get_bottom():this.get_bottom(),n>=r?new zn:new zn(t,n,i-t,r-n)},intersects:function(e){var t
t=this.x<e.x?e.x:this.x
var i
if(i=this.get_right()>e.get_right()?e.get_right():this.get_right(),t>=i)return!1
var n
n=this.y<e.y?e.y:this.y
var r
return r=this.get_bottom()>e.get_bottom()?e.get_bottom():this.get_bottom(),r>n},isEmpty:function(){return this.width<=0||this.height<=0},offset:function(e,t){this.x+=e,this.y+=t},offsetPoint:function(e){this.x+=e.x,this.y+=e.y},setEmpty:function(){this.x=this.y=this.width=this.height=0},setTo:function(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n},transform:function(e){var t=e.a*this.x+e.c*this.y,i=t,n=e.b*this.x+e.d*this.y,r=n,s=e.a*(this.x+this.width)+e.c*this.y,o=e.b*(this.x+this.width)+e.d*this.y
return t>s&&(t=s),n>o&&(n=o),s>i&&(i=s),o>r&&(r=o),s=e.a*(this.x+this.width)+e.c*(this.y+this.height),o=e.b*(this.x+this.width)+e.d*(this.y+this.height),t>s&&(t=s),n>o&&(n=o),s>i&&(i=s),o>r&&(r=o),s=e.a*this.x+e.c*(this.y+this.height),o=e.b*this.x+e.d*(this.y+this.height),t>s&&(t=s),n>o&&(n=o),s>i&&(i=s),o>r&&(r=o),new zn(t+e.tx,n+e.ty,i-t,r-n)},union:function(e){if(0==this.width||0==this.height)return e.clone()
if(0==e.width||0==e.height)return this.clone()
var t
t=this.x>e.x?e.x:this.x
var i
i=this.get_right()<e.get_right()?e.get_right():this.get_right()
var n
n=this.y>e.y?e.y:this.y
var r
return r=this.get_bottom()<e.get_bottom()?e.get_bottom():this.get_bottom(),new zn(t,n,i-t,r-n)},__contract:function(e,t,i,n){if(0!=this.width||0!=this.height){this.get_right(),this.get_bottom()
this.x<e&&(this.x=e),this.y<t&&(this.y=t),this.get_right()>e+i&&(this.width=e+i-this.x),this.get_bottom()>t+n&&(this.height=t+n-this.y)}},__expand:function(e,t,i,n){if(0==this.width&&0==this.height)return this.x=e,this.y=t,this.width=i,void(this.height=n)
var r=this.get_right(),s=this.get_bottom()
this.x>e&&(this.x=e),this.y>t&&(this.y=t),e+i>r&&(this.width=e+i-this.x),t+n>s&&(this.height=t+n-this.y)},__toFlashRectangle:function(){return null},get_bottom:function(){return this.y+this.height},set_bottom:function(e){return this.height=e-this.y,e},get_bottomRight:function(){return new Bn(this.x+this.width,this.y+this.height)},set_bottomRight:function(e){return this.width=e.x-this.x,this.height=e.y-this.y,e.clone()},get_left:function(){return this.x},set_left:function(e){return this.width-=e-this.x,this.x=e,e},get_right:function(){return this.x+this.width},set_right:function(e){return this.width=e-this.x,e},get_size:function(){return new Bn(this.width,this.height)},set_size:function(e){return this.width=e.x,this.height=e.y,e.clone()},get_top:function(){return this.y},set_top:function(e){return this.height-=e-this.y,this.y=e,e},get_topLeft:function(){return new Bn(this.x,this.y)},set_topLeft:function(e){return this.x=e.x,this.y=e.y,e.clone()},__class__:zn,__properties__:{set_topLeft:"set_topLeft",get_topLeft:"get_topLeft",set_top:"set_top",get_top:"get_top",set_size:"set_size",get_size:"get_size",set_right:"set_right",get_right:"get_right",set_left:"set_left",get_left:"get_left",set_bottomRight:"set_bottomRight",get_bottomRight:"get_bottomRight",set_bottom:"set_bottom",get_bottom:"get_bottom"}}
var Bn=function(e,t){null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t}
s["lime.math.Vector2"]=Bn,Bn.__name__=["lime","math","Vector2"],Bn.distance=function(e,t){var i=e.x-t.x,n=e.y-t.y
return Math.sqrt(i*i+n*n)},Bn.interpolate=function(e,t,i){return new Bn(t.x+i*(e.x-t.x),t.y+i*(e.y-t.y))},Bn.polar=function(e,t){return new Bn(e*Math.cos(t),e*Math.sin(t))},Bn.prototype={length:null,x:null,y:null,add:function(e){return new Bn(e.x+this.x,e.y+this.y)},clone:function(){return new Bn(this.x,this.y)},equals:function(e){return null!=e&&e.x==this.x&&e.y==this.y},normalize:function(e){if(0!=this.x||0!=this.y){var t=e/Math.sqrt(this.x*this.x+this.y*this.y)
this.x*=t,this.y*=t}},offset:function(e,t){this.x+=e,this.y+=t},setTo:function(e,t){this.x=e,this.y=t},subtract:function(e){return new Bn(this.x-e.x,this.y-e.y)},__toFlashPoint:function(){return null},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},__class__:Bn,__properties__:{get_length:"get_length"}}
var On=function(e,t,i,n){null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.w=n,this.x=e,this.y=t,this.z=i}
s["lime.math.Vector4"]=On,On.__name__=["lime","math","Vector4"],On.__properties__={get_Z_AXIS:"get_Z_AXIS",get_Y_AXIS:"get_Y_AXIS",get_X_AXIS:"get_X_AXIS"},On.angleBetween=function(e,t){var i=new On(e.x,e.y,e.z,e.w)
i.normalize()
var n=new On(t.x,t.y,t.z,t.w)
return n.normalize(),Math.acos(i.x*n.x+i.y*n.y+i.z*n.z)},On.distance=function(e,t){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z
return Math.sqrt(i*i+n*n+r*r)},On.get_X_AXIS=function(){return new On(1,0,0)},On.get_Y_AXIS=function(){return new On(0,1,0)},On.get_Z_AXIS=function(){return new On(0,0,1)},On.prototype={length:null,lengthSquared:null,w:null,x:null,y:null,z:null,add:function(e){return new On(this.x+e.x,this.y+e.y,this.z+e.z)},clone:function(){return new On(this.x,this.y,this.z,this.w)},copyFrom:function(e){this.x=e.x,this.y=e.y,this.z=e.z},crossProduct:function(e){return new On(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x,1)},decrementBy:function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},dotProduct:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},equals:function(e,t){return null==t&&(t=!1),this.x==e.x&&this.y==e.y&&this.z==e.z&&(!t||this.w==e.w)},incrementBy:function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},nearEquals:function(e,t,i){return null==i&&(i=!1),Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t&&(!i||Math.abs(this.w-e.w)<t)},negate:function(){this.x*=-1,this.y*=-1,this.z*=-1},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)
return 0!=e&&(this.x/=e,this.y/=e,this.z/=e),e},project:function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},scaleBy:function(e){this.x*=e,this.y*=e,this.z*=e},setTo:function(e,t,i){this.x=e,this.y=t,this.z=i},subtract:function(e){return new On(this.x-e.x,this.y-e.y,this.z-e.z)},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+")"},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},get_lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},__class__:On,__properties__:{get_lengthSquared:"get_lengthSquared",get_length:"get_length"}}
var kn=function(e){this.onSecurityError=new Ji,this.onProgress=new Ji,this.onOpen=new Ji,this.onIOError=new Ji,this.onHTTPStatus=new Ji,this.onComplete=new Ji,this.bytesLoaded=0,this.bytesTotal=0,this.set_dataFormat(Vn.TEXT),null!=e&&this.load(e)}
s["lime.net.URLLoader"]=kn,kn.__name__=["lime","net","URLLoader"],kn.prototype={bytesLoaded:null,bytesTotal:null,data:null,dataFormat:null,onComplete:null,onHTTPStatus:null,onIOError:null,onOpen:null,onProgress:null,onSecurityError:null,close:function(){},getData:function(){return null},load:function(e){this.requestUrl(e.url,e.method,e.data,e.formatRequestHeaders())},registerEvents:function(e){var t=this,i=this
"undefined"!=typeof XMLHttpRequestProgressEvent&&e.addEventListener("progress",r(this,this.__onProgress),!1),e.onreadystatechange=function(){if(4==e.readyState){var n
try{n=e.status}catch(r){r instanceof Wi&&(r=r.val),n=null}if(void 0==n&&(n=null),null!=n)for(var s=i.onHTTPStatus.listeners,o=i.onHTTPStatus.repeat,a=s.length,l=0;a>l;)s[l](t,n),o[l]?l++:(i.onHTTPStatus.remove(s[l]),a--)
if(null!=n&&n>=200&&400>n)i.__onData(e.response)
else if(null==n)for(var h=i.onIOError.listeners,u=i.onIOError.repeat,c=h.length,f=0;c>f;)h[f](t,"Failed to connect or resolve host"),u[f]?f++:(i.onIOError.remove(h[f]),c--)
else if(12029==n)for(var d=i.onIOError.listeners,m=i.onIOError.repeat,_=d.length,p=0;_>p;)d[p](t,"Failed to connect to host"),m[p]?p++:(i.onIOError.remove(d[p]),_--)
else if(12007==n)for(var v=i.onIOError.listeners,g=i.onIOError.repeat,x=v.length,y=0;x>y;)v[y](t,"Unknown host"),g[y]?y++:(i.onIOError.remove(v[y]),x--)
else if(0==n){for(var b=i.onIOError.listeners,w=i.onIOError.repeat,S=b.length,M=0;S>M;)b[M](t,"Unable to make request (may be blocked due to cross-domain permissions)"),w[M]?M++:(i.onIOError.remove(b[M]),S--)
for(var T=i.onSecurityError.listeners,C=i.onSecurityError.repeat,A=T.length,I=0;A>I;)T[I](t,"Unable to make request (may be blocked due to cross-domain permissions)"),C[I]?I++:(i.onSecurityError.remove(T[I]),A--)}else for(var P=i.onIOError.listeners,E=i.onIOError.repeat,D=P.length,L=0;D>L;)P[L](t,"Http Error #"+e.status),E[L]?L++:(i.onIOError.remove(P[L]),D--)}}},requestUrl:function(e,t,i,n){var r=new XMLHttpRequest
this.registerEvents(r)
var s=""
if(Me.__instanceof(i,Jn)){var o=i,a=this.dataFormat
switch(a[1]){case 0:s=o.data.buffer
break
default:s=o.readUTFBytes(o.length)}}else if(Me.__instanceof(i,Wn))for(var l=i,h=0,u=v.fields(l);h<u.length;){var c=u[h];++h,0!=s.length&&(s+="&"),s+=encodeURIComponent(c)+"="+y.urlEncode(v.field(l,c))}else null!=i&&(s=""+i)
try{if("GET"==t&&null!=s&&""!=s){var f=e.split("?").length<=1
r.open("GET",e+(f?"?":"&")+g.string(s),!0),s=""}else r.open(Me.__cast(t,String),e,!0)}catch(d){d instanceof Wi&&(d=d.val)
for(var m=this.onIOError.listeners,_=this.onIOError.repeat,p=m.length,x=0;p>x;)m[x](this,""+d),_[x]?x++:(this.onIOError.remove(m[x]),p--)
return}var b=this.dataFormat
switch(b[1]){case 0:r.responseType="arraybuffer"}for(var w=0;w<n.length;){var S=n[w];++w,r.setRequestHeader(S.name,S.value)}r.send(s)
for(var M=this.onOpen.listeners,T=this.onOpen.repeat,C=M.length,A=0;C>A;)M[A](this),T[A]?A++:(this.onOpen.remove(M[A]),C--)
this.getData=function(){return null!=r.response?r.response:r.responseText}},__onData:function(){var e=this.getData(),t=this.dataFormat
switch(t[1]){case 0:this.data=Jn.__ofBuffer(e)
break
default:this.data=g.string(e)}for(var i=this.onComplete.listeners,n=this.onComplete.repeat,r=i.length,s=0;r>s;)i[s](this),n[s]?s++:(this.onComplete.remove(i[s]),r--)},__onProgress:function(e){this.bytesLoaded=e.loaded,this.bytesTotal=e.total
for(var t=this.onProgress.listeners,i=this.onProgress.repeat,n=t.length,r=0;n>r;)t[r](this,this.bytesLoaded,this.bytesTotal),i[r]?r++:(this.onProgress.remove(t[r]),n--)},set_dataFormat:function(e){return e!=Vn.BINARY||v.hasField(window,"ArrayBuffer")?this.dataFormat=e:this.dataFormat=Vn.TEXT,this.dataFormat},__class__:kn,__properties__:{set_dataFormat:"set_dataFormat"}}
var Vn=s["lime.net.URLLoaderDataFormat"]={__ename__:!0,__constructs__:["BINARY","TEXT","VARIABLES"]}
Vn.BINARY=["BINARY",0],Vn.BINARY.toString=o,Vn.BINARY.__enum__=Vn,Vn.TEXT=["TEXT",1],Vn.TEXT.toString=o,Vn.TEXT.__enum__=Vn,Vn.VARIABLES=["VARIABLES",2],Vn.VARIABLES.toString=o,Vn.VARIABLES.__enum__=Vn
var Nn=function(e){null!=e&&(this.url=e),this.requestHeaders=[],this.method="GET",this.contentType=null}
s["lime.net.URLRequest"]=Nn,Nn.__name__=["lime","net","URLRequest"],Nn.prototype={contentType:null,data:null,method:null,requestHeaders:null,url:null,userAgent:null,formatRequestHeaders:function(){var e=this.requestHeaders
return null==e&&(e=[]),"GET"==this.method||null==this.data?e:(("string"==typeof this.data||Me.__instanceof(this.data,Jn))&&(e=e.slice(),e.push(new Un("Content-Type",null!=this.contentType?this.contentType:"application/x-www-form-urlencoded"))),e)},__class__:Nn}
var Un=function(e,t){null==t&&(t=""),null==e&&(e=""),this.name=e,this.value=t}
s["lime.net.URLRequestHeader"]=Un,Un.__name__=["lime","net","URLRequestHeader"],Un.prototype={name:null,value:null,__class__:Un}
var Wn=function(e){null!=e&&this.decode(e)}
s["lime.net.URLVariables"]=Wn,Wn.__name__=["lime","net","URLVariables"],Wn.prototype={decode:function(e){for(var t=v.fields(this),i=0;i<t.length;){var n=t[i];++i,v.deleteField(this,n)}for(var r=e.split(";").join("&").split("&"),s=0;s<r.length;){var o=r[s];++s
var a=o.indexOf("=")
a>0?v.setField(this,y.urlDecode(c.substr(o,0,a)),y.urlDecode(c.substr(o,a+1,null))):0!=a&&v.setField(this,decodeURIComponent(o.split("+").join(" ")),"")}},toString:function(){for(var e=[],t=v.fields(this),i=0;i<t.length;){var n=t[i];++i,e.push(encodeURIComponent(n)+"="+y.urlEncode(v.field(this,n)))}return e.join("&")},__class__:Wn}
var Gn=function(){}
s["lime.system.System"]=Gn,Gn.__name__=["lime","system","System"],Gn.__properties__={get_userDirectory:"get_userDirectory",get_fontsDirectory:"get_fontsDirectory",get_documentsDirectory:"get_documentsDirectory",get_desktopDirectory:"get_desktopDirectory",get_applicationStorageDirectory:"get_applicationStorageDirectory",get_applicationDirectory:"get_applicationDirectory"},Gn.embed=t.lime.embed=function(e,t,i,n,r){var s=null
s="string"==typeof e?window.document.getElementById(Me.__cast(e,String)):null==e?window.document.createElement("div"):e
var o=null
null!=n&&(n=y.replace(n,"#",""),o=g.parseInt(n.indexOf("0x")>-1?n:"0x"+n)),null==t&&(t=0),null==i&&(i=0),a.config.background=o,a.config.element=s,a.config.width=t,a.config.height=i,a.config.assetsPrefix=r,a.create()},Gn.exit=function(){},Gn.findHaxeLib=function(){return""},Gn.getTimer=function(){return(new Date).getTime()},Gn.load=function(e,t,i,n){if(null==n&&(n=!1),null==i&&(i=0),Gn.disableCFFI)return v.makeVarArgs(function(){return{}})
var r=null
return r},Gn.sysName=function(){return null},Gn.tryLoad=function(){return null},Gn.loaderTrace=function(){},Gn.get_applicationDirectory=function(){return null},Gn.get_applicationStorageDirectory=function(){var e="MyCompany",t="MyApplication"
return null!=_.current&&null!=_.current.config&&(null!=_.current.config.company&&(e=_.current.config.company),null!=_.current.config.file&&(t=_.current.config.file)),null},Gn.get_desktopDirectory=function(){return null},Gn.get_documentsDirectory=function(){return null},Gn.get_fontsDirectory=function(){return null},Gn.get_userDirectory=function(){return null}
var Yn=function(e){null!=e&&(this.name=e),null!=this.__fontPath&&this.__fromFile(this.__fontPath)}
s["lime.text.Font"]=Yn,Yn.__name__=["lime","text","Font"],Yn.fromBytes=function(e){var t=new Yn
return t.__fromBytes(e),t},Yn.fromFile=function(e){var t=new Yn
return t.__fromFile(e),t},Yn.prototype={ascender:null,descender:null,height:null,name:null,numGlyphs:null,src:null,underlinePosition:null,underlineThickness:null,unitsPerEM:null,__fontPath:null,decompose:function(){return null},getGlyph:function(){return-1},getGlyphs:function(e){return null==e&&(e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^`'\"/\\&*()[]{}<>|:;_-+=?,. "),null},getGlyphMetrics:function(){return null},renderGlyph:function(){return null},renderGlyphs:function(){return null},__fromBytes:function(){this.__fontPath=null},__fromFile:function(e){this.__fontPath=e},get_ascender:function(){return 0},get_descender:function(){return 0},get_height:function(){return 0},get_numGlyphs:function(){return 0},get_underlinePosition:function(){return 0},get_underlineThickness:function(){return 0},get_unitsPerEM:function(){return 0},__class__:Yn,__properties__:{get_unitsPerEM:"get_unitsPerEM",get_underlineThickness:"get_underlineThickness",get_underlinePosition:"get_underlinePosition",get_numGlyphs:"get_numGlyphs",get_height:"get_height",get_descender:"get_descender",get_ascender:"get_ascender"}}
var Hn={}
s["lime.text._Glyph.Glyph_Impl_"]=Hn,Hn.__name__=["lime","text","_Glyph","Glyph_Impl_"],Hn._new=function(e){return e}
var Xn=function(){}
s["lime.text.GlyphMetrics"]=Xn,Xn.__name__=["lime","text","GlyphMetrics"],Xn.prototype={advance:null,height:null,horizontalBearing:null,verticalBearing:null,__class__:Xn}
var jn=function(e){this.id=e,this.connected=!0}
s["lime.ui.Gamepad"]=jn,jn.__name__=["lime","ui","Gamepad"],jn.prototype={connected:null,id:null,get_guid:function(){return null},get_name:function(){return null},__class__:jn,__properties__:{get_name:"get_name",get_guid:"get_guid"}}
var Kn={}
s["lime.ui._GamepadAxis.GamepadAxis_Impl_"]=Kn,Kn.__name__=["lime","ui","_GamepadAxis","GamepadAxis_Impl_"],Kn.toString=function(e){switch(e){case 0:return"LEFT_X"
case 1:return"LEFT_Y"
case 2:return"RIGHT_X"
case 3:return"RIGHT_Y"
case 4:return"TRIGGER_LEFT"
case 5:return"TRIGGER_RIGHT"
default:return"UNKNOWN ("+e+")"}}
var Zn={}
s["lime.ui._GamepadButton.GamepadButton_Impl_"]=Zn,Zn.__name__=["lime","ui","_GamepadButton","GamepadButton_Impl_"],Zn.toString=function(e){switch(e){case 0:return"A"
case 1:return"B"
case 2:return"X"
case 3:return"Y"
case 4:return"BACK"
case 5:return"GUIDE"
case 6:return"START"
case 7:return"LEFT_STICK"
case 8:return"RIGHT_STICK"
case 9:return"LEFT_SHOULDER"
case 10:return"RIGHT_SHOULDER"
case 11:return"DPAD_UP"
case 12:return"DPAD_DOWN"
case 13:return"DPAD_LEFT"
case 14:return"DPAD_RIGHT"
default:return"UNKNOWN ("+e+")"}}
var qn={}
s["lime.ui._KeyModifier.KeyModifier_Impl_"]=qn,qn.__name__=["lime","ui","_KeyModifier","KeyModifier_Impl_"],qn.__properties__={set_shiftKey:"set_shiftKey",get_shiftKey:"get_shiftKey",set_numLock:"set_numLock",get_numLock:"get_numLock",set_metaKey:"set_metaKey",get_metaKey:"get_metaKey",set_ctrlKey:"set_ctrlKey",get_ctrlKey:"get_ctrlKey",set_capsLock:"set_capsLock",get_capsLock:"get_capsLock",set_altKey:"set_altKey",get_altKey:"get_altKey"},qn.get_altKey=function(e){return(256&e)>0||(512&e)>0},qn.set_altKey=function(e,t){return t?e|=768:e&=268434687,t},qn.get_capsLock=function(e){return(8192&e)>0||(8192&e)>0},qn.set_capsLock=function(e,t){return t?e|=8192:e&=268427263,t},qn.get_ctrlKey=function(e){return(64&e)>0||(128&e)>0},qn.set_ctrlKey=function(e,t){return t?e|=192:e&=268435263,t},qn.get_metaKey=function(e){return(1024&e)>0||(2048&e)>0},qn.set_metaKey=function(e,t){return t?e|=3072:e&=268432383,t},qn.get_numLock=function(e){return(4096&e)>0||(4096&e)>0},qn.set_numLock=function(e,t){return t?e|=4096:e&=268431359,t},qn.get_shiftKey=function(e){return(1&e)>0||(2&e)>0},qn.set_shiftKey=function(e,t){return t?e|=3:e&=268435452,t}
var Qn=function(e){this.onWindowRestore=new Ji,this.onWindowResize=new Ji,this.onWindowMove=new Ji,this.onWindowMinimize=new Ji,this.onWindowLeave=new Ji,this.onWindowFullscreen=new Ji,this.onWindowFocusOut=new Ji,this.onWindowFocusIn=new Ji,this.onWindowEnter=new Ji,this.onWindowDeactivate=new Ji,this.onWindowClose=new Ji,this.onWindowActivate=new Ji,this.onTouchStart=new Ji,this.onTouchMove=new Ji,this.onTouchEnd=new Ji,this.onTextInput=new Ji,this.onTextEdit=new Ji,this.onMouseWheel=new Ji,this.onMouseUp=new Ji,this.onMouseMoveRelative=new Ji,this.onMouseMove=new Ji,this.onMouseDown=new Ji,this.onKeyUp=new Ji,this.onKeyDown=new Ji,this.onGamepadDisconnect=new Ji,this.onGamepadConnect=new Ji,this.onGamepadButtonUp=new Ji,this.onGamepadButtonDown=new Ji,this.onGamepadAxisMove=new Ji,this.config=e,this.__width=0,this.__height=0,this.__fullscreen=!1,this.__x=0,this.__y=0,null!=e&&(Object.prototype.hasOwnProperty.call(e,"width")&&(this.__width=e.width),Object.prototype.hasOwnProperty.call(e,"height")&&(this.__height=e.height),Object.prototype.hasOwnProperty.call(e,"fullscreen")&&(this.__fullscreen=e.fullscreen)),this.backend=new Qi(this)}
s["lime.ui.Window"]=Qn,Qn.__name__=["lime","ui","Window"],Qn.prototype={currentRenderer:null,config:null,onGamepadAxisMove:null,onGamepadButtonDown:null,onGamepadButtonUp:null,onGamepadConnect:null,onGamepadDisconnect:null,onKeyDown:null,onKeyUp:null,onMouseDown:null,onMouseMove:null,onMouseMoveRelative:null,onMouseUp:null,onMouseWheel:null,onTextEdit:null,onTextInput:null,onTouchEnd:null,onTouchMove:null,onTouchStart:null,onWindowActivate:null,onWindowClose:null,onWindowDeactivate:null,onWindowEnter:null,onWindowFocusIn:null,onWindowFocusOut:null,onWindowFullscreen:null,onWindowLeave:null,onWindowMinimize:null,onWindowMove:null,onWindowResize:null,onWindowRestore:null,backend:null,__fullscreen:null,__height:null,__minimized:null,__width:null,__x:null,__y:null,close:function(){this.backend.close()},create:function(e){this.backend.create(e),null!=this.currentRenderer&&this.currentRenderer.create()},move:function(e,t){this.backend.move(e,t),this.__x=e,this.__y=t},resize:function(e,t){this.backend.resize(e,t),this.__width=e,this.__height=t},setIcon:function(e){null!=e&&this.backend.setIcon(e)},get_enableTextEvents:function(){return this.backend.getEnableTextEvents()},set_enableTextEvents:function(e){return this.backend.setEnableTextEvents(e)},get_fullscreen:function(){return this.__fullscreen},set_fullscreen:function(e){return this.__fullscreen=this.backend.setFullscreen(e)},get_height:function(){return this.__height},set_height:function(e){return this.resize(this.__width,e),this.__height},get_minimized:function(){return this.__minimized},set_minimized:function(e){return this.__minimized=this.backend.setMinimized(e)},get_width:function(){return this.__width},set_width:function(e){return this.resize(e,this.__height),this.__width},get_x:function(){return this.__x},set_x:function(e){return this.move(e,this.__y),this.__x},get_y:function(){return this.__y},set_y:function(e){return this.move(this.__x,e),this.__y},__class__:Qn,__properties__:{set_y:"set_y",get_y:"get_y",set_x:"set_x",get_x:"get_x",set_width:"set_width",get_width:"get_width",set_minimized:"set_minimized",get_minimized:"get_minimized",set_height:"set_height",get_height:"get_height",set_fullscreen:"set_fullscreen",get_fullscreen:"get_fullscreen",set_enableTextEvents:"set_enableTextEvents",get_enableTextEvents:"get_enableTextEvents"}}
var Jn=function(e){null==e&&(e=0),this.littleEndian=!1,this.allocated=0,this.position=0,this.length=0,e>0&&(this.allocated=e),this.___resizeBuffer(this.allocated),this.set_length(this.allocated)}
s["lime.utils.ByteArray"]=Jn,Jn.__name__=["lime","utils","ByteArray"],Jn.fromBytes=function(e){var t=new Jn
return t.byteView=new Us(e.b.bufferValue),t.set_length(t.byteView.length),t.allocated=t.length,t},Jn.readFile=function(){return null},Jn.__ofBuffer=function(e){var t=new Jn
return t.set_length(t.allocated=e.byteLength),t.data=new Ns(e),t.byteView=new Us(e),t},Jn.prototype={bytesAvailable:null,length:null,objectEncoding:null,position:null,allocated:null,littleEndian:null,byteView:null,data:null,clear:function(){this.allocated<0?this.___resizeBuffer(this.allocated=g["int"](Math.max(0,2*this.allocated))):this.allocated>0&&this.___resizeBuffer(this.allocated=0),this.length=0,this.position=0},compress:function(){},deflate:function(){this.compress($n.DEFLATE)},inflate:function(){this.uncompress($n.DEFLATE)},readBoolean:function(){return 0!=this.readByte()},readByte:function(){var e=this.data
return e.getInt8(this.position++)},readBytes:function(e,t,i){if(null==i&&(i=0),null==t&&(t=0),0>t||0>i)throw new Wi("Read error - Out of bounds")
0==i&&(i=this.length-this.position)
var n=t+i
e.length<n&&(e.allocated<n?e.___resizeBuffer(e.allocated=g["int"](Math.max(n,2*e.allocated))):e.allocated>2*n&&e.___resizeBuffer(e.allocated=n),e.length=n),e.byteView.set(this.byteView.subarray(this.position,this.position+i),t),e.position=t,this.position+=i,e.position+i>e.length&&e.set_length(e.position+i)},readDouble:function(){var e=this.data.getFloat64(this.position,this.littleEndian)
return this.position+=8,e},readFloat:function(){var e=this.data.getFloat32(this.position,this.littleEndian)
return this.position+=4,e},readInt:function(){var e=this.data.getInt32(this.position,this.littleEndian)
return this.position+=4,e},readMultiByte:function(e){return this.readUTFBytes(e)},readShort:function(){var e=this.data.getInt16(this.position,this.littleEndian)
return this.position+=2,e},readUnsignedByte:function(){var e=this.data
return e.getUint8(this.position++)},readUnsignedInt:function(){var e=this.data.getUint32(this.position,this.littleEndian)
return this.position+=4,e},readUnsignedShort:function(){var e=this.data.getUint16(this.position,this.littleEndian)
return this.position+=2,e},readUTF:function(){var e=this.readUnsignedShort()
return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t="",i=this.position+e;this.position<i;){var n=this.data,r=n.getUint8(this.position++)
if(128>r){if(0==r)break
t+=String.fromCharCode(r)}else if(224>r)t+=String.fromCharCode((63&r)<<6|127&n.getUint8(this.position++))
else if(240>r){var s=n.getUint8(this.position++)
t+=String.fromCharCode((31&r)<<12|(127&s)<<6|127&n.getUint8(this.position++))}else{var o=n.getUint8(this.position++),a=n.getUint8(this.position++)
t+=String.fromCharCode((15&r)<<18|(127&o)<<12|a<<6&127|127&n.getUint8(this.position++))}}return t},toString:function(){var e=this.position
this.position=0
var t=this.readUTFBytes(this.length)
return this.position=e,t},uncompress:function(){Ei.trace("Warning: ByteArray.uncompress on JS target requires the 'format' haxelib",{fileName:"ByteArray.hx",lineNumber:667,className:"lime.utils.ByteArray",methodName:"uncompress"})},write_uncheck:function(){},writeBoolean:function(e){this.writeByte(e?1:0)},writeByte:function(e){var t=this.position+1
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t)
var i=this.data
i.setInt8(this.position,e),this.position+=1},writeBytes:function(e,t,i){if(null==i&&(i=0),null==t&&(t=0),0!=e.length){if(S.gt(0,t)||S.gt(0,i))throw new Wi("Write error - Out of bounds")
0==i&&(i=e.length)
var n=this.position+i
this.length<n&&(this.allocated<n?this.___resizeBuffer(this.allocated=g["int"](Math.max(n,2*this.allocated))):this.allocated>2*n&&this.___resizeBuffer(this.allocated=n),this.length=n),this.byteView.set(e.byteView.subarray(t,t+i),this.position),this.position=this.position+i}},writeDouble:function(e){var t=this.position+8
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setFloat64(this.position,e,this.littleEndian),this.position+=8},writeFile:function(){},writeFloat:function(e){var t=this.position+4
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setFloat32(this.position,e,this.littleEndian),this.position+=4},writeInt:function(e){var t=this.position+4
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setInt32(this.position,e,this.littleEndian),this.position+=4},writeShort:function(e){var t=this.position+2
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setInt16(this.position,e,this.littleEndian),this.position+=2},writeUnsignedInt:function(e){var t=this.position+4
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setUint32(this.position,e,this.littleEndian),this.position+=4},writeUnsignedShort:function(e){var t=this.position+2
this.length<t&&(this.allocated<t?this.___resizeBuffer(this.allocated=g["int"](Math.max(t,2*this.allocated))):this.allocated>2*t&&this.___resizeBuffer(this.allocated=t),this.length=t),this.data.setUint16(this.position,e,this.littleEndian),this.position+=2},writeUTF:function(e){this.writeUnsignedShort(this.__getUTFBytesCount(e)),this.writeUTFBytes(e)},writeUTFBytes:function(e){for(var t=0,i=e.length;i>t;){var n=t++,r=e.charCodeAt(n)
127>=r?this.writeByte(r):2047>=r?(this.writeByte(192|r>>6),this.writeByte(128|63&r)):65535>=r?(this.writeByte(224|r>>12),this.writeByte(128|r>>6&63),this.writeByte(128|63&r)):(this.writeByte(240|r>>18),this.writeByte(128|r>>12&63),this.writeByte(128|r>>6&63),this.writeByte(128|63&r))}},__fromBytes:function(e){this.byteView=new Us(e.b.bufferValue),this.set_length(this.byteView.length),this.allocated=this.length},__get:function(e){return this.data.getInt8(e)},__getBuffer:function(){return this.data.buffer},__getUTFBytesCount:function(e){for(var t=0,i=0,n=e.length;n>i;){var r=i++,s=e.charCodeAt(r)
t+=127>=s?1:2047>=s?2:65535>=s?3:4}return t},___resizeBuffer:function(e){var t=this.byteView,i=new Us(e)
null!=t&&i.set(t.length<=e?t:t.subarray(0,e)),this.byteView=i,this.data=new Ns(i.buffer)},__set:function(e,t){this.data.setUint8(e,t)},get_bytesAvailable:function(){return this.length-this.position},get_endian:function(){return this.littleEndian?"littleEndian":"bigEndian"},set_endian:function(e){return this.littleEndian="littleEndian"==e,e},set_length:function(e){return this.allocated<e?this.___resizeBuffer(this.allocated=g["int"](Math.max(e,2*this.allocated))):this.allocated>2*e&&this.___resizeBuffer(this.allocated=e),this.length=e,e},__class__:Jn,__properties__:{set_length:"set_length",set_endian:"set_endian",get_endian:"get_endian",get_bytesAvailable:"get_bytesAvailable"}}
var $n=s["lime.utils.CompressionAlgorithm"]={__ename__:!0,__constructs__:["DEFLATE","ZLIB","LZMA","GZIP"]}
$n.DEFLATE=["DEFLATE",0],$n.DEFLATE.toString=o,$n.DEFLATE.__enum__=$n,$n.ZLIB=["ZLIB",1],$n.ZLIB.toString=o,$n.ZLIB.__enum__=$n,$n.LZMA=["LZMA",2],$n.LZMA.toString=o,$n.LZMA.__enum__=$n,$n.GZIP=["GZIP",3],$n.GZIP.toString=o,$n.GZIP.__enum__=$n
var er=function(){}
s["lime.utils.IDataInput"]=er,er.__name__=["lime","utils","IDataInput"],er.prototype={bytesAvailable:null,readBoolean:null,readByte:null,readBytes:null,readDouble:null,readFloat:null,readInt:null,readShort:null,readUnsignedByte:null,readUnsignedInt:null,readUnsignedShort:null,readUTF:null,readUTFBytes:null,get_bytesAvailable:null,get_endian:null,set_endian:null,__class__:er,__properties__:{set_endian:"set_endian",get_endian:"get_endian",get_bytesAvailable:"get_bytesAvailable"}}
var tr=function(){}
s["lime.utils.IMemoryRange"]=tr,tr.__name__=["lime","utils","IMemoryRange"],tr.prototype={getByteBuffer:null,getStart:null,getLength:null,__class__:tr}
var ir=function(){}
s["motion.actuators.IGenericActuator"]=ir,ir.__name__=["motion","actuators","IGenericActuator"],ir.prototype={autoVisible:null,delay:null,ease:null,onComplete:null,onRepeat:null,onUpdate:null,reflect:null,repeat:null,reverse:null,smartRotation:null,snapping:null,onPause:null,onResume:null,apply:null,move:null,pause:null,resume:null,stop:null,__class__:ir}
var nr=function(e,t,i){this._autoVisible=!0,this._delay=0,this._reflect=!1,this._repeat=0,this._reverse=!1,this._smartRotation=!1,this._snapping=!1,this.special=!1,this.target=e,this.properties=i,this.duration=t,this._ease=lr.defaultEase}
s["motion.actuators.GenericActuator"]=nr,nr.__name__=["motion","actuators","GenericActuator"],nr.__interfaces__=[ir],nr.prototype={duration:null,id:null,properties:null,target:null,_autoVisible:null,_delay:null,_ease:null,_onComplete:null,_onCompleteParams:null,_onRepeat:null,_onRepeatParams:null,_onUpdate:null,_onUpdateParams:null,_onResume:null,_onResumeParams:null,_onPause:null,_onPauseParams:null,_reflect:null,_repeat:null,_reverse:null,_smartRotation:null,_snapping:null,special:null,apply:function(){for(var e=0,t=v.fields(this.properties);e<t.length;){var i=t[e];++e,Object.prototype.hasOwnProperty.call(this.target,i)?v.setField(this.target,i,v.field(this.properties,i)):v.setProperty(this.target,i,v.field(this.properties,i))}},autoVisible:function(e){return null==e&&(e=!0),this._autoVisible=e,this},callMethod:function(e,t){return null==t&&(t=[]),v.callMethod(e,e,t)},change:function(){null!=this._onUpdate&&this.callMethod(this._onUpdate,this._onUpdateParams)},complete:function(e){null==e&&(e=!0),e&&(this.change(),null!=this._onComplete&&this.callMethod(this._onComplete,this._onCompleteParams)),lr.unload(this)},delay:function(e){return this._delay=e,this},ease:function(e){return this._ease=e,this},move:function(){},onComplete:function(e,t){return this._onComplete=e,null==t?this._onCompleteParams=[]:this._onCompleteParams=t,0==this.duration&&this.complete(),this},onRepeat:function(e,t){return this._onRepeat=e,null==t?this._onRepeatParams=[]:this._onRepeatParams=t,this},onUpdate:function(e,t){return this._onUpdate=e,null==t?this._onUpdateParams=[]:this._onUpdateParams=t,this},onPause:function(e,t){return this._onPause=e,null==t?this._onPauseParams=[]:this._onPauseParams=t,this},onResume:function(e,t){return this._onResume=e,null==t?this._onResumeParams=[]:this._onResumeParams=t,this},pause:function(){null!=this._onPause&&this.callMethod(this._onPause,this._onPauseParams)},reflect:function(e){return null==e&&(e=!0),this._reflect=e,this.special=!0,this},repeat:function(e){return null==e&&(e=-1),this._repeat=e,this},resume:function(){null!=this._onResume&&this.callMethod(this._onResume,this._onResumeParams)},reverse:function(e){return null==e&&(e=!0),this._reverse=e,this.special=!0,this},smartRotation:function(e){return null==e&&(e=!0),this._smartRotation=e,this.special=!0,this},snapping:function(e){return null==e&&(e=!0),this._snapping=e,this.special=!0,this},stop:function(){},__class__:nr}
var rr=function(e,t,i){this.active=!0,this.propertyDetails=[],this.sendChange=!1,this.paused=!1,this.cacheVisible=!1,this.initialized=!1,this.setVisible=!1,this.toggleVisible=!1,this.startTime=Gn.getTimer()/1e3,nr.call(this,e,t,i),rr.addedEvent||(rr.addedEvent=!0,_.current.onUpdate.add(rr.stage_onEnterFrame))}
s["motion.actuators.SimpleActuator"]=rr,rr.__name__=["motion","actuators","SimpleActuator"],rr.stage_onEnterFrame=function(){for(var e,t=Gn.getTimer()/1e3,i=0,n=0,r=rr.actuatorsLength;r>n;){n++
e=rr.actuators[i],null!=e&&e.active?(t>=e.timeOffset&&e.update(t),i++):(rr.actuators.splice(i,1),--rr.actuatorsLength)}},rr.__super__=nr,rr.prototype=i(nr.prototype,{setField_motion_actuators_MotionPathActuator_T:function(e,t,i){Object.prototype.hasOwnProperty.call(e,t)?e[t]=i:v.setProperty(e,t,i)},setField_motion_actuators_SimpleActuator_T:function(e,t,i){Object.prototype.hasOwnProperty.call(e,t)?e[t]=i:v.setProperty(e,t,i)},timeOffset:null,active:null,cacheVisible:null,detailsLength:null,initialized:null,paused:null,pauseTime:null,propertyDetails:null,sendChange:null,setVisible:null,startTime:null,toggleVisible:null,autoVisible:function(e){return null==e&&(e=!0),this._autoVisible=e,e||(this.toggleVisible=!1,this.setVisible&&this.setField_motion_actuators_SimpleActuator_T(this.target,"visible",this.cacheVisible)),this},delay:function(e){return this._delay=e,this.timeOffset=this.startTime+e,this},getField:function(e,t){var i=null
return i=Object.prototype.hasOwnProperty.call(e,t)?v.field(e,t):v.getProperty(e,t)},initialize:function(){for(var e,t,i=0,n=v.fields(this.properties);i<n.length;){var r=n[i];++i
var s=!0
if(!Object.prototype.hasOwnProperty.call(this.target,r)||this.target.__properties__&&this.target.__properties__["set_"+r]?(s=!1,t=v.getProperty(this.target,r)):t=v.field(this.target,r),"number"==typeof t){var o=this.getField(this.properties,r)
null==t&&(t=0),null==o&&(o=0),e=new gr(this.target,r,t,o-t,s),this.propertyDetails.push(e)}}this.detailsLength=this.propertyDetails.length,this.initialized=!0},move:function(){this.toggleVisible=Object.prototype.hasOwnProperty.call(this.properties,"alpha")&&Object.prototype.hasOwnProperty.call(this.properties,"visible"),this.toggleVisible&&0!=this.properties.alpha&&!this.getField(this.target,"visible")&&(this.setVisible=!0,this.cacheVisible=this.getField(this.target,"visible"),this.setField_motion_actuators_SimpleActuator_T(this.target,"visible",!0)),this.timeOffset=this.startTime,rr.actuators.push(this),++rr.actuatorsLength},onUpdate:function(e,t){return this._onUpdate=e,null==t?this._onUpdateParams=[]:this._onUpdateParams=t,this.sendChange=!0,this},pause:function(){this.paused||(this.paused=!0,nr.prototype.pause.call(this),this.pauseTime=Gn.getTimer())},resume:function(){this.paused&&(this.paused=!1,this.timeOffset+=(Gn.getTimer()-this.pauseTime)/1e3,nr.prototype.resume.call(this))},setProperty:function(e,t){e.isField?e.target[e.propertyName]=t:v.setProperty(e.target,e.propertyName,t)},stop:function(e,t,i){if(this.active){if(null==e)return this.active=!1,t&&this.apply(),void this.complete(i)
for(var n=0,r=v.fields(e);n<r.length;){var s=r[n]
if(++n,Object.prototype.hasOwnProperty.call(this.properties,s))return this.active=!1,t&&this.apply(),void this.complete(i)}}},update:function(e){if(!this.paused){var t,i,n=(e-this.timeOffset)/this.duration
if(n>1&&(n=1),this.initialized||this.initialize(),this.special){i=this._ease.calculate(this._reverse?1-n:n)
for(var r,s=0,o=this.detailsLength;o>s;){var a=s++
if(t=this.propertyDetails[a],!this._smartRotation||"rotation"!=t.propertyName&&"rotationX"!=t.propertyName&&"rotationY"!=t.propertyName&&"rotationZ"!=t.propertyName)r=t.start+t.change*i
else{var l=t.change%360
l>180?l-=360:-180>l&&(l+=360),r=t.start+l*i}this._snapping?this.setProperty(t,Math.round(r)):t.isField?t.target[t.propertyName]=r:v.setProperty(t.target,t.propertyName,r)}}else{i=this._ease.calculate(n)
for(var h=0,u=this.detailsLength;u>h;){var c=h++
t=this.propertyDetails[c],this.setProperty(t,t.start+t.change*i)}}if(1==n){if(0==this._repeat)return this.active=!1,this.toggleVisible&&0==this.getField(this.target,"alpha")&&this.setField_motion_actuators_SimpleActuator_T(this.target,"visible",!1),void this.complete(!0)
null!=this._onRepeat&&this.callMethod(this._onRepeat,this._onRepeatParams),this._reflect&&(this._reverse=!this._reverse),this.startTime=e,this.timeOffset=this.startTime+this._delay,this._repeat>0&&this._repeat--}this.sendChange&&this.change()}},__class__:rr})
var sr=function(){}
s["motion.easing.Expo"]=sr,sr.__name__=["motion","easing","Expo"],sr.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},sr.get_easeIn=function(){return new yr},sr.get_easeInOut=function(){return new br},sr.get_easeOut=function(){return new ar}
var or=function(){}
s["motion.easing.IEasing"]=or,or.__name__=["motion","easing","IEasing"],or.prototype={calculate:null,ease:null,__class__:or}
var ar=function(){}
s["motion.easing.ExpoEaseOut"]=ar,ar.__name__=["motion","easing","ExpoEaseOut"],ar.__interfaces__=[or],ar.prototype={calculate:function(e){return 1==e?1:1-Math.pow(2,-10*e)},ease:function(e,t,i,n){return e==n?t+i:i*(1-Math.pow(2,-10*e/n))+t},__class__:ar}
var lr=function(){}
s["motion.Actuate"]=lr,lr.__name__=["motion","Actuate"],lr.apply=function(e,t,i){lr.stop(e,t),null==i&&(i=lr.defaultActuator)
var n=w.createInstance(i,[e,0,t])
return n.apply(),n},lr.getLibrary=function(e,t){return null==t&&(t=!0),null==lr.targetLibraries.h.__keys__[e.__id__]&&t&&lr.targetLibraries.set(e,[]),lr.targetLibraries.h[e.__id__]},lr.isActive=function(){for(var e=!1,t=lr.targetLibraries.iterator();t.hasNext();){t.next()
e=!0
break}return e},lr.motionPath=function(e,t,i,n){return null==n&&(n=!0),lr.tween(e,t,i,n,vr)},lr.pause=function(e){if(Me.__instanceof(e,ir)){var t=e
t.pause()}else{var i=lr.getLibrary(e,!1)
if(null!=i)for(var n=0;n<i.length;){var r=i[n];++n,r.pause()}}},lr.pauseAll=function(){for(var e=lr.targetLibraries.iterator();e.hasNext();)for(var t=e.next(),i=0;i<t.length;){var n=t[i];++i,n.pause()}},lr.reset=function(){for(var e=lr.targetLibraries.iterator();e.hasNext();)for(var t=e.next(),i=t.length-1;i>=0;)t[i].stop(null,!1,!1),i--
lr.targetLibraries=new Ri},lr.resume=function(e){if(Me.__instanceof(e,ir)){var t=e
t.resume()}else{var i=lr.getLibrary(e,!1)
if(null!=i)for(var n=0;n<i.length;){var r=i[n];++n,r.resume()}}},lr.resumeAll=function(){for(var e=lr.targetLibraries.iterator();e.hasNext();)for(var t=e.next(),i=0;i<t.length;){var n=t[i];++i,n.resume()}},lr.stop=function(e,t,i,n){if(null==n&&(n=!0),null==i&&(i=!1),null!=e)if(Me.__instanceof(e,ir)){var r=e
r.stop(null,i,n)}else{var s=lr.getLibrary(e,!1)
if(null!=s){if("string"==typeof t){var o={}
v.setField(o,t,null),t=o}else if(t instanceof Array&&null==t.__enum__){var a,l={},h=0
for(a=Me.__cast(t,Array);h<a.length;){var u=a[h];++h,v.setField(l,u,null)}t=l}for(var c=s.length-1;c>=0;)s[c].stop(t,i,n),c--}}},lr.timer=function(e,t){return lr.tween(new hr(0),e,new hr(1),!1,t)},lr.tween=function(e,t,i,n,r){if(null==n&&(n=!0),null!=e){if(t>0){null==r&&(r=lr.defaultActuator)
var s=w.createInstance(r,[e,t,i]),o=lr.getLibrary(s.target)
if(n){for(var a=o.length-1;a>=0;)o[a].stop(s.properties,!1,!1),a--
o=lr.getLibrary(s.target)}return o.push(s),s.move(),s}return lr.apply(e,i,r)}return null},lr.unload=function(e){var t=e.target
null!=lr.targetLibraries.h.__keys__[t.__id__]&&(c.remove(lr.targetLibraries.h[t.__id__],e),0==lr.targetLibraries.h[t.__id__].length&&lr.targetLibraries.remove(t))},lr.update=function(e,t,i,n,r){null==r&&(r=!0)
var s={start:i,end:n}
return lr.tween(e,t,s,r,pr)}
var hr=function(e){this.progress=e}
s["motion._Actuate.TweenTimer"]=hr,hr.__name__=["motion","_Actuate","TweenTimer"],hr.prototype={progress:null,__class__:hr}
var ur=function(){this._x=new fr,this._y=new fr,this._rotation=null}
s["motion.MotionPath"]=ur,ur.__name__=["motion","MotionPath"],ur.prototype={rotation:null,x:null,y:null,_rotation:null,_x:null,_y:null,bezier:function(e,t,i,n,r){return null==r&&(r=1),this._x.addPath(new dr(e,i,r)),this._y.addPath(new dr(t,n,r)),this},line:function(e,t,i){return null==i&&(i=1),this._x.addPath(new mr(e,i)),this._y.addPath(new mr(t,i)),this},get_rotation:function(){return null==this._rotation&&(this._rotation=new _r(this._x,this._y)),this._rotation},get_x:function(){return this._x},get_y:function(){return this._y},__class__:ur,__properties__:{get_y:"get_y",get_x:"get_x",get_rotation:"get_rotation"}}
var cr=function(){}
s["motion.IComponentPath"]=cr,cr.__name__=["motion","IComponentPath"],cr.prototype={get_end:null,end:null,start:null,calculate:null,__class__:cr,__properties__:{get_end:"get_end"}}
var fr=function(){this.paths=[],this.start=0,this.totalStrength=0}
s["motion.ComponentPath"]=fr,fr.__name__=["motion","ComponentPath"],fr.__interfaces__=[cr],fr.prototype={start:null,end:null,paths:null,totalStrength:null,addPath:function(e){this.paths.push(e),this.totalStrength+=e.strength},calculate:function(e){if(1==this.paths.length)return this.paths[0].calculate(this.start,e)
for(var t=e*this.totalStrength,i=this.start,n=0,r=this.paths;n<r.length;){var s=r[n]
if(++n,!(t>s.strength))return s.calculate(i,t/s.strength)
t-=s.strength,i=s.end}return 0},get_end:function(){if(this.paths.length>0){var e=this.paths[this.paths.length-1]
return e.end}return this.start},__class__:fr,__properties__:{get_end:"get_end"}}
var dr=function(e,t,i){this.end=e,this.control=t,this.strength=i}
s["motion.BezierPath"]=dr,dr.__name__=["motion","BezierPath"],dr.prototype={control:null,end:null,strength:null,calculate:function(e,t){return(1-t)*(1-t)*e+2*(1-t)*t*this.control+t*t*this.end},__class__:dr}
var mr=function(e,t){dr.call(this,e,0,t)}
s["motion.LinearPath"]=mr,mr.__name__=["motion","LinearPath"],mr.__super__=dr,mr.prototype=i(dr.prototype,{calculate:function(e,t){return e+t*(this.end-e)},__class__:mr})
var _r=function(e,t){this.step=.01,this._x=e,this._y=t,this.offset=0,this.start=this.calculate(0)}
s["motion.RotationPath"]=_r,_r.__name__=["motion","RotationPath"],_r.__interfaces__=[cr],_r.prototype={end:null,offset:null,start:null,step:null,_x:null,_y:null,calculate:function(e){var t=this._x.calculate(e)-this._x.calculate(e+this.step),i=this._y.calculate(e)-this._y.calculate(e+this.step),n=Math.atan2(i,t)*(180/Math.PI)
return n=(n+this.offset)%360},get_end:function(){return this.calculate(1)},__class__:_r,__properties__:{get_end:"get_end"}}
var pr=function(e,t,i){this.currentParameters=[],this.tweenProperties={},rr.call(this,e,t,i),Object.prototype.hasOwnProperty.call(i,"start")||(this.properties.start=[]),Object.prototype.hasOwnProperty.call(i,"end")||(this.properties.end=this.properties.start)
for(var n=0,r=this.properties.start.length;r>n;){var s=n++
this.currentParameters.push(this.properties.start[s])}}
s["motion.actuators.MethodActuator"]=pr,pr.__name__=["motion","actuators","MethodActuator"],pr.__super__=rr,pr.prototype=i(rr.prototype,{currentParameters:null,tweenProperties:null,apply:function(){this.callMethod(this.target,this.properties.end)},complete:function(e){null==e&&(e=!0)
for(var t=0,i=this.properties.start.length;i>t;){var n=t++
this.currentParameters[n]=v.field(this.tweenProperties,"param"+n)}this.callMethod(this.target,this.currentParameters),rr.prototype.complete.call(this,e)},initialize:function(){for(var e,t,i,n=0,r=this.properties.start.length;r>n;){var s=n++
t="param"+s,i=this.properties.start[s],this.tweenProperties[t]=i,("number"==typeof i||(0|i)===i)&&(e=new gr(this.tweenProperties,t,i,this.properties.end[s]-i),this.propertyDetails.push(e))}this.detailsLength=this.propertyDetails.length,this.initialized=!0},update:function(e){if(rr.prototype.update.call(this,e),this.active&&!this.paused){for(var t=0,i=this.properties.start.length;i>t;){var n=t++
this.currentParameters[n]=v.field(this.tweenProperties,"param"+n)}this.callMethod(this.target,this.currentParameters)}},__class__:pr})
var vr=function(e,t,i){rr.call(this,e,t,i)}
s["motion.actuators.MotionPathActuator"]=vr,vr.__name__=["motion","actuators","MotionPathActuator"],vr.__super__=rr,vr.prototype=i(rr.prototype,{apply:function(){for(var e=0,t=v.fields(this.properties);e<t.length;){var i=t[e];++e,Object.prototype.hasOwnProperty.call(this.target,i)?v.setField(this.target,i,Me.__cast(v.field(this.properties,i),cr).get_end()):v.setProperty(this.target,i,Me.__cast(v.field(this.properties,i),cr).get_end())}},initialize:function(){for(var e,t,i=0,n=v.fields(this.properties);i<n.length;){var r=n[i]
if(++i,t=Me.__cast(v.field(this.properties,r),cr),null!=t){var s=!0
Object.prototype.hasOwnProperty.call(this.target,r)?t.start=v.field(this.target,r):(s=!1,t.start=v.getProperty(this.target,r)),e=new xr(this.target,r,t,s),this.propertyDetails.push(e)}}this.detailsLength=this.propertyDetails.length,this.initialized=!0},update:function(e){if(!this.paused){var t,i=(e-this.timeOffset)/this.duration
if(i>1&&(i=1),this.initialized||this.initialize(),this.special){t=this._ease.calculate(this._reverse?1-i:i)
for(var n=0,r=this.propertyDetails;n<r.length;){var s=r[n];++n,this._snapping?s.isField?v.setField(s.target,s.propertyName,Math.round(Me.__cast(s,xr).path.calculate(t))):v.setProperty(s.target,s.propertyName,Math.round(Me.__cast(s,xr).path.calculate(t))):s.isField?v.setField(s.target,s.propertyName,Me.__cast(s,xr).path.calculate(t)):v.setProperty(s.target,s.propertyName,Me.__cast(s,xr).path.calculate(t))}}else{t=this._ease.calculate(i)
for(var o=0,a=this.propertyDetails;o<a.length;){var l=a[o];++o,l.isField?v.setField(l.target,l.propertyName,Me.__cast(l,xr).path.calculate(t)):v.setProperty(l.target,l.propertyName,Me.__cast(l,xr).path.calculate(t))}}if(1==i){if(0==this._repeat)return this.active=!1,this.toggleVisible&&0==this.getField(this.target,"alpha")&&this.setField_motion_actuators_MotionPathActuator_T(this.target,"visible",!1),void this.complete(!0)
null!=this._onRepeat&&this.callMethod(this._onRepeat,this._onRepeatParams),this._reflect&&(this._reverse=!this._reverse),this.startTime=e,this.timeOffset=this.startTime+this._delay,this._repeat>0&&this._repeat--}this.sendChange&&this.change()}},__class__:vr})
var gr=function(e,t,i,n,r){null==r&&(r=!0),this.target=e,this.propertyName=t,this.start=i,this.change=n,this.isField=r}
s["motion.actuators.PropertyDetails"]=gr,gr.__name__=["motion","actuators","PropertyDetails"],gr.prototype={change:null,isField:null,propertyName:null,start:null,target:null,__class__:gr}
var xr=function(e,t,i,n){null==n&&(n=!0),gr.call(this,e,t,0,0,n),this.path=i}
s["motion.actuators.PropertyPathDetails"]=xr,xr.__name__=["motion","actuators","PropertyPathDetails"],xr.__super__=gr,xr.prototype=i(gr.prototype,{path:null,__class__:xr})
var yr=function(){}
s["motion.easing.ExpoEaseIn"]=yr,yr.__name__=["motion","easing","ExpoEaseIn"],yr.__interfaces__=[or],yr.prototype={calculate:function(e){return 0==e?0:Math.pow(2,10*(e-1))},ease:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},__class__:yr}
var br=function(){}
s["motion.easing.ExpoEaseInOut"]=br,br.__name__=["motion","easing","ExpoEaseInOut"],br.__interfaces__=[or],br.prototype={calculate:function(e){return 0==e?0:1==e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e))},ease:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t},__class__:br}
var wr=function(){}
s["motion.easing.Quad"]=wr,wr.__name__=["motion","easing","Quad"],wr.__properties__={get_easeOut:"get_easeOut",get_easeInOut:"get_easeInOut",get_easeIn:"get_easeIn"},wr.get_easeIn=function(){return new Sr},wr.get_easeInOut=function(){return new Mr},wr.get_easeOut=function(){return new Tr}
var Sr=function(){}
s["motion.easing.QuadEaseIn"]=Sr,Sr.__name__=["motion","easing","QuadEaseIn"],Sr.__interfaces__=[or],Sr.prototype={calculate:function(e){return e*e},ease:function(e,t,i,n){return i*(e/=n)*e+t},__class__:Sr}
var Mr=function(){}
s["motion.easing.QuadEaseInOut"]=Mr,Mr.__name__=["motion","easing","QuadEaseInOut"],Mr.__interfaces__=[or],Mr.prototype={calculate:function(e){return(e*=2)<1?.5*e*e:-.5*((e-1)*(e-3)-1)},ease:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*((e-1)*(e-3)-1)+t},__class__:Mr}
var Tr=function(){}
s["motion.easing.QuadEaseOut"]=Tr,Tr.__name__=["motion","easing","QuadEaseOut"],Tr.__interfaces__=[or],Tr.prototype={calculate:function(e){return-e*(e-2)},ease:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},__class__:Tr}
var Cr=function(e,t,i,n,r,s,o,a,l){null==l&&(l=1),null==a&&(a=0),null==o&&(o=0),null==s&&(s=0),null==r&&(r=1),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1),this.elements=new Float32Array(9)
var h=this.elements
h[0]=e,h[1]=t,h[2]=i,h[3]=n,h[4]=r,h[5]=s,h[6]=o,h[7]=a,h[8]=l}
s["oimohx.math.Mat33"]=Cr,Cr.__name__=["oimohx","math","Mat33"],Cr.prototype={elements:null,init:function(e,t,i,n,r,s,o,a,l){null==l&&(l=1),null==a&&(a=0),null==o&&(o=0),null==s&&(s=0),null==r&&(r=1),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1)
var h=this.elements
return h[0]=e,h[1]=t,h[2]=i,h[3]=n,h[4]=r,h[5]=s,h[6]=o,h[7]=a,h[8]=l,this},add:function(e,t){var i=this.elements,n=e.elements,r=t.elements
return i[0]=n[0]+r[0],i[1]=n[1]+r[1],i[2]=n[2]+r[2],i[3]=n[3]+r[3],i[4]=n[4]+r[4],i[5]=n[5]+r[5],i[6]=n[6]+r[6],i[7]=n[7]+r[7],i[8]=n[8]+r[8],this},addEqual:function(e){var t=this.elements,i=e.elements
return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],t[4]+=i[4],t[5]+=i[5],t[6]+=i[6],t[7]+=i[7],t[8]+=i[8],this},sub:function(e,t){var i=this.elements,n=e.elements,r=t.elements
return i[0]=n[0]-r[0],i[1]=n[1]-r[1],i[2]=n[2]-r[2],i[3]=n[3]-r[3],i[4]=n[4]-r[4],i[5]=n[5]-r[5],i[6]=n[6]-r[6],i[7]=n[7]-r[7],i[8]=n[8]-r[8],this},subEqual:function(e){var t=this.elements,i=e.elements
return t[0]-=i[0],t[1]-=i[1],t[2]-=i[2],t[3]-=i[3],t[4]-=i[4],t[5]-=i[5],t[6]-=i[6],t[7]-=i[7],t[8]-=i[8],this},scale:function(e,t){var i=this.elements,n=e.elements
return i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t,i[4]=n[4]*t,i[5]=n[5]*t,i[6]=n[6]*t,i[7]=n[7]*t,i[8]=n[8]*t,this},scaleEqual:function(e){var t=this.elements
return t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=e,this},mul:function(e,t){var i=this.elements,n=e.elements,r=t.elements,s=n[0],o=n[3],a=n[6],l=n[1],h=n[4],u=n[7],c=n[2],f=n[5],d=n[8],m=r[0],_=r[3],p=r[6],v=r[1],g=r[4],x=r[7],y=r[2],b=r[5],w=r[8]
return i[0]=s*m+l*_+c*p,i[1]=s*v+l*g+c*x,i[2]=s*y+l*b+c*w,i[3]=o*m+h*_+f*p,i[4]=o*v+h*g+f*x,i[5]=o*y+h*b+f*w,i[6]=a*m+u*_+d*p,i[7]=a*v+u*g+d*x,i[8]=a*y+u*b+d*w,this},mulScale:function(e,t,i,n,r){null==r&&(r=!1)
var s=this.elements,o=e.elements
return r?(s[0]=t*o[0],s[1]=t*o[1],s[2]=t*o[2],s[3]=i*o[3],s[4]=i*o[4],s[5]=i*o[5],s[6]=n*o[6],s[7]=n*o[7],s[8]=n*o[8]):(s[0]=o[0]*t,s[1]=o[1]*i,s[2]=o[2]*n,s[3]=o[3]*t,s[4]=o[4]*i,s[5]=o[5]*n,s[6]=o[6]*t,s[7]=o[7]*i,s[8]=o[8]*n),this},mulRotate:function(e,t,i,n,r,s){null==s&&(s=!1)
var o=Math.sin(t),a=Math.cos(t),l=1-a,h=i*i*l+a,u=i*n*l-r*o,c=i*r*l+n*o,f=n*i*l+r*o,d=n*n*l+a,m=n*r*l-i*o,_=r*i*l-n*o,p=r*n*l+i*o,v=r*r*l+a,g=e.elements,x=g[0],y=g[3],b=g[6],w=g[1],S=g[4],M=g[7],T=g[2],C=g[5],A=g[8],I=this.elements
return s?(I[0]=h*x+u*y+c*b,I[1]=h*w+u*S+c*M,I[2]=h*T+u*C+c*A,I[3]=f*x+d*y+m*b,I[4]=f*w+d*S+m*M,I[5]=f*T+d*C+m*A,I[6]=_*x+p*y+v*b,I[7]=_*w+p*S+v*M,I[8]=_*T+p*C+v*A):(I[0]=x*h+w*f+T*_,I[1]=x*u+w*d+T*p,I[2]=x*c+w*m+T*v,I[3]=y*h+S*f+C*_,I[4]=y*u+S*d+C*p,I[5]=y*c+S*m+C*v,I[6]=b*h+M*f+A*_,I[7]=b*u+M*d+A*p,I[8]=b*c+M*m+A*v),this},transpose:function(e){var t=this.elements,i=e.elements
return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setQuat:function(e){var t=this.elements,i=2*e.x,n=2*e.y,r=2*e.z,s=e.x*i,o=e.y*n,a=e.z*r,l=e.x*n,h=e.y*r,u=e.x*r,c=e.s*i,f=e.s*n,d=e.s*r
return t[0]=1-o-a,t[1]=l-d,t[2]=u+f,t[3]=l+d,t[4]=1-s-a,t[5]=h-c,t[6]=u-f,t[7]=h+c,t[8]=1-s-o,this},invert:function(e){var t=this.elements,i=e.elements,n=i[0],r=i[3],s=i[6],o=i[1],a=i[4],l=i[7],h=i[2],u=i[5],c=i[8],f=a*c-l*u,d=l*h-o*c,m=o*u-a*h,_=n*f+r*d+s*m
return 0!=_&&(_=1/_),t[0]=_*f,t[1]=_*d,t[2]=_*m,t[3]=_*(u*s-r*c),t[4]=_*(n*c-h*s),t[5]=_*(h*r-n*u),t[6]=_*(r*l-a*s),t[7]=_*(o*s-n*l),t[8]=_*(n*a-o*r),this},copy:function(e){var t=this.elements,i=e.elements
return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},clone:function(){var e=this.elements
return new Cr(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},__class__:Cr}
var Ar=function(e,t,i,n,r,s,o,a,l,h,u,c,f,d,m,_){null==_&&(_=1),null==m&&(m=0),null==d&&(d=0),null==f&&(f=0),null==c&&(c=0),null==u&&(u=1),null==h&&(h=0),null==l&&(l=0),null==a&&(a=0),null==o&&(o=0),null==s&&(s=1),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1),this.elements=new Float32Array(16)
var p=this.elements
p[0]=e,p[4]=t,p[8]=i,p[12]=n,p[1]=r,p[5]=s,p[9]=o,p[13]=a,p[2]=l,p[6]=h,p[10]=u,p[14]=c,p[3]=f,p[7]=d,p[11]=m,p[15]=_}
s["oimohx.math.Mat44"]=Ar,Ar.__name__=["oimohx","math","Mat44"],Ar.prototype={elements:null,init:function(e,t,i,n,r,s,o,a,l,h,u,c,f,d,m,_){null==_&&(_=1),null==m&&(m=0),null==d&&(d=0),null==f&&(f=0),null==c&&(c=0),null==u&&(u=1),null==h&&(h=0),null==l&&(l=0),null==a&&(a=0),null==o&&(o=0),null==s&&(s=1),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1)
var p=this.elements
return p[0]=e,p[4]=t,p[8]=i,p[12]=n,p[1]=r,p[5]=s,p[9]=o,p[13]=a,p[2]=l,p[6]=h,p[10]=u,p[14]=c,p[3]=f,p[7]=d,p[11]=m,p[15]=_,this},__class__:Ar}
var Ir=function(e,t,i,n){null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1),this.s=e,this.x=t,this.y=i,this.z=n}
s["oimohx.math.Quat"]=Ir,Ir.__name__=["oimohx","math","Quat"],Ir.prototype={s:null,x:null,y:null,z:null,init:function(e,t,i,n){return null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=1),this.s=e,this.x=t,this.y=i,this.z=n,this},add:function(e,t){return this.s=e.s+t.s,this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addTime:function(e,t){var i=e.x,n=e.y,r=e.z,s=this.s,o=this.x,a=this.y,l=this.z
t*=.5
var h=(-i*o-n*a-r*l)*t,u=(i*s+n*l-r*a)*t,c=(-i*l+n*s+r*o)*t,f=(i*a-n*o+r*s)*t
s+=h,o+=u,a+=c,l+=f
var d=1/Math.sqrt(s*s+o*o+a*a+l*l)
return this.s=s*d,this.x=o*d,this.y=a*d,this.z=l*d,this},sub:function(e,t){return this.s=e.s-t.s,this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},scale:function(e,t){return this.s=e.s*t,this.x=e.x*t,this.y=e.y*t,this.z=e.z*t,this},mul:function(e,t){return this.s=e.s*t.s-e.x*t.x-e.y*t.y-e.z*t.z,this.x=e.s*t.x+e.x*t.s+e.y*t.z-e.z*t.y,this.y=e.s*t.y-e.x*t.z+e.y*t.s+e.z*t.x,this.z=e.s*t.z+e.x*t.y-e.y*t.x+e.z*t.s,this},arc:function(e,t){var i=e.x*t.x+e.y*t.y+e.z*t.z
return-1==i?(t.x=e.y*e.x-e.z*e.z,t.y=-e.z*e.y-e.x*e.x,t.z=e.x*e.z+e.y*e.y,i=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),this.s=0,this.x=t.x*i,this.y=t.y*i,this.z=t.z*i):(i=.5/Math.sqrt(.5*(1+i)),this.x=(e.y*t.z-e.z*t.y)*i,this.y=(e.z*t.x-e.x*t.z)*i,this.z=(e.x*t.y-e.y*t.x)*i),this},normalize:function(e){var t=Math.sqrt(e.s*e.s+e.x*e.x+e.y*e.y+e.z*e.z)
return t>0&&(t=1/t),this.s=e.s*t,this.x=e.x*t,this.y=e.y*t,this.z=e.z*t,this},invert:function(e){return this.s=e.s,this.x=-e.x,this.y=-e.y,this.z=-e.z,this},length:function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(e){return this.s=e.s,this.x=e.x,this.y=e.y,this.z=e.z,this},testDiff:function(e){return this.s!=e.s||this.x!=e.x||this.y!=e.y||this.z!=e.z?!0:!1},clone:function(){return new Ir(this.s,this.x,this.y,this.z)},toString:function(){return"Quat["+this.s+", ("+this.x+", "+this.y+", "+this.z+")]"},__class__:Ir}
var Pr=function(e,t,i){null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i}
s["oimohx.math.Vec3"]=Pr,Pr.__name__=["oimohx","math","Vec3"],Pr.prototype={x:null,y:null,z:null,init:function(e,t,i){return null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.x=e,this.y=t,this.z=i,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addEqual:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addTime:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subEqual:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},scale:function(e,t){return this.x=e.x*t,this.y=e.y*t,this.z=e.z*t,this},scaleEqual:function(e){return this.x*=e,this.y*=e,this.z*=e,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},mul:function(e,t,i){var n=i.elements
return this.x=e.x+t.x*n[0]+t.y*n[1]+t.z*n[2],this.y=e.y+t.x*n[3]+t.y*n[4]+t.z*n[5],this.z=e.z+t.x*n[6]+t.y*n[7]+t.z*n[8],this},mulMat:function(e,t){return this.x=e.elements[0]*t.x+e.elements[1]*t.y+e.elements[2]*t.z,this.y=e.elements[3]*t.x+e.elements[4]*t.y+e.elements[5]*t.z,this.z=e.elements[6]*t.x+e.elements[7]*t.y+e.elements[8]*t.z,this},normalize:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)
return t>0&&(t=1/t),this.x=e.x*t,this.y=e.y*t,this.z=e.z*t,this},invert:function(e){return this.x=-e.x,this.y=-e.y,this.z=-e.z,this},testZero:function(){return 0!=this.x||0!=this.y||0!=this.z?!0:!1},testDiff:function(e){return this.x!=e.x||this.y!=e.y||this.z!=e.z?!0:!1},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},clone:function(){return new Pr(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x+", "+this.y+", "+this.z+"]"},__class__:Pr}
var Er=function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.minX=e,this.maxX=t,this.minY=i,this.maxY=n,this.minZ=r,this.maxZ=s}
s["oimohx.physics.collision.broadphase.AABB"]=Er,Er.__name__=["oimohx","physics","collision","broadphase","AABB"],Er.prototype={minX:null,maxX:null,minY:null,maxY:null,minZ:null,maxZ:null,init:function(e,t,i,n,r,s){null==s&&(s=0),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.minX=e,this.maxX=t,this.minY=i,this.maxY=n,this.minZ=r,this.maxZ=s},combine:function(e,t){e.minX<t.minX?this.minX=e.minX:this.minX=t.minX,e.maxX>t.maxX?this.maxX=e.maxX:this.maxX=t.maxX,e.minY<t.minY?this.minY=e.minY:this.minY=t.minY,e.maxY>t.maxY?this.maxY=e.maxY:this.maxY=t.maxY,e.minZ<t.minZ?this.minZ=e.minZ:this.minZ=t.minZ,e.maxZ>t.maxZ?this.maxZ=e.maxZ:this.maxZ=t.maxZ
var i=0
this.minX-=i,this.minY-=i,this.minZ-=i,this.maxX+=i,this.maxY+=i,this.maxZ+=i},surfaceArea:function(){var e=this.maxY-this.minY,t=this.maxZ-this.minZ
return 2*((this.maxX-this.minX)*(e+t)+e*t)},intersectsWithPoint:function(e,t,i){return e>=this.minX&&e<=this.maxX&&t>=this.minY&&t<=this.maxY&&i>=this.minZ&&i<=this.maxZ},__class__:Er}
var Dr=function(e){this.shape=e,this.aabb=e.aabb,this.update=function(){}}
s["oimohx.physics.collision.broadphase.Proxy"]=Dr,Dr.__name__=["oimohx","physics","collision","broadphase","Proxy"],Dr.prototype={shape:null,aabb:null,update:null,__class__:Dr}
var Lr=function(e){Dr.call(this,e)}
s["oimohx.physics.collision.broadphase.BasicProxy"]=Lr,Lr.__name__=["oimohx","physics","collision","broadphase","BasicProxy"],Lr.__super__=Dr,Lr.prototype=i(Dr.prototype,{__class__:Lr})
var Fr=function(){this.numPairs=0,this.bufferSize=256,this.pairs=[]
for(var e=0,t=this.bufferSize;t>e;){var i=e++
this.pairs[i]=new zr}}
s["oimohx.physics.collision.broadphase.BroadPhase"]=Fr,Fr.__name__=["oimohx","physics","collision","broadphase","BroadPhase"],Fr.prototype={pairs:null,numPairs:null,collectPairs:null,numPairChecks:null,bufferSize:null,createProxy:function(){throw new Wi("Inheritance error.")},addProxy:function(){throw new Wi("Inheritance error.")},removeProxy:function(){throw new Wi("Inheritance error.")},isAvailablePair:function(e,t){var i=e.parent,n=t.parent
if(i==n||!i.isDynamic&&!n.isDynamic||0==(e.belongsTo&t.collidesWith)||0==(t.belongsTo&e.collidesWith))return!1
var r
r=i.numJoints<n.numJoints?i.jointLink:n.jointLink
for(var s=null;null!=r;){if(s=r.joint,!s.allowCollision&&(s.body1==i&&s.body2==n||s.body1==n&&s.body2==i))return!1
r=r.next}return!0},detectPairs:function(){for(;this.numPairs>0;){var e=this.pairs[--this.numPairs]
e.shape1=null,e.shape2=null}this.numPairChecks=0,this.collectPairs()},addPair:function(e,t){if(this.numPairs==this.bufferSize){for(var i=this.bufferSize<<1,n=[],r=0,s=this.bufferSize;s>r;){var o=r++
n[o]=this.pairs[o]}for(var a=this.bufferSize;i>a;){var l=a++
n[l]=new zr}this.pairs=n,this.bufferSize=i}var h=this.pairs[this.numPairs++]
h.shape1=e,h.shape2=t},__class__:Fr}
var Rr=function(){Fr.call(this),this.maxProxies=256,this.proxies=[],this.collectPairs=r(this,this._collectPairs)}
s["oimohx.physics.collision.broadphase.BruteForceBroadPhase"]=Rr,Rr.__name__=["oimohx","physics","collision","broadphase","BruteForceBroadPhase"],Rr.__super__=Fr,Rr.prototype=i(Fr.prototype,{proxies:null,numProxies:null,maxProxies:null,createProxy:function(e){return new Lr(e)},addProxy:function(e){if(this.numProxies==this.maxProxies){this.maxProxies<<=1
for(var t=[],i=0,n=this.numProxies;n>i;){var r=i++
t[r]=this.proxies[r]}this.proxies=t}this.proxies[this.numProxies++]=e},removeProxy:function(e){for(var t=0,i=this.numProxies;i>t;){var n=t++
if(this.proxies[n]==e)return this.proxies[n]=this.proxies[--this.numProxies],void(this.proxies[this.numProxies]=null)}},_collectPairs:function(){this.numPairChecks=this.numProxies*(this.numProxies-1)>>1
for(var e=null,t=null,i=null,n=null,r=null,s=null,o=0,a=this.numProxies;a>o;){var l=o++
e=this.proxies[l],t=e.aabb,i=e.shape
for(var h=l+1,u=this.numProxies;u>h;){var c=h++
n=this.proxies[c],r=n.aabb,s=n.shape,t.maxX<r.minX||t.minX>r.maxX||t.maxY<r.minY||t.minY>r.maxY||t.maxZ<r.minZ||t.minZ>r.maxZ||!this.isAvailablePair(i,s)||this.addPair(i,s)}}},__class__:Rr})
var zr=function(){}
s["oimohx.physics.collision.broadphase.Pair"]=zr,zr.__name__=["oimohx","physics","collision","broadphase","Pair"],zr.prototype={shape1:null,shape2:null,__class__:zr}
var Br=function(){this.freeNodes=[],this.numFreeNodes=0,this.aabb=new Er}
s["oimohx.physics.collision.broadphase.dbvt.DBVT"]=Br,Br.__name__=["oimohx","physics","collision","broadphase","dbvt","DBVT"],Br.prototype={root:null,freeNodes:null,numFreeNodes:null,aabb:null,moveLeaf:function(e){this.deleteLeaf(e),this.insertLeaf(e)},insertLeaf:function(e){if(null==this.root)return void(this.root=e)
for(var t,i,n=e.aabb,r=this.root;null==r.proxy;){var s=r.child1,o=r.child2,a=r.aabb,l=s.aabb,h=o.aabb
t=a.surfaceArea(),this.aabb.combine(n,a),i=this.aabb.surfaceArea()
var u=2*i,c=2*(i-t),f=c
this.aabb.combine(n,l),f+=null!=s.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-l.surfaceArea()
var d=c
if(this.aabb.combine(n,h),d+=null!=o.proxy?this.aabb.surfaceArea():this.aabb.surfaceArea()-h.surfaceArea(),d>f){if(f>u)break
r=s}else{if(d>u)break
r=o}}var m,_=r.parent
m=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new kr,m.parent=_,m.child1=e,m.child2=r,m.aabb.combine(e.aabb,r.aabb),m.height=r.height+1,r.parent=m,e.parent=m,r==this.root?this.root=m:_.child1==r?_.child1=m:_.child2=m
do m=this.balance(m),this.fix(m),m=m.parent
while(null!=m)},getBalance:function(e){return null!=e.proxy?0:e.child1.height-e.child2.height},print:function(e,t,i){var n=null==e.proxy
n&&(i=this.print(e.child1,t+1,i))
for(var r=2*t;r>=0;)i+=" ",r--
return i+=(n?this.getBalance(e)+"":"["+e.proxy.aabb.minX+"]")+"\n",n&&(i=this.print(e.child2,t+1,i)),i},deleteLeaf:function(e){if(e==this.root)return void(this.root=null)
var t,i=e.parent
if(t=i.child1==e?i.child2:i.child1,i==this.root)return this.root=t,void(t.parent=null)
var n=i.parent
t.parent=n,n.child1==i?n.child1=t:n.child2=t,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=i)
do n=this.balance(n),this.fix(n),n=n.parent
while(null!=n)},balance:function(e){var t=e.height
if(2>t)return e
var i,n=e.parent,r=e.child1,s=e.child2,o=r.height,a=s.height,l=o-a
if(l>1){var h=r.child1,u=r.child2,c=h.height,f=u.height
return c>f?(r.child2=e,e.parent=r,e.child1=u,u.parent=e,e.aabb.combine(u.aabb,s.aabb),i=f-a,e.height=f-(i&i>>31)+1,r.aabb.combine(h.aabb,e.aabb),i=c-t,r.height=c-(i&i>>31)+1):(r.child1=e,e.parent=r,e.child1=h,h.parent=e,e.aabb.combine(h.aabb,s.aabb),i=c-a,e.height=c-(i&i>>31)+1,r.aabb.combine(e.aabb,u.aabb),i=t-f,r.height=t-(i&i>>31)+1),null!=n?n.child1==e?n.child1=r:n.child2=r:this.root=r,r.parent=n,r}if(-1>l){var d=s.child1,m=s.child2,_=d.height,p=m.height
return _>p?(s.child2=e,e.parent=s,e.child2=m,m.parent=e,e.aabb.combine(r.aabb,m.aabb),i=o-p,e.height=o-(i&i>>31)+1,s.aabb.combine(d.aabb,e.aabb),i=_-t,s.height=_-(i&i>>31)+1):(s.child1=e,e.parent=s,e.child2=d,d.parent=e,e.aabb.combine(r.aabb,d.aabb),i=o-_,e.height=o-(i&i>>31)+1,s.aabb.combine(e.aabb,m.aabb),i=t-p,s.height=t-(i&i>>31)+1),null!=n?n.child1==e?n.child1=s:n.child2=s:this.root=s,s.parent=n,s}return e},fix:function(e){var t=e.child1,i=e.child2
e.aabb.combine(t.aabb,i.aabb)
var n=t.height,r=i.height
r>n?e.height=r+1:e.height=n+1},__class__:Br}
var Or=function(){Fr.call(this),this.tree=new Br,this.maxStack=256,this.stack=[],this.maxLeaves=256,this.leaves=[],this.collectPairs=r(this,this._collectPairs)}
s["oimohx.physics.collision.broadphase.dbvt.DBVTBroadPhase"]=Or,Or.__name__=["oimohx","physics","collision","broadphase","dbvt","DBVTBroadPhase"],Or.__super__=Fr,Or.prototype=i(Fr.prototype,{tree:null,stack:null,maxStack:null,leaves:null,numLeaves:null,maxLeaves:null,createProxy:function(e){return new Vr(e)},addProxy:function(e){var t
if(t=Me.__cast(e,Vr),this.tree.insertLeaf(t.leaf),this.numLeaves==this.maxLeaves){this.maxLeaves<<=1
for(var i=[],n=0,r=this.numLeaves;r>n;){var s=n++
i[s]=this.leaves[s]}this.leaves=i}this.leaves[this.numLeaves++]=t.leaf},removeProxy:function(e){var t
t=Me.__cast(e,Vr),this.tree.deleteLeaf(t.leaf)
for(var i=0,n=this.numLeaves;n>i;){var r=i++
if(this.leaves[r]==t.leaf)return this.leaves[r]=this.leaves[--this.numLeaves],void(this.leaves[this.numLeaves]=null)}},_collectPairs:function(){if(!(this.numLeaves<2))for(var e=0,t=this.numLeaves;t>e;){var i=e++,n=this.leaves[i],r=n.proxy.aabb,s=n.aabb
if(r.minX<s.minX||r.maxX>s.maxX||r.minY<s.minY||r.maxY>s.maxY||r.minZ<s.minZ||r.maxZ>s.maxZ){var o=.1
this.tree.deleteLeaf(n),s.minX=r.minX-o,s.maxX=r.maxX+o,s.minY=r.minY-o,s.maxY=r.maxY+o,s.minZ=r.minZ-o,s.maxZ=r.maxZ+o,this.tree.insertLeaf(n),this.collide(n,this.tree.root)}}},collide:function(e,t){var i=2
for(this.stack[0]=e,this.stack[1]=t;i>0;){var n=this.stack[--i],r=this.stack[--i],s=null!=n.proxy,o=null!=r.proxy
if(this.numPairChecks++,s&&o){var a=n.proxy.shape,l=r.proxy.shape,h=a.aabb,u=l.aabb
if(a==l||h.maxX<u.minX||h.minX>u.maxX||h.maxY<u.minY||h.minY>u.maxY||h.maxZ<u.minZ||h.minZ>u.maxZ||!this.isAvailablePair(a,l))continue
this.addPair(a,l)}else{var c=n.aabb,f=r.aabb
if(c.maxX<f.minX||c.minX>f.maxX||c.maxY<f.minY||c.minY>f.maxY||c.maxZ<f.minZ||c.minZ>f.maxZ)continue
if(i+4>=this.maxStack){this.maxStack<<=1
for(var d=[],m=0;i>m;){var _=m++
d[_]=this.stack[_]}this.stack=d}o||!s&&n.aabb.surfaceArea()>r.aabb.surfaceArea()?(this.stack[i++]=n.child1,this.stack[i++]=r,this.stack[i++]=n.child2,this.stack[i++]=r):(this.stack[i++]=n,this.stack[i++]=r.child1,this.stack[i++]=n,this.stack[i++]=r.child2)}}},__class__:Or})
var kr=function(){this.aabb=new Er}
s["oimohx.physics.collision.broadphase.dbvt.DBVTNode"]=kr,kr.__name__=["oimohx","physics","collision","broadphase","dbvt","DBVTNode"],kr.prototype={child1:null,child2:null,parent:null,proxy:null,height:null,aabb:null,__class__:kr}
var Vr=function(e){Dr.call(this,e),this.leaf=new kr,this.leaf.proxy=this}
s["oimohx.physics.collision.broadphase.dbvt.DBVTProxy"]=Vr,Vr.__name__=["oimohx","physics","collision","broadphase","dbvt","DBVTProxy"],Vr.__super__=Dr,Vr.prototype=i(Dr.prototype,{leaf:null,__class__:Vr})
var Nr=function(){this.stack=[],this.numElements=0,this.bufferSize=256,this.elements=[]}
s["oimohx.physics.collision.broadphase.sap.SAPAxis"]=Nr,Nr.__name__=["oimohx","physics","collision","broadphase","sap","SAPAxis"],Nr.prototype={elements:null,numElements:null,bufferSize:null,stack:null,addElements:function(e,t){if(this.numElements+2>=this.bufferSize){this.bufferSize<<=1
for(var i=[],n=0,r=this.numElements;r>n;){var s=n++
i[s]=this.elements[s]}}this.elements[this.numElements++]=e,this.elements[this.numElements++]=t},removeElements:function(e,t){for(var i=-1,n=-1,r=0,s=this.numElements;s>r;){var o=r++,a=this.elements[o]
if(a==e||a==t){if(-1!=i){n=o
break}i=o}}for(var l=i+1;n>l;){var h=l++
this.elements[h-1]=this.elements[h]}for(var u=n+1,c=this.numElements;c>u;){var f=u++
this.elements[f-2]=this.elements[f]}this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var e=0,t=1;this.numElements>>t!=0;)t++
t=t*this.numElements>>2,e=0
for(var i=!1,n=this.elements,r=1,s=this.numElements;s>r;){var o=r++,a=n[o],l=a.value,h=n[o-1]
if(h.value>l){var u=o
do{if(n[u]=h,0==--u)break
h=n[u-1]}while(h.value>l)
if(n[u]=a,e+=o-u,e>t){i=!0
break}}}if(i){e=2
var c=this.stack
for(c[0]=0,c[1]=this.numElements-1;e>0;){var f=c[--e],d=c[--e],m=f-d
if(m>16){var _=d+(m>>1),p=n[_]
n[_]=n[f],n[f]=p
for(var v=p.value,g=d-1,x=f;;){var y,b
do y=n[++g]
while(y.value<v)
do b=n[--x]
while(v<b.value&&x!=d)
if(g>=x)break
n[g]=b,n[x]=y}n[f]=n[g],n[g]=p,g-d>f-g?(c[e++]=d,c[e++]=g-1,c[e++]=g+1,c[e++]=f):(c[e++]=g+1,c[e++]=f,c[e++]=d,c[e++]=g-1)}else for(var w=d+1,S=f+1;S>w;){var M=w++,T=n[M],C=T.value,A=n[M-1]
if(A.value>C){var I=M
do{if(n[I]=A,0==--I)break
A=n[I-1]}while(A.value>C)
n[I]=T}}}}},calculateTestCount:function(){for(var e=1,t=0,i=1,n=this.numElements;n>i;){var r=i++
this.elements[r].max?e--:(t+=e,e++)}return t},__class__:Nr}
var Ur=function(){this.numElementsS=0,this.numElementsD=0,this.axesS=[],this.axesD=[],Fr.call(this),this.axesD[0]=new Nr,this.axesD[1]=new Nr,this.axesD[2]=new Nr,this.axesS[0]=new Nr,this.axesS[1]=new Nr,this.axesS[2]=new Nr,this.index1=0,this.index2=1,this.collectPairs=r(this,this._collectPairs)}
s["oimohx.physics.collision.broadphase.sap.SAPBroadPhase"]=Ur,Ur.__name__=["oimohx","physics","collision","broadphase","sap","SAPBroadPhase"],Ur.__super__=Fr,Ur.prototype=i(Fr.prototype,{axesD:null,axesS:null,index1:null,index2:null,numElementsD:null,numElementsS:null,createProxy:function(e){return new Gr(this,e)},addProxy:function(e){var t
t=Me.__cast(e,Gr),t.isDynamic()?(this.axesD[0].addElements(t.min[0],t.max[0]),this.axesD[1].addElements(t.min[1],t.max[1]),this.axesD[2].addElements(t.min[2],t.max[2]),t.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(t.min[0],t.max[0]),this.axesS[1].addElements(t.min[1],t.max[1]),this.axesS[2].addElements(t.min[2],t.max[2]),t.belongsTo=2,this.numElementsS+=2)},removeProxy:function(e){var t
if(t=Me.__cast(e,Gr),0!=t.belongsTo){var i=t.belongsTo
switch(i){case 1:this.axesD[0].removeElements(t.min[0],t.max[0]),this.axesD[1].removeElements(t.min[1],t.max[1]),this.axesD[2].removeElements(t.min[2],t.max[2]),this.numElementsD-=2
break
case 2:this.axesS[0].removeElements(t.min[0],t.max[0]),this.axesS[1].removeElements(t.min[1],t.max[1]),this.axesS[2].removeElements(t.min[2],t.max[2]),this.numElementsS-=2}t.belongsTo=0}},_collectPairs:function(){if(0!=this.numElementsD){var e=this.axesD[this.index1],t=this.axesD[this.index2]
e.sort(),t.sort()
var i,n,r=e.calculateTestCount(),s=t.calculateTestCount()
s>=r?(t=this.axesS[this.index1],t.sort(),i=e.elements,n=t.elements):(e=this.axesS[this.index2],e.sort(),i=t.elements,n=e.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2)
for(var o,a,l=null,h=null,u=0,c=0;u<this.numElementsD;)if(c==this.numElementsS?(o=i[u],a=!0,u++):i[u].value<n[c].value?(o=i[u],a=!0,u++):(o=n[c],a=!1,c++),o.max){var f=o.pair
if(a){if(f==l){l=l.pair
continue}o=l}else{if(f==h){h=h.pair
continue}o=h}do{var d=o.pair
if(d==f){o.pair=d.pair
break}o=d}while(null!=o)}else{for(var m=l;null!=m;){var _=m.proxy.shape
this.numPairChecks++,o.min1.value>m.max1.value||o.max1.value<m.min1.value||o.min2.value>m.max2.value||o.max2.value<m.min2.value||!this.isAvailablePair(o.proxy.shape,_)?m=m.pair:(this.addPair(o.proxy.shape,_),m=m.pair)}if(a){for(m=h;null!=m;){var p=m.proxy.shape
this.numPairChecks++,o.min1.value>m.max1.value||o.max1.value<m.min1.value||o.min2.value>m.max2.value||o.max2.value<m.min2.value||!this.isAvailablePair(o.proxy.shape,p)?m=m.pair:(this.addPair(o.proxy.shape,p),m=m.pair)}o.pair=l,l=o}else o.pair=h,h=o}this.index2=3^(this.index1|this.index2)}},__class__:Ur})
var Wr=function(e,t){this.proxy=e,this.max=t,this.value=0}
s["oimohx.physics.collision.broadphase.sap.SAPElement"]=Wr,Wr.__name__=["oimohx","physics","collision","broadphase","sap","SAPElement"],Wr.prototype={proxy:null,pair:null,value:null,max:null,min1:null,max1:null,min2:null,max2:null,__class__:Wr}
var Gr=function(e,t){this.max=[],this.min=[],Dr.call(this,t),this.sap=e,this.min[0]=new Wr(this,!1),this.max[0]=new Wr(this,!0),this.min[1]=new Wr(this,!1),this.max[1]=new Wr(this,!0),this.min[2]=new Wr(this,!1),this.max[2]=new Wr(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1],this.update=r(this,this._update)}
s["oimohx.physics.collision.broadphase.sap.SAPProxy"]=Gr,Gr.__name__=["oimohx","physics","collision","broadphase","sap","SAPProxy"],Gr.__super__=Dr,Gr.prototype=i(Dr.prototype,{min:null,max:null,belongsTo:null,sap:null,_update:function(){this.min[0].value=this.aabb.minX,this.max[0].value=this.aabb.maxX,this.min[1].value=this.aabb.minY,this.max[1].value=this.aabb.maxY,this.min[2].value=this.aabb.minZ,this.max[2].value=this.aabb.maxZ,(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))},isDynamic:function(){var e=this.shape.parent
return e.isDynamic&&!e.sleeping},__class__:Gr})
var Yr=function(){}
s["oimohx.physics.collision.narrowphase.CollisionDetector"]=Yr,Yr.__name__=["oimohx","physics","collision","narrowphase","CollisionDetector"],Yr.prototype={flip:null,detectCollision:function(){},__class__:Yr}
var Hr=function(){this.INF=1/0,Yr.call(this),this.clipVertices1=[],this.clipVertices2=[],this.used=[]}
s["oimohx.physics.collision.narrowphase.BoxBoxCollisionDetector"]=Hr,Hr.__name__=["oimohx","physics","collision","narrowphase","BoxBoxCollisionDetector"],Hr.__super__=Yr,Hr.prototype=i(Yr.prototype,{clipVertices1:null,clipVertices2:null,used:null,INF:null,detectCollision:function(e,t,i){var n,r
e.id<t.id?(n=Me.__cast(e,Zr),r=Me.__cast(t,Zr)):(n=Me.__cast(t,Zr),r=Me.__cast(e,Zr))
var s,o,a,l,h,u,c,f,d,m,_,p,v,g,x,y,b,w,S,M,T,C,A,I,P,E,D,L,F,R,z,B,O,k,V,N,U=n.position,W=r.position,G=U.x,Y=U.y,H=U.z,X=W.x,j=W.y,K=W.z,Z=X-G,q=j-Y,Q=K-H,J=n.halfWidth,$=n.halfHeight,ee=n.halfDepth,te=r.halfWidth,ie=r.halfHeight,ne=r.halfDepth,re=n.halfDirectionWidth.x,se=n.halfDirectionWidth.y,oe=n.halfDirectionWidth.z,ae=n.halfDirectionHeight.x,le=n.halfDirectionHeight.y,he=n.halfDirectionHeight.z,ue=n.halfDirectionDepth.x,ce=n.halfDirectionDepth.y,fe=n.halfDirectionDepth.z,de=r.halfDirectionWidth.x,me=r.halfDirectionWidth.y,_e=r.halfDirectionWidth.z,pe=r.halfDirectionHeight.x,ve=r.halfDirectionHeight.y,ge=r.halfDirectionHeight.z,xe=r.halfDirectionDepth.x,ye=r.halfDirectionDepth.y,be=r.halfDirectionDepth.z,we=n.normalDirectionWidth.x,Se=n.normalDirectionWidth.y,Te=n.normalDirectionWidth.z,Ce=n.normalDirectionHeight.x,Ae=n.normalDirectionHeight.y,Ie=n.normalDirectionHeight.z,Pe=n.normalDirectionDepth.x,Ee=n.normalDirectionDepth.y,De=n.normalDirectionDepth.z,Le=r.normalDirectionWidth.x,Fe=r.normalDirectionWidth.y,Re=r.normalDirectionWidth.z,ze=r.normalDirectionHeight.x,Be=r.normalDirectionHeight.y,Oe=r.normalDirectionHeight.z,ke=r.normalDirectionDepth.x,Ve=r.normalDirectionDepth.y,Ne=r.normalDirectionDepth.z,Ue=Se*Re-Te*Fe,We=Te*Le-we*Re,Ge=we*Fe-Se*Le,Ye=Se*Oe-Te*Be,He=Te*ze-we*Oe,Xe=we*Be-Se*ze,je=Se*Ne-Te*Ve,Ke=Te*ke-we*Ne,Ze=we*Ve-Se*ke,qe=Ae*Re-Ie*Fe,Qe=Ie*Le-Ce*Re,Je=Ce*Fe-Ae*Le,$e=Ae*Oe-Ie*Be,et=Ie*ze-Ce*Oe,tt=Ce*Be-Ae*ze,it=Ae*Ne-Ie*Ve,nt=Ie*ke-Ce*Ne,rt=Ce*Ve-Ae*ke,st=Ee*Re-De*Fe,ot=De*Le-Pe*Re,at=Pe*Fe-Ee*Le,lt=Ee*Oe-De*Be,ht=De*ze-Pe*Oe,ut=Pe*Be-Ee*ze,ct=Ee*Ne-De*Ve,ft=De*ke-Pe*Ne,dt=Pe*Ve-Ee*ke,mt=!1,_t=!1,pt=!1,vt=!1,gt=!1,xt=!1,yt=!1,bt=!1,wt=!1
if(z=we*Z+Se*q+Te*Q,s=z>0,s||(z=-z),B=J,k=we*Le+Se*Fe+Te*Re,V=we*ze+Se*Be+Te*Oe,N=we*ke+Se*Ve+Te*Ne,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),O=k*te+V*ie+N*ne,y=z-B-O,!(y>0||(z=Ce*Z+Ae*q+Ie*Q,o=z>0,o||(z=-z),B=$,k=Ce*Le+Ae*Fe+Ie*Re,V=Ce*ze+Ae*Be+Ie*Oe,N=Ce*ke+Ae*Ve+Ie*Ne,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),O=k*te+V*ie+N*ne,b=z-B-O,b>0||(z=Pe*Z+Ee*q+De*Q,a=z>0,a||(z=-z),B=ee,k=Pe*Le+Ee*Fe+De*Re,V=Pe*ze+Ee*Be+De*Oe,N=Pe*ke+Ee*Ve+De*Ne,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),O=k*te+V*ie+N*ne,w=z-B-O,w>0||(z=Le*Z+Fe*q+Re*Q,l=z>0,l||(z=-z),k=Le*we+Fe*Se+Re*Te,V=Le*Ce+Fe*Ae+Re*Ie,N=Le*Pe+Fe*Ee+Re*De,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),B=k*J+V*$+N*ee,O=te,S=z-B-O,S>0||(z=ze*Z+Be*q+Oe*Q,h=z>0,h||(z=-z),k=ze*we+Be*Se+Oe*Te,V=ze*Ce+Be*Ae+Oe*Ie,N=ze*Pe+Be*Ee+Oe*De,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),B=k*J+V*$+N*ee,O=ie,M=z-B-O,M>0||(z=ke*Z+Ve*q+Ne*Q,u=z>0,u||(z=-z),k=ke*we+Ve*Se+Ne*Te,V=ke*Ce+Ve*Ae+Ne*Ie,N=ke*Pe+Ve*Ee+Ne*De,0>k&&(k=-k),0>V&&(V=-V),0>N&&(N=-N),B=k*J+V*$+N*ee,O=ne,T=z-B-O,T>0))))))){if(z=Ue*Ue+We*We+Ge*Ge,z>1e-5){if(z=1/Math.sqrt(z),Ue*=z,We*=z,Ge*=z,z=Ue*Z+We*q+Ge*Q,c=z>0,c||(z=-z),k=Ue*Ce+We*Ae+Ge*Ie,V=Ue*Pe+We*Ee+Ge*De,0>k&&(k=-k),0>V&&(V=-V),B=k*$+V*ee,k=Ue*ze+We*Be+Ge*Oe,V=Ue*ke+We*Ve+Ge*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*ie+V*ne,C=z-B-O,C>0)return}else c=!1,C=0,mt=!0
if(z=Ye*Ye+He*He+Xe*Xe,z>1e-5){if(z=1/Math.sqrt(z),Ye*=z,He*=z,Xe*=z,z=Ye*Z+He*q+Xe*Q,f=z>0,f||(z=-z),k=Ye*Ce+He*Ae+Xe*Ie,V=Ye*Pe+He*Ee+Xe*De,0>k&&(k=-k),0>V&&(V=-V),B=k*$+V*ee,k=Ye*Le+He*Fe+Xe*Re,V=Ye*ke+He*Ve+Xe*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ne,A=z-B-O,A>0)return}else f=!1,A=0,_t=!0
if(z=je*je+Ke*Ke+Ze*Ze,z>1e-5){if(z=1/Math.sqrt(z),je*=z,Ke*=z,Ze*=z,z=je*Z+Ke*q+Ze*Q,d=z>0,d||(z=-z),k=je*Ce+Ke*Ae+Ze*Ie,V=je*Pe+Ke*Ee+Ze*De,0>k&&(k=-k),0>V&&(V=-V),B=k*$+V*ee,k=je*Le+Ke*Fe+Ze*Re,V=je*ze+Ke*Be+Ze*Oe,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ie,I=z-B-O,I>0)return}else d=!1,I=0,pt=!0
if(z=qe*qe+Qe*Qe+Je*Je,z>1e-5){if(z=1/Math.sqrt(z),qe*=z,Qe*=z,Je*=z,z=qe*Z+Qe*q+Je*Q,m=z>0,m||(z=-z),k=qe*we+Qe*Se+Je*Te,V=qe*Pe+Qe*Ee+Je*De,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*ee,k=qe*ze+Qe*Be+Je*Oe,V=qe*ke+Qe*Ve+Je*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*ie+V*ne,P=z-B-O,P>0)return}else m=!1,P=0,vt=!0
if(z=$e*$e+et*et+tt*tt,z>1e-5){if(z=1/Math.sqrt(z),$e*=z,et*=z,tt*=z,z=$e*Z+et*q+tt*Q,_=z>0,_||(z=-z),k=$e*we+et*Se+tt*Te,V=$e*Pe+et*Ee+tt*De,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*ee,k=$e*Le+et*Fe+tt*Re,V=$e*ke+et*Ve+tt*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ne,E=z-B-O,E>0)return}else _=!1,E=0,gt=!0
if(z=it*it+nt*nt+rt*rt,z>1e-5){if(z=1/Math.sqrt(z),it*=z,nt*=z,rt*=z,z=it*Z+nt*q+rt*Q,p=z>0,p||(z=-z),k=it*we+nt*Se+rt*Te,V=it*Pe+nt*Ee+rt*De,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*ee,k=it*Le+nt*Fe+rt*Re,V=it*ze+nt*Be+rt*Oe,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ie,D=z-B-O,D>0)return}else p=!1,D=0,xt=!0
if(z=st*st+ot*ot+at*at,z>1e-5){if(z=1/Math.sqrt(z),st*=z,ot*=z,at*=z,z=st*Z+ot*q+at*Q,v=z>0,v||(z=-z),k=st*we+ot*Se+at*Te,V=st*Ce+ot*Ae+at*Ie,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*$,k=st*ze+ot*Be+at*Oe,V=st*ke+ot*Ve+at*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*ie+V*ne,L=z-B-O,L>0)return}else v=!1,L=0,yt=!0
if(z=lt*lt+ht*ht+ut*ut,z>1e-5){if(z=1/Math.sqrt(z),lt*=z,ht*=z,ut*=z,z=lt*Z+ht*q+ut*Q,g=z>0,g||(z=-z),k=lt*we+ht*Se+ut*Te,V=lt*Ce+ht*Ae+ut*Ie,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*$,k=lt*Le+ht*Fe+ut*Re,V=lt*ke+ht*Ve+ut*Ne,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ne,F=z-B-O,F>0)return}else g=!1,F=0,bt=!0
if(z=ct*ct+ft*ft+dt*dt,z>1e-5){if(z=1/Math.sqrt(z),ct*=z,ft*=z,dt*=z,z=ct*Z+ft*q+dt*Q,x=z>0,x||(z=-z),k=ct*we+ft*Se+dt*Te,V=ct*Ce+ft*Ae+dt*Ie,0>k&&(k=-k),0>V&&(V=-V),B=k*J+V*$,k=ct*Le+ft*Fe+dt*Re,V=ct*ze+ft*Be+dt*Oe,0>k&&(k=-k),0>V&&(V=-V),O=k*te+V*ie,R=z-B-O,R>0)return}else x=!1,R=0,wt=!0
var St=y,Mt=y,Tt=0,Ct=s
b>Mt&&(St=b,Mt=b,Tt=1,Ct=o),w>Mt&&(St=w,Mt=w,Tt=2,Ct=a),S>Mt&&(St=S,Mt=S,Tt=3,Ct=l),M>Mt&&(St=M,Mt=M,Tt=4,Ct=h),T>Mt&&(St=T,Mt=T,Tt=5,Ct=u),C-.01>Mt&&!mt&&(St=C,Mt=C-.01,Tt=6,Ct=c),A-.01>Mt&&!_t&&(St=A,Mt=A-.01,Tt=7,Ct=f),I-.01>Mt&&!pt&&(St=I,Mt=I-.01,Tt=8,Ct=d),P-.01>Mt&&!vt&&(St=P,Mt=P-.01,Tt=9,Ct=m),E-.01>Mt&&!gt&&(St=E,Mt=E-.01,Tt=10,Ct=_),D-.01>Mt&&!xt&&(St=D,Mt=D-.01,Tt=11,Ct=p),L-.01>Mt&&!yt&&(St=L,Mt=L-.01,Tt=12,Ct=v),F-.01>Mt&&!bt&&(St=F,Mt=F-.01,Tt=13,Ct=g),R-.01>Mt&&!wt&&(St=R,Tt=14,Ct=x)
var At=0,It=0,Pt=0,Et=0,Dt=0,Lt=0,Ft=0,Rt=0,zt=0,Bt=0,Ot=0,kt=0,Vt=0,Nt=0,Ut=0,Wt=0,Gt=0,Yt=0,Ht=!1
switch(Tt){case 0:Ct?(Bt=G+re,Ot=Y+se,kt=H+oe,At=we,It=Se,Pt=Te):(Bt=G-re,Ot=Y-se,kt=H-oe,At=-we,It=-Se,Pt=-Te),Vt=ae,Nt=le,Ut=he,Et=-Ce,Dt=-Ae,Lt=-Ie,Wt=ue,Gt=ce,Yt=fe,Ft=-Pe,Rt=-Ee,zt=-De
break
case 1:Ct?(Bt=G+ae,Ot=Y+le,kt=H+he,At=Ce,It=Ae,Pt=Ie):(Bt=G-ae,Ot=Y-le,kt=H-he,At=-Ce,It=-Ae,Pt=-Ie),Vt=re,Nt=se,Ut=oe,Et=-we,Dt=-Se,Lt=-Te,Wt=ue,Gt=ce,Yt=fe,Ft=-Pe,Rt=-Ee,zt=-De
break
case 2:Ct?(Bt=G+ue,Ot=Y+ce,kt=H+fe,At=Pe,It=Ee,Pt=De):(Bt=G-ue,Ot=Y-ce,kt=H-fe,At=-Pe,It=-Ee,Pt=-De),Vt=re,Nt=se,Ut=oe,Et=-we,Dt=-Se,Lt=-Te,Wt=ae,Gt=le,Yt=he,Ft=-Ce,Rt=-Ae,zt=-Ie
break
case 3:Ht=!0,Ct?(Bt=X-de,Ot=j-me,kt=K-_e,At=-Le,It=-Fe,Pt=-Re):(Bt=X+de,Ot=j+me,kt=K+_e,At=Le,It=Fe,Pt=Re),Vt=pe,Nt=ve,Ut=ge,Et=-ze,Dt=-Be,Lt=-Oe,Wt=xe,Gt=ye,Yt=be,Ft=-ke,Rt=-Ve,zt=-Ne
break
case 4:Ht=!0,Ct?(Bt=X-pe,Ot=j-ve,kt=K-ge,At=-ze,It=-Be,Pt=-Oe):(Bt=X+pe,Ot=j+ve,kt=K+ge,At=ze,It=Be,Pt=Oe),Vt=de,Nt=me,Ut=_e,Et=-Le,Dt=-Fe,Lt=-Re,Wt=xe,Gt=ye,Yt=be,Ft=-ke,Rt=-Ve,zt=-Ne
break
case 5:Ht=!0,Ct?(Bt=X-xe,Ot=j-ye,kt=K-be,At=-ke,It=-Ve,Pt=-Ne):(Bt=X+xe,Ot=j+ye,kt=K+be,At=ke,It=Ve,Pt=Ne),Vt=de,Nt=me,Ut=_e,Et=-Le,Dt=-Fe,Lt=-Re,Wt=pe,Gt=ve,Yt=ge,Ft=-ze,Rt=-Be,zt=-Oe
break
case 6:At=Ue,It=We,Pt=Ge,Et=we,Dt=Se,Lt=Te,Ft=Le,Rt=Fe,zt=Re
break
case 7:At=Ye,It=He,Pt=Xe,Et=we,Dt=Se,Lt=Te,Ft=ze,Rt=Be,zt=Oe
break
case 8:At=je,It=Ke,Pt=Ze,Et=we,Dt=Se,Lt=Te,Ft=ke,Rt=Ve,zt=Ne
break
case 9:At=qe,It=Qe,Pt=Je,Et=Ce,Dt=Ae,Lt=Ie,Ft=Le,Rt=Fe,zt=Re
break
case 10:At=$e,It=et,Pt=tt,Et=Ce,Dt=Ae,Lt=Ie,Ft=ze,Rt=Be,zt=Oe
break
case 11:At=it,It=nt,Pt=rt,Et=Ce,Dt=Ae,Lt=Ie,Ft=ke,Rt=Ve,zt=Ne
break
case 12:At=st,It=ot,Pt=at,Et=Pe,Dt=Ee,Lt=De,Ft=Le,Rt=Fe,zt=Re
break
case 13:At=lt,It=ht,Pt=ut,Et=Pe,Dt=Ee,Lt=De,Ft=ze,Rt=Be,zt=Oe
break
case 14:At=ct,It=ft,Pt=dt,Et=Pe,Dt=Ee,Lt=De,Ft=ke,Rt=Ve,zt=Ne}var Xt=null
if(Tt>5){Ct||(At=-At,It=-It,Pt=-Pt)
var jt,Kt,Zt,qt,Qt,Jt,$t,ei,ti,ii,ni
Xt=n.vertex1,Jt=Xt.x,$t=Xt.y,ei=Xt.z,Kt=At*Jt+It*$t+Pt*ei,Xt=n.vertex2,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex3,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex4,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex5,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex6,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex7,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=n.vertex8,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,jt>Kt&&(Kt=jt,Jt=Zt,$t=qt,ei=Qt),Xt=r.vertex1,ti=Xt.x,ii=Xt.y,ni=Xt.z,Kt=At*ti+It*ii+Pt*ni,Xt=r.vertex2,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex3,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex4,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex5,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex6,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex7,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Xt=r.vertex8,Zt=Xt.x,qt=Xt.y,Qt=Xt.z,jt=At*Zt+It*qt+Pt*Qt,Kt>jt&&(Kt=jt,ti=Zt,ii=qt,ni=Qt),Zt=ti-Jt,qt=ii-$t,Qt=ni-ei,k=Et*Ft+Dt*Rt+Lt*zt
var ri=(Zt*(Et-Ft*k)+qt*(Dt-Rt*k)+Qt*(Lt-zt*k))/(1-k*k)
return void i.addPoint(Jt+Et*ri+At*St*.5,$t+Dt*ri+It*St*.5,ei+Lt*ri+Pt*St*.5,At,It,Pt,St,!1)}var si=0,oi=0,ai=0,li=0,hi=0,ui=0,ci=0,fi=0,di=0,mi=0,_i=0,pi=0,vi=1,gi=0,xi=0
if(Ht)switch(gi=we*At+Se*It+Te*Pt,vi>gi&&(vi=gi,xi=0),vi>-gi&&(vi=-gi,xi=1),gi=Ce*At+Ae*It+Ie*Pt,vi>gi&&(vi=gi,xi=2),vi>-gi&&(vi=-gi,xi=3),gi=Pe*At+Ee*It+De*Pt,vi>gi&&(vi=gi,xi=4),vi>-gi&&(vi=-gi,xi=5),xi){case 0:Xt=n.vertex1,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex3,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex4,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex2,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 1:Xt=n.vertex6,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex8,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex7,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex5,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 2:Xt=n.vertex5,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex1,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex2,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex6,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 3:Xt=n.vertex8,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex4,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex3,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex7,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 4:Xt=n.vertex5,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex7,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex3,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex1,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 5:Xt=n.vertex2,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=n.vertex4,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=n.vertex8,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=n.vertex6,mi=Xt.x,_i=Xt.y,pi=Xt.z}else switch(gi=Le*At+Fe*It+Re*Pt,vi>gi&&(vi=gi,xi=0),vi>-gi&&(vi=-gi,xi=1),gi=ze*At+Be*It+Oe*Pt,vi>gi&&(vi=gi,xi=2),vi>-gi&&(vi=-gi,xi=3),gi=ke*At+Ve*It+Ne*Pt,vi>gi&&(vi=gi,xi=4),vi>-gi&&(vi=-gi,xi=5),xi){case 0:Xt=r.vertex1,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex3,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex4,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex2,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 1:Xt=r.vertex6,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex8,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex7,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex5,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 2:Xt=r.vertex5,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex1,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex2,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex6,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 3:Xt=r.vertex8,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex4,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex3,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex7,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 4:Xt=r.vertex5,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex7,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex3,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex1,mi=Xt.x,_i=Xt.y,pi=Xt.z
break
case 5:Xt=r.vertex2,si=Xt.x,oi=Xt.y,ai=Xt.z,Xt=r.vertex4,li=Xt.x,hi=Xt.y,ui=Xt.z,Xt=r.vertex8,ci=Xt.x,fi=Xt.y,di=Xt.z,Xt=r.vertex6,mi=Xt.x,_i=Xt.y,pi=Xt.z}var yi,bi,wi,Si,Mi,Ti,Ci,Ai,Ii
this.clipVertices1[0]=si,this.clipVertices1[1]=oi,this.clipVertices1[2]=ai,this.clipVertices1[3]=li,this.clipVertices1[4]=hi,this.clipVertices1[5]=ui,this.clipVertices1[6]=ci,this.clipVertices1[7]=fi,this.clipVertices1[8]=di,this.clipVertices1[9]=mi,this.clipVertices1[10]=_i,this.clipVertices1[11]=pi,bi=0,Si=this.clipVertices1[9],Mi=this.clipVertices1[10],Ti=this.clipVertices1[11],k=(Si-Bt-Vt)*Et+(Mi-Ot-Nt)*Dt+(Ti-kt-Ut)*Lt
for(var Pi=0;4>Pi;){var Ei=Pi++
if(wi=3*Ei,Ci=this.clipVertices1[wi],Ai=this.clipVertices1[wi+1],Ii=this.clipVertices1[wi+2],V=(Ci-Bt-Vt)*Et+(Ai-Ot-Nt)*Dt+(Ii-kt-Ut)*Lt,k>0)if(V>0)wi=3*bi,bi++,this.clipVertices2[wi]=Ci,this.clipVertices2[wi+1]=Ai,this.clipVertices2[wi+2]=Ii
else{wi=3*bi,bi++
var Di=k/(k-V)
this.clipVertices2[wi]=Si+(Ci-Si)*Di,this.clipVertices2[wi+1]=Mi+(Ai-Mi)*Di,this.clipVertices2[wi+2]=Ti+(Ii-Ti)*Di}else if(V>0){wi=3*bi,bi++
var Li=k/(k-V)
this.clipVertices2[wi]=Si+(Ci-Si)*Li,this.clipVertices2[wi+1]=Mi+(Ai-Mi)*Li,this.clipVertices2[wi+2]=Ti+(Ii-Ti)*Li,wi=3*bi,bi++,this.clipVertices2[wi]=Ci,this.clipVertices2[wi+1]=Ai,this.clipVertices2[wi+2]=Ii}Si=Ci,Mi=Ai,Ti=Ii,k=V}if(yi=bi,0!=yi){bi=0,wi=3*(yi-1),Si=this.clipVertices2[wi],Mi=this.clipVertices2[wi+1],Ti=this.clipVertices2[wi+2],k=(Si-Bt-Wt)*Ft+(Mi-Ot-Gt)*Rt+(Ti-kt-Yt)*zt
for(var Fi=0;yi>Fi;){var Ri=Fi++
if(wi=3*Ri,Ci=this.clipVertices2[wi],Ai=this.clipVertices2[wi+1],Ii=this.clipVertices2[wi+2],V=(Ci-Bt-Wt)*Ft+(Ai-Ot-Gt)*Rt+(Ii-kt-Yt)*zt,k>0)if(V>0)wi=3*bi,bi++,this.clipVertices1[wi]=Ci,this.clipVertices1[wi+1]=Ai,this.clipVertices1[wi+2]=Ii
else{wi=3*bi,bi++
var zi=k/(k-V)
this.clipVertices1[wi]=Si+(Ci-Si)*zi,this.clipVertices1[wi+1]=Mi+(Ai-Mi)*zi,this.clipVertices1[wi+2]=Ti+(Ii-Ti)*zi}else if(V>0){wi=3*bi,bi++
var Bi=k/(k-V)
this.clipVertices1[wi]=Si+(Ci-Si)*Bi,this.clipVertices1[wi+1]=Mi+(Ai-Mi)*Bi,this.clipVertices1[wi+2]=Ti+(Ii-Ti)*Bi,wi=3*bi,bi++,this.clipVertices1[wi]=Ci,this.clipVertices1[wi+1]=Ai,this.clipVertices1[wi+2]=Ii}Si=Ci,Mi=Ai,Ti=Ii,k=V}if(yi=bi,0!=yi){bi=0,wi=3*(yi-1),Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],k=(Si-Bt+Vt)*-Et+(Mi-Ot+Nt)*-Dt+(Ti-kt+Ut)*-Lt
for(var Oi=0;yi>Oi;){var ki=Oi++
if(wi=3*ki,Ci=this.clipVertices1[wi],Ai=this.clipVertices1[wi+1],Ii=this.clipVertices1[wi+2],V=(Ci-Bt+Vt)*-Et+(Ai-Ot+Nt)*-Dt+(Ii-kt+Ut)*-Lt,k>0)if(V>0)wi=3*bi,bi++,this.clipVertices2[wi]=Ci,this.clipVertices2[wi+1]=Ai,this.clipVertices2[wi+2]=Ii
else{wi=3*bi,bi++
var Vi=k/(k-V)
this.clipVertices2[wi]=Si+(Ci-Si)*Vi,this.clipVertices2[wi+1]=Mi+(Ai-Mi)*Vi,this.clipVertices2[wi+2]=Ti+(Ii-Ti)*Vi}else if(V>0){wi=3*bi,bi++
var Ni=k/(k-V)
this.clipVertices2[wi]=Si+(Ci-Si)*Ni,this.clipVertices2[wi+1]=Mi+(Ai-Mi)*Ni,this.clipVertices2[wi+2]=Ti+(Ii-Ti)*Ni,wi=3*bi,bi++,this.clipVertices2[wi]=Ci,this.clipVertices2[wi+1]=Ai,this.clipVertices2[wi+2]=Ii}Si=Ci,Mi=Ai,Ti=Ii,k=V}if(yi=bi,0!=yi){bi=0,wi=3*(yi-1),Si=this.clipVertices2[wi],Mi=this.clipVertices2[wi+1],Ti=this.clipVertices2[wi+2],k=(Si-Bt+Wt)*-Ft+(Mi-Ot+Gt)*-Rt+(Ti-kt+Yt)*-zt
for(var Ui=0;yi>Ui;){var Wi=Ui++
if(wi=3*Wi,Ci=this.clipVertices2[wi],Ai=this.clipVertices2[wi+1],Ii=this.clipVertices2[wi+2],V=(Ci-Bt+Wt)*-Ft+(Ai-Ot+Gt)*-Rt+(Ii-kt+Yt)*-zt,k>0)if(V>0)wi=3*bi,bi++,this.clipVertices1[wi]=Ci,this.clipVertices1[wi+1]=Ai,this.clipVertices1[wi+2]=Ii
else{wi=3*bi,bi++
var Gi=k/(k-V)
this.clipVertices1[wi]=Si+(Ci-Si)*Gi,this.clipVertices1[wi+1]=Mi+(Ai-Mi)*Gi,this.clipVertices1[wi+2]=Ti+(Ii-Ti)*Gi}else if(V>0){wi=3*bi,bi++
var Yi=k/(k-V)
this.clipVertices1[wi]=Si+(Ci-Si)*Yi,this.clipVertices1[wi+1]=Mi+(Ai-Mi)*Yi,this.clipVertices1[wi+2]=Ti+(Ii-Ti)*Yi,wi=3*bi,bi++,this.clipVertices1[wi]=Ci,this.clipVertices1[wi+1]=Ai,this.clipVertices1[wi+2]=Ii}Si=Ci,Mi=Ai,Ti=Ii,k=V}if(yi=bi,Ht){var Hi=n
n=r,r=Hi}if(0!=yi){var Xi=n!=e
if(yi>4){Si=.25*(si+li+ci+mi),Mi=.25*(oi+hi+fi+_i),Ti=.25*(ai+ui+di+pi),Et=si-Si,Dt=oi-Mi,Lt=ai-Ti,Ft=li-Si,Rt=hi-Mi,zt=ui-Ti
var ji=0,Ki=0,Zi=0,qi=0,Qi=-this.INF
vi=this.INF
for(var Ji=0;yi>Ji;){var $i=Ji++
this.used[$i]=!1,wi=3*$i,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=Si*Et+Mi*Dt+Ti*Lt,vi>gi&&(vi=gi,ji=$i),gi>Qi&&(Qi=gi,Zi=$i)}this.used[ji]=!0,this.used[Zi]=!0,Qi=-this.INF,vi=this.INF
for(var en=0;yi>en;){var tn=en++
this.used[tn]||(wi=3*tn,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=Si*Ft+Mi*Rt+Ti*zt,vi>gi&&(vi=gi,Ki=tn),gi>Qi&&(Qi=gi,qi=tn))}wi=3*ji,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=(Si-Bt)*At+(Mi-Ot)*It+(Ti-kt)*Pt,0>gi&&i.addPoint(Si,Mi,Ti,At,It,Pt,gi,Xi),wi=3*Ki,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=(Si-Bt)*At+(Mi-Ot)*It+(Ti-kt)*Pt,0>gi&&i.addPoint(Si,Mi,Ti,At,It,Pt,gi,Xi),wi=3*Zi,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=(Si-Bt)*At+(Mi-Ot)*It+(Ti-kt)*Pt,0>gi&&i.addPoint(Si,Mi,Ti,At,It,Pt,gi,Xi),wi=3*qi,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=(Si-Bt)*At+(Mi-Ot)*It+(Ti-kt)*Pt,0>gi&&i.addPoint(Si,Mi,Ti,At,It,Pt,gi,Xi)}else for(var nn=0;yi>nn;){var rn=nn++
wi=3*rn,Si=this.clipVertices1[wi],Mi=this.clipVertices1[wi+1],Ti=this.clipVertices1[wi+2],gi=(Si-Bt)*At+(Mi-Ot)*It+(Ti-kt)*Pt,0>gi&&i.addPoint(Si,Mi,Ti,At,It,Pt,gi,Xi)}}}}}}},__class__:Hr})
var Xr=function(e){Yr.call(this),this.flip=e}
s["oimohx.physics.collision.narrowphase.SphereBoxCollisionDetector"]=Xr,Xr.__name__=["oimohx","physics","collision","narrowphase","SphereBoxCollisionDetector"],Xr.__super__=Yr,Xr.prototype=i(Yr.prototype,{detectCollision:function(e,t,i){var n,r
this.flip?(n=Me.__cast(t,Jr),r=Me.__cast(e,Zr)):(n=Me.__cast(e,Jr),r=Me.__cast(t,Zr))
var s,o,a,l,h,u=n.position,c=u.x,f=u.y,d=u.z,m=r.position,_=m.x,p=m.y,v=m.z,g=n.radius,x=r.normalDirectionWidth,y=r.normalDirectionHeight,b=r.normalDirectionDepth,w=r.halfWidth,S=r.halfHeight,M=r.halfDepth,T=c-_,C=f-p,A=d-v,I=x.x*T+x.y*C+x.z*A,P=y.x*T+y.y*C+y.z*A,E=b.x*T+b.y*C+b.z*A,D=0
I>w?I=w:-w>I?I=-w:D=1,P>S?P=S:-S>P?P=-S:D|=2,E>M?E=M:-M>E?E=-M:D|=4,7==D?(T=0>I?w+I:w-I,C=0>P?S+P:S-P,A=0>E?M+E:M-E,C>T?A>T?(l=T-w,0>I?(I=-w,T=x.x,C=x.y,A=x.z):(I=w,T=-x.x,C=-x.y,A=-x.z)):(l=A-M,0>E?(E=-M,T=b.x,C=b.y,A=b.z):(E=M,T=-b.x,C=-b.y,A=-b.z)):A>C?(l=C-S,0>P?(P=-S,T=y.x,C=y.y,A=y.z):(P=S,T=-y.x,C=-y.y,A=-y.z)):(l=A-M,0>E?(E=-M,T=b.x,C=b.y,A=b.z):(E=M,T=-b.x,C=-b.y,A=-b.z)),s=_+I*x.x+P*y.x+E*b.x,o=p+I*x.y+P*y.y+E*b.y,a=v+I*x.z+P*y.z+E*b.z,i.addPoint(c+g*T,f+g*C,d+g*A,T,C,A,l-g,this.flip)):(s=_+I*x.x+P*y.x+E*b.x,o=p+I*x.y+P*y.y+E*b.y,a=v+I*x.z+P*y.z+E*b.z,T=s-u.x,C=o-u.y,A=a-u.z,l=T*T+C*C+A*A,l>0&&g*g>l&&(l=Math.sqrt(l),h=1/l,T*=h,C*=h,A*=h,i.addPoint(c+g*T,f+g*C,d+g*A,T,C,A,l-g,this.flip)))},__class__:Xr})
var jr=function(){Yr.call(this)}
s["oimohx.physics.collision.narrowphase.SphereSphereCollisionDetector"]=jr,jr.__name__=["oimohx","physics","collision","narrowphase","SphereSphereCollisionDetector"],jr.__super__=Yr,jr.prototype=i(Yr.prototype,{detectCollision:function(e,t,i){var n
n=Me.__cast(e,Jr)
var r
r=Me.__cast(t,Jr)
var s=n.position,o=r.position,a=o.x-s.x,l=o.y-s.y,h=o.z-s.z,u=a*a+l*l+h*h,c=n.radius,f=r.radius,d=c+f
if(u>0&&d*d>u){u=Math.sqrt(u)
var m=1/u
a*=m,l*=m,h*=m,i.addPoint(s.x+a*c,s.y+l*c,s.z+h*c,a,l,h,u-d,!1)}},__class__:jr})
var Kr=function(e){this.parent=null,this.id=++Kr.nextID,this.position=new Pr,this.relativePosition=(new Pr).copy(e.relativePosition),this.rotation=new Cr,this.relativeRotation=(new Cr).copy(e.relativeRotation),this.aabb=new Er,this.density=e.density,this.friction=e.friction,this.restitution=e.restitution,this.belongsTo=e.belongsTo,this.collidesWith=e.collidesWith}
s["oimohx.physics.collision.shape.Shape"]=Kr,Kr.__name__=["oimohx","physics","collision","shape","Shape"],Kr.prototype={prev:null,next:null,id:null,type:null,position:null,rotation:null,relativePosition:null,relativeRotation:null,friction:null,restitution:null,density:null,aabb:null,proxy:null,parent:null,contactLink:null,numContacts:null,belongsTo:null,collidesWith:null,calculateMassInfo:null,updateProxy:null,__class__:Kr}
var Zr=function(e,t,i,n){Kr.call(this,e),this.width=t,this.halfWidth=.5*t,this.height=i,this.halfHeight=.5*i,this.depth=n,this.halfDepth=.5*n,this.normalDirectionWidth=new Pr,this.normalDirectionHeight=new Pr,this.normalDirectionDepth=new Pr,this.halfDirectionWidth=new Pr,this.halfDirectionHeight=new Pr,this.halfDirectionDepth=new Pr,this.vertex1=new Pr,this.vertex2=new Pr,this.vertex3=new Pr,this.vertex4=new Pr,this.vertex5=new Pr,this.vertex6=new Pr,this.vertex7=new Pr,this.vertex8=new Pr,this.type=2,this.calculateMassInfo=r(this,this._calculateMassInfo),this.updateProxy=r(this,this._updateProxy)}
s["oimohx.physics.collision.shape.BoxShape"]=Zr,Zr.__name__=["oimohx","physics","collision","shape","BoxShape"],Zr.__super__=Kr,Zr.prototype=i(Kr.prototype,{width:null,halfWidth:null,height:null,halfHeight:null,depth:null,halfDepth:null,normalDirectionWidth:null,normalDirectionHeight:null,normalDirectionDepth:null,halfDirectionWidth:null,halfDirectionHeight:null,halfDirectionDepth:null,vertex1:null,vertex2:null,vertex3:null,vertex4:null,vertex5:null,vertex6:null,vertex7:null,vertex8:null,wx:null,wy:null,wz:null,hx:null,hy:null,hz:null,dx:null,dy:null,dz:null,x:null,y:null,z:null,w:null,h:null,d:null,_calculateMassInfo:function(e){var t=this.width*this.height*this.depth*this.density
e.mass=t,e.inertia.init(t*(this.height*this.height+this.depth*this.depth)/12,0,0,0,t*(this.width*this.width+this.depth*this.depth)/12,0,0,0,t*(this.width*this.width+this.height*this.height)/12)},_updateProxy:function(){this.normalDirectionWidth.x=this.rotation.elements[0],this.normalDirectionWidth.y=this.rotation.elements[3],this.normalDirectionWidth.z=this.rotation.elements[6],this.normalDirectionHeight.x=this.rotation.elements[1],this.normalDirectionHeight.y=this.rotation.elements[4],this.normalDirectionHeight.z=this.rotation.elements[7],this.normalDirectionDepth.x=this.rotation.elements[2],this.normalDirectionDepth.y=this.rotation.elements[5],this.normalDirectionDepth.z=this.rotation.elements[8],this.halfDirectionWidth.x=this.rotation.elements[0]*this.halfWidth,this.halfDirectionWidth.y=this.rotation.elements[3]*this.halfWidth,this.halfDirectionWidth.z=this.rotation.elements[6]*this.halfWidth,this.halfDirectionHeight.x=this.rotation.elements[1]*this.halfHeight,this.halfDirectionHeight.y=this.rotation.elements[4]*this.halfHeight,this.halfDirectionHeight.z=this.rotation.elements[7]*this.halfHeight,this.halfDirectionDepth.x=this.rotation.elements[2]*this.halfDepth,this.halfDirectionDepth.y=this.rotation.elements[5]*this.halfDepth,this.halfDirectionDepth.z=this.rotation.elements[8]*this.halfDepth,this.wx=this.halfDirectionWidth.x,this.wy=this.halfDirectionWidth.y,this.wz=this.halfDirectionWidth.z,this.hx=this.halfDirectionHeight.x,this.hy=this.halfDirectionHeight.y,this.hz=this.halfDirectionHeight.z,this.dx=this.halfDirectionDepth.x,this.dy=this.halfDirectionDepth.y,this.dz=this.halfDirectionDepth.z,this.x=this.position.x,this.y=this.position.y,this.z=this.position.z,this.vertex1.x=this.x+this.wx+this.hx+this.dx,this.vertex1.y=this.y+this.wy+this.hy+this.dy,this.vertex1.z=this.z+this.wz+this.hz+this.dz,this.vertex2.x=this.x+this.wx+this.hx-this.dx,this.vertex2.y=this.y+this.wy+this.hy-this.dy,this.vertex2.z=this.z+this.wz+this.hz-this.dz,this.vertex3.x=this.x+this.wx-this.hx+this.dx,this.vertex3.y=this.y+this.wy-this.hy+this.dy,this.vertex3.z=this.z+this.wz-this.hz+this.dz,this.vertex4.x=this.x+this.wx-this.hx-this.dx,this.vertex4.y=this.y+this.wy-this.hy-this.dy,this.vertex4.z=this.z+this.wz-this.hz-this.dz,this.vertex5.x=this.x-this.wx+this.hx+this.dx,this.vertex5.y=this.y-this.wy+this.hy+this.dy,this.vertex5.z=this.z-this.wz+this.hz+this.dz,this.vertex6.x=this.x-this.wx+this.hx-this.dx,this.vertex6.y=this.y-this.wy+this.hy-this.dy,this.vertex6.z=this.z-this.wz+this.hz-this.dz,this.vertex7.x=this.x-this.wx-this.hx+this.dx,this.vertex7.y=this.y-this.wy-this.hy+this.dy,this.vertex7.z=this.z-this.wz-this.hz+this.dz,this.vertex8.x=this.x-this.wx-this.hx-this.dx,this.vertex8.y=this.y-this.wy-this.hy-this.dy,this.vertex8.z=this.z-this.wz-this.hz-this.dz,this.halfDirectionWidth.x<0?this.w=-this.halfDirectionWidth.x:this.w=this.halfDirectionWidth.x,this.halfDirectionWidth.y<0?this.h=-this.halfDirectionWidth.y:this.h=this.halfDirectionWidth.y,this.halfDirectionWidth.z<0?this.d=-this.halfDirectionWidth.z:this.d=this.halfDirectionWidth.z,this.halfDirectionHeight.x<0?this.w-=this.halfDirectionHeight.x:this.w+=this.halfDirectionHeight.x,this.halfDirectionHeight.y<0?this.h-=this.halfDirectionHeight.y:this.h+=this.halfDirectionHeight.y,this.halfDirectionHeight.z<0?this.d-=this.halfDirectionHeight.z:this.d+=this.halfDirectionHeight.z,this.halfDirectionDepth.x<0?this.w-=this.halfDirectionDepth.x:this.w+=this.halfDirectionDepth.x,this.halfDirectionDepth.y<0?this.h-=this.halfDirectionDepth.y:this.h+=this.halfDirectionDepth.y,this.halfDirectionDepth.z<0?this.d-=this.halfDirectionDepth.z:this.d+=this.halfDirectionDepth.z,this.aabb.init(this.position.x-this.w-.005,this.position.x+this.w+.005,this.position.y-this.h-.005,this.position.y+this.h+.005,this.position.z-this.d-.005,this.position.z+this.d+.005),null!=this.proxy&&this.proxy.update()},__class__:Zr})
var qr=function(){this.mass=0,this.inertia=new Cr}
s["oimohx.physics.collision.shape.MassInfo"]=qr,qr.__name__=["oimohx","physics","collision","shape","MassInfo"],qr.prototype={mass:null,inertia:null,__class__:qr}
var Qr=function(){this.relativePosition=new Pr,this.relativeRotation=new Cr,this.friction=.4,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=-1}
s["oimohx.physics.collision.shape.ShapeConfig"]=Qr,Qr.__name__=["oimohx","physics","collision","shape","ShapeConfig"],Qr.prototype={relativePosition:null,relativeRotation:null,friction:null,restitution:null,density:null,belongsTo:null,collidesWith:null,__class__:Qr}
var Jr=function(e,t){Kr.call(this,e),this.radius=t,this.type=1,this.updateProxy=r(this,this._updateProxy),this.calculateMassInfo=r(this,this._calculateMassInfo)}
s["oimohx.physics.collision.shape.SphereShape"]=Jr,Jr.__name__=["oimohx","physics","collision","shape","SphereShape"],Jr.__super__=Kr,Jr.prototype=i(Kr.prototype,{radius:null,_updateProxy:function(){this.aabb.init(this.position.x-this.radius-.005,this.position.x+this.radius+.005,this.position.y-this.radius-.005,this.position.y+this.radius+.005,this.position.z-this.radius-.005,this.position.z+this.radius+.005),null!=this.proxy&&this.proxy.update()},_calculateMassInfo:function(e){var t=1.3333333333333333*Math.PI*this.radius*this.radius*this.radius*this.density
e.mass=t
var i=t*this.radius*this.radius*2/5
e.inertia.init(i,0,0,0,i,0,0,0,i)},__class__:Jr})
var $r=function(){}
s["oimohx.physics.constraint.Constraint"]=$r,$r.__name__=["oimohx","physics","constraint","Constraint"],$r.prototype={parent:null,body1:null,body2:null,addedToIsland:null,preSolve:function(){throw new Wi("Inheritance error.")},solve:function(){throw new Wi("Inheritance error.")},postSolve:function(){throw new Wi("Inheritance error.")},__class__:$r}
var es=function(){this.b1Link=new is(this),this.b2Link=new is(this),this.s1Link=new is(this),this.s2Link=new is(this),this.manifold=new ns,this.buffer=[],this.buffer[0]=new ss,this.buffer[1]=new ss,this.buffer[2]=new ss,this.buffer[3]=new ss,this.points=this.manifold.points,this.constraint=new ts(this.manifold)}
s["oimohx.physics.constraint.contact.Contact"]=es,es.__name__=["oimohx","physics","constraint","contact","Contact"],es.prototype={b1Link:null,b2Link:null,s1Link:null,s2Link:null,shape1:null,shape2:null,body1:null,body2:null,prev:null,next:null,persisting:null,sleeping:null,detector:null,manifold:null,constraint:null,touching:null,buffer:null,points:null,mixRestitution:function(e,t){return Math.sqrt(e*t)},mixFriction:function(e,t){return Math.sqrt(e*t)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction)
for(var e=this.manifold.numPoints,t=0;e>t;){var i=t++,n=this.buffer[i],r=this.points[i]
n.lp1X=r.localPoint1.x,n.lp1Y=r.localPoint1.y,n.lp1Z=r.localPoint1.z,n.lp2X=r.localPoint2.x,n.lp2Y=r.localPoint2.y,n.lp2Z=r.localPoint2.z,n.impulse=r.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold)
var s=this.manifold.numPoints
if(0==s)return void(this.touching=!1)
this.touching=!0
for(var o=0;s>o;){for(var a=o++,l=this.points[a],h=l.localPoint1.x,u=l.localPoint1.y,c=l.localPoint1.z,f=l.localPoint2.x,d=l.localPoint2.y,m=l.localPoint2.z,_=-1,p=4e-4,v=0;e>v;){var g=v++,x=this.buffer[g],y=x.lp1X-h,b=x.lp1Y-u,w=x.lp1Z-c,S=y*y+b*b+w*w
y=x.lp2X-f,b=x.lp2Y-d,w=x.lp2Z-m
var M=y*y+b*b+w*w
M>S?p>S&&(p=S,_=g):p>M&&(p=M,_=g)}if(-1!=_){var T=this.buffer[_]
this.buffer[_]=this.buffer[--e],this.buffer[e]=T,l.normalImpulse=T.impulse,l.warmStarted=!0}else l.normalImpulse=0,l.warmStarted=!1}},attach:function(e,t){this.shape1=e,this.shape2=t,this.body1=e.parent,this.body2=t.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=t,this.s1Link.body=this.body2,this.s2Link.shape=e,this.s2Link.body=this.body1,null!=e.contactLink?(this.s1Link.next=e.contactLink).prev=this.s1Link:this.s1Link.next=null,e.contactLink=this.s1Link,e.numContacts++,null!=t.contactLink?(this.s2Link.next=t.contactLink).prev=this.s2Link:this.s2Link.next=null,t.contactLink=this.s2Link,t.numContacts++,this.b1Link.shape=t,this.b1Link.body=this.body2,this.b2Link.shape=e,this.b2Link.body=this.body1,null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var e=this.s1Link.prev,t=this.s1Link.next
null!=e&&(e.next=t),null!=t&&(t.prev=e),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=t),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,e=this.s2Link.prev,t=this.s2Link.next,null!=e&&(e.next=t),null!=t&&(t.prev=e),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=t),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,e=this.b1Link.prev,t=this.b1Link.next,null!=e&&(e.next=t),null!=t&&(t.prev=e),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=t),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,e=this.b2Link.prev,t=this.b2Link.next,null!=e&&(e.next=t),null!=t&&(t.prev=e),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=t),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null},__class__:es}
var ts=function(e){$r.call(this),this.manifold=e,this.ps=e.points,this.cs=new rs,this.cs.next=new rs,this.cs.next.next=new rs,this.cs.next.next.next=new rs}
s["oimohx.physics.constraint.contact.ContactConstraint"]=ts,ts.__name__=["oimohx","physics","constraint","contact","ContactConstraint"],ts.__super__=$r,ts.prototype=i($r.prototype,{manifold:null,restitution:null,friction:null,p1:null,p2:null,lv1:null,lv2:null,av1:null,av2:null,i1:null,i2:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,m1:null,m2:null,ps:null,cs:null,num:null,attach:function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},detach:function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},preSolve:function(e,t){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.p1.x,n=this.p1.y,r=this.p1.z,s=this.p2.x,o=this.p2.y,a=this.p2.z,l=this.m1+this.m2
this.num=this.manifold.numPoints
for(var h=this.cs,u=0,c=this.num;c>u;){var f,d,m,_,p,v,g=u++,x=this.ps[g]
f=x.position.x,d=x.position.y,m=x.position.z
var y=f-i,b=d-n,w=m-r,S=f-s,M=d-o,T=m-a
h.rp1X=y,h.rp1Y=b,h.rp1Z=w,h.rp2X=S,h.rp2Y=M,h.rp2Z=T,h.norImp=x.normalImpulse,h.tanImp=x.tangentImpulse,h.binImp=x.binormalImpulse
var C=x.normal.x,A=x.normal.y,I=x.normal.z,P=this.lv2.x+this.av2.y*T-this.av2.z*M-(this.lv1.x+this.av1.y*w-this.av1.z*b),E=this.lv2.y+this.av2.z*S-this.av2.x*T-(this.lv1.y+this.av1.z*y-this.av1.x*w),D=this.lv2.z+this.av2.x*M-this.av2.y*S-(this.lv1.z+this.av1.x*b-this.av1.y*y),L=C*P+A*E+I*D,F=P-L*C,R=E-L*A,z=D-L*I,B=F*F+R*R+z*z
B>.04?B=1/Math.sqrt(B):(F=A*C-I*I,R=-I*A-C*C,z=C*I+A*A,B=1/Math.sqrt(F*F+R*R+z*z)),F*=B,R*=B,z*=B
var O=A*z-I*R,k=I*F-C*z,V=C*R-A*F
h.norX=C,h.norY=A,h.norZ=I,h.tanX=F,h.tanY=R,h.tanZ=z,h.binX=O,h.binY=k,h.binZ=V,h.norU1X=C*this.m1,h.norU1Y=A*this.m1,h.norU1Z=I*this.m1,h.norU2X=C*this.m2,h.norU2Y=A*this.m2,h.norU2Z=I*this.m2,h.tanU1X=F*this.m1,h.tanU1Y=R*this.m1,h.tanU1Z=z*this.m1,h.tanU2X=F*this.m2,h.tanU2Y=R*this.m2,h.tanU2Z=z*this.m2,h.binU1X=O*this.m1,h.binU1Y=k*this.m1,h.binU1Z=V*this.m1,h.binU2X=O*this.m2,h.binU2Y=k*this.m2,h.binU2Z=V*this.m2
var N=b*I-w*A,U=w*C-y*I,W=y*A-b*C,G=M*I-T*A,Y=T*C-S*I,H=S*A-M*C,X=b*z-w*R,j=w*F-y*z,K=y*R-b*F,Z=M*z-T*R,q=T*F-S*z,Q=S*R-M*F,J=b*V-w*k,$=w*O-y*V,ee=y*k-b*O,te=M*V-T*k,ie=T*O-S*V,ne=S*k-M*O,re=N*this.i1e00+U*this.i1e01+W*this.i1e02,se=N*this.i1e10+U*this.i1e11+W*this.i1e12,oe=N*this.i1e20+U*this.i1e21+W*this.i1e22,ae=G*this.i2e00+Y*this.i2e01+H*this.i2e02,le=G*this.i2e10+Y*this.i2e11+H*this.i2e12,he=G*this.i2e20+Y*this.i2e21+H*this.i2e22,ue=X*this.i1e00+j*this.i1e01+K*this.i1e02,ce=X*this.i1e10+j*this.i1e11+K*this.i1e12,fe=X*this.i1e20+j*this.i1e21+K*this.i1e22,de=Z*this.i2e00+q*this.i2e01+Q*this.i2e02,me=Z*this.i2e10+q*this.i2e11+Q*this.i2e12,_e=Z*this.i2e20+q*this.i2e21+Q*this.i2e22,pe=J*this.i1e00+$*this.i1e01+ee*this.i1e02,ve=J*this.i1e10+$*this.i1e11+ee*this.i1e12,ge=J*this.i1e20+$*this.i1e21+ee*this.i1e22,xe=te*this.i2e00+ie*this.i2e01+ne*this.i2e02,ye=te*this.i2e10+ie*this.i2e11+ne*this.i2e12,be=te*this.i2e20+ie*this.i2e21+ne*this.i2e22
h.norT1X=N,h.norT1Y=U,h.norT1Z=W,h.tanT1X=X,h.tanT1Y=j,h.tanT1Z=K,h.binT1X=J,h.binT1Y=$,h.binT1Z=ee,h.norT2X=G,h.norT2Y=Y,h.norT2Z=H,h.tanT2X=Z,h.tanT2Y=q,h.tanT2Z=Q,h.binT2X=te,h.binT2Y=ie,h.binT2Z=ne,h.norTU1X=re,h.norTU1Y=se,h.norTU1Z=oe,h.tanTU1X=ue,h.tanTU1Y=ce,h.tanTU1Z=fe,h.binTU1X=pe,h.binTU1Y=ve,h.binTU1Z=ge,h.norTU2X=ae,h.norTU2Y=le,h.norTU2Z=he,h.tanTU2X=de,h.tanTU2Y=me,h.tanTU2Z=_e,h.binTU2X=xe,h.binTU2Y=ye,h.binTU2Z=be,f=N*this.i1e00+U*this.i1e01+W*this.i1e02,d=N*this.i1e10+U*this.i1e11+W*this.i1e12,m=N*this.i1e20+U*this.i1e21+W*this.i1e22,_=d*w-m*b,p=m*y-f*w,v=f*b-d*y,f=G*this.i2e00+Y*this.i2e01+H*this.i2e02,d=G*this.i2e10+Y*this.i2e11+H*this.i2e12,m=G*this.i2e20+Y*this.i2e21+H*this.i2e22,_+=d*T-m*M,p+=m*S-f*T,v+=f*M-d*S
var we=1/(l+C*_+A*p+I*v)
f=X*this.i1e00+j*this.i1e01+K*this.i1e02,d=X*this.i1e10+j*this.i1e11+K*this.i1e12,m=X*this.i1e20+j*this.i1e21+K*this.i1e22,_=d*w-m*b,p=m*y-f*w,v=f*b-d*y,f=Z*this.i2e00+q*this.i2e01+Q*this.i2e02,d=Z*this.i2e10+q*this.i2e11+Q*this.i2e12,m=Z*this.i2e20+q*this.i2e21+Q*this.i2e22,_+=d*T-m*M,p+=m*S-f*T,v+=f*M-d*S
var Se=1/(l+F*_+R*p+z*v)
f=J*this.i1e00+$*this.i1e01+ee*this.i1e02,d=J*this.i1e10+$*this.i1e11+ee*this.i1e12,m=J*this.i1e20+$*this.i1e21+ee*this.i1e22,_=d*w-m*b,p=m*y-f*w,v=f*b-d*y,f=te*this.i2e00+ie*this.i2e01+ne*this.i2e02,d=te*this.i2e10+ie*this.i2e11+ne*this.i2e12,m=te*this.i2e20+ie*this.i2e21+ne*this.i2e22,_+=d*T-m*M,p+=m*S-f*T,v+=f*M-d*S
var Me=1/(l+O*_+k*p+V*v)
if(h.norDen=we,h.tanDen=Se,h.binDen=Me,x.warmStarted){var Te=x.normalImpulse
this.lv1.x+=h.norU1X*Te,this.lv1.y+=h.norU1Y*Te,this.lv1.z+=h.norU1Z*Te,this.av1.x+=re*Te,this.av1.y+=se*Te,this.av1.z+=oe*Te,this.lv2.x-=h.norU2X*Te,this.lv2.y-=h.norU2Y*Te,this.lv2.z-=h.norU2Z*Te,this.av2.x-=ae*Te,this.av2.y-=le*Te,this.av2.z-=he*Te,h.norImp=Te,h.tanImp=0,h.binImp=0,L=0}else h.norImp=0,h.tanImp=0,h.binImp=0
L>-1&&(L=0)
var Ce=this.restitution*-L,Ae=-(x.penetration+.005)*t*.05
Ae>Ce&&(Ce=Ae),h.norTar=Ce,h.last=g==this.num-1,h=h.next}},solve:function(){for(var e=this.lv1.x,t=this.lv1.y,i=this.lv1.z,n=this.lv2.x,r=this.lv2.y,s=this.lv2.z,o=this.av1.x,a=this.av1.y,l=this.av1.z,h=this.av2.x,u=this.av2.y,c=this.av2.z,f=this.cs;;){var d,m,_,p,v,g=f.norImp,x=f.tanImp,y=f.binImp,b=-g*this.friction,w=n-e,S=r-t,M=s-i
v=w*f.tanX+S*f.tanY+M*f.tanZ+h*f.tanT2X+u*f.tanT2Y+c*f.tanT2Z-o*f.tanT1X-a*f.tanT1Y-l*f.tanT1Z,d=x,m=v*f.tanDen,x+=m,v=w*f.binX+S*f.binY+M*f.binZ+h*f.binT2X+u*f.binT2Y+c*f.binT2Z-o*f.binT1X-a*f.binT1Y-l*f.binT1Z,_=y,p=v*f.binDen,y+=p
var T=x*x+y*y
if(T>b*b&&(T=b/Math.sqrt(T),x*=T,y*=T),m=x-d,p=y-_,e+=f.tanU1X*m+f.binU1X*p,t+=f.tanU1Y*m+f.binU1Y*p,i+=f.tanU1Z*m+f.binU1Z*p,o+=f.tanTU1X*m+f.binTU1X*p,a+=f.tanTU1Y*m+f.binTU1Y*p,l+=f.tanTU1Z*m+f.binTU1Z*p,n-=f.tanU2X*m+f.binU2X*p,r-=f.tanU2Y*m+f.binU2Y*p,s-=f.tanU2Z*m+f.binU2Z*p,h-=f.tanTU2X*m+f.binTU2X*p,u-=f.tanTU2Y*m+f.binTU2Y*p,c-=f.tanTU2Z*m+f.binTU2Z*p,v=(n-e)*f.norX+(r-t)*f.norY+(s-i)*f.norZ+h*f.norT2X+u*f.norT2Y+c*f.norT2Z-o*f.norT1X-a*f.norT1Y-l*f.norT1Z,d=g,m=(v-f.norTar)*f.norDen,g+=m,g>0&&(g=0),m=g-d,e+=f.norU1X*m,t+=f.norU1Y*m,i+=f.norU1Z*m,o+=f.norTU1X*m,a+=f.norTU1Y*m,l+=f.norTU1Z*m,n-=f.norU2X*m,r-=f.norU2Y*m,s-=f.norU2Z*m,h-=f.norTU2X*m,u-=f.norTU2Y*m,c-=f.norTU2Z*m,f.norImp=g,f.tanImp=x,f.binImp=y,f.last)break
f=f.next}this.lv1.x=e,this.lv1.y=t,this.lv1.z=i,this.lv2.x=n,this.lv2.y=r,this.lv2.z=s,this.av1.x=o,this.av1.y=a,this.av1.z=l,this.av2.x=h,this.av2.y=u,this.av2.z=c},postSolve:function(){for(var e=this.cs,t=0,i=this.num;i>t;){var n=t++,r=this.ps[n]
r.normal.x=e.norX,r.normal.y=e.norY,r.normal.z=e.norZ,r.tangent.x=e.tanX,r.tangent.y=e.tanY,r.tangent.z=e.tanZ,r.binormal.x=e.binX,r.binormal.y=e.binY,r.binormal.z=e.binZ,r.normalImpulse=e.norImp,r.tangentImpulse=e.tanImp,r.binormalImpulse=e.binImp,r.normalDenominator=e.norDen,r.tangentDenominator=e.tanDen,r.binormalDenominator=e.binDen,e=e.next}},__class__:ts})
var is=function(e){this.contact=e}
s["oimohx.physics.constraint.contact.ContactLink"]=is,is.__name__=["oimohx","physics","constraint","contact","ContactLink"],is.prototype={prev:null,next:null,shape:null,body:null,contact:null,__class__:is}
var ns=function(){this.points=[],this.points[0]=new os,this.points[1]=new os,this.points[2]=new os,this.points[3]=new os}
s["oimohx.physics.constraint.contact.ContactManifold"]=ns,ns.__name__=["oimohx","physics","constraint","contact","ContactManifold"],ns.prototype={body1:null,body2:null,points:null,numPoints:null,reset:function(e,t){this.body1=e.parent,this.body2=t.parent,this.numPoints=0},addPoint:function(e,t,i,n,r,s,o,a){var l=this.points[this.numPoints++]
l.position.x=e,l.position.y=t,l.position.z=i
var h=this.body1.rotation,u=e-this.body1.position.x,c=t-this.body1.position.y,f=i-this.body1.position.z
l.localPoint1.x=u*h.elements[0]+c*h.elements[1]+f*h.elements[2],l.localPoint1.y=u*h.elements[3]+c*h.elements[4]+f*h.elements[5],l.localPoint1.z=u*h.elements[6]+c*h.elements[7]+f*h.elements[8],h=this.body2.rotation,u=e-this.body2.position.x,c=t-this.body2.position.y,f=i-this.body2.position.z,l.localPoint2.x=u*h.elements[0]+c*h.elements[1]+f*h.elements[2],l.localPoint2.y=u*h.elements[3]+c*h.elements[4]+f*h.elements[5],l.localPoint2.z=u*h.elements[6]+c*h.elements[7]+f*h.elements[8],l.normalImpulse=0,a?(l.normal.x=-n,l.normal.y=-r,l.normal.z=-s):(l.normal.x=n,l.normal.y=r,l.normal.z=s),l.penetration=o,l.warmStarted=!1},__class__:ns}
var rs=function(){}
s["oimohx.physics.constraint.contact.ContactPointDataBuffer"]=rs,rs.__name__=["oimohx","physics","constraint","contact","ContactPointDataBuffer"],rs.prototype={norX:null,norY:null,norZ:null,tanX:null,tanY:null,tanZ:null,binX:null,binY:null,binZ:null,rp1X:null,rp1Y:null,rp1Z:null,rp2X:null,rp2Y:null,rp2Z:null,norU1X:null,norU1Y:null,norU1Z:null,norU2X:null,norU2Y:null,norU2Z:null,tanU1X:null,tanU1Y:null,tanU1Z:null,tanU2X:null,tanU2Y:null,tanU2Z:null,binU1X:null,binU1Y:null,binU1Z:null,binU2X:null,binU2Y:null,binU2Z:null,norT1X:null,norT1Y:null,norT1Z:null,norT2X:null,norT2Y:null,norT2Z:null,tanT1X:null,tanT1Y:null,tanT1Z:null,tanT2X:null,tanT2Y:null,tanT2Z:null,binT1X:null,binT1Y:null,binT1Z:null,binT2X:null,binT2Y:null,binT2Z:null,norTU1X:null,norTU1Y:null,norTU1Z:null,norTU2X:null,norTU2Y:null,norTU2Z:null,tanTU1X:null,tanTU1Y:null,tanTU1Z:null,tanTU2X:null,tanTU2Y:null,tanTU2Z:null,binTU1X:null,binTU1Y:null,binTU1Z:null,binTU2X:null,binTU2Y:null,binTU2Z:null,norImp:null,tanImp:null,binImp:null,norDen:null,tanDen:null,binDen:null,norTar:null,next:null,last:null,__class__:rs}
var ss=function(){}
s["oimohx.physics.constraint.contact.ImpulseDataBuffer"]=ss,ss.__name__=["oimohx","physics","constraint","contact","ImpulseDataBuffer"],ss.prototype={lp1X:null,lp1Y:null,lp1Z:null,lp2X:null,lp2Y:null,lp2Z:null,impulse:null,__class__:ss}
var os=function(){this.position=new Pr,this.localPoint1=new Pr,this.localPoint2=new Pr,this.normal=new Pr,this.tangent=new Pr,this.binormal=new Pr,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}
s["oimohx.physics.constraint.contact.ManifoldPoint"]=os,os.__name__=["oimohx","physics","constraint","contact","ManifoldPoint"],os.prototype={position:null,localPoint1:null,localPoint2:null,normal:null,tangent:null,binormal:null,normalImpulse:null,tangentImpulse:null,binormalImpulse:null,normalDenominator:null,tangentDenominator:null,binormalDenominator:null,warmStarted:null,penetration:null,__class__:os}
var as=function(e){$r.call(this),this.body1=e.body1,this.body2=e.body2,this.localAnchorPoint1=(new Pr).copy(e.localAnchorPoint1),this.localAnchorPoint2=(new Pr).copy(e.localAnchorPoint2),this.relativeAnchorPoint1=new Pr,this.relativeAnchorPoint2=new Pr,this.anchorPoint1=new Pr,this.anchorPoint2=new Pr,this.allowCollision=e.allowCollision,this.b1Link=new fs(this),this.b2Link=new fs(this)}
s["oimohx.physics.constraint.joint.Joint"]=as,as.__name__=["oimohx","physics","constraint","joint","Joint"],as.__super__=$r,as.prototype=i($r.prototype,{b1Link:null,b2Link:null,type:null,allowCollision:null,localAnchorPoint1:null,localAnchorPoint2:null,relativeAnchorPoint1:null,relativeAnchorPoint2:null,anchorPoint1:null,anchorPoint2:null,prev:null,next:null,updateAnchorPoints:function(){var e=this.body1.position,t=this.body2.position,i=this.body1.rotation,n=this.body2.rotation,r=this.localAnchorPoint1.x,s=this.localAnchorPoint1.y,o=this.localAnchorPoint1.z,a=this.localAnchorPoint2.x,l=this.localAnchorPoint2.y,h=this.localAnchorPoint2.z,u=r*i.elements[0]+s*i.elements[1]+o*i.elements[2],c=r*i.elements[3]+s*i.elements[4]+o*i.elements[5],f=r*i.elements[6]+s*i.elements[7]+o*i.elements[8],d=a*n.elements[0]+l*n.elements[1]+h*n.elements[2],m=a*n.elements[3]+l*n.elements[4]+h*n.elements[5],_=a*n.elements[6]+l*n.elements[7]+h*n.elements[8]
this.relativeAnchorPoint1.x=u,this.relativeAnchorPoint1.y=c,this.relativeAnchorPoint1.z=f,this.relativeAnchorPoint2.x=d,this.relativeAnchorPoint2.y=m,this.relativeAnchorPoint2.z=_
var p=u+e.x,v=c+e.y,g=f+e.z,x=d+t.x,y=m+t.y,b=_+t.z
this.anchorPoint1.x=p,this.anchorPoint1.y=v,this.anchorPoint1.z=g,this.anchorPoint2.x=x,this.anchorPoint2.y=y,this.anchorPoint2.z=b},attach:function(){this.b1Link.body=this.body2,this.b2Link.body=this.body1,null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++},detach:function(){var e=this.b1Link.prev,t=this.b1Link.next
null!=e&&(e.next=t),null!=t&&(t.prev=e),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=t),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,e=this.b2Link.prev,t=this.b2Link.next,null!=e&&(e.next=t),null!=t&&(t.prev=e),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=t),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--,this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(e,t){$r.prototype.preSolve.call(this,e,t)},solve:function(){$r.prototype.solve.call(this)},postSolve:function(){$r.prototype.postSolve.call(this)},__class__:as})
var ls=function(e){as.call(this,e),this.type=2,this.lc=new gs(this)}
s["oimohx.physics.constraint.joint.BallAndSocketJoint"]=ls,ls.__name__=["oimohx","physics","constraint","joint","BallAndSocketJoint"],ls.__super__=as,ls.prototype=i(as.prototype,{lc:null,preSolve:function(e,t){this.updateAnchorPoints(),this.lc.preSolve(e,t)},solve:function(){this.lc.solve()},postSolve:function(){},__class__:ls})
var hs=function(e,t,i){as.call(this,e),this.type=1,this.normal=new Pr,this.limitMotor=new ds(this.normal,!0),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.t=new ws(this,this.limitMotor)}
s["oimohx.physics.constraint.joint.DistanceJoint"]=hs,hs.__name__=["oimohx","physics","constraint","joint","DistanceJoint"],hs.__super__=as,hs.prototype=i(as.prototype,{limitMotor:null,t:null,normal:null,preSolve:function(e,t){this.updateAnchorPoints()
var i=this.anchorPoint2.x-this.anchorPoint1.x,n=this.anchorPoint2.y-this.anchorPoint1.y,r=this.anchorPoint2.z-this.anchorPoint1.z,s=Math.sqrt(i*i+n*n+r*r)
s>0&&(s=1/s),this.normal.init(i*s,n*s,r*s),this.t.preSolve(e,t)},solve:function(){this.t.solve()},postSolve:function(){},__class__:hs})
var us=function(e,t,i){null==i&&(i=0),null==t&&(t=1),as.call(this,e),this.localAxis1=(new Pr).normalize(e.localAxis1),this.localAxis2=(new Pr).normalize(e.localAxis2)
var n
this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,n=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=n,this.localAngAxis1Y*=n,this.localAngAxis1Z*=n,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z
var r=(new Cr).setQuat((new Ir).arc(this.localAxis1,this.localAxis2))
this.localAngAxis2X=this.localAngAxis1X*r.elements[0]+this.localAngAxis1Y*r.elements[1]+this.localAngAxis1Z*r.elements[2],this.localAngAxis2Y=this.localAngAxis1X*r.elements[3]+this.localAngAxis1Y*r.elements[4]+this.localAngAxis1Z*r.elements[5],this.localAngAxis2Z=this.localAngAxis1X*r.elements[6]+this.localAngAxis1Y*r.elements[7]+this.localAngAxis1Z*r.elements[7],this.type=3,this.nor=new Pr,this.tan=new Pr,this.bin=new Pr,this.limitMotor=new ds(this.nor,!1),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.lc=new gs(this),this.r3=new xs(this,this.limitMotor,new ds(this.tan,!0),new ds(this.bin,!0))}
s["oimohx.physics.constraint.joint.HingeJoint"]=us,us.__name__=["oimohx","physics","constraint","joint","HingeJoint"],us.__super__=as,us.prototype=i(as.prototype,{localAxis1:null,localAxis2:null,limitMotor:null,localAxis1X:null,localAxis1Y:null,localAxis1Z:null,localAxis2X:null,localAxis2Y:null,localAxis2Z:null,localAngAxis1X:null,localAngAxis1Y:null,localAngAxis1Z:null,localAngAxis2X:null,localAngAxis2Y:null,localAngAxis2Z:null,lc:null,r3:null,nor:null,tan:null,bin:null,preSolve:function(e,t){var i,n,r,s
this.updateAnchorPoints(),i=this.body1.rotation
var o=this.localAxis1X*i.elements[0]+this.localAxis1Y*i.elements[1]+this.localAxis1Z*i.elements[2],a=this.localAxis1X*i.elements[3]+this.localAxis1Y*i.elements[4]+this.localAxis1Z*i.elements[5],l=this.localAxis1X*i.elements[6]+this.localAxis1Y*i.elements[7]+this.localAxis1Z*i.elements[8],h=this.localAngAxis1X*i.elements[0]+this.localAngAxis1Y*i.elements[1]+this.localAngAxis1Z*i.elements[2],u=this.localAngAxis1X*i.elements[3]+this.localAngAxis1Y*i.elements[4]+this.localAngAxis1Z*i.elements[5],c=this.localAngAxis1X*i.elements[6]+this.localAngAxis1Y*i.elements[7]+this.localAngAxis1Z*i.elements[8]
i=this.body2.rotation
var f=this.localAxis2X*i.elements[0]+this.localAxis2Y*i.elements[1]+this.localAxis2Z*i.elements[2],d=this.localAxis2X*i.elements[3]+this.localAxis2Y*i.elements[4]+this.localAxis2Z*i.elements[5],m=this.localAxis2X*i.elements[6]+this.localAxis2Y*i.elements[7]+this.localAxis2Z*i.elements[8],_=this.localAngAxis2X*i.elements[0]+this.localAngAxis2Y*i.elements[1]+this.localAngAxis2Z*i.elements[2],p=this.localAngAxis2X*i.elements[3]+this.localAngAxis2Y*i.elements[4]+this.localAngAxis2Z*i.elements[5],v=this.localAngAxis2X*i.elements[6]+this.localAngAxis2Y*i.elements[7]+this.localAngAxis2Z*i.elements[8],g=o*this.body2.inverseMass+f*this.body1.inverseMass,x=a*this.body2.inverseMass+d*this.body1.inverseMass,y=l*this.body2.inverseMass+m*this.body1.inverseMass
n=Math.sqrt(g*g+x*x+y*y),n>0&&(n=1/n),g*=n,x*=n,y*=n
var b=x*g-y*y,w=-y*x-g*g,S=g*y+x*x
n=1/Math.sqrt(b*b+w*w+S*S),b*=n,w*=n,S*=n
var M=x*S-y*w,T=y*b-g*S,C=g*w-x*b
this.nor.init(g,x,y),this.tan.init(b,w,S),this.bin.init(M,T,C),0>g*(u*v-c*p)+x*(c*_-h*v)+y*(h*p-u*_)?this.limitMotor.angle=-this.acosClamp(h*_+u*p+c*v):this.limitMotor.angle=this.acosClamp(h*_+u*p+c*v),n=a*m-l*d,r=l*f-o*m,s=o*d-a*f,this.r3.limitMotor2.angle=b*n+w*r+S*s,this.r3.limitMotor3.angle=M*n+T*r+C*s,this.r3.preSolve(e,t),this.lc.preSolve(e,t)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){},acosClamp:function(e){return e>1?0:-1>e?Math.PI:Math.acos(e)},__class__:us})
var cs=function(){this.localAnchorPoint1=new Pr,this.localAnchorPoint2=new Pr,this.localAxis1=new Pr,this.localAxis2=new Pr,this.allowCollision=!1}
s["oimohx.physics.constraint.joint.JointConfig"]=cs,cs.__name__=["oimohx","physics","constraint","joint","JointConfig"],cs.prototype={body1:null,body2:null,localAnchorPoint1:null,localAnchorPoint2:null,localAxis1:null,localAxis2:null,allowCollision:null,__class__:cs}
var fs=function(e){this.joint=e}
s["oimohx.physics.constraint.joint.JointLink"]=fs,fs.__name__=["oimohx","physics","constraint","joint","JointLink"],fs.prototype={prev:null,next:null,body:null,joint:null,__class__:fs}
var ds=function(e,t){this.axis=e,this.angle=0,t?this.lowerLimit=0:this.lowerLimit=1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}
s["oimohx.physics.constraint.joint.LimitMotor"]=ds,ds.__name__=["oimohx","physics","constraint","joint","LimitMotor"],ds.prototype={angle:null,axis:null,lowerLimit:null,upperLimit:null,motorSpeed:null,maxMotorForce:null,frequency:null,dampingRatio:null,setLimit:function(e,t){this.lowerLimit=e,this.upperLimit=t},setMotor:function(e,t){this.motorSpeed=e,this.maxMotorForce=t},setSpring:function(e,t){this.frequency=e,this.dampingRatio=t},__class__:ds}
var ms=function(e,t,i){as.call(this,e),this.localAxis1=(new Pr).normalize(e.localAxis1),this.localAxis2=(new Pr).normalize(e.localAxis2),this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z,this.type=6,this.nor=new Pr,this.tan=new Pr,this.bin=new Pr,this.ac=new vs(this,(new Ir).arc(this.localAxis1,this.localAxis2)),this.limitMotor=new ds(this.nor,!0),this.limitMotor.lowerLimit=t,this.limitMotor.upperLimit=i,this.t3=new bs(this,this.limitMotor,new ds(this.tan,!0),new ds(this.bin,!0))}
s["oimohx.physics.constraint.joint.PrismaticJoint"]=ms,ms.__name__=["oimohx","physics","constraint","joint","PrismaticJoint"],ms.__super__=as,ms.prototype=i(as.prototype,{localAxis1:null,localAxis2:null,limitMotor:null,localAxis1X:null,localAxis1Y:null,localAxis1Z:null,localAxis2X:null,localAxis2Y:null,localAxis2Z:null,t3:null,ac:null,nor:null,tan:null,bin:null,preSolve:function(e,t){var i,n
this.updateAnchorPoints(),i=this.body1.rotation
var r=this.localAxis1X*i.elements[0]+this.localAxis1Y*i.elements[1]+this.localAxis1Z*i.elements[2],s=this.localAxis1X*i.elements[3]+this.localAxis1Y*i.elements[4]+this.localAxis1Z*i.elements[5],o=this.localAxis1X*i.elements[6]+this.localAxis1Y*i.elements[7]+this.localAxis1Z*i.elements[8]
i=this.body2.rotation
var a=this.localAxis2X*i.elements[0]+this.localAxis2Y*i.elements[1]+this.localAxis2Z*i.elements[2],l=this.localAxis2X*i.elements[3]+this.localAxis2Y*i.elements[4]+this.localAxis2Z*i.elements[5],h=this.localAxis2X*i.elements[6]+this.localAxis2Y*i.elements[7]+this.localAxis2Z*i.elements[8],u=r*this.body2.inverseMass+a*this.body1.inverseMass,c=s*this.body2.inverseMass+l*this.body1.inverseMass,f=o*this.body2.inverseMass+h*this.body1.inverseMass
n=Math.sqrt(u*u+c*c+f*f),n>0&&(n=1/n),u*=n,c*=n,f*=n
var d=c*u-f*f,m=-f*c-u*u,_=u*f+c*c
n=1/Math.sqrt(d*d+m*m+_*_),d*=n,m*=n,_*=n
var p=c*_-f*m,v=f*d-u*_,g=u*m-c*d
this.nor.init(u,c,f),this.tan.init(d,m,_),this.bin.init(p,v,g),this.ac.preSolve(e,t),this.t3.preSolve(e,t)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){},__class__:ms})
var _s=function(e,t,i){as.call(this,e),this.localAxis1=(new Pr).normalize(e.localAxis1),this.localAxis2=(new Pr).normalize(e.localAxis2)
var n
this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,n=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=n,this.localAngAxis1Y*=n,this.localAngAxis1Z*=n,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z
var r=(new Cr).setQuat((new Ir).arc(this.localAxis1,this.localAxis2))
this.localAngAxis2X=this.localAngAxis1X*r.elements[0]+this.localAngAxis1Y*r.elements[1]+this.localAngAxis1Z*r.elements[2],this.localAngAxis2Y=this.localAngAxis1X*r.elements[3]+this.localAngAxis1Y*r.elements[4]+this.localAngAxis1Z*r.elements[5],this.localAngAxis2Z=this.localAngAxis1X*r.elements[6]+this.localAngAxis1Y*r.elements[7]+this.localAngAxis1Z*r.elements[8],this.type=5,this.nor=new Pr,this.tan=new Pr,this.bin=new Pr,this.rotationalLimitMotor=new ds(this.nor,!1),this.r3=new xs(this,this.rotationalLimitMotor,new ds(this.tan,!0),new ds(this.bin,!0)),this.translationalLimitMotor=new ds(this.nor,!0),this.translationalLimitMotor.lowerLimit=t,this.translationalLimitMotor.upperLimit=i,this.t3=new bs(this,this.translationalLimitMotor,new ds(this.tan,!0),new ds(this.bin,!0))}
s["oimohx.physics.constraint.joint.SliderJoint"]=_s,_s.__name__=["oimohx","physics","constraint","joint","SliderJoint"],_s.__super__=as,_s.prototype=i(as.prototype,{localAxis1:null,localAxis2:null,rotationalLimitMotor:null,translationalLimitMotor:null,localAxis1X:null,localAxis1Y:null,localAxis1Z:null,localAxis2X:null,localAxis2Y:null,localAxis2Z:null,localAngAxis1X:null,localAngAxis1Y:null,localAngAxis1Z:null,localAngAxis2X:null,localAngAxis2Y:null,localAngAxis2Z:null,t3:null,r3:null,nor:null,tan:null,bin:null,preSolve:function(e,t){var i,n,r,s
this.updateAnchorPoints(),i=this.body1.rotation
var o=this.localAxis1X*i.elements[0]+this.localAxis1Y*i.elements[1]+this.localAxis1Z*i.elements[2],a=this.localAxis1X*i.elements[3]+this.localAxis1Y*i.elements[4]+this.localAxis1Z*i.elements[5],l=this.localAxis1X*i.elements[6]+this.localAxis1Y*i.elements[7]+this.localAxis1Z*i.elements[8],h=this.localAngAxis1X*i.elements[0]+this.localAngAxis1Y*i.elements[1]+this.localAngAxis1Z*i.elements[2],u=this.localAngAxis1X*i.elements[3]+this.localAngAxis1Y*i.elements[4]+this.localAngAxis1Z*i.elements[5],c=this.localAngAxis1X*i.elements[6]+this.localAngAxis1Y*i.elements[7]+this.localAngAxis1Z*i.elements[8]
i=this.body2.rotation
var f=this.localAxis2X*i.elements[0]+this.localAxis2Y*i.elements[1]+this.localAxis2Z*i.elements[2],d=this.localAxis2X*i.elements[3]+this.localAxis2Y*i.elements[4]+this.localAxis2Z*i.elements[5],m=this.localAxis2X*i.elements[6]+this.localAxis2Y*i.elements[7]+this.localAxis2Z*i.elements[8],_=this.localAngAxis2X*i.elements[0]+this.localAngAxis2Y*i.elements[1]+this.localAngAxis2Z*i.elements[2],p=this.localAngAxis2X*i.elements[3]+this.localAngAxis2Y*i.elements[4]+this.localAngAxis2Z*i.elements[5],v=this.localAngAxis2X*i.elements[6]+this.localAngAxis2Y*i.elements[7]+this.localAngAxis2Z*i.elements[8],g=o*this.body2.inverseMass+f*this.body1.inverseMass,x=a*this.body2.inverseMass+d*this.body1.inverseMass,y=l*this.body2.inverseMass+m*this.body1.inverseMass
n=Math.sqrt(g*g+x*x+y*y),n>0&&(n=1/n),g*=n,x*=n,y*=n
var b=x*g-y*y,w=-y*x-g*g,S=g*y+x*x
n=1/Math.sqrt(b*b+w*w+S*S),b*=n,w*=n,S*=n
var M=x*S-y*w,T=y*b-g*S,C=g*w-x*b
this.nor.init(g,x,y),this.tan.init(b,w,S),this.bin.init(M,T,C),0>g*(u*v-c*p)+x*(c*_-h*v)+y*(h*p-u*_)?this.rotationalLimitMotor.angle=-this.acosClamp(h*_+u*p+c*v):this.rotationalLimitMotor.angle=this.acosClamp(h*_+u*p+c*v),n=a*m-l*d,r=l*f-o*m,s=o*d-a*f,this.r3.limitMotor2.angle=b*n+w*r+S*s,this.r3.limitMotor3.angle=M*n+T*r+C*s,this.r3.preSolve(e,t),this.t3.preSolve(e,t)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){},acosClamp:function(e){return e>1?0:-1>e?Math.PI:Math.acos(e)},__class__:_s})
var ps=function(e){as.call(this,e),this.localAxis1=(new Pr).normalize(e.localAxis1),this.localAxis2=(new Pr).normalize(e.localAxis2)
var t
this.localAxis1X=this.localAxis1.x,this.localAxis1Y=this.localAxis1.y,this.localAxis1Z=this.localAxis1.z,this.localAxis2X=this.localAxis2.x,this.localAxis2Y=this.localAxis2.y,this.localAxis2Z=this.localAxis2.z
var i=this.localAxis1X*this.localAxis2X+this.localAxis1Y*this.localAxis2Y+this.localAxis1Z*this.localAxis2Z
if(i>-1&&1>i)this.localAngAxis1X=this.localAxis2X-i*this.localAxis1X,this.localAngAxis1Y=this.localAxis2Y-i*this.localAxis1Y,this.localAngAxis1Z=this.localAxis2Z-i*this.localAxis1Z,this.localAngAxis2X=this.localAxis1X-i*this.localAxis2X,this.localAngAxis2Y=this.localAxis1Y-i*this.localAxis2Y,this.localAngAxis2Z=this.localAxis1Z-i*this.localAxis2Z,t=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=t,this.localAngAxis1Y*=t,this.localAngAxis1Z*=t,t=1/Math.sqrt(this.localAngAxis2X*this.localAngAxis2X+this.localAngAxis2Y*this.localAngAxis2Y+this.localAngAxis2Z*this.localAngAxis2Z),this.localAngAxis2X*=t,this.localAngAxis2Y*=t,this.localAngAxis2Z*=t
else{this.localAngAxis1X=this.localAxis1Y*this.localAxis1X-this.localAxis1Z*this.localAxis1Z,this.localAngAxis1Y=-this.localAxis1Z*this.localAxis1Y-this.localAxis1X*this.localAxis1X,this.localAngAxis1Z=this.localAxis1X*this.localAxis1Z+this.localAxis1Y*this.localAxis1Y,t=1/Math.sqrt(this.localAngAxis1X*this.localAngAxis1X+this.localAngAxis1Y*this.localAngAxis1Y+this.localAngAxis1Z*this.localAngAxis1Z),this.localAngAxis1X*=t,this.localAngAxis1Y*=t,this.localAngAxis1Z*=t
var n=(new Cr).setQuat((new Ir).arc(this.localAxis1,this.localAxis2))
this.localAngAxis2X=this.localAngAxis1X*n.elements[0]+this.localAngAxis1Y*n.elements[1]+this.localAngAxis1Z*n.elements[2],this.localAngAxis2Y=this.localAngAxis1X*n.elements[3]+this.localAngAxis1Y*n.elements[4]+this.localAngAxis1Z*n.elements[5],this.localAngAxis2Z=this.localAngAxis1X*n.elements[6]+this.localAngAxis1Y*n.elements[7]+this.localAngAxis1Z*n.elements[8]}this.type=4,this.nor=new Pr,this.tan=new Pr,this.bin=new Pr,this.translationalLimitMotor=new ds(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new ds(this.tan,!1),this.rotationalLimitMotor2=new ds(this.bin,!1),this.t3=new bs(this,new ds(this.nor,!0),this.translationalLimitMotor,new ds(this.bin,!0)),this.t3.weight=1,this.r3=new xs(this,new ds(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}
s["oimohx.physics.constraint.joint.WheelJoint"]=ps,ps.__name__=["oimohx","physics","constraint","joint","WheelJoint"],ps.__super__=as,ps.prototype=i(as.prototype,{localAxis1:null,localAxis2:null,rotationalLimitMotor1:null,rotationalLimitMotor2:null,translationalLimitMotor:null,nor:null,tan:null,bin:null,localAxis1X:null,localAxis1Y:null,localAxis1Z:null,localAxis2X:null,localAxis2Y:null,localAxis2Z:null,localAngAxis1X:null,localAngAxis1Y:null,localAngAxis1Z:null,localAngAxis2X:null,localAngAxis2Y:null,localAngAxis2Z:null,r3:null,t3:null,preSolve:function(e,t){var i,n
this.updateAnchorPoints(),i=this.body1.rotation
var r=this.localAxis1X*i.elements[0]+this.localAxis1Y*i.elements[1]+this.localAxis1Z*i.elements[2],s=this.localAxis1X*i.elements[3]+this.localAxis1Y*i.elements[4]+this.localAxis1Z*i.elements[5],o=this.localAxis1X*i.elements[6]+this.localAxis1Y*i.elements[7]+this.localAxis1Z*i.elements[8],a=this.localAngAxis1X*i.elements[0]+this.localAngAxis1Y*i.elements[1]+this.localAngAxis1Z*i.elements[2],l=this.localAngAxis1X*i.elements[3]+this.localAngAxis1Y*i.elements[4]+this.localAngAxis1Z*i.elements[5],h=this.localAngAxis1X*i.elements[6]+this.localAngAxis1Y*i.elements[7]+this.localAngAxis1Z*i.elements[8]
i=this.body2.rotation
var u=this.localAxis2X*i.elements[0]+this.localAxis2Y*i.elements[1]+this.localAxis2Z*i.elements[2],c=this.localAxis2X*i.elements[3]+this.localAxis2Y*i.elements[4]+this.localAxis2Z*i.elements[5],f=this.localAxis2X*i.elements[6]+this.localAxis2Y*i.elements[7]+this.localAxis2Z*i.elements[8],d=this.localAngAxis2X*i.elements[0]+this.localAngAxis2Y*i.elements[1]+this.localAngAxis2Z*i.elements[2],m=this.localAngAxis2X*i.elements[3]+this.localAngAxis2Y*i.elements[4]+this.localAngAxis2Z*i.elements[5],_=this.localAngAxis2X*i.elements[6]+this.localAngAxis2Y*i.elements[7]+this.localAngAxis2Z*i.elements[8]
this.r3.limitMotor1.angle=r*u+s*c+o*f,0>r*(l*f-h*c)+s*(h*u-a*f)+o*(a*c-l*u)?this.rotationalLimitMotor1.angle=-this.acosClamp(a*u+l*c+h*f):this.rotationalLimitMotor1.angle=this.acosClamp(a*u+l*c+h*f),0>u*(m*o-_*s)+c*(_*r-d*o)+f*(d*s-m*r)?this.rotationalLimitMotor2.angle=this.acosClamp(d*r+m*s+_*o):this.rotationalLimitMotor2.angle=-this.acosClamp(d*r+m*s+_*o)
var p=c*o-f*s,v=f*r-u*o,g=u*s-c*r
n=Math.sqrt(p*p+v*v+g*g),n>0&&(n=1/n),p*=n,v*=n,g*=n
var x=v*f-g*c,y=g*u-p*f,b=p*c-v*u
n=Math.sqrt(x*x+y*y+b*b),n>0&&(n=1/n),x*=n,y*=n,b*=n
var w=s*g-o*v,S=o*p-r*g,M=r*v-s*p
n=Math.sqrt(w*w+S*S+M*M),n>0&&(n=1/n),w*=n,S*=n,M*=n,this.nor.init(p,v,g),this.tan.init(x,y,b),this.bin.init(w,S,M),this.r3.preSolve(e,t),this.t3.preSolve(e,t)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){},acosClamp:function(e){return e>1?0:-1>e?Math.PI:Math.acos(e)},__class__:ps})
var vs=function(e,t){this.joint=e,this.targetOrientation=(new Ir).invert(t),this.relativeOrientation=new Ir,this.b1=e.body1,this.b2=e.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}
s["oimohx.physics.constraint.joint.base.AngularConstraint"]=vs,vs.__name__=["oimohx","physics","constraint","joint","base","AngularConstraint"],vs.prototype={joint:null,b1:null,b2:null,a1:null,a2:null,i1:null,i2:null,targetOrientation:null,relativeOrientation:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,d00:null,d01:null,d02:null,d10:null,d11:null,d12:null,d20:null,d21:null,d22:null,ax:null,ay:null,az:null,impx:null,impy:null,impz:null,velx:null,vely:null,velz:null,preSolve:function(e,t){this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.i1e00+this.i2e00,n=this.i1e01+this.i2e01,r=this.i1e02+this.i2e02,s=this.i1e10+this.i2e10,o=this.i1e11+this.i2e11,a=this.i1e12+this.i2e12,l=this.i1e20+this.i2e20,h=this.i1e21+this.i2e21,u=this.i1e22+this.i2e22,c=1/(i*(o*u-h*a)+s*(h*r-n*u)+l*(n*a-o*r))
this.d00=(o*u-a*h)*c,this.d01=(r*h-n*u)*c,this.d02=(n*a-r*o)*c,this.d10=(a*l-s*u)*c,this.d11=(i*u-r*l)*c,this.d12=(r*s-i*a)*c,this.d20=(s*h-o*l)*c,this.d21=(n*l-i*h)*c,this.d22=(i*o-n*s)*c,this.relativeOrientation.invert(this.b1.orientation),this.relativeOrientation.mul(this.targetOrientation,this.relativeOrientation),this.relativeOrientation.mul(this.b2.orientation,this.relativeOrientation),c=2*this.relativeOrientation.s,this.velx=this.relativeOrientation.x*c,this.vely=this.relativeOrientation.y*c,this.velz=this.relativeOrientation.z*c
var f=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz)
f>.02?(f=(.02-f)/f*t*.05,this.velx*=f,this.vely*=f,this.velz*=f):(this.velx=0,this.vely=0,this.velz=0),this.a1.x+=this.impx*this.i1e00+this.impy*this.i1e01+this.impz*this.i1e02,this.a1.y+=this.impx*this.i1e10+this.impy*this.i1e11+this.impz*this.i1e12,this.a1.z+=this.impx*this.i1e20+this.impy*this.i1e21+this.impz*this.i1e22,this.a2.x-=this.impx*this.i2e00+this.impy*this.i2e01+this.impz*this.i2e02,this.a2.y-=this.impx*this.i2e10+this.impy*this.i2e11+this.impz*this.i2e12,this.a2.z-=this.impx*this.i2e20+this.impy*this.i2e21+this.impz*this.i2e22},solve:function(){var e=this.a2.x-this.a1.x-this.velx,t=this.a2.y-this.a1.y-this.vely,i=this.a2.z-this.a1.z-this.velz,n=e*this.d00+t*this.d01+i*this.d02,r=e*this.d10+t*this.d11+i*this.d12,s=e*this.d20+t*this.d21+i*this.d22
this.impx+=n,this.impy+=r,this.impz+=s,this.a1.x+=n*this.i1e00+r*this.i1e01+s*this.i1e02,this.a1.y+=n*this.i1e10+r*this.i1e11+s*this.i1e12,this.a1.z+=n*this.i1e20+r*this.i1e21+s*this.i1e22,this.a2.x-=n*this.i2e00+r*this.i2e01+s*this.i2e02,this.a2.y-=n*this.i2e10+r*this.i2e11+s*this.i2e12,this.a2.z-=n*this.i2e20+r*this.i2e21+s*this.i2e22},__class__:vs}
var gs=function(e){this.joint=e,this.r1=e.relativeAnchorPoint1,this.r2=e.relativeAnchorPoint2,this.p1=e.anchorPoint1,this.p2=e.anchorPoint2,this.b1=e.body1,this.b2=e.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}
s["oimohx.physics.constraint.joint.base.LinearConstraint"]=gs,gs.__name__=["oimohx","physics","constraint","joint","base","LinearConstraint"],gs.prototype={joint:null,b1:null,b2:null,r1:null,r2:null,p1:null,p2:null,l1:null,l2:null,a1:null,a2:null,i1:null,i2:null,m1:null,m2:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,d00:null,d01:null,d02:null,d10:null,d11:null,d12:null,d20:null,d21:null,d22:null,r1x:null,r1y:null,r1z:null,r2x:null,r2y:null,r2z:null,ax1x:null,ax1y:null,ax1z:null,ay1x:null,ay1y:null,ay1z:null,az1x:null,az1y:null,az1z:null,ax2x:null,ax2y:null,ax2z:null,ay2x:null,ay2y:null,ay2z:null,az2x:null,az2y:null,az2z:null,vel:null,impx:null,impy:null,impz:null,velx:null,vely:null,velz:null,preSolve:function(e,t){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8],this.ax1x=this.r1z*this.i1e01+-this.r1y*this.i1e02,this.ax1y=this.r1z*this.i1e11+-this.r1y*this.i1e12,this.ax1z=this.r1z*this.i1e21+-this.r1y*this.i1e22,this.ay1x=-this.r1z*this.i1e00+this.r1x*this.i1e02,this.ay1y=-this.r1z*this.i1e10+this.r1x*this.i1e12,this.ay1z=-this.r1z*this.i1e20+this.r1x*this.i1e22,this.az1x=this.r1y*this.i1e00+-this.r1x*this.i1e01,this.az1y=this.r1y*this.i1e10+-this.r1x*this.i1e11,this.az1z=this.r1y*this.i1e20+-this.r1x*this.i1e21,this.ax2x=this.r2z*this.i2e01+-this.r2y*this.i2e02,this.ax2y=this.r2z*this.i2e11+-this.r2y*this.i2e12,this.ax2z=this.r2z*this.i2e21+-this.r2y*this.i2e22,this.ay2x=-this.r2z*this.i2e00+this.r2x*this.i2e02,this.ay2y=-this.r2z*this.i2e10+this.r2x*this.i2e12,this.ay2z=-this.r2z*this.i2e20+this.r2x*this.i2e22,this.az2x=this.r2y*this.i2e00+-this.r2x*this.i2e01,this.az2y=this.r2y*this.i2e10+-this.r2x*this.i2e11,this.az2z=this.r2y*this.i2e20+-this.r2x*this.i2e21
var i=this.m1+this.m2,n=0,r=0,s=0,o=i,a=0,l=0,h=0,u=i
i+=this.i1e11*this.r1z*this.r1z-(this.i1e21+this.i1e12)*this.r1y*this.r1z+this.i1e22*this.r1y*this.r1y,n+=(this.i1e20*this.r1y+this.i1e12*this.r1x)*this.r1z-this.i1e10*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,r+=(this.i1e10*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e20*this.r1y*this.r1y+this.i1e21*this.r1x*this.r1y,s+=(this.i1e02*this.r1y+this.i1e21*this.r1x)*this.r1z-this.i1e01*this.r1z*this.r1z-this.i1e22*this.r1x*this.r1y,o+=this.i1e00*this.r1z*this.r1z-(this.i1e20+this.i1e02)*this.r1x*this.r1z+this.i1e22*this.r1x*this.r1x,a+=(this.i1e01*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e21*this.r1x*this.r1x+this.i1e20*this.r1x*this.r1y,l+=(this.i1e01*this.r1y-this.i1e11*this.r1x)*this.r1z-this.i1e02*this.r1y*this.r1y+this.i1e12*this.r1x*this.r1y,h+=(this.i1e10*this.r1x-this.i1e00*this.r1y)*this.r1z-this.i1e12*this.r1x*this.r1x+this.i1e02*this.r1x*this.r1y,u+=this.i1e00*this.r1y*this.r1y-(this.i1e10+this.i1e01)*this.r1x*this.r1y+this.i1e11*this.r1x*this.r1x,i+=this.i2e11*this.r2z*this.r2z-(this.i2e21+this.i2e12)*this.r2y*this.r2z+this.i2e22*this.r2y*this.r2y,n+=(this.i2e20*this.r2y+this.i2e12*this.r2x)*this.r2z-this.i2e10*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,r+=(this.i2e10*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e20*this.r2y*this.r2y+this.i2e21*this.r2x*this.r2y,s+=(this.i2e02*this.r2y+this.i2e21*this.r2x)*this.r2z-this.i2e01*this.r2z*this.r2z-this.i2e22*this.r2x*this.r2y,o+=this.i2e00*this.r2z*this.r2z-(this.i2e20+this.i2e02)*this.r2x*this.r2z+this.i2e22*this.r2x*this.r2x,a+=(this.i2e01*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e21*this.r2x*this.r2x+this.i2e20*this.r2x*this.r2y,l+=(this.i2e01*this.r2y-this.i2e11*this.r2x)*this.r2z-this.i2e02*this.r2y*this.r2y+this.i2e12*this.r2x*this.r2y,h+=(this.i2e10*this.r2x-this.i2e00*this.r2y)*this.r2z-this.i2e12*this.r2x*this.r2x+this.i2e02*this.r2x*this.r2y,u+=this.i2e00*this.r2y*this.r2y-(this.i2e10+this.i2e01)*this.r2x*this.r2y+this.i2e11*this.r2x*this.r2x
var c=1/(i*(o*u-h*a)+s*(h*r-n*u)+l*(n*a-o*r))
this.d00=(o*u-a*h)*c,this.d01=(r*h-n*u)*c,this.d02=(n*a-r*o)*c,this.d10=(a*l-s*u)*c,this.d11=(i*u-r*l)*c,this.d12=(r*s-i*a)*c,this.d20=(s*h-o*l)*c,this.d21=(n*l-i*h)*c,this.d22=(i*o-n*s)*c,this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z
var f=Math.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz)
f>.005?(f=(.005-f)/f*t*.05,this.velx*=f,this.vely*=f,this.velz*=f):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var e=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,t=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,i=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,n=e*this.d00+t*this.d01+i*this.d02,r=e*this.d10+t*this.d11+i*this.d12,s=e*this.d20+t*this.d21+i*this.d22
this.impx+=n,this.impy+=r,this.impz+=s,this.l1.x+=n*this.m1,this.l1.y+=r*this.m1,this.l1.z+=s*this.m1,this.a1.x+=n*this.ax1x+r*this.ay1x+s*this.az1x,this.a1.y+=n*this.ax1y+r*this.ay1y+s*this.az1y,this.a1.z+=n*this.ax1z+r*this.ay1z+s*this.az1z,this.l2.x-=n*this.m2,this.l2.y-=r*this.m2,this.l2.z-=s*this.m2,this.a2.x-=n*this.ax2x+r*this.ay2x+s*this.az2x,this.a2.y-=n*this.ax2y+r*this.ay2y+s*this.az2y,this.a2.z-=n*this.ax2z+r*this.ay2z+s*this.az2z},__class__:gs}
var xs=function(e,t,i,n){this.limitMotor1=t,this.limitMotor2=i,this.limitMotor3=n,this.b1=e.body1,this.b2=e.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}
s["oimohx.physics.constraint.joint.base.Rotational3Constraint"]=xs,xs.__name__=["oimohx","physics","constraint","joint","base","Rotational3Constraint"],xs.prototype={limitMotor1:null,limitMotor2:null,limitMotor3:null,cfm1:null,cfm2:null,cfm3:null,b1:null,b2:null,a1:null,a2:null,i1:null,i2:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,ax1:null,ay1:null,az1:null,ax2:null,ay2:null,az2:null,ax3:null,ay3:null,az3:null,a1x1:null,a1y1:null,a1z1:null,a2x1:null,a2y1:null,a2z1:null,a1x2:null,a1y2:null,a1z2:null,a2x2:null,a2y2:null,a2z2:null,a1x3:null,a1y3:null,a1z3:null,a2x3:null,a2y3:null,a2z3:null,lowerLimit1:null,upperLimit1:null,limitVelocity1:null,limitImpulse1:null,limitState1:null,enableMotor1:null,motorSpeed1:null,maxMotorForce1:null,maxMotorImpulse1:null,motorImpulse1:null,lowerLimit2:null,upperLimit2:null,limitVelocity2:null,limitImpulse2:null,limitState2:null,enableMotor2:null,motorSpeed2:null,maxMotorForce2:null,maxMotorImpulse2:null,motorImpulse2:null,lowerLimit3:null,upperLimit3:null,limitVelocity3:null,limitImpulse3:null,limitState3:null,enableMotor3:null,motorSpeed3:null,maxMotorForce3:null,maxMotorImpulse3:null,motorImpulse3:null,k00:null,k01:null,k02:null,k10:null,k11:null,k12:null,k20:null,k21:null,k22:null,kv00:null,kv11:null,kv22:null,dv00:null,dv11:null,dv22:null,d00:null,d01:null,d02:null,d10:null,d11:null,d12:null,d20:null,d21:null,d22:null,preSolve:function(e,t){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.limitMotor1.frequency,n=this.limitMotor2.frequency,r=this.limitMotor3.frequency,s=i>0,o=n>0,a=r>0,l=this.lowerLimit1<=this.upperLimit1,h=this.lowerLimit2<=this.upperLimit2,u=this.lowerLimit3<=this.upperLimit3,c=this.limitMotor1.angle
l?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-c):c<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-c):c>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-c):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),s||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0)
var f=this.limitMotor2.angle
h?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-f):f<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-f):f>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-f):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),o||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0)
var d=this.limitMotor3.angle
u?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d):d<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d):d>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-d):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),a||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||s)?this.maxMotorImpulse1=this.maxMotorForce1*e:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||o)?this.maxMotorImpulse2=this.maxMotorForce2*e:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||a)?this.maxMotorImpulse3=this.maxMotorForce3*e:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22
var m=0,_=0,p=0
s&&2!=this.limitState1?(m=6.2831853*i,_=m*m*e,p=t/(_+2*this.limitMotor1.dampingRatio*m),this.cfm1=this.kv00*p,this.limitVelocity1*=_*p):(this.cfm1=0,this.limitVelocity1*=.05*t),o&&2!=this.limitState2?(m=6.2831853*n,_=m*m*e,p=t/(_+2*this.limitMotor2.dampingRatio*m),this.cfm2=this.kv11*p,this.limitVelocity2*=_*p):(this.cfm2=0,this.limitVelocity2*=.05*t),a&&2!=this.limitState3?(m=6.2831853*r,_=m*m*e,p=t/(_+2*this.limitMotor3.dampingRatio*m),this.cfm3=this.kv22*p,this.limitVelocity3*=_*p):(this.cfm3=0,this.limitVelocity3*=.05*t),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3
var v=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02))
this.d00=(this.k11*this.k22-this.k12*this.k21)*v,this.d01=(this.k02*this.k21-this.k01*this.k22)*v,this.d02=(this.k01*this.k12-this.k02*this.k11)*v,this.d10=(this.k12*this.k20-this.k10*this.k22)*v,this.d11=(this.k00*this.k22-this.k02*this.k20)*v,this.d12=(this.k02*this.k10-this.k00*this.k12)*v,this.d20=(this.k10*this.k21-this.k11*this.k20)*v,this.d21=(this.k01*this.k20-this.k00*this.k21)*v,this.d22=(this.k00*this.k11-this.k01*this.k10)*v,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95
var g=this.limitImpulse1+this.motorImpulse1,x=this.limitImpulse2+this.motorImpulse2,y=this.limitImpulse3+this.motorImpulse3
this.a1.x+=g*this.a1x1+x*this.a1x2+y*this.a1x3,this.a1.y+=g*this.a1y1+x*this.a1y2+y*this.a1y3,this.a1.z+=g*this.a1z1+x*this.a1z2+y*this.a1z3,this.a2.x-=g*this.a2x1+x*this.a2x2+y*this.a2x3,this.a2.y-=g*this.a2y1+x*this.a2y2+y*this.a2y3,this.a2.z-=g*this.a2z1+x*this.a2z2+y*this.a2z3},solve_:function(){var e=this.a2.x-this.a1.x,t=this.a2.y-this.a1.y,i=this.a2.z-this.a1.z
this.limitVelocity3=30
var n=e*this.ax1+t*this.ay1+i*this.az1-this.limitVelocity1,r=e*this.ax2+t*this.ay2+i*this.az2-this.limitVelocity2,s=e*this.ax3+t*this.ay3+i*this.az3-this.limitVelocity3,o=n*this.d00+r*this.d01+s*this.d02,a=n*this.d10+r*this.d11+s*this.d12,l=n*this.d20+r*this.d21+s*this.d22
this.limitImpulse1+=o,this.limitImpulse2+=a,this.limitImpulse3+=l,this.a1.x+=o*this.a1x1+a*this.a1x2+l*this.a1x3,this.a1.y+=o*this.a1y1+a*this.a1y2+l*this.a1y3,this.a1.z+=o*this.a1z1+a*this.a1z2+l*this.a1z3,this.a2.x-=o*this.a2x1+a*this.a2x2+l*this.a2x3,this.a2.y-=o*this.a2y1+a*this.a2y2+l*this.a2y3,this.a2.z-=o*this.a2z1+a*this.a2z2+l*this.a2z3},solve:function(){var e=this.a2.x-this.a1.x,t=this.a2.y-this.a1.y,i=this.a2.z-this.a1.z,n=e*this.ax1+t*this.ay1+i*this.az1,r=e*this.ax2+t*this.ay2+i*this.az2,s=e*this.ax3+t*this.ay3+i*this.az3,o=this.motorImpulse1,a=this.motorImpulse2,l=this.motorImpulse3,h=0,u=0,c=0
this.enableMotor1&&(h=(n-this.motorSpeed1)*this.dv00,this.motorImpulse1+=h,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),h=this.motorImpulse1-o),this.enableMotor2&&(u=(r-this.motorSpeed2)*this.dv11,this.motorImpulse2+=u,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),u=this.motorImpulse2-a),this.enableMotor3&&(c=(s-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-l),n+=h*this.kv00+u*this.k01+c*this.k02,r+=h*this.k10+u*this.kv11+c*this.k12,s+=h*this.k20+u*this.k21+c*this.kv22,n-=this.limitVelocity1+this.limitImpulse1*this.cfm1,r-=this.limitVelocity2+this.limitImpulse2*this.cfm2,s-=this.limitVelocity3+this.limitImpulse3*this.cfm3
var f=this.limitImpulse1,d=this.limitImpulse2,m=this.limitImpulse3,_=n*this.d00+r*this.d01+s*this.d02,p=n*this.d10+r*this.d11+s*this.d12,v=n*this.d20+r*this.d21+s*this.d22
this.limitImpulse1+=_,this.limitImpulse2+=p,this.limitImpulse3+=v
var g=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(_=-f,r+=_*this.k10,s+=_*this.k20,g|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(p=-d,n+=p*this.k01,s+=p*this.k21,g|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(v=-m,n+=v*this.k02,r+=v*this.k12,g|=4)
var x
switch(g){case 1:x=1/(this.k11*this.k22-this.k12*this.k21),p=(this.k22*r+-this.k12*s)*x,v=(-this.k21*r+this.k11*s)*x
break
case 2:x=1/(this.k00*this.k22-this.k02*this.k20),_=(this.k22*n+-this.k02*s)*x,v=(-this.k20*n+this.k00*s)*x
break
case 3:v=s/this.k22
break
case 4:x=1/(this.k00*this.k11-this.k01*this.k10),_=(this.k11*n+-this.k01*r)*x,p=(-this.k10*n+this.k00*r)*x
break
case 5:p=r/this.k11
break
case 6:_=n/this.k00}this.limitImpulse1=_+f,this.limitImpulse2=p+d,this.limitImpulse3=v+m
var y=h+_,b=u+p,w=c+v
this.a1.x+=y*this.a1x1+b*this.a1x2+w*this.a1x3,this.a1.y+=y*this.a1y1+b*this.a1y2+w*this.a1y3,this.a1.z+=y*this.a1z1+b*this.a1z2+w*this.a1z3,this.a2.x-=y*this.a2x1+b*this.a2x2+w*this.a2x3,this.a2.y-=y*this.a2y1+b*this.a2y2+w*this.a2y3,this.a2.z-=y*this.a2z1+b*this.a2z2+w*this.a2z3,e=this.a2.x-this.a1.x,t=this.a2.y-this.a1.y,i=this.a2.z-this.a1.z,r=e*this.ax2+t*this.ay2+i*this.az2},__class__:xs}
var ys=function(e,t){this.limitMotor=t,this.b1=e.body1,this.b2=e.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}
s["oimohx.physics.constraint.joint.base.RotationalConstraint"]=ys,ys.__name__=["oimohx","physics","constraint","joint","base","RotationalConstraint"],ys.prototype={limitMotor:null,b1:null,b2:null,a1:null,a2:null,i1:null,i2:null,cfm:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,motorDenom:null,invMotorDenom:null,invDenom:null,ax:null,ay:null,az:null,a1x:null,a1y:null,a1z:null,a2x:null,a2y:null,a2z:null,enableLimit:null,lowerLimit:null,upperLimit:null,limitVelocity:null,limitImpulse:null,limitState:null,enableMotor:null,motorSpeed:null,maxMotorForce:null,maxMotorImpulse:null,motorImpulse:null,preSolve:function(e,t){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.limitMotor.frequency,n=i>0,r=this.lowerLimit<=this.upperLimit,s=this.limitMotor.angle
if(r?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-s):s<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-s):s>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-s):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),n||(this.limitVelocity>.02?this.limitVelocity-=.02:this.limitVelocity<-.02?this.limitVelocity+=.02:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||n)?this.maxMotorImpulse=this.maxMotorForce*e:(this.motorImpulse=0,this.maxMotorImpulse=0),this.a1x=this.ax*this.i1e00+this.ay*this.i1e01+this.az*this.i1e02,this.a1y=this.ax*this.i1e10+this.ay*this.i1e11+this.az*this.i1e12,this.a1z=this.ax*this.i1e20+this.ay*this.i1e21+this.az*this.i1e22,this.a2x=this.ax*this.i2e00+this.ay*this.i2e01+this.az*this.i2e02,this.a2y=this.ax*this.i2e10+this.ay*this.i2e11+this.az*this.i2e12,this.a2z=this.ax*this.i2e20+this.ay*this.i2e21+this.az*this.i2e22,this.motorDenom=this.ax*(this.a1x+this.a2x)+this.ay*(this.a1y+this.a2y)+this.az*(this.a1z+this.a2z),this.invMotorDenom=1/this.motorDenom,n&&2!=this.limitState){var o=6.2831853*i,a=o*o*e,l=t/(a+2*this.limitMotor.dampingRatio*o)
this.cfm=this.motorDenom*l,this.limitVelocity*=a*l}else this.cfm=0,this.limitVelocity*=.05*t
this.invDenom=1/(this.motorDenom+this.cfm),this.limitImpulse*=.95,this.motorImpulse*=.95
var h=this.limitImpulse+this.motorImpulse
this.a1.x+=h*this.a1x,this.a1.y+=h*this.a1y,this.a1.z+=h*this.a1z,this.a2.x-=h*this.a2x,this.a2.y-=h*this.a2y,this.a2.z-=h*this.a2z},solve:function(){var e,t=this.ax*(this.a2.x-this.a1.x)+this.ay*(this.a2.y-this.a1.y)+this.az*(this.a2.z-this.a1.z)
if(this.enableMotor){e=(t-this.motorSpeed)*this.invMotorDenom
var i=this.motorImpulse
this.motorImpulse+=e,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),e=this.motorImpulse-i,t-=e*this.motorDenom}else e=0
var n
if(2!=this.limitState){n=(t-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom
var r=this.limitImpulse
this.limitImpulse+=n,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),n=this.limitImpulse-r}else n=0
var s=n+e
this.a1.x+=s*this.a1x,this.a1.y+=s*this.a1y,this.a1.z+=s*this.a1z,this.a2.x-=s*this.a2x,this.a2.y-=s*this.a2y,this.a2.z-=s*this.a2z},__class__:ys}
var bs=function(e,t,i,n){this.limitMotor1=t,this.limitMotor2=i,this.limitMotor3=n,this.b1=e.body1,this.b2=e.body2,this.p1=e.anchorPoint1,this.p2=e.anchorPoint2,this.r1=e.relativeAnchorPoint1,this.r2=e.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}
s["oimohx.physics.constraint.joint.base.Translational3Constraint"]=bs,bs.__name__=["oimohx","physics","constraint","joint","base","Translational3Constraint"],bs.prototype={limitMotor1:null,limitMotor2:null,limitMotor3:null,weight:null,cfm1:null,cfm2:null,cfm3:null,b1:null,b2:null,p1:null,p2:null,r1:null,r2:null,l1:null,l2:null,a1:null,a2:null,i1:null,i2:null,m1:null,m2:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,ax1:null,ay1:null,az1:null,ax2:null,ay2:null,az2:null,ax3:null,ay3:null,az3:null,r1x:null,r1y:null,r1z:null,r2x:null,r2y:null,r2z:null,t1x1:null,t1y1:null,t1z1:null,t2x1:null,t2y1:null,t2z1:null,l1x1:null,l1y1:null,l1z1:null,l2x1:null,l2y1:null,l2z1:null,a1x1:null,a1y1:null,a1z1:null,a2x1:null,a2y1:null,a2z1:null,t1x2:null,t1y2:null,t1z2:null,t2x2:null,t2y2:null,t2z2:null,l1x2:null,l1y2:null,l1z2:null,l2x2:null,l2y2:null,l2z2:null,a1x2:null,a1y2:null,a1z2:null,a2x2:null,a2y2:null,a2z2:null,t1x3:null,t1y3:null,t1z3:null,t2x3:null,t2y3:null,t2z3:null,l1x3:null,l1y3:null,l1z3:null,l2x3:null,l2y3:null,l2z3:null,a1x3:null,a1y3:null,a1z3:null,a2x3:null,a2y3:null,a2z3:null,lowerLimit1:null,upperLimit1:null,limitVelocity1:null,limitImpulse1:null,limitState1:null,enableMotor1:null,motorSpeed1:null,maxMotorForce1:null,maxMotorImpulse1:null,motorImpulse1:null,lowerLimit2:null,upperLimit2:null,limitVelocity2:null,limitImpulse2:null,limitState2:null,enableMotor2:null,motorSpeed2:null,maxMotorForce2:null,maxMotorImpulse2:null,motorImpulse2:null,lowerLimit3:null,upperLimit3:null,limitVelocity3:null,limitImpulse3:null,limitState3:null,enableMotor3:null,motorSpeed3:null,maxMotorForce3:null,maxMotorImpulse3:null,motorImpulse3:null,k00:null,k01:null,k02:null,k10:null,k11:null,k12:null,k20:null,k21:null,k22:null,kv00:null,kv11:null,kv22:null,dv00:null,dv11:null,dv22:null,d00:null,d01:null,d02:null,d10:null,d11:null,d12:null,d20:null,d21:null,d22:null,preSolve:function(e,t){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,r=this.p2.z-this.p1.z,s=i*this.ax1+n*this.ay1+r*this.az1,o=i*this.ax2+n*this.ay2+r*this.az2,a=i*this.ax3+n*this.ay3+r*this.az3,l=this.limitMotor1.frequency,h=this.limitMotor2.frequency,u=this.limitMotor3.frequency,c=l>0,f=h>0,d=u>0,m=this.lowerLimit1<=this.upperLimit1,_=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3;(c&&s>20||-20>s)&&(c=!1),(f&&o>20||-20>o)&&(f=!1),(d&&a>20||-20>a)&&(d=!1),m?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-s,c||(s=this.lowerLimit1)):s<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-s,c||(s=this.lowerLimit1)):s>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-s,c||(s=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),c||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),_?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-o,f||(o=this.lowerLimit2)):o<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-o,f||(o=this.lowerLimit2)):o>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-o,f||(o=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),f||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),p?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-a,d||(a=this.lowerLimit3)):a<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-a,d||(a=this.lowerLimit3)):a>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-a,d||(a=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),d||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||c)?this.maxMotorImpulse1=this.maxMotorForce1*e:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||f)?this.maxMotorImpulse2=this.maxMotorForce2*e:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||d)?this.maxMotorImpulse3=this.maxMotorForce3*e:(this.motorImpulse3=0,this.maxMotorImpulse3=0)
var v=s*this.ax1+o*this.ax2+a*this.ax2,g=s*this.ay1+o*this.ay2+a*this.ay2,x=s*this.az1+o*this.az2+a*this.az2,y=this.m2/(this.m1+this.m2)
this.weight>=0&&(y=this.weight)
var b=1-y
this.r1x=this.r1.x+v*y,this.r1y=this.r1.y+g*y,this.r1z=this.r1.z+x*y,this.r2x=this.r2.x-v*b,this.r2y=this.r2.y-g*b,this.r2z=this.r2.z-x*b,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22
var w=this.m1+this.m2
this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*w,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*w,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*w,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*w,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*w,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*w,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*w,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*w,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*w,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22
var S=0,M=0,T=0
c&&2!=this.limitState1?(S=6.2831853*l,M=S*S*e,T=t/(M+2*this.limitMotor1.dampingRatio*S),this.cfm1=this.kv00*T,this.limitVelocity1*=M*T):(this.cfm1=0,this.limitVelocity1*=.05*t),f&&2!=this.limitState2?(S=6.2831853*h,M=S*S*e,T=t/(M+2*this.limitMotor2.dampingRatio*S),this.cfm2=this.kv11*T,this.limitVelocity2*=M*T):(this.cfm2=0,this.limitVelocity2*=.05*t),d&&2!=this.limitState3?(S=6.2831853*u,M=S*S*e,T=t/(M+2*this.limitMotor3.dampingRatio*S),this.cfm3=this.kv22*T,this.limitVelocity3*=M*T):(this.cfm3=0,this.limitVelocity3*=.05*t),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3
var C=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02))
this.d00=(this.k11*this.k22-this.k12*this.k21)*C,this.d01=(this.k02*this.k21-this.k01*this.k22)*C,this.d02=(this.k01*this.k12-this.k02*this.k11)*C,this.d10=(this.k12*this.k20-this.k10*this.k22)*C,this.d11=(this.k00*this.k22-this.k02*this.k20)*C,this.d12=(this.k02*this.k10-this.k00*this.k12)*C,this.d20=(this.k10*this.k21-this.k11*this.k20)*C,this.d21=(this.k01*this.k20-this.k00*this.k21)*C,this.d22=(this.k00*this.k11-this.k01*this.k10)*C
var A=this.limitImpulse1+this.motorImpulse1,I=this.limitImpulse2+this.motorImpulse2,P=this.limitImpulse3+this.motorImpulse3
this.l1.x+=A*this.l1x1+I*this.l1x2+P*this.l1x3,this.l1.y+=A*this.l1y1+I*this.l1y2+P*this.l1y3,this.l1.z+=A*this.l1z1+I*this.l1z2+P*this.l1z3,this.a1.x+=A*this.a1x1+I*this.a1x2+P*this.a1x3,this.a1.y+=A*this.a1y1+I*this.a1y2+P*this.a1y3,this.a1.z+=A*this.a1z1+I*this.a1z2+P*this.a1z3,this.l2.x-=A*this.l2x1+I*this.l2x2+P*this.l2x3,this.l2.y-=A*this.l2y1+I*this.l2y2+P*this.l2y3,this.l2.z-=A*this.l2z1+I*this.l2z2+P*this.l2z3,this.a2.x-=A*this.a2x1+I*this.a2x2+P*this.a2x3,this.a2.y-=A*this.a2y1+I*this.a2y2+P*this.a2y3,this.a2.z-=A*this.a2z1+I*this.a2z2+P*this.a2z3},solve:function(){var e=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,t=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,i=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,n=e*this.ax1+t*this.ay1+i*this.az1,r=e*this.ax2+t*this.ay2+i*this.az2,s=e*this.ax3+t*this.ay3+i*this.az3,o=this.motorImpulse1,a=this.motorImpulse2,l=this.motorImpulse3,h=0,u=0,c=0
this.enableMotor1&&(h=(n-this.motorSpeed1)*this.dv00,this.motorImpulse1+=h,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),h=this.motorImpulse1-o),this.enableMotor2&&(u=(r-this.motorSpeed2)*this.dv11,this.motorImpulse2+=u,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),u=this.motorImpulse2-a),this.enableMotor3&&(c=(s-this.motorSpeed3)*this.dv22,this.motorImpulse3+=c,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),c=this.motorImpulse3-l),n+=h*this.kv00+u*this.k01+c*this.k02,r+=h*this.k10+u*this.kv11+c*this.k12,s+=h*this.k20+u*this.k21+c*this.kv22,n-=this.limitVelocity1+this.limitImpulse1*this.cfm1,r-=this.limitVelocity2+this.limitImpulse2*this.cfm2,s-=this.limitVelocity3+this.limitImpulse3*this.cfm3
var f=this.limitImpulse1,d=this.limitImpulse2,m=this.limitImpulse3,_=n*this.d00+r*this.d01+s*this.d02,p=n*this.d10+r*this.d11+s*this.d12,v=n*this.d20+r*this.d21+s*this.d22
this.limitImpulse1+=_,this.limitImpulse2+=p,this.limitImpulse3+=v
var g=0;(2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(_=-f,r+=_*this.k10,s+=_*this.k20,g|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(p=-d,n+=p*this.k01,s+=p*this.k21,g|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(v=-m,n+=v*this.k02,r+=v*this.k12,g|=4)
var x
switch(g){case 1:x=1/(this.k11*this.k22-this.k12*this.k21),p=(this.k22*r+-this.k12*s)*x,v=(-this.k21*r+this.k11*s)*x
break
case 2:x=1/(this.k00*this.k22-this.k02*this.k20),_=(this.k22*n+-this.k02*s)*x,v=(-this.k20*n+this.k00*s)*x
break
case 3:v=s/this.k22
break
case 4:x=1/(this.k00*this.k11-this.k01*this.k10),_=(this.k11*n+-this.k01*r)*x,p=(-this.k10*n+this.k00*r)*x
break
case 5:p=r/this.k11
break
case 6:_=n/this.k00}this.limitImpulse1=f+_,this.limitImpulse2=d+p,this.limitImpulse3=m+v
var y=h+_,b=u+p,w=c+v
this.l1.x+=y*this.l1x1+b*this.l1x2+w*this.l1x3,this.l1.y+=y*this.l1y1+b*this.l1y2+w*this.l1y3,this.l1.z+=y*this.l1z1+b*this.l1z2+w*this.l1z3,this.a1.x+=y*this.a1x1+b*this.a1x2+w*this.a1x3,this.a1.y+=y*this.a1y1+b*this.a1y2+w*this.a1y3,this.a1.z+=y*this.a1z1+b*this.a1z2+w*this.a1z3,this.l2.x-=y*this.l2x1+b*this.l2x2+w*this.l2x3,this.l2.y-=y*this.l2y1+b*this.l2y2+w*this.l2y3,this.l2.z-=y*this.l2z1+b*this.l2z2+w*this.l2z3,this.a2.x-=y*this.a2x1+b*this.a2x2+w*this.a2x3,this.a2.y-=y*this.a2y1+b*this.a2y2+w*this.a2y3,this.a2.z-=y*this.a2z1+b*this.a2z2+w*this.a2z3},__class__:bs}
var ws=function(e,t){this.limitMotor=t,this.b1=e.body1,this.b2=e.body2,this.p1=e.anchorPoint1,this.p2=e.anchorPoint2,this.r1=e.relativeAnchorPoint1,this.r2=e.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}
s["oimohx.physics.constraint.joint.base.TranslationalConstraint"]=ws,ws.__name__=["oimohx","physics","constraint","joint","base","TranslationalConstraint"],ws.prototype={limitMotor:null,b1:null,b2:null,p1:null,p2:null,r1:null,r2:null,l1:null,l2:null,a1:null,a2:null,i1:null,i2:null,cfm:null,m1:null,m2:null,i1e00:null,i1e01:null,i1e02:null,i1e10:null,i1e11:null,i1e12:null,i1e20:null,i1e21:null,i1e22:null,i2e00:null,i2e01:null,i2e02:null,i2e10:null,i2e11:null,i2e12:null,i2e20:null,i2e21:null,i2e22:null,motorDenom:null,invMotorDenom:null,invDenom:null,ax:null,ay:null,az:null,r1x:null,r1y:null,r1z:null,r2x:null,r2y:null,r2z:null,t1x:null,t1y:null,t1z:null,t2x:null,t2y:null,t2z:null,l1x:null,l1y:null,l1z:null,l2x:null,l2y:null,l2z:null,a1x:null,a1y:null,a1z:null,a2x:null,a2y:null,a2z:null,lowerLimit:null,upperLimit:null,limitVelocity:null,limitImpulse:null,limitState:null,enableMotor:null,motorSpeed:null,maxMotorForce:null,maxMotorImpulse:null,motorImpulse:null,preSolve:function(e,t){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.i1e00=this.i1.elements[0],this.i1e01=this.i1.elements[1],this.i1e02=this.i1.elements[2],this.i1e10=this.i1.elements[3],this.i1e11=this.i1.elements[4],this.i1e12=this.i1.elements[5],this.i1e20=this.i1.elements[6],this.i1e21=this.i1.elements[7],this.i1e22=this.i1.elements[8],this.i2e00=this.i2.elements[0],this.i2e01=this.i2.elements[1],this.i2e02=this.i2.elements[2],this.i2e10=this.i2.elements[3],this.i2e11=this.i2.elements[4],this.i2e12=this.i2.elements[5],this.i2e20=this.i2.elements[6],this.i2e21=this.i2.elements[7],this.i2e22=this.i2.elements[8]
var i=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,r=this.p2.z-this.p1.z,s=i*this.ax+n*this.ay+r*this.az,o=this.limitMotor.frequency,a=o>0,l=this.lowerLimit<=this.upperLimit;(a&&s>20||-20>s)&&(a=!1),l?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-s,a||(s=this.lowerLimit)):s<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-s,a||(s=this.lowerLimit)):s>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-s,a||(s=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),a||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||a)?this.maxMotorImpulse=this.maxMotorForce*e:(this.motorImpulse=0,this.maxMotorImpulse=0)
var h=s*this.ax,u=s*this.ay,c=s*this.az,f=this.m1/(this.m1+this.m2),d=1-f
if(this.r1x=this.r1.x+h*f,this.r1y=this.r1.y+u*f,this.r1z=this.r1.z+c*f,this.r2x=this.r2.x-h*d,this.r2y=this.r2.y-u*d,this.r2z=this.r2.z-c*d,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,a&&2!=this.limitState){var m=6.2831853*o,_=m*m*e,p=t/(_+2*this.limitMotor.dampingRatio*m)
this.cfm=this.motorDenom*p,this.limitVelocity*=_*p}else this.cfm=0,this.limitVelocity*=.05*t
this.invDenom=1/(this.motorDenom+this.cfm)
var v=this.limitImpulse+this.motorImpulse
this.l1.x+=v*this.l1x,this.l1.y+=v*this.l1y,this.l1.z+=v*this.l1z,this.a1.x+=v*this.a1x,this.a1.y+=v*this.a1y,this.a1.z+=v*this.a1z,this.l2.x-=v*this.l2x,this.l2.y-=v*this.l2y,this.l2.z-=v*this.l2z,this.a2.x-=v*this.a2x,this.a2.y-=v*this.a2y,this.a2.z-=v*this.a2z},solve:function(){var e,t=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z
if(this.enableMotor){e=(t-this.motorSpeed)*this.invMotorDenom
var i=this.motorImpulse
this.motorImpulse+=e,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),e=this.motorImpulse-i,t-=e*this.motorDenom}else e=0
var n
if(2!=this.limitState){n=(t-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom
var r=this.limitImpulse
this.limitImpulse+=n,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),n=this.limitImpulse-r}else n=0
var s=n+e
this.l1.x+=s*this.l1x,this.l1.y+=s*this.l1y,this.l1.z+=s*this.l1z,this.a1.x+=s*this.a1x,this.a1.y+=s*this.a1y,this.a1.z+=s*this.a1z,this.l2.x-=s*this.l2x,this.l2.y-=s*this.l2y,this.l2.z-=s*this.l2z,this.a2.x-=s*this.a2x,this.a2.y-=s*this.a2y,this.a2.z-=s*this.a2z},__class__:ws}
var Ss=function(e,t,i,n,r,s,o){null==o&&(o=0),null==s&&(s=0),null==r&&(r=0),null==n&&(n=0),null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),this.massInfo=new qr,this.numShapes=0,this.controlRot=!1,this.controlPos=!1,this.position=new Pr(0,0,0),this.name="",this.position=new Pr(e,t,i)
var a=r*r+s*s+o*o
a>0&&(a=1/Math.sqrt(a),r*=a,s*=a,o*=a)
var l=Math.sin(.5*n),h=Math.cos(.5*n)
this.orientation=new Ir(h,l*r,l*s,l*o),this.linearVelocity=new Pr,this.angularVelocity=new Pr,this.sleepPosition=new Pr,this.sleepOrientation=new Ir,this.rotation=new Cr,this.inverseInertia=new Cr,this.localInertia=new Cr,this.inverseLocalInertia=new Cr,this.allowSleep=!0,this.sleepTime=0,this.newOrientation=new Ir,this.newRotation=new Pr(0,0,0),this.newPosition=new Pr(0,0,0),this.matrix=new Ar}
s["oimohx.physics.dynamics.RigidBody"]=Ss,Ss.__name__=["oimohx","physics","dynamics","RigidBody"],Ss.prototype={prev:null,next:null,name:null,type:null,isDynamic:null,isStatic:null,position:null,orientation:null,sleepPosition:null,sleepOrientation:null,linearVelocity:null,angularVelocity:null,rotation:null,matrix:null,newRotation:null,newPosition:null,newOrientation:null,controlPos:null,controlRot:null,mass:null,inverseMass:null,inverseInertia:null,localInertia:null,inverseLocalInertia:null,shapes:null,numShapes:null,parent:null,contactLink:null,numContacts:null,jointLink:null,numJoints:null,addedToIsland:null,sleepTime:null,sleeping:null,allowSleep:null,massInfo:null,prestep:null,addShape:function(e){if(null!=e){if(null!=e.parent)throw new Wi("Shape already has a parent!")
null!=this.shapes&&((this.shapes.prev=e).next=this.shapes),this.shapes=e,e.parent=this,null!=this.parent&&this.parent.addShape(e),this.numShapes++}},removeShape:function(e){var t=e
if(t.parent==this){var i=t.prev,n=t.next
null!=i&&(i.next=n),null!=n&&(n.prev=i),this.shapes==t&&(this.shapes=n),t.prev=null,t.next=null,t.parent=null,null!=this.parent&&this.parent.removeShape(t),this.numShapes--}},setupMass:function(e,t){null==t&&(t=!0),null==e&&(e=1),this.type=e,this.isDynamic=1==e,this.isStatic=2==e,this.mass=0,this.localInertia.init(0,0,0,0,0,0,0,0,0)
for(var i=new Cr,n=new Pr,r=this.shapes;null!=r;){r.calculateMassInfo(this.massInfo)
var s=this.massInfo.mass,o=r.relativePosition.x,a=r.relativePosition.y,l=r.relativePosition.z
n.x+=o*s,n.y+=a*s,n.z+=l*s,this.mass+=s,this.rotateInertia(r.relativeRotation,this.massInfo.inertia,i),this.localInertia.addEqual(i),this.localInertia.elements[0]+=s*(a*a+l*l),this.localInertia.elements[1]+=s*(o*o+l*l),this.localInertia.elements[2]+=s*(o*o+a*a)
var h=s*o*a,u=s*a*l,c=s*l*o
this.localInertia.elements[3]-=h,this.localInertia.elements[4]-=h,this.localInertia.elements[5]-=u,this.localInertia.elements[6]-=u,this.localInertia.elements[7]-=c,this.localInertia.elements[8]-=c,r=r.next}if(this.inverseMass=1/this.mass,n.scaleEqual(this.inverseMass),t){for(this.position.addEqual(n),r=this.shapes;null!=r;)r.relativePosition.subEqual(n),r=r.next
var f=n.x,d=n.y,m=n.z
this.localInertia.elements[0]-=this.mass*(d*d+m*m),this.localInertia.elements[1]-=this.mass*(f*f+m*m),this.localInertia.elements[2]-=this.mass*(f*f+d*d)
var _=this.mass*f*d,p=this.mass*d*m,v=this.mass*m*f
this.localInertia.elements[3]+=_,this.localInertia.elements[4]+=_,this.localInertia.elements[5]+=p,this.localInertia.elements[6]+=p,this.localInertia.elements[7]+=v,this.localInertia.elements[8]+=v}this.inverseLocalInertia.invert(this.localInertia),2==e&&(this.inverseMass=0,this.inverseLocalInertia.init(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0
for(var e=this.contactLink;null!=e;)e.body.sleepTime=0,e.body.sleeping=!1,e=e.next
for(var t=this.jointLink;null!=t;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next
for(var i=this.shapes;null!=i;)i.updateProxy(),i=i.next}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.x=0,this.linearVelocity.y=0,this.linearVelocity.z=0,this.angularVelocity.x=0,this.angularVelocity.y=0,this.angularVelocity.z=0,this.sleepPosition.x=this.position.x,this.sleepPosition.y=this.position.y,this.sleepPosition.z=this.position.z,this.sleepOrientation.s=this.orientation.s,this.sleepOrientation.x=this.orientation.x,this.sleepOrientation.y=this.orientation.y,this.sleepOrientation.z=this.orientation.z,this.sleepTime=0,this.sleeping=!0
for(var e=this.shapes;null!=e;)e.updateProxy(),e=e.next}},isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(e){var t=this.type
switch(t){case 2:this.linearVelocity.x=0,this.linearVelocity.y=0,this.linearVelocity.z=0,this.angularVelocity.x=0,this.angularVelocity.y=0,this.angularVelocity.z=0
break
case 1:var i=this.linearVelocity.x,n=this.linearVelocity.y,r=this.linearVelocity.z
this.position.x+=i*e,this.position.y+=n*e,this.position.z+=r*e,i=this.angularVelocity.x,n=this.angularVelocity.y,r=this.angularVelocity.z
var s=this.orientation.s,o=this.orientation.x,a=this.orientation.y,l=this.orientation.z
e*=.5
var h=(-i*o-n*a-r*l)*e,u=(i*s+n*l-r*a)*e,c=(-i*l+n*s+r*o)*e,f=(i*a-n*o+r*s)*e
s+=h,o+=u,a+=c,l+=f,h=1/Math.sqrt(s*s+o*o+a*a+l*l),this.orientation.s=s*h,this.orientation.x=o*h,this.orientation.y=a*h,this.orientation.z=l*h}this.syncShapes()},rotateInertia:function(e,t,i){var n=e.elements[0],r=e.elements[1],s=e.elements[2],o=e.elements[3],a=e.elements[4],l=e.elements[5],h=e.elements[6],u=e.elements[7],c=e.elements[8],f=t.elements[0],d=t.elements[1],m=t.elements[2],_=t.elements[3],p=t.elements[4],v=t.elements[5],g=t.elements[6],x=t.elements[7],y=t.elements[8],b=n*f+r*_+s*g,w=n*d+r*p+s*x,S=n*m+r*v+s*y,M=o*f+a*_+l*g,T=o*d+a*p+l*x,C=o*m+a*v+l*y,A=h*f+u*_+c*g,I=h*d+u*p+c*x,P=h*m+u*v+c*y
i.elements[0]=b*n+w*r+S*s,i.elements[1]=b*o+w*a+S*l,i.elements[2]=b*h+w*u+S*c,i.elements[3]=M*n+T*r+C*s,i.elements[4]=M*o+T*a+C*l,i.elements[5]=M*h+T*u+C*c,i.elements[6]=A*n+I*r+P*s,i.elements[7]=A*o+I*a+P*l,i.elements[8]=A*h+I*u+P*c},syncShapes:function(){var e=this.orientation.s,t=this.orientation.x,i=this.orientation.y,n=this.orientation.z,r=2*t,s=2*i,o=2*n,a=t*r,l=i*s,h=n*o,u=t*s,c=i*o,f=t*o,d=e*r,m=e*s,_=e*o,p=this.rotation.elements
this.rotation.elements[0]=p[0]=1-l-h,this.rotation.elements[1]=p[1]=u-_,this.rotation.elements[2]=p[2]=f+m,this.rotation.elements[3]=p[3]=u+_,this.rotation.elements[4]=p[4]=1-a-h,this.rotation.elements[5]=p[5]=c-d,this.rotation.elements[6]=p[6]=f-m,this.rotation.elements[7]=p[7]=c+d,this.rotation.elements[8]=p[8]=1-a-l,this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia)
for(var v=this.shapes;null!=v;)v.position.mul(this.position,v.relativePosition,this.rotation),v.rotation.mul(v.relativeRotation,this.rotation),v.updateProxy(),v=v.next},applyImpulse:function(e,t){this.linearVelocity.x+=t.x*this.inverseMass,this.linearVelocity.y+=t.y*this.inverseMass,this.linearVelocity.z+=t.z*this.inverseMass
var i=new Pr
i.sub(e,this.position).cross(i,t).mulMat(this.inverseInertia,i),this.angularVelocity.addEqual(i)},setImpulse:function(e,t){this.linearVelocity.x=t.x*this.inverseMass,this.linearVelocity.y=t.y*this.inverseMass,this.linearVelocity.z=t.z*this.inverseMass
var i=new Pr
i.sub(e,this.position).cross(i,t).mulMat(this.inverseInertia,i),this.angularVelocity.x=i.x,this.angularVelocity.y=i.y,this.angularVelocity.z=i.z},rotationVectToQuad:function(e){var t=$t.EulerToAxis(e.x*Ms.TO_RAD,e.y*Ms.TO_RAD,e.z*Ms.TO_RAD)
return this.rotationAxisToQuad(t[0],t[1],t[2],t[3])},rotationAxisToQuad:function(e,t,i,n){var r=t*t+i*i+n*n
r>0&&(r=1/Math.sqrt(r),t*=r,i*=r,n*=r)
var s=Math.sin(.5*e),o=Math.cos(.5*e)
return new Ir(o,s*t,s*i,s*n)},setPosition:function(e){this.newPosition.init(.01*e.x,.01*e.y,.01*e.z),this.controlPos=!0},setQuaternion:function(e){this.newOrientation.init(e.s,e.x,e.y,e.z),this.controlRot=!0},setRotation:function(e){this.newOrientation=this.rotationVectToQuad(e),this.controlRot=!0},resetPosition:function(e,t,i){this.linearVelocity.init(),this.angularVelocity.init(),this.position.init(.01*e,.01*t,.01*i),this.awake()},resetQuaternion:function(e){this.angularVelocity.init(),this.orientation=new Ir(e.s,e.x,e.y,e.z),this.awake()},resetRotation:function(e,t,i){this.angularVelocity.init(),this.orientation=this.rotationVectToQuad(new Pr(e,t,i)),this.awake()},getPosition:function(){return(new Pr).scale(this.position,100)},getMatrix:function(){var e=this.matrix.elements,t=new Float32Array(9),i=null
return this.sleeping?e[15]=1:(t=this.rotation.elements,e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=0,e[4]=t[1],e[5]=t[4],e[6]=t[7],e[7]=0,e[8]=t[2],e[9]=t[5],e[10]=t[8],e[11]=0,i=this.position,e[12]=100*i.x,e[13]=100*i.y,e[14]=100*i.z,e[15]=0),e},__class__:Ss}
var Ms=function(e,t){switch(null==t&&(t=2),null==e&&(e=60),this.so=null,this.o=null,this.sp=null,this.p=null,this.lv=null,this.body=null,Ei.trace("OimoPhysics *** Copyright (c) 2012-2013 EL-EMENT saharan",{fileName:"World.hx",lineNumber:142,className:"oimohx.physics.dynamics.World",methodName:"new"}),this.timeStep=1/e,t){case 1:this.broadPhase=new Rr
break
case 2:this.broadPhase=new Ur
break
case 3:this.broadPhase=new Or}this.numIterations=8,this.gravity=new Pr(Ms.gravityX,Ms.gravityY,Ms.gravityZ),this.performance=new Ts
var i=3
this.detectors=[]
for(var n=0;i>n;){var r=n++
this.detectors[r]=[]}this.detectors[1][1]=new jr,this.detectors[1][2]=new Xr(!1),this.detectors[2][1]=new Xr(!0),this.detectors[2][2]=new Hr,this.randX=65535,this.randA=98765,this.randB=123456789,this.maxIslandRigidBodies=64,this.islandRigidBodies=[],this.islandStack=[],this.maxIslandConstraints=128,this.islandConstraints=[],this.enableRandomizer=!0}
s["oimohx.physics.dynamics.World"]=Ms,Ms.__name__=["oimohx","physics","dynamics","World"],Ms.prototype={rigidBodies:null,numRigidBodies:null,contacts:null,unusedContacts:null,numContacts:null,numContactPoints:null,joints:null,numJoints:null,numIslands:null,timeStep:null,gravity:null,numIterations:null,enableRandomizer:null,performance:null,broadPhase:null,detectors:null,islandStack:null,islandRigidBodies:null,maxIslandRigidBodies:null,islandConstraints:null,maxIslandConstraints:null,randX:null,randA:null,randB:null,clear:function(){for(this.randX=65535;null!=this.joints;)this.removeJoint(this.joints)
for(;null!=this.contacts;)this.removeContact(this.contacts)
for(;null!=this.rigidBodies;)this.removeRigidBody(this.rigidBodies)},addRigidBody:function(e){if(null!=e.parent)return void Ei.trace("Body already has a parent!",{fileName:"World.hx",lineNumber:207,className:"oimohx.physics.dynamics.World",methodName:"addRigidBody"})
e.parent=this,e.awake()
for(var t=e.shapes;null!=t;)this.addShape(t),t=t.next
null!=this.rigidBodies&&((this.rigidBodies.prev=e).next=this.rigidBodies),this.rigidBodies=e,this.numRigidBodies++},removeRigidBody:function(e){var t=e
if(t.parent==this){t.awake()
for(var i=t.jointLink;null!=i;){var n=i.joint
i=i.next,this.removeJoint(n)}for(var r=e.shapes;null!=r;)this.removeShape(r),r=r.next
var s=t.prev,o=t.next
null!=s&&(s.next=o),null!=o&&(o.prev=s),this.rigidBodies==t&&(this.rigidBodies=o),t.prev=null,t.next=null,t.parent=null,this.numRigidBodies--,t.setupMass(),t.position.x=9999,t.position.y=9999,t.position.z=9999}},addShape:function(e){null==e.parent||null==e.parent.parent,e.proxy=this.broadPhase.createProxy(e),e.updateProxy(),this.broadPhase.addProxy(e.proxy)},removeShape:function(e){this.broadPhase.removeProxy(e.proxy),e.proxy=null},addJoint:function(e){null!=e.parent,null!=this.joints&&((this.joints.prev=e).next=this.joints),this.joints=e,e.parent=this,this.numJoints++,e.awake(),e.attach()},removeJoint:function(e){var t=e,i=t.prev,n=t.next
null!=i&&(i.next=n),null!=n&&(n.prev=i),this.joints==t&&(this.joints=n),t.prev=null,t.next=null,this.numJoints--,t.awake(),t.detach(),t.parent=null},body:null,lv:null,p:null,sp:null,o:null,so:null,step:function(e){this.timeStep=e
var t=Be.stamp()
for(this.body=this.rigidBodies,this.lv=null,this.p=null,this.sp=null,this.o=null,this.so=null;null!=this.body;)null!=this.body.prestep&&this.body.prestep(),this.body.addedToIsland=!1,this.body.sleeping&&(this.lv=this.body.linearVelocity,this.p=this.body.position,this.sp=this.body.sleepPosition,this.o=this.body.orientation,this.so=this.body.sleepOrientation,(0!=this.lv.x||0!=this.lv.y||0!=this.lv.z||this.p.x!=this.sp.x||this.p.y!=this.sp.y||this.p.z!=this.sp.z||this.o.s!=this.so.s||this.o.x!=this.so.x||this.o.y!=this.so.y||this.o.z!=this.so.z)&&this.body.awake()),this.body=this.body.next
this.updateContacts(),this.solveIslands()
var i=Be.stamp()
this.performance.totalTime=i-t,this.performance.updatingTime=this.performance.totalTime-(this.performance.broadPhaseTime+this.performance.narrowPhaseTime+this.performance.solvingTime)},updateContacts:function(){var e=1e3*Be.stamp()
this.broadPhase.detectPairs()
for(var t=this.broadPhase.pairs,i=this.broadPhase.numPairs,n=0;i>n;){var r,s,o=n++,a=t[o]
a.shape1.id<a.shape2.id?(r=a.shape1,s=a.shape2):(r=a.shape2,s=a.shape1)
var l
l=r.numContacts<s.numContacts?r.contactLink:s.contactLink
for(var h=!1;null!=l;){if(l.contact.shape1==r&&l.contact.shape2==s){l.contact.persisting=!0,h=!0
break}l=l.next}h||this.addContact(r,s)}var u=1e3*Be.stamp()
this.performance.broadPhaseTime=u-e,this.numContactPoints=0
for(var c,f,d=this.contacts;null!=d;)if(!d.persisting&&(c=d.shape1.aabb,f=d.shape2.aabb,c.minX>f.maxX||c.maxX<f.minX||c.minY>f.maxY||c.maxY<f.minY||c.minZ>f.maxZ||c.maxZ<f.minZ)){var m=d.next
this.removeContact(d),d=m}else(d.body1.isDynamic&&!d.body1.sleeping||d.body2.isDynamic&&!d.body2.sleeping)&&d.updateManifold(),this.numContactPoints+=d.manifold.numPoints,d.persisting=!1,d.constraint.addedToIsland=!1,d=d.next
var _=1e3*Be.stamp()
this.performance.narrowPhaseTime=_-u},addContact:function(e,t){var i
null!=this.unusedContacts?(i=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):i=new es,i.attach(e,t),i.detector=this.detectors[e.type][t.type],null!=this.contacts&&((this.contacts.prev=i).next=this.contacts),this.contacts=i,this.numContacts++},removeContact:function(e){var t=e.prev,i=e.next
null!=i&&(i.prev=t),null!=t&&(t.next=i),this.contacts==e&&(this.contacts=i),e.prev=null,e.next=null,e.detach(),e.next=this.unusedContacts,this.unusedContacts=e,this.numContacts--},checkContact:function(e,t){return null!=this.getContact(e,t)?!0:!1},getContact:function(e,t){for(var i="",n="",r=this.contacts;null!=r;){if(i=r.body1.name,n=r.body2.name,i==e&&n==t||n==e&&i==t)return r.touching?r:null
r=r.next}return null},calSleep:function(e){if(!e.allowSleep)return!1
var t=e.linearVelocity
return t.x*t.x+t.y*t.y+t.z*t.z>.04?!1:(t=e.angularVelocity,t.x*t.x+t.y*t.y+t.z*t.z>.25?!1:!0)},solveIslands:function(){var e,t,i,n=1/this.timeStep
for(t=this.joints;null!=t;)t.addedToIsland=!1,t=t.next
this.maxIslandRigidBodies<this.numRigidBodies&&(this.maxIslandRigidBodies=this.numRigidBodies<<1,this.islandRigidBodies=[],this.islandStack=[])
var r=this.numJoints+this.numContacts
this.maxIslandConstraints<r&&(this.maxIslandConstraints=r<<1,this.islandConstraints=[])
var s=Math.round(1e3*Be.stamp())
this.numIslands=0
for(var o=this.rigidBodies;null!=o;)if(o.addedToIsland||o.isStatic||o.sleeping)o=o.next
else if(0!=o.numJoints||0!=o.numContacts){var a=0,l=0,h=1
this.islandStack[0]=o,o.addedToIsland=!0
do{if(0==h)break
if(e=this.islandStack[--h],this.islandStack[h]=null,e.sleeping=!1,this.islandRigidBodies[a++]=e,!e.isStatic){for(var u=e.contactLink;null!=u;){var c=u.contact
if(i=c.constraint,!i.addedToIsland&&c.touching){this.islandConstraints[l++]=i,i.addedToIsland=!0
var f=u.body
f.addedToIsland?u=u.next:(this.islandStack[h++]=f,f.addedToIsland=!0,u=u.next)}else u=u.next}for(var d=e.jointLink;null!=d;)if(i=d.joint,i.addedToIsland)d=d.next
else{this.islandConstraints[l++]=i,i.addedToIsland=!0
var m=d.body
!m.addedToIsland&&m.isDynamic?(this.islandStack[h++]=m,m.addedToIsland=!0,d=d.next):d=d.next}}}while(0!=h)
for(var _=this.gravity.x*this.timeStep,p=this.gravity.y*this.timeStep,v=this.gravity.z*this.timeStep,g=0;a>g;){var x=g++
e=this.islandRigidBodies[x],e.isDynamic&&(e.linearVelocity.x+=_,e.linearVelocity.y+=p,e.linearVelocity.z+=v)}if(this.enableRandomizer)for(var y=1;l>y;){var b=y++
this.randX=this.randX*this.randA+this.randB&2147483647
var w=this.randX/2147483648*b|0|0
i=this.islandConstraints[b],this.islandConstraints[b]=this.islandConstraints[w],this.islandConstraints[w]=i}for(var S=0;l>S;){var M=S++
this.islandConstraints[M].preSolve(this.timeStep,n)}for(var T=0,C=this.numIterations;C>T;)for(var A=(T++,0);l>A;){var I=A++
this.islandConstraints[I].solve()}for(var P=0;l>P;){var E=P++
this.islandConstraints[E].postSolve(),this.islandConstraints[E]=null}for(var D=10,L=0;a>L;){var F=L++
e=this.islandRigidBodies[F],this.calSleep(e)?(e.sleepTime+=this.timeStep,e.sleepTime<D&&(D=e.sleepTime)):(e.sleepTime=0,D=0)}if(D>.5)for(var R=0;a>R;){var z=R++
this.islandRigidBodies[z].sleep(),this.islandRigidBodies[z]=null}else for(var B=0;a>B;){var O=B++
this.islandRigidBodies[O].updatePosition(this.timeStep),this.islandRigidBodies[O]=null}this.numIslands++,null!=o&&(o=o.next)}else o.isDynamic&&(o.linearVelocity.x+=this.gravity.x*this.timeStep,o.linearVelocity.y+=this.gravity.y*this.timeStep,o.linearVelocity.z+=this.gravity.z*this.timeStep),this.calSleep(o)?(o.sleepTime+=this.timeStep,o.sleepTime>.5?o.sleep():o.updatePosition(this.timeStep)):(o.sleepTime=0,o.updatePosition(this.timeStep)),this.numIslands++,o=o.next
var k=Math.round(1e3*Be.stamp())
this.performance.solvingTime=k-s},__class__:Ms}
var Ts=function(){}
s["oimohx.physics.util.Performance"]=Ts,Ts.__name__=["oimohx","physics","util","Performance"],Ts.prototype={broadPhaseTime:null,narrowPhaseTime:null,solvingTime:null,updatingTime:null,totalTime:null,__class__:Ts}
var Cs=function(e,t){this.k=e,this.v=t}
s["org.msgpack._Decoder.Pair"]=Cs,Cs.__name__=["org","msgpack","_Decoder","Pair"],Cs.prototype={k:null,v:null,__class__:Cs}
var As=function(e){this.o=new Vi,this.o.set_bigEndian(!0),this.encode(e)}
s["org.msgpack.Encoder"]=As,As.__name__=["org","msgpack","Encoder"],As.prototype={o:null,encode:function(e){var t=w["typeof"](e)
switch(t[1]){case 0:this.o.writeByte(192)
break
case 3:this.o.writeByte(e?195:194)
break
case 1:this.writeInt(e)
break
case 2:this.writeFloat(e)
break
case 6:var i=t[2],n=w.getClassName(i)
switch(n){case"haxe.Int64":this.writeInt64(e)
break
case"haxe.io.Bytes":this.writeBinary(e)
break
case"String":this.writeString(e)
break
case"Array":this.writeArray(e)
break
case"haxe.ds.IntMap":case"haxe.ds.StringMap":case"haxe.ds.UnsafeStringMap":this.writeMap(e)
break
default:throw new Wi("Error: "+w.getClassName(i)+" not supported")}break
case 4:this.writeObject(e)
break
case 7:t[2]
throw new Wi("Error: Enum not supported")
case 5:throw new Wi("Error: Function not supported")
case 8:throw new Wi("Error: Unknown Data Type")}},writeInt64:function(e){this.o.writeByte(211),this.o.writeInt32(e.high),this.o.writeInt32(e.low)},writeInt:function(e){-32>e?-32768>e?(this.o.writeByte(210),this.o.writeInt32(e)):-128>e?(this.o.writeByte(209),this.o.writeInt16(e)):(this.o.writeByte(208),this.o.writeInt8(e)):128>e?this.o.writeByte(255&e):256>e?(this.o.writeByte(204),this.o.writeByte(e)):65536>e?(this.o.writeByte(205),this.o.writeUInt16(e)):(this.o.writeByte(206),this.o.writeInt32(e))},writeFloat:function(e){var t=Math.abs(e)
t>1.401298464324817e-45&&3.4028234663852886e38>t?(this.o.writeByte(202),this.o.writeInt32(Ui.floatToI32(e))):(this.o.writeByte(203),this.o.writeDouble(e))},writeBinary:function(e){var t=e.length
256>t?(this.o.writeByte(196),this.o.writeByte(t)):65536>t?(this.o.writeByte(197),this.o.writeUInt16(t)):(this.o.writeByte(198),this.o.writeInt32(t)),this.o.write(e)},writeString:function(e){var t=e.length
32>t?this.o.writeByte(160|t):256>t?(this.o.writeByte(217),this.o.writeByte(t)):65536>t?(this.o.writeByte(218),this.o.writeUInt16(t)):(this.o.writeByte(219),this.o.writeInt32(t)),this.o.writeString(e)},writeArray:function(e){var t=e.length
16>t?this.o.writeByte(144|t):65536>t?(this.o.writeByte(220),this.o.writeUInt16(t)):(this.o.writeByte(221),this.o.writeInt32(t))
for(var i=0;i<e.length;){var n=e[i];++i,this.encode(n)}},writeMapLength:function(e){16>e?this.o.writeByte(128|e):65536>e?(this.o.writeByte(222),this.o.writeUInt16(e)):(this.o.writeByte(223),this.o.writeInt32(e))},writeMap:function(e){for(var t=0,i=e.keys();i.hasNext();){i.next()
t++}16>t?this.o.writeByte(128|t):65536>t?(this.o.writeByte(222),this.o.writeUInt16(t)):(this.o.writeByte(223),this.o.writeInt32(t))
for(var n=e.keys();n.hasNext();){var r=n.next()
this.encode(r),this.encode(e.get(r))}},writeObject:function(e){var t=v.fields(e)
this.writeMapLength(f.count(t))
for(var i=0;i<t.length;){var n=t[i];++i,this.encode(n),this.encode(v.field(e,n))}},getBytes:function(){return this.o.getBytes()},__class__:As}
var Is=function(e){var t=this,i=new ye("Omni0",new W(-2,-2,0),e)
i.intensity=.5
var n=new q("Camera",3.38,1.55,20,new W(0,0,0),e),r=new Ti(e)
r.load("assets/models/","Planisferio.obj",function(r){r[0].rotation.x=Math.PI/2,r[0].rotation.z=-Math.PI/2.5,i.excludedMeshes=r,n.target=r[0].position
var s=new Fe("smat",e)
s.diffuseColor=Re.Red(),s.alpha=.9,s.specularPower=0,s.emissiveFresnelParameters=new He,s.emissiveFresnelParameters.bias=.8,s.emissiveFresnelParameters.leftColor=Re.Black(),s.emissiveFresnelParameters.rightColor=Re.Black(),s.opacityFresnelParameters=new He,s.opacityFresnelParameters.power=8,s.opacityFresnelParameters.leftColor=Re.White(),s.opacityFresnelParameters.rightColor=Re.Black(),r[0].set_material(s)
var o=new ri("godrays",1,n,null,50,2,e._engine,!1)
o.exposure=.1,t.sun=o.mesh,t.sun.billboardMode=1,Me.__cast(t.sun.get_material(),Fe).diffuseTexture=new Ve("assets/img/haxe-logo.png",e,!0,!1,2),Me.__cast(t.sun.get_material(),Fe).diffuseTexture.hasAlpha=!0,Me.__cast(t.sun.get_material(),Fe).diffuseTexture.level=1,t.sun.scaling=new W(3,3,1),t.sun.position=r[0].position.clone(),t.sun.position.x=5,t.sun.position.z+=10,t.sun.position.y+=5
var a=0,l=0
e.registerBeforeRender(function(){l=Math.sin(a)/10,t.sun.rotation.z+=.004,r[0].rotation.x=Math.PI/2+l,r[0].rotation.z=-Math.PI/2.5-l,a+=.005}),t.animateSun()
var h=new de("background","assets/img/skybox/Sky_FantasySky_Fire_Cam_px.jpg",e,!0)
h.render(),e._engine.runRenderLoop(function(){e.render()})})}
s["samples.LoadObjFile"]=Is,Is.__name__=["samples","LoadObjFile"],Is.prototype={sun:null,animateSun:function(){var e=this
lr.tween(this.sun.position,15,{y:-6,z:10},!1).ease(wr.get_easeInOut()).onComplete(function(){lr.tween(e.sun.position,15,{y:5,z:-6},!1).ease(wr.get_easeInOut()).onComplete(function(){lr.tween(e.sun.position,15,{y:-6,z:-8},!1).ease(wr.get_easeInOut()).onComplete(function(){lr.tween(e.sun.position,15,{y:1,z:2},!1).ease(wr.get_easeInOut()).onComplete(function(){lr.tween(e.sun.position,15,{y:-5,z:-1},!1).ease(wr.get_easeInOut()).onComplete(function(){lr.tween(e.sun.position,15,{y:5,z:10},!1).ease(wr.get_easeInOut()).onComplete(function(){e.animateSun()})})})})})})},__class__:Is}
var Ps,Es=0
Array.prototype.indexOf&&(c.indexOf=function(e,t,i){return Array.prototype.indexOf.call(e,t,i)}),s.Math=Math,String.prototype.__class__=s.String=String,String.__name__=["String"],s.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=s.Date=Date,Date.__name__=["Date"]
var Ds=s.Int={__name__:["Int"]},Ls=s.Dynamic={__name__:["Dynamic"]},Fs=s.Float=Number
Fs.__name__=["Float"]
var Rs=s.Bool=Boolean
Rs.__ename__=["Bool"]
var zs=s.Class={__name__:["Class"]},Bs={}
null==Array.prototype.map&&(Array.prototype.map=function(e){for(var t=[],i=0,n=this.length;n>i;){var r=i++
t[r]=e(this[r])}return t})
var Os={},ks=Function('return"undefined"!=typeof ArrayBuffer?ArrayBuffer:null')()||Yi
null==ks.prototype.slice&&(ks.prototype.slice=Yi.sliceImpl)
var Vs,Ns=Function('return"undefined"!=typeof DataView?DataView:null')()||Hi,Us=Function('return"undefined"!=typeof Uint8Array?Uint8Array:null')()||Xi._new
Vs=Array(256),Ln.__alpha16=Vs
for(var Ws=0;256>Ws;){var Gs=Ws++
Ln.__alpha16[Gs]=65536*Gs/255|0}var Ys
Ys=Array(510),Ln.__clamp=Ys
for(var Hs=0;255>Hs;){var Xs=Hs++
Ln.__clamp[Xs]=Xs}for(var js=255,Ks=511;Ks>js;){var Zs=js++
Ln.__clamp[Zs]=255}M.ALPHA_DISABLE=0,M.ALPHA_ADD=1,M.ALPHA_COMBINE=2,M.DELAYLOADSTATE_NONE=0,M.DELAYLOADSTATE_LOADED=1,M.DELAYLOADSTATE_LOADING=2,M.DELAYLOADSTATE_NOTLOADED=4,M.TEXTUREFORMAT_ALPHA=0,M.TEXTUREFORMAT_LUMINANCE=1,M.TEXTUREFORMAT_LUMINANCE_ALPHA=2,M.TEXTUREFORMAT_RGB=3,M.TEXTUREFORMAT_RGBA=4,M.TEXTURETYPE_UNSIGNED_INT=0,M.TEXTURETYPE_FLOAT=1,M.Version="2.0.0",M.Epsilon=.001,M.CollisionsEpsilon=.001,M.ShadersRepository="assets/shaders/",M.mouseDown=[],M.mouseUp=[],M.mouseMove=[],M.mouseWheel=[],M.touchDown=[],M.touchUp=[],M.touchMove=[],M.keyUp=[],M.keyDown=[],P.FOGMODE_NONE=0,P.FOGMODE_EXP=1,P.FOGMODE_EXP2=2,P.FOGMODE_LINEAR=3,P.MinDeltaTime=1,P.MaxDeltaTime=1e3,R.NothingTrigger=0,R.OnPickTrigger=1,R.OnLeftPickTrigger=2,R.OnRightPickTrigger=3,R.OnCenterPickTrigger=4,R.OnPointerOverTrigger=5,R.OnPointerOutTrigger=6,R.OnEveryFrameTrigger=7,R.OnIntersectionEnterTrigger=8,R.OnIntersectionExitTrigger=9,R.OnKeyDownTrigger=10,R.OnKeyUpTrigger=11,R.OnPickUpTrigger=12,k.IsEqual=0,k.IsDifferent=1,k.IsGreater=2,k.IsLesser=3,U._tempQuaternion=new N,U._xAxis=new W(0,0,0),U._yAxis=new W(0,0,0),U._zAxis=new W(0,0,0),W.Unproject_matrix=new U,G.ANIMATIONTYPE_FLOAT=0,G.ANIMATIONTYPE_VECTOR3=1,G.ANIMATIONTYPE_QUATERNION=2,G.ANIMATIONTYPE_MATRIX=3,G.ANIMATIONTYPE_COLOR3=4,G.ANIMATIONTYPE_VECTOR2=5,G.ANIMATIONLOOPMODE_RELATIVE=0,G.ANIMATIONLOOPMODE_CYCLE=1,G.ANIMATIONLOOPMODE_CONSTANT=2,G.matrixInterpolateFunction_startScale=new W(0,0,0),G.matrixInterpolateFunction_startRotation=new N,G.matrixInterpolateFunction_startTranslation=new W(0,0,0),G.matrixInterpolateFunction_endScale=new W(0,0,0),G.matrixInterpolateFunction_endRotation=new N,G.matrixInterpolateFunction_endTranslation=new W(0,0,0),X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2,Z.PERSPECTIVE_CAMERA=0,Z.ORTHOGRAPHIC_CAMERA=1,Z.FOVMODE_VERTICAL_FIXED=0,Z.FOVMODE_HORIZONTAL_FIXED=1,ae.IntersectsSphere_vector=new W,we.FILTER_NONE=0,we.FILTER_VARIANCESHADOWMAP=1,we.FILTER_POISSONSAMPLING=2,we.FILTER_BLURVARIANCESHADOWMAP=3,Se._ForceFullSceneLoadingForIncremental=!1,Se._ShowLoadingScreen=!0,Se._registeredPlugins=[],Me.__toStr={}.toString,Le.TriangleFillMode=0,Le.WireFrameFillMode=1,Le.PointFillMode=2,Fe.DiffuseTextureEnabled=!0,Fe.AmbientTextureEnabled=!0,Fe.OpacityTextureEnabled=!0,Fe.ReflectionTextureEnabled=!0,Fe.EmissiveTextureEnabled=!0,Fe.SpecularTextureEnabled=!0,Fe.BumpTextureEnabled=!0,Fe.FresnelEnabled=!0,Oe.BaseUrl="",Oe.__startTime=Be.stamp(),Ve.NEAREST_SAMPLINGMODE=1,Ve.BILINEAR_SAMPLINGMODE=2,Ve.TRILINEAR_SAMPLINGMODE=3,Ve.EXPLICIT_MODE=0,Ve.SPHERICAL_MODE=1,Ve.PLANAR_MODE=2,Ve.CUBIC_MODE=3,Ve.PROJECTION_MODE=4,Ve.SKYBOX_MODE=5,Ve.CLAMP_ADDRESSMODE=0,Ve.WRAP_ADDRESSMODE=1,Ve.MIRROR_ADDRESSMODE=2,Ge.MAX_RENDERINGGROUPS=4,Ye.transposedMatrix=new U,je.BILLBOARDMODE_NONE=0,je.BILLBOARDMODE_X=1,je.BILLBOARDMODE_Y=2,je.BILLBOARDMODE_Z=4,je.BILLBOARDMODE_ALL=7,qe.FRONTSIDE=0,qe.BACKSIDE=1,qe.DOUBLESIDE=2,qe.DEFAULTSIDE=0,qe.NO_CAP=0,qe.CAP_START=1,qe.CAP_END=2,qe.CAP_ALL=3,qe.CreateDecal_target=new W(0,0,1),qe.CreateDecal_cameraWorldTarget=new W(0,0,0),qe.decalWorldMatrix=new U,qe.inverseDecalWorldMatrix=new U,qe.CreateDecal_indices=[],qe.CreateDecal_positions=[],qe.CreateDecal_normals=[],qe.CreateDecal_meshWorldMatrix=new U,qe.CreateDecal_transformMatrix=new U,qe.CreateDecal_vertexData=new Ze,Qe.PositionKind="position",Qe.NormalKind="normal",Qe.UVKind="uv",Qe.UV2Kind="uv2",Qe.ColorKind="color",Qe.MatricesIndicesKind="matricesIndices",Qe.MatricesWeightsKind="matricesWeights",Qe.count=0,et.BLENDMODE_ONEONE=0,et.BLENDMODE_STANDARD=1,it.UID_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",_t._plugin={extensions:".babylon",importMesh:function(e,t,i,n,r,s,o){var a=null
if("string"==typeof i)a=JSON.parse(i)
else{if(!Me.__instanceof(i,Te))return Ei.trace("Unknown data type!",{fileName:"BabylonFileLoader.hx",lineNumber:96,className:"com.babylonhx.loading.plugins.BabylonFileLoader",methodName:"_plugin"}),!1
a=Ce.decode(i,null)}for(var l=[],h=[],u=[],f=a.meshes,d=0,m=f.length;m>d;){var _=d++,p=f[_]
if(null==e||""==e||_t.isDescendantOf(p,e,u)){if(e instanceof Array&&null==e.__enum__&&e.splice(e.indexOf(p.name),1),Object.prototype.hasOwnProperty.call(p,"materialId")){var v=-1!=c.indexOf(h,p.materialId,0)
if(!v)for(var g=a.multiMaterials,x=0,y=g.length;y>x;){var b=x++,w=g[b]
if(w.id==p.materialId){for(var S=w.materials,M=0,T=S.length;T>M;){var C=M++,A=S[C]
h.push(A),_t.parseMaterialById(null==A?"null":""+A,a,t,n)}h.push(w.id),_t.parseMultiMaterial(w,t),v=!0
break}}v||(h.push(p.materialId),_t.parseMaterialById(p.materialId,a,t,n))}if(p.skeletonId>-1&&null!=t.skeletons){var I=c.indexOf(l,p.skeletonId,0)>-1
if(!I)for(var P=a.skeletons,E=0,D=P.length;D>E;){var L=E++,F=P[L]
F.id==p.skeletonId&&(o.push(_t.parseSkeleton(F,t)),l.push(F.id))}}var R=_t.parseMesh(p,t,n)
r.push(R)}}for(var z=0,B=t.meshes.length;B>z;){var O=z++,k=t.meshes[O]
null!=k._waitingParentId&&(k.parent=t.getLastEntryByID(k._waitingParentId),k._waitingParentId=null)}if(null!=a.particleSystems)for(var V=a.particleSystems,N=0,U=V.length;U>N;){var W=N++,G=V[W];-1!=c.indexOf(u,G.emitterId,0)&&s.push(_t.parseParticleSystem(G,t,n))}return!0},load:function(e,t,i){var n=null
if("string"==typeof t)n=JSON.parse(t)
else{if(!Me.__instanceof(t,Te))return Ei.trace("Unknown data type!",{fileName:"BabylonFileLoader.hx",lineNumber:195,className:"com.babylonhx.loading.plugins.BabylonFileLoader",methodName:"_plugin"}),!1
n=Ce.decode(t,null)}t=null,e.useDelayedTextureLoading=n.useDelayedTextureLoading&&!Se.get_ForceFullSceneLoadingForIncremental(),e.autoClear=n.autoClear,e.clearColor=Re.FromArray(n.clearColor),e.ambientColor=Re.FromArray(n.ambientColor),e.gravity=W.FromArray(n.gravity,null),null!=n.fogMode&&0!=n.fogMode&&(e.fogMode=n.fogMode,e.fogColor=Re.FromArray(n.fogColor),e.fogStart=n.fogStart,e.fogEnd=n.fogEnd,e.fogDensity=n.fogDensity)
for(var r=0,s=n.lights.length;s>r;){var o=r++,a=n.lights[o]
_t.parseLight(a,e)}if(null!=n.materials)for(var l=0,h=n.materials.length;h>l;){var u=l++,c=n.materials[u]
_t.parseMaterial(c,e,i)}if(null!=n.multiMaterials)for(var f=0,d=n.multiMaterials.length;d>f;){var m=f++,_=n.multiMaterials[m]
_t.parseMultiMaterial(_,e)}if(null!=n.skeletons)for(var p=0,v=n.skeletons.length;v>p;){var g=p++,x=n.skeletons[g]
_t.parseSkeleton(x,e)}var y=n.geometries
if(null!=y){var b=y.boxes
if(null!=b)for(var w=0,S=b.length;S>w;){var M=w++,T=b[M]
_t.parseBox(T,e)}var C=y.spheres
if(null!=C)for(var A=0,I=C.length;I>A;){var P=A++,E=C[P]
_t.parseSphere(E,e)}var D=y.cylinders
if(null!=D)for(var L=0,F=D.length;F>L;){var R=L++,z=D[R]
_t.parseCylinder(z,e)}var B=y.toruses
if(null!=B)for(var O=0,k=B.length;k>O;){var V=O++,N=B[V]
_t.parseTorus(N,e)}var U=y.grounds
if(null!=U)for(var G=0,Y=U.length;Y>G;){var H=G++,X=U[H]
_t.parseGround(X,e)}var j=y.planes
if(null!=j)for(var K=0,Z=j.length;Z>K;){var q=K++,Q=j[q]
_t.parsePlane(Q,e)}var J=y.torusKnots
if(null!=J)for(var $=0,ee=J.length;ee>$;){var te=$++,ie=J[te]
_t.parseTorusKnot(ie,e)}var ne=y.vertexData
if(null!=ne)for(var re=0,se=ne.length;se>re;){var oe=re++,ae=ne[oe]
_t.parseVertexData(ae,e,i)}}for(var le=n.meshes,he=0,ue=le.length;ue>he;){var ce=he++,fe=le[ce]
_t.parseMesh(fe,e,i)}for(var de=(n.cameras,0),me=n.cameras.length;me>de;){var _e=de++,pe=n.cameras[_e]
_t.parseCamera(pe,e)}null!=n.activeCameraID&&e.setActiveCameraByID(n.activeCameraID)
for(var ve=0,ge=e.cameras.length;ge>ve;){var xe=ve++,ye=e.cameras[xe]
null!=ye._waitingParentId&&(ye.parent=e.getLastEntryByID(ye._waitingParentId),ye._waitingParentId=null)}for(var be=0,we=e.lights.length;we>be;){var Ae=be++,Ie=e.lights[Ae]
null!=Ie._waitingParentId&&(Ie.parent=e.getLastEntryByID(Ie._waitingParentId),Ie._waitingParentId=null)}for(var Pe=0,Ee=e.meshes.length;Ee>Pe;){var De=Pe++,Le=e.meshes[De]
null!=Le._waitingParentId&&(Le.parent=e.getLastEntryByID(Le._waitingParentId),Le._waitingParentId=null),null!=Le._waitingActions&&(_t.parseActions(Le._waitingActions,Le,e),Le._waitingActions=null)}if(null!=n.particleSystems)for(var Fe=0,ze=n.particleSystems.length;ze>Fe;){var Be=Fe++,Oe=n.particleSystems[Be]
_t.parseParticleSystem(Oe,e,i)}if(null!=n.lensFlareSystems)for(var ke=0,Ve=n.lensFlareSystems.length;Ve>ke;){var Ne=ke++,Ue=n.lensFlareSystems[Ne]
_t.parseLensFlareSystem(Ue,e,i)}if(null!=n.shadowGenerators)for(var We=0,Ge=n.shadowGenerators.length;Ge>We;){var Ye=We++,He=n.shadowGenerators[Ye]
_t.parseShadowGenerator(He,e)}return null!=n.actions&&_t.parseActions(n.actions,null,e),!0}},xt.Shaders=function(){var e,t=new Bi
return null!=Os["anaglyph.fragment"]?t.setReserved("anaglyph.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D leftSampler;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 leftFrag = texture2D(leftSampler, vUV);\r\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\r\n\r\n	vec4 rightFrag = texture2D(textureSampler, vUV);\r\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\r\n\r\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\r\n}"):t.h["anaglyph.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D leftSampler;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 leftFrag = texture2D(leftSampler, vUV);\r\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\r\n\r\n	vec4 rightFrag = texture2D(textureSampler, vUV);\r\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\r\n\r\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\r\n}",null!=Os["blackAndWhite.fragment"]?t.setReserved("blackAndWhite.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\r\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\r\n}"):t.h["blackAndWhite.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\r\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\r\n}",null!=Os["blur.fragment"]?t.setReserved("blur.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\nuniform vec2 direction;\r\nuniform float blurWidth;\r\n\r\nvoid main(void)\r\n{\r\n	float weights[7];\r\n	weights[0] = 0.05;\r\n	weights[1] = 0.1;\r\n	weights[2] = 0.2;\r\n	weights[3] = 0.3;\r\n	weights[4] = 0.2;\r\n	weights[5] = 0.1;\r\n	weights[6] = 0.05;\r\n\r\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\r\n	vec2 texelStep = texelSize * direction * blurWidth;\r\n	vec2 start = vUV - 3.0 * texelStep;\r\n\r\n	vec4 baseColor = vec4(0., 0., 0., 0.);\r\n	vec2 texelOffset = vec2(0., 0.);\r\n\r\n	for (int i = 0; i < 7; i++)\r\n	{\r\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\r\n		texelOffset += texelStep;\r\n	}\r\n\r\n	gl_FragColor = baseColor;\r\n}"):t.h["blur.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\nuniform vec2 direction;\r\nuniform float blurWidth;\r\n\r\nvoid main(void)\r\n{\r\n	float weights[7];\r\n	weights[0] = 0.05;\r\n	weights[1] = 0.1;\r\n	weights[2] = 0.2;\r\n	weights[3] = 0.3;\r\n	weights[4] = 0.2;\r\n	weights[5] = 0.1;\r\n	weights[6] = 0.05;\r\n\r\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\r\n	vec2 texelStep = texelSize * direction * blurWidth;\r\n	vec2 start = vUV - 3.0 * texelStep;\r\n\r\n	vec4 baseColor = vec4(0., 0., 0., 0.);\r\n	vec2 texelOffset = vec2(0., 0.);\r\n\r\n	for (int i = 0; i < 7; i++)\r\n	{\r\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\r\n		texelOffset += texelStep;\r\n	}\r\n\r\n	gl_FragColor = baseColor;\r\n}",null!=Os["brick.fragment"]?t.setReserved("brick.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfBricksHeight;\r\nuniform float numberOfBricksWidth;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	float brickW = 1.0 / numberOfBricksWidth;\r\n	float brickH = 1.0 / numberOfBricksHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.05;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\r\n\r\n		if (brickColorSwitch == 0.0)\r\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\r\n		else if (brickColorSwitch == 2.0)\r\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 1.0);\r\n}"):t.h["brick.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfBricksHeight;\r\nuniform float numberOfBricksWidth;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	float brickW = 1.0 / numberOfBricksWidth;\r\n	float brickH = 1.0 / numberOfBricksHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.05;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\r\n\r\n		if (brickColorSwitch == 0.0)\r\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\r\n		else if (brickColorSwitch == 2.0)\r\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",null!=Os["chromaticAberration.fragment"]?t.setReserved("chromaticAberration.fragment","// BABYLON.JS Chromatic Aberration GLSL Shader\r\n// Author: Olivier Guyot\r\n// Separates very slightly R, G and B colors on the edges of the screen\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float chromatic_aberration;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\nvoid main(void)\r\n{\r\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\r\n		+ centered_screen_pos.y*centered_screen_pos.y;\r\n	float radius = sqrt(radius2);\r\n\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	if (chromatic_aberration > 0.0) {\r\n		//index of refraction of each color channel, causing chromatic dispersion\r\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\r\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\r\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\r\n\r\n		// shifts for red, green & blue\r\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\r\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\r\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\r\n\r\n		original.r = texture2D(textureSampler, ref_coords_r).r;\r\n		original.g = texture2D(textureSampler, ref_coords_g).g;\r\n		original.b = texture2D(textureSampler, ref_coords_b).b;\r\n	}\r\n\r\n	gl_FragColor = original;\r\n}"):t.h["chromaticAberration.fragment"]="// BABYLON.JS Chromatic Aberration GLSL Shader\r\n// Author: Olivier Guyot\r\n// Separates very slightly R, G and B colors on the edges of the screen\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float chromatic_aberration;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\nvoid main(void)\r\n{\r\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\r\n		+ centered_screen_pos.y*centered_screen_pos.y;\r\n	float radius = sqrt(radius2);\r\n\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	if (chromatic_aberration > 0.0) {\r\n		//index of refraction of each color channel, causing chromatic dispersion\r\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\r\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\r\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\r\n\r\n		// shifts for red, green & blue\r\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\r\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\r\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\r\n\r\n		original.r = texture2D(textureSampler, ref_coords_r).r;\r\n		original.g = texture2D(textureSampler, ref_coords_g).g;\r\n		original.b = texture2D(textureSampler, ref_coords_b).b;\r\n	}\r\n\r\n	gl_FragColor = original;\r\n}",null!=Os["cloud.fragment"]?t.setReserved("cloud.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;\r\n\r\nuniform vec3 skyColor;\r\nuniform vec3 cloudColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n\r\n	vec2 p = vUV * 12.0;\r\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\r\n	gl_FragColor = vec4(c, 1);\r\n\r\n}"):t.h["cloud.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;\r\n\r\nuniform vec3 skyColor;\r\nuniform vec3 cloudColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n\r\n	vec2 p = vUV * 12.0;\r\n	vec3 c = mix(skyColor, cloudColor, fbm(p));\r\n	gl_FragColor = vec4(c, 1);\r\n\r\n}",null!=Os["color.fragment"]?t.setReserved("color.fragment","precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = color;\r\n}"):t.h["color.fragment"]="precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = color;\r\n}",null!=Os["color.vertex"]?t.setReserved("color.vertex","precision highp float;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n\r\n// Uniforms\r\nuniform mat4 worldViewProjection;\r\n\r\nvoid main(void) {\r\n	gl_Position = worldViewProjection * vec4(position, 1.0);\r\n}"):t.h["color.vertex"]="precision highp float;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n\r\n// Uniforms\r\nuniform mat4 worldViewProjection;\r\n\r\nvoid main(void) {\r\n	gl_Position = worldViewProjection * vec4(position, 1.0);\r\n}",null!=Os["colorCorrection.fragment"]?t.setReserved("colorCorrection.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// screen render\r\nuniform sampler2D colorTable;		// color table with modified colors\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\r\n// it means the image is 256x16 pixels\r\n\r\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\r\n	float sliceSize = 1.0 / width;              // space of 1 slice\r\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\r\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\r\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\r\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\r\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\r\n	float s0 = xOffset + (zSlice0 * sliceSize);\r\n	float s1 = xOffset + (zSlice1 * sliceSize);\r\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\r\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\r\n	float zOffset = mod(uv.z * width, 1.0);\r\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\r\n	return result;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 screen_color = texture2D(textureSampler, vUV);\r\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\r\n\r\n}"):t.h["colorCorrection.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// screen render\r\nuniform sampler2D colorTable;		// color table with modified colors\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\r\n// it means the image is 256x16 pixels\r\n\r\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\r\n	float sliceSize = 1.0 / width;              // space of 1 slice\r\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\r\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\r\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\r\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\r\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\r\n	float s0 = xOffset + (zSlice0 * sliceSize);\r\n	float s1 = xOffset + (zSlice1 * sliceSize);\r\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\r\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\r\n	float zOffset = mod(uv.z * width, 1.0);\r\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\r\n	return result;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 screen_color = texture2D(textureSampler, vUV);\r\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\r\n\r\n}",null!=Os["convolution.fragment"]?t.setReserved("convolution.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform vec2 screenSize;\r\nuniform float kernel[9];\r\n\r\nvoid main(void)\r\n{\r\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\r\n	vec4 colorSum =\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\r\n\r\n	float kernelWeight =\r\n		kernel[0] +\r\n		kernel[1] +\r\n		kernel[2] +\r\n		kernel[3] +\r\n		kernel[4] +\r\n		kernel[5] +\r\n		kernel[6] +\r\n		kernel[7] +\r\n		kernel[8];\r\n\r\n	if (kernelWeight <= 0.0) {\r\n		kernelWeight = 1.0;\r\n	}\r\n\r\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\r\n}"):t.h["convolution.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform vec2 screenSize;\r\nuniform float kernel[9];\r\n\r\nvoid main(void)\r\n{\r\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\r\n	vec4 colorSum =\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\r\n\r\n	float kernelWeight =\r\n		kernel[0] +\r\n		kernel[1] +\r\n		kernel[2] +\r\n		kernel[3] +\r\n		kernel[4] +\r\n		kernel[5] +\r\n		kernel[6] +\r\n		kernel[7] +\r\n		kernel[8];\r\n\r\n	if (kernelWeight <= 0.0) {\r\n		kernelWeight = 1.0;\r\n	}\r\n\r\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\r\n}",t.set("default.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_EXPLICIT	0.\r\n#define MAP_SPHERICAL	1.\r\n#define MAP_PLANAR		2.\r\n#define MAP_CUBIC		3.\r\n#define MAP_PROJECTION	4.\r\n#define MAP_SKYBOX		5.\r\n\r\n// Constants\r\nuniform vec3 vEyePosition;\r\nuniform vec3 vAmbientColor;\r\nuniform vec4 vDiffuseColor;\r\nuniform vec4 vSpecularColor;\r\nuniform vec3 vEmissiveColor;\r\n\r\n// Input\r\nvarying vec3 vPositionW;\r\n\r\n#ifdef NORMAL\r\nvarying vec3 vNormalW;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n// Lights\r\n#ifdef LIGHT0\r\nuniform vec4 vLightData0;\r\nuniform vec4 vLightDiffuse0;\r\nuniform vec3 vLightSpecular0;\r\n#ifdef SHADOW0\r\nvarying vec4 vPositionFromLight0;\r\nuniform sampler2D shadowSampler0;\r\nuniform vec3 shadowsInfo0;\r\n#endif\r\n#ifdef SPOTLIGHT0\r\nuniform vec4 vLightDirection0;\r\n#endif\r\n#ifdef HEMILIGHT0\r\nuniform vec3 vLightGround0;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\nuniform vec4 vLightData1;\r\nuniform vec4 vLightDiffuse1;\r\nuniform vec3 vLightSpecular1;\r\n#ifdef SHADOW1\r\nvarying vec4 vPositionFromLight1;\r\nuniform sampler2D shadowSampler1;\r\nuniform vec3 shadowsInfo1;\r\n#endif\r\n#ifdef SPOTLIGHT1\r\nuniform vec4 vLightDirection1;\r\n#endif\r\n#ifdef HEMILIGHT1\r\nuniform vec3 vLightGround1;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\nuniform vec4 vLightData2;\r\nuniform vec4 vLightDiffuse2;\r\nuniform vec3 vLightSpecular2;\r\n#ifdef SHADOW2\r\nvarying vec4 vPositionFromLight2;\r\nuniform sampler2D shadowSampler2;\r\nuniform vec3 shadowsInfo2;\r\n#endif\r\n#ifdef SPOTLIGHT2\r\nuniform vec4 vLightDirection2;\r\n#endif\r\n#ifdef HEMILIGHT2\r\nuniform vec3 vLightGround2;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\nuniform vec4 vLightData3;\r\nuniform vec4 vLightDiffuse3;\r\nuniform vec3 vLightSpecular3;\r\n#ifdef SHADOW3\r\nvarying vec4 vPositionFromLight3;\r\nuniform sampler2D shadowSampler3;\r\nuniform vec3 shadowsInfo3;\r\n#endif\r\n#ifdef SPOTLIGHT3\r\nuniform vec4 vLightDirection3;\r\n#endif\r\n#ifdef HEMILIGHT3\r\nuniform vec3 vLightGround3;\r\n#endif\r\n#endif\r\n\r\n// Samplers\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform sampler2D diffuseSampler;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform sampler2D ambientSampler;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY	\r\nvarying vec2 vOpacityUV;\r\nuniform sampler2D opacitySampler;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform sampler2D emissiveSampler;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform sampler2D specularSampler;\r\n#endif\r\n\r\n// Fresnel\r\n#ifdef FRESNEL\r\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\r\n{\r\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\r\n	return clamp(fresnelTerm, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifdef DIFFUSEFRESNEL\r\nuniform vec4 diffuseLeftColor;\r\nuniform vec4 diffuseRightColor;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\nuniform vec4 opacityParts;\r\n#endif\r\n\r\n#ifdef REFLECTIONFRESNEL\r\nuniform vec4 reflectionLeftColor;\r\nuniform vec4 reflectionRightColor;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\nuniform vec4 emissiveLeftColor;\r\nuniform vec4 emissiveRightColor;\r\n#endif\r\n\r\n// Reflection\r\n#ifdef REFLECTION\r\nvarying vec3 vPositionUVW;\r\nuniform samplerCube reflectionCubeSampler;\r\nuniform sampler2D reflection2DSampler;\r\nuniform vec3 vReflectionInfos;\r\nuniform mat4 reflectionMatrix;\r\nuniform mat4 view;\r\n\r\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\r\n{\r\n	if (mode == MAP_SPHERICAL)\r\n	{\r\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\r\n	}\r\n	else if (mode == MAP_PLANAR)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1));\r\n	}\r\n	else if (mode == MAP_CUBIC)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = reflect(viewDir, worldNormal);\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 0));\r\n	}\r\n	else if (mode == MAP_PROJECTION)\r\n	{\r\n		return vec3(reflectionMatrix * (view * worldPos));\r\n	}\r\n	else if (mode == MAP_SKYBOX)\r\n	{\r\n		return vPositionUVW;\r\n	}\r\n\r\n	return vec3(0, 0, 0);\r\n}\r\n#endif\r\n\r\n// Shadows\r\n#ifdef SHADOWS\r\n\r\nfloat unpack(vec4 color)\r\n{\r\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\r\n	return dot(color, bit_shift);\r\n}\r\n\r\nfloat unpackHalf(vec2 color)\r\n{\r\n	return color.x + (color.y / 255.0);\r\n}\r\n\r\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\r\n\r\n	if (depth.z > shadow)\r\n	{\r\n		return darkness;\r\n	}\r\n	return 1.;\r\n}\r\n\r\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float visibility = 1.;\r\n\r\n	vec2 poissonDisk[4];\r\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\r\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\r\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\r\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\r\n\r\n	// Poisson Sampling\r\n	float biasedDepth = depth.z - bias;\r\n\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n\r\n	return visibility;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nfloat linstep(float low, float high, float v) {\r\n	return clamp((v - low) / (high - low), 0.0, 1.0);\r\n}\r\n\r\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\r\n{\r\n	float p = smoothstep(compare - bias, compare, moments.x);\r\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\r\n	float d = compare - moments.x;\r\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\r\n\r\n	return clamp(max(p, p_max), 0.0, 1.0);\r\n}\r\n\r\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	vec4 texel = texture2D(shadowSampler, uv);\r\n\r\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\r\n	return 1.0 - ChebychevInequality(moments, depth.z, bias);\r\n}\r\n#endif\r\n\r\n// Bump\r\n#ifdef BUMP\r\n#extension GL_OES_standard_derivatives : enable\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform sampler2D bumpSampler;\r\n\r\n// Thanks to http://www.thetenthplanet.de/archives/1180\r\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\r\n{\r\n	// get edge vectors of the pixel triangle\r\n	vec3 dp1 = dFdx(p);\r\nvec3 dp2 = dFdy(p);\r\nvec2 duv1 = dFdx(uv);\r\nvec2 duv2 = dFdy(uv);\r\n\r\n	// solve the linear system\r\n	vec3 dp2perp = cross(dp2, normal);\r\n	vec3 dp1perp = cross(normal, dp1);\r\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\r\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\r\n\r\n	// construct a scale-invariant frame \r\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\r\n	return mat3(tangent * invmax, binormal * invmax, normal);\r\n}\r\n\r\nvec3 perturbNormal(vec3 viewDir)\r\n{\r\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\r\n	map = map * 255. / 127. - 128. / 127.;\r\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\r\n	return normalize(TBN * map);\r\n}\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n// Light Computing\r\nstruct lightingInfo\r\n{\r\n	vec3 diffuse;\r\n	vec3 specular;\r\n};\r\n\r\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range) {\r\n	lightingInfo result;\r\n\r\n	vec3 lightVectorW;\r\n	float attenuation = 1.0;\r\n	if (lightData.w == 0.)\r\n	{\r\n		vec3 direction = lightData.xyz - vPositionW;\r\n\r\n		attenuation = max(0., 1.0 - length(direction) / range);\r\n		lightVectorW = normalize(direction);\r\n	}\r\n	else\r\n	{\r\n		lightVectorW = normalize(-lightData.xyz);\r\n	}\r\n\r\n	// diffuse\r\n	float ndl = max(0., dot(vNormal, lightVectorW));\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, max(1., vSpecularColor.a));\r\n\r\n	result.diffuse = ndl * diffuseColor * attenuation;\r\n	result.specular = specComp * specularColor * attenuation;\r\n\r\n	return result;\r\n}\r\n\r\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range) {\r\n	lightingInfo result;\r\n\r\n	vec3 direction = lightData.xyz - vPositionW;\r\n	vec3 lightVectorW = normalize(direction);\r\n	float attenuation = max(0., 1.0 - length(direction) / range);\r\n\r\n	// diffuse\r\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\r\n	float spotAtten = 0.0;\r\n\r\n	if (cosAngle >= lightDirection.w)\r\n	{\r\n		cosAngle = max(0., pow(cosAngle, lightData.w));\r\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\r\n\r\n		// Diffuse\r\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\r\n\r\n		// Specular\r\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\r\n		float specComp = max(0., dot(vNormal, angleW));\r\n		specComp = pow(specComp, vSpecularColor.a);\r\n\r\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\r\n		result.specular = specComp * specularColor * spotAtten * attenuation;\r\n\r\n		return result;\r\n	}\r\n\r\n	result.diffuse = vec3(0.);\r\n	result.specular = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor) {\r\n	lightingInfo result;\r\n\r\n	// Diffuse\r\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, vSpecularColor.a);\r\n\r\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\r\n	result.specular = specComp * specularColor;\r\n\r\n	return result;\r\n}\r\n\r\nvoid main(void) {\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n\r\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\r\n\r\n	// Base color\r\n	vec4 baseColor = vec4(1., 1., 1., 1.);\r\n	vec3 diffuseColor = vDiffuseColor.rgb;\r\n\r\n	// Alpha\r\n	float alpha = vDiffuseColor.a;\r\n\r\n#ifdef VERTEXCOLOR\r\n	baseColor.rgb *= vColor.rgb;\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\r\n\r\n#ifdef ALPHATEST\r\n	if (baseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n#ifdef ALPHAFROMDIFFUSE\r\n	alpha *= baseColor.a;\r\n#endif\r\n\r\n	baseColor.rgb *= vDiffuseInfos.y;\r\n#endif\r\n\r\n	// Bump\r\n#ifdef NORMAL\r\n	vec3 normalW = normalize(vNormalW);\r\n#else\r\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\r\n#endif\r\n\r\n\r\n#ifdef BUMP\r\n	normalW = perturbNormal(viewDirectionW);\r\n#endif\r\n\r\n\r\n	// Ambient color\r\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\r\n\r\n#ifdef AMBIENT\r\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\r\n#endif\r\n\r\n	// Lighting\r\n	vec3 diffuseBase = vec3(0., 0., 0.);\r\n	vec3 specularBase = vec3(0., 0., 0.);\r\n	float shadow = 1.;\r\n\r\n#ifdef LIGHT0\r\n#ifdef SPOTLIGHT0\r\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\r\n#endif\r\n#ifdef HEMILIGHT0\r\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0);\r\n#endif\r\n#ifdef POINTDIRLIGHT0\r\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a);\r\n#endif\r\n#ifdef SHADOW0\r\n#ifdef SHADOWVSM0\r\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z);\r\n#else\r\n	#ifdef SHADOWPCF0\r\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\r\n	#endif\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT1\r\n#ifdef SPOTLIGHT1\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\r\n#endif\r\n#ifdef HEMILIGHT1\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1);\r\n#endif\r\n#ifdef POINTDIRLIGHT1\r\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a);\r\n#endif\r\n#ifdef SHADOW1\r\n#ifdef SHADOWVSM1\r\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z);\r\n#else\r\n	#ifdef SHADOWPCF1\r\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\r\n	#endif\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT2\r\n#ifdef SPOTLIGHT2\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\r\n#endif\r\n#ifdef HEMILIGHT2\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2);\r\n#endif\r\n#ifdef POINTDIRLIGHT2\r\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a);\r\n#endif\r\n#ifdef SHADOW2\r\n#ifdef SHADOWVSM2\r\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z);\r\n#else\r\n	#ifdef SHADOWPCF2\r\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\r\n	#endif	\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT3\r\n#ifdef SPOTLIGHT3\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\r\n#endif\r\n#ifdef HEMILIGHT3\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3);\r\n#endif\r\n#ifdef POINTDIRLIGHT3\r\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a);\r\n#endif\r\n#ifdef SHADOW3\r\n#ifdef SHADOWVSM3\r\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z);\r\n#else\r\n	#ifdef SHADOWPCF3\r\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\r\n	#endif	\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n\r\n	// Reflection\r\n	vec3 reflectionColor = vec3(0., 0., 0.);\r\n\r\n#ifdef REFLECTION\r\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\r\n\r\n	if (vReflectionInfos.z != 0.0)\r\n	{\r\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y * shadow;\r\n	}\r\n	else\r\n	{\r\n		vec2 coords = vReflectionUVW.xy;\r\n\r\n		if (vReflectionInfos.x == MAP_PROJECTION)\r\n		{\r\n			coords /= vReflectionUVW.z;\r\n		}\r\n\r\n		coords.y = 1.0 - coords.y;\r\n\r\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\r\n	}\r\n\r\n#ifdef REFLECTIONFRESNEL\r\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\r\n\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\r\n\r\n#ifdef OPACITYRGB\r\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\r\n#else\r\n	alpha *= opacityMap.a * vOpacityInfos.y;\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTEXALPHA\r\n	alpha *= vColor.a;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\r\n\r\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\r\n#endif\r\n\r\n	// Emissive\r\n	vec3 emissiveColor = vEmissiveColor;\r\n#ifdef EMISSIVE\r\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\r\n\r\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\r\n#endif\r\n\r\n	// Specular map\r\n	vec3 specularColor = vSpecularColor.rgb;\r\n#ifdef SPECULAR\r\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\r\n#endif\r\n\r\n	// Fresnel\r\n#ifdef DIFFUSEFRESNEL\r\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\r\n\r\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\r\n#endif\r\n\r\n	// Composition\r\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n	vec3 finalSpecular = specularBase * specularColor;\r\n\r\n#ifdef SPECULAROVERALPHA\r\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\r\n#endif\r\n\r\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}"),
null!=Os["default.vertex"]?t.setReserved("default.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n#ifdef NORMAL\r\nattribute vec3 normal;\r\n#endif\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef POINTSIZE\r\nuniform float pointSize;\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\n#ifdef NORMAL\r\nvarying vec3 vNormalW;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vPositionUVW;\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef REFLECTION\r\n	vPositionUVW = position;\r\n#endif \r\n\r\n#ifdef INSTANCES\r\n	finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = finalWorld * (m0 + m1 + m2);\r\n#endif \r\n\r\n#endif\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n\r\n#ifdef NORMAL\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n#endif\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef SPECULAR\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n\r\n	// Point size\r\n#ifdef POINTSIZE\r\n	gl_PointSize = pointSize;\r\n#endif\r\n}"):t.h["default.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n#ifdef NORMAL\r\nattribute vec3 normal;\r\n#endif\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef POINTSIZE\r\nuniform float pointSize;\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\n#ifdef NORMAL\r\nvarying vec3 vNormalW;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vPositionUVW;\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef REFLECTION\r\n	vPositionUVW = position;\r\n#endif \r\n\r\n#ifdef INSTANCES\r\n	finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = finalWorld * (m0 + m1 + m2);\r\n#endif \r\n\r\n#endif\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n\r\n#ifdef NORMAL\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n#endif\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef SPECULAR\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n\r\n	// Point size\r\n#ifdef POINTSIZE\r\n	gl_PointSize = pointSize;\r\n#endif\r\n}",null!=Os["depth.fragment"]?t.setReserved("depth.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nuniform float far;\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\r\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\r\n}"):t.h["depth.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nuniform float far;\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\r\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\r\n}",null!=Os["depth.vertex"]?t.setReserved("depth.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}"):t.h["depth.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",null!=Os["depthBoxBlur.fragment"]?t.setReserved("depthBoxBlur.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\n\r\nvoid main(void)\r\n{\r\n	vec4 colorDepth = vec4(0.0);\r\n\r\n	for (int x = -OFFSET; x <= OFFSET; x++)\r\n		for (int y = -OFFSET; y <= OFFSET; y++)\r\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\r\n\r\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\r\n}"):t.h["depthBoxBlur.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\n\r\nvoid main(void)\r\n{\r\n	vec4 colorDepth = vec4(0.0);\r\n\r\n	for (int x = -OFFSET; x <= OFFSET; x++)\r\n		for (int y = -OFFSET; y <= OFFSET; y++)\r\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\r\n\r\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\r\n}",null!=Os["depthOfField.fragment"]?t.setReserved("depthOfField.fragment",'// BABYLON.JS Depth-of-field GLSL Shader\r\n// Author: Olivier Guyot\r\n// Does depth-of-field blur, edge blur\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D highlightsSampler;\r\nuniform sampler2D depthSampler;\r\nuniform sampler2D grainSampler;\r\n\r\n// uniforms\r\nuniform float grain_amount;\r\nuniform bool blur_noise;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\nuniform float distortion;\r\nuniform bool dof_enabled;\r\n//uniform float focus_distance;		// not needed; already used to compute screen distance\r\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\r\nuniform float aperture;\r\nuniform float darken;\r\nuniform float edge_blur;\r\nuniform bool highlights;\r\n\r\n// preconputed uniforms (not effect parameters)\r\nuniform float near;\r\nuniform float far;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\n#define PI 		3.14159265\r\n#define TWOPI 	6.28318530\r\n#define inverse_focal_length 0.1	// a property of the lens used\r\n\r\n// common calculations\r\nvec2 centered_screen_pos;\r\nvec2 distorted_coords;\r\nfloat radius2;\r\nfloat radius;\r\n\r\n\r\n// on-the-fly constant noise\r\nvec2 rand(vec2 co)\r\n{\r\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\r\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\r\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\r\n}\r\n\r\n// applies edge distortion on texture coords\r\nvec2 getDistortedCoords(vec2 coords) {\r\n\r\n	if (distortion == 0.0) { return coords; }\r\n\r\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\r\n	vec2 dist_coords = vec2(0.5, 0.5);\r\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\r\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\r\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\r\n\r\n	dist_coords = mix(coords, dist_coords, dist_amount);\r\n\r\n	return dist_coords;\r\n}\r\n\r\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\r\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\r\n\r\n	// compute coords with offset (a random angle is added)\r\n	vec2 coords = distorted_coords;\r\n	float angle = rand(coords * 100.0).x * TWOPI;\r\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\r\n\r\n	color += texture2D(textureSampler, coords)*weight;\r\n\r\n	return weight;\r\n}\r\n\r\n// returns blur level according to blur size required\r\nfloat getBlurLevel(float size) {\r\n	return min(3.0, ceil(size / 1.0));\r\n}\r\n\r\n// returns original screen color after blur\r\nvec4 getBlurColor(float size) {\r\n\r\n	vec4 col = texture2D(textureSampler, distorted_coords);\r\n	if (size == 0.0) { return col; }\r\n\r\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\r\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\r\n	float blur_level = getBlurLevel(size);\r\n\r\n	float w = (size / screen_width);\r\n	float h = (size / screen_height);\r\n	float total_weight = 1.0;\r\n	vec2 sample_coords;\r\n\r\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\r\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\r\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\r\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\r\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\r\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\r\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\r\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\r\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\r\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\r\n\r\n	if (blur_level > 1.0) {\r\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\r\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\r\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\r\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\r\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\r\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\r\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\r\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\r\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\r\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\r\n	}\r\n\r\n	if (blur_level > 2.0) {\r\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\r\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\r\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\r\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\r\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\r\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\r\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\r\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\r\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\r\n	}\r\n\r\n	col /= total_weight;		// scales color according to weights\r\n\r\n								// darken if out of focus\r\n	if (darken > 0.0) {\r\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\r\n	}\r\n\r\n	// blur levels debug\r\n	// if(blur_level == 1.0) { col.b *= 0.5; }\r\n	// if(blur_level == 2.0) { col.r *= 0.5; }\r\n	// if(blur_level == 3.0) { col.g *= 0.5; }\r\n\r\n	return col;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n\r\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\r\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\r\n	radius = sqrt(radius2);\r\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens "magnifying" effect)\r\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\r\n\r\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\r\n	float distance = near + (far - near)*depth;		// actual distance from the lens\r\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\r\n\r\n\r\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\r\n													// screen_distance is precomputed in code\r\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\r\n\r\n	// disable blur\r\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\r\n\r\n	// blur from edge blur effect\r\n	float edge_blur_amount = 0.0;\r\n	if (edge_blur > 0.0) {\r\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\r\n	}\r\n\r\n	// total blur amount\r\n	float blur_amount = max(edge_blur_amount, coc);\r\n\r\n	// apply blur if necessary\r\n	if (blur_amount == 0.0) {\r\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\r\n	}\r\n	else {\r\n\r\n		// add blurred color\r\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\r\n\r\n		// if we have computed highlights: enhance highlights\r\n		if (highlights) {\r\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\r\n		}\r\n\r\n		if (blur_noise) {\r\n			// we put a slight amount of noise in the blurred color\r\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\r\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\r\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\r\n		}\r\n	}\r\n\r\n\r\n	// apply grain\r\n	if (grain_amount > 0.0) {\r\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\r\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\r\n	}\r\n\r\n}\r\n'):t.h["depthOfField.fragment"]='// BABYLON.JS Depth-of-field GLSL Shader\r\n// Author: Olivier Guyot\r\n// Does depth-of-field blur, edge blur\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D highlightsSampler;\r\nuniform sampler2D depthSampler;\r\nuniform sampler2D grainSampler;\r\n\r\n// uniforms\r\nuniform float grain_amount;\r\nuniform bool blur_noise;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\nuniform float distortion;\r\nuniform bool dof_enabled;\r\n//uniform float focus_distance;		// not needed; already used to compute screen distance\r\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\r\nuniform float aperture;\r\nuniform float darken;\r\nuniform float edge_blur;\r\nuniform bool highlights;\r\n\r\n// preconputed uniforms (not effect parameters)\r\nuniform float near;\r\nuniform float far;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\n#define PI 		3.14159265\r\n#define TWOPI 	6.28318530\r\n#define inverse_focal_length 0.1	// a property of the lens used\r\n\r\n// common calculations\r\nvec2 centered_screen_pos;\r\nvec2 distorted_coords;\r\nfloat radius2;\r\nfloat radius;\r\n\r\n\r\n// on-the-fly constant noise\r\nvec2 rand(vec2 co)\r\n{\r\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\r\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\r\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\r\n}\r\n\r\n// applies edge distortion on texture coords\r\nvec2 getDistortedCoords(vec2 coords) {\r\n\r\n	if (distortion == 0.0) { return coords; }\r\n\r\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\r\n	vec2 dist_coords = vec2(0.5, 0.5);\r\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\r\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\r\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\r\n\r\n	dist_coords = mix(coords, dist_coords, dist_amount);\r\n\r\n	return dist_coords;\r\n}\r\n\r\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\r\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\r\n\r\n	// compute coords with offset (a random angle is added)\r\n	vec2 coords = distorted_coords;\r\n	float angle = rand(coords * 100.0).x * TWOPI;\r\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\r\n\r\n	color += texture2D(textureSampler, coords)*weight;\r\n\r\n	return weight;\r\n}\r\n\r\n// returns blur level according to blur size required\r\nfloat getBlurLevel(float size) {\r\n	return min(3.0, ceil(size / 1.0));\r\n}\r\n\r\n// returns original screen color after blur\r\nvec4 getBlurColor(float size) {\r\n\r\n	vec4 col = texture2D(textureSampler, distorted_coords);\r\n	if (size == 0.0) { return col; }\r\n\r\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\r\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\r\n	float blur_level = getBlurLevel(size);\r\n\r\n	float w = (size / screen_width);\r\n	float h = (size / screen_height);\r\n	float total_weight = 1.0;\r\n	vec2 sample_coords;\r\n\r\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\r\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\r\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\r\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\r\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\r\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\r\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\r\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\r\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\r\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\r\n\r\n	if (blur_level > 1.0) {\r\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\r\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\r\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\r\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\r\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\r\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\r\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\r\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\r\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\r\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\r\n	}\r\n\r\n	if (blur_level > 2.0) {\r\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\r\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\r\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\r\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\r\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\r\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\r\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\r\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\r\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\r\n	}\r\n\r\n	col /= total_weight;		// scales color according to weights\r\n\r\n								// darken if out of focus\r\n	if (darken > 0.0) {\r\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\r\n	}\r\n\r\n	// blur levels debug\r\n	// if(blur_level == 1.0) { col.b *= 0.5; }\r\n	// if(blur_level == 2.0) { col.r *= 0.5; }\r\n	// if(blur_level == 3.0) { col.g *= 0.5; }\r\n\r\n	return col;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n\r\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\r\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\r\n	radius = sqrt(radius2);\r\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens "magnifying" effect)\r\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\r\n\r\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\r\n	float distance = near + (far - near)*depth;		// actual distance from the lens\r\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\r\n\r\n\r\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\r\n													// screen_distance is precomputed in code\r\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\r\n\r\n	// disable blur\r\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\r\n\r\n	// blur from edge blur effect\r\n	float edge_blur_amount = 0.0;\r\n	if (edge_blur > 0.0) {\r\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\r\n	}\r\n\r\n	// total blur amount\r\n	float blur_amount = max(edge_blur_amount, coc);\r\n\r\n	// apply blur if necessary\r\n	if (blur_amount == 0.0) {\r\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\r\n	}\r\n	else {\r\n\r\n		// add blurred color\r\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\r\n\r\n		// if we have computed highlights: enhance highlights\r\n		if (highlights) {\r\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\r\n		}\r\n\r\n		if (blur_noise) {\r\n			// we put a slight amount of noise in the blurred color\r\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\r\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\r\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\r\n		}\r\n	}\r\n\r\n\r\n	// apply grain\r\n	if (grain_amount > 0.0) {\r\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\r\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\r\n	}\r\n\r\n}\r\n',
null!=Os["displayPass.fragment"]?t.setReserved("displayPass.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D passSampler;\r\n\r\nvoid main(void)\r\n{\r\n    gl_FragColor = texture2D(passSampler, vUV);\r\n}"):t.h["displayPass.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D passSampler;\r\n\r\nvoid main(void)\r\n{\r\n    gl_FragColor = texture2D(passSampler, vUV);\r\n}",null!=Os["filter.fragment"]?t.setReserved("filter.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform mat4 kernelMatrix;\r\n\r\nvoid main(void)\r\n{\r\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\r\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\r\n\r\n	gl_FragColor = vec4(updatedColor, 1.0);\r\n}"):t.h["filter.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform mat4 kernelMatrix;\r\n\r\nvoid main(void)\r\n{\r\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\r\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\r\n\r\n	gl_FragColor = vec4(updatedColor, 1.0);\r\n}",null!=Os["fire.fragment"]?t.setReserved("fire.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform float time;\r\nuniform vec3 c1;\r\nuniform vec3 c2;\r\nuniform vec3 c3;\r\nuniform vec3 c4;\r\nuniform vec3 c5;\r\nuniform vec3 c6;\r\nuniform vec2 speed;\r\nuniform float shift;\r\nuniform float alphaThreshold;\r\n\r\nvarying vec2 vUV;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n	vec2 p = vUV * 8.0;\r\n	float q = fbm(p - time * 0.1);\r\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\r\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\r\n	vec3 color = c * cos(shift * vUV.y);\r\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\r\n\r\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\r\n}"):t.h["fire.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform float time;\r\nuniform vec3 c1;\r\nuniform vec3 c2;\r\nuniform vec3 c3;\r\nuniform vec3 c4;\r\nuniform vec3 c5;\r\nuniform vec3 c6;\r\nuniform vec2 speed;\r\nuniform float shift;\r\nuniform float alphaThreshold;\r\n\r\nvarying vec2 vUV;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n	vec2 p = vUV * 8.0;\r\n	float q = fbm(p - time * 0.1);\r\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\r\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\r\n	vec3 color = c * cos(shift * vUV.y);\r\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\r\n\r\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\r\n}",null!=Os["fxaa.fragment"]?t.setReserved("fxaa.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define FXAA_REDUCE_MIN   (1.0/128.0)\r\n#define FXAA_REDUCE_MUL   (1.0/8.0)\r\n#define FXAA_SPAN_MAX     8.0\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 texelSize;\r\n\r\nvoid main(){\r\n	vec2 localTexelSize = texelSize;\r\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\r\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\r\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\r\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\r\n	vec4 rgbM = texture2D(textureSampler, vUV);\r\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\r\n	float lumaNW = dot(rgbNW, luma);\r\n	float lumaNE = dot(rgbNE, luma);\r\n	float lumaSW = dot(rgbSW, luma);\r\n	float lumaSE = dot(rgbSE, luma);\r\n	float lumaM = dot(rgbM, luma);\r\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\r\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\r\n\r\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\r\n\r\n	float dirReduce = max(\r\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\r\n		FXAA_REDUCE_MIN);\r\n\r\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\r\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\r\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\r\n		dir * rcpDirMin)) * localTexelSize;\r\n\r\n	vec4 rgbA = 0.5 * (\r\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\r\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\r\n\r\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\r\n		texture2D(textureSampler, vUV + dir *  -0.5) +\r\n		texture2D(textureSampler, vUV + dir * 0.5));\r\n	float lumaB = dot(rgbB, luma);\r\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\r\n		gl_FragColor = rgbA;\r\n	}\r\n	else {\r\n		gl_FragColor = rgbB;\r\n	}\r\n}"):t.h["fxaa.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define FXAA_REDUCE_MIN   (1.0/128.0)\r\n#define FXAA_REDUCE_MUL   (1.0/8.0)\r\n#define FXAA_SPAN_MAX     8.0\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 texelSize;\r\n\r\nvoid main(){\r\n	vec2 localTexelSize = texelSize;\r\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\r\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\r\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\r\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\r\n	vec4 rgbM = texture2D(textureSampler, vUV);\r\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\r\n	float lumaNW = dot(rgbNW, luma);\r\n	float lumaNE = dot(rgbNE, luma);\r\n	float lumaSW = dot(rgbSW, luma);\r\n	float lumaSE = dot(rgbSE, luma);\r\n	float lumaM = dot(rgbM, luma);\r\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\r\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\r\n\r\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\r\n\r\n	float dirReduce = max(\r\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\r\n		FXAA_REDUCE_MIN);\r\n\r\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\r\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\r\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\r\n		dir * rcpDirMin)) * localTexelSize;\r\n\r\n	vec4 rgbA = 0.5 * (\r\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\r\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\r\n\r\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\r\n		texture2D(textureSampler, vUV + dir *  -0.5) +\r\n		texture2D(textureSampler, vUV + dir * 0.5));\r\n	float lumaB = dot(rgbB, luma);\r\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\r\n		gl_FragColor = rgbA;\r\n	}\r\n	else {\r\n		gl_FragColor = rgbB;\r\n	}\r\n}",null!=Os["grass.fragment"]?t.setReserved("grass.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform vec3 herb1Color;\r\nuniform vec3 herb2Color;\r\nuniform vec3 herb3Color;\r\nuniform vec3 groundColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\r\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\r\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\r\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\r\n	gl_FragColor = vec4(color, 1.0);\r\n}"):t.h["grass.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform vec3 herb1Color;\r\nuniform vec3 herb2Color;\r\nuniform vec3 herb3Color;\r\nuniform vec3 groundColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\r\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\r\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\r\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",null!=Os["layer.fragment"]?t.setReserved("layer.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}"):t.h["layer.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}",null!=Os["layer.vertex"]?t.setReserved("layer.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 textureMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}"):t.h["layer.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 textureMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",null!=Os["legacydefault.fragment"]?t.setReserved("legacydefault.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_PROJECTION	4.\r\n\r\n// Constants\r\nuniform vec3 vEyePosition;\r\nuniform vec3 vAmbientColor;\r\nuniform vec4 vDiffuseColor;\r\nuniform vec4 vSpecularColor;\r\nuniform vec3 vEmissiveColor;\r\n\r\n// Input\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n// Lights\r\n#ifdef LIGHT0\r\nuniform vec4 vLightData0;\r\nuniform vec4 vLightDiffuse0;\r\nuniform vec3 vLightSpecular0;\r\n#ifdef SHADOW0\r\nvarying vec4 vPositionFromLight0;\r\nuniform sampler2D shadowSampler0;\r\n#endif\r\n#ifdef SPOTLIGHT0\r\nuniform vec4 vLightDirection0;\r\n#endif\r\n#ifdef HEMILIGHT0\r\nuniform vec3 vLightGround0;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\nuniform vec4 vLightData1;\r\nuniform vec4 vLightDiffuse1;\r\nuniform vec3 vLightSpecular1;\r\n#ifdef SHADOW1\r\nvarying vec4 vPositionFromLight1;\r\nuniform sampler2D shadowSampler1;\r\n#endif\r\n#ifdef SPOTLIGHT1\r\nuniform vec4 vLightDirection1;\r\n#endif\r\n#ifdef HEMILIGHT1\r\nuniform vec3 vLightGround1;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\nuniform vec4 vLightData2;\r\nuniform vec4 vLightDiffuse2;\r\nuniform vec3 vLightSpecular2;\r\n#ifdef SHADOW2\r\nvarying vec4 vPositionFromLight2;\r\nuniform sampler2D shadowSampler2;\r\n#endif\r\n#ifdef SPOTLIGHT2\r\nuniform vec4 vLightDirection2;\r\n#endif\r\n#ifdef HEMILIGHT2\r\nuniform vec3 vLightGround2;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\nuniform vec4 vLightData3;\r\nuniform vec4 vLightDiffuse3;\r\nuniform vec3 vLightSpecular3;\r\n#ifdef SHADOW3\r\nvarying vec4 vPositionFromLight3;\r\nuniform sampler2D shadowSampler3;\r\n#endif\r\n#ifdef SPOTLIGHT3\r\nuniform vec4 vLightDirection3;\r\n#endif\r\n#ifdef HEMILIGHT3\r\nuniform vec3 vLightGround3;\r\n#endif\r\n#endif\r\n\r\n// Samplers\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform sampler2D diffuseSampler;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform sampler2D ambientSampler;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY	\r\nvarying vec2 vOpacityUV;\r\nuniform sampler2D opacitySampler;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vReflectionUVW;\r\nuniform samplerCube reflectionCubeSampler;\r\nuniform sampler2D reflection2DSampler;\r\nuniform vec3 vReflectionInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform sampler2D emissiveSampler;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform sampler2D specularSampler;\r\n#endif\r\n\r\n// Fresnel\r\n#ifdef FRESNEL\r\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\r\n{\r\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\r\n	return clamp(fresnelTerm, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifdef DIFFUSEFRESNEL\r\nuniform vec4 diffuseLeftColor;\r\nuniform vec4 diffuseRightColor;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\nuniform vec4 opacityParts;\r\n#endif\r\n\r\n#ifdef REFLECTIONFRESNEL\r\nuniform vec4 reflectionLeftColor;\r\nuniform vec4 reflectionRightColor;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\nuniform vec4 emissiveLeftColor;\r\nuniform vec4 emissiveRightColor;\r\n#endif\r\n\r\n// Shadows\r\n#ifdef SHADOWS\r\n\r\nfloat unpack(vec4 color)\r\n{\r\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\r\n	return dot(color, bitShift);\r\n}\r\n\r\nfloat unpackHalf(vec2 color)\r\n{\r\n	return color.x + (color.y / 255.0);\r\n}\r\n\r\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float shadow = unpack(texture2D(shadowSampler, uv));\r\n\r\n	if (depth.z > shadow)\r\n	{\r\n		return 0.;\r\n	}\r\n	return 1.;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nfloat ChebychevInequality(vec2 moments, float t)\r\n{\r\n	if (t <= moments.x)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float variance = moments.y - (moments.x * moments.x);\r\n	variance = max(variance, 0.);\r\n\r\n	float d = t - moments.x;\r\n	return variance / (variance + d * d);\r\n}\r\n\r\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	vec4 texel = texture2D(shadowSampler, uv);\r\n\r\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\r\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\r\n}\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n// Light Computing\r\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW;\r\n	if (lightData.w == 0.)\r\n	{\r\n		lightVectorW = normalize(lightData.xyz - vPositionW);\r\n	}\r\n	else\r\n	{\r\n		lightVectorW = normalize(-lightData.xyz);\r\n	}\r\n\r\n	// diffuse\r\n	float ndl = max(0., dot(vNormal, lightVectorW));\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\r\n\r\n	result[0] = ndl * diffuseColor.rgb;\r\n	result[1] = specComp * specularColor;\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\r\n\r\n	// diffuse\r\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\r\n	float spotAtten = 0.0;\r\n\r\n	if (cosAngle >= lightDirection.w)\r\n	{\r\n		cosAngle = max(0., pow(cosAngle, lightData.w));\r\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\r\n\r\n		// Diffuse\r\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\r\n\r\n		// Specular\r\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\r\n		float specComp = max(0., dot(vNormal, angleW));\r\n		specComp = pow(specComp, vSpecularColor.a);\r\n\r\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\r\n		result[1] = specComp * specularColor * spotAtten;\r\n		result[2] = vec3(0.);\r\n\r\n		return result;\r\n	}\r\n\r\n	result[0] = vec3(0.);\r\n	result[1] = vec3(0.);\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\r\n	mat3 result;\r\n\r\n	// Diffuse\r\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, vSpecularColor.a);\r\n\r\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\r\n	result[1] = specComp * specularColor;\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nvoid main(void) {\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n\r\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\r\n\r\n	// Base color\r\n	vec4 baseColor = vec4(1., 1., 1., 1.);\r\n	vec3 diffuseColor = vDiffuseColor.rgb;\r\n\r\n#ifdef VERTEXCOLOR\r\n	baseColor.rgb *= vColor.rgb;\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\r\n\r\n#ifdef ALPHATEST\r\n	if (baseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	baseColor.rgb *= vDiffuseInfos.y;\r\n#endif\r\n\r\n	// Bump\r\n	vec3 normalW = normalize(vNormalW);\r\n\r\n	// Ambient color\r\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\r\n\r\n#ifdef AMBIENT\r\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\r\n#endif\r\n\r\n	// Lighting\r\n	vec3 diffuseBase = vec3(0., 0., 0.);\r\n	vec3 specularBase = vec3(0., 0., 0.);\r\n	float shadow = 1.;\r\n\r\n#ifdef LIGHT0\r\n#ifdef SPOTLIGHT0\r\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef HEMILIGHT0\r\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\r\n#endif\r\n#ifdef POINTDIRLIGHT0\r\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef SHADOW0\r\n#ifdef SHADOWVSM0\r\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT1\r\n#ifdef SPOTLIGHT1\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef HEMILIGHT1\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\r\n#endif\r\n#ifdef POINTDIRLIGHT1\r\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef SHADOW1\r\n#ifdef SHADOWVSM1\r\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT2\r\n#ifdef SPOTLIGHT2\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef HEMILIGHT2\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\r\n#endif\r\n#ifdef POINTDIRLIGHT2\r\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef SHADOW2\r\n#ifdef SHADOWVSM2\r\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT3\r\n#ifdef SPOTLIGHT3\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef HEMILIGHT3\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\r\n#endif\r\n#ifdef POINTDIRLIGHT3\r\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef SHADOW3\r\n#ifdef SHADOWVSM3\r\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n	// Reflection\r\n	vec3 reflectionColor = vec3(0., 0., 0.);\r\n\r\n#ifdef REFLECTION\r\n	if (vReflectionInfos.z != 0.0)\r\n	{\r\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\r\n	}\r\n	else\r\n	{\r\n		vec2 coords = vReflectionUVW.xy;\r\n\r\n		if (vReflectionInfos.x == MAP_PROJECTION)\r\n		{\r\n			coords /= vReflectionUVW.z;\r\n		}\r\n\r\n		coords.y = 1.0 - coords.y;\r\n\r\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\r\n	}\r\n\r\n#ifdef REFLECTIONFRESNEL\r\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\r\n\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#endif\r\n\r\n	// Alpha\r\n	float alpha = vDiffuseColor.a;\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\r\n#ifdef OPACITYRGB\r\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\r\n#else\r\n	alpha *= opacityMap.a * vOpacityInfos.y;\r\n#endif\r\n#endif\r\n\r\n#ifdef VERTEXALPHA\r\n	alpha *= vColor.a;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\r\n\r\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\r\n#endif\r\n\r\n	// Emissive\r\n	vec3 emissiveColor = vEmissiveColor;\r\n#ifdef EMISSIVE\r\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\r\n\r\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\r\n#endif\r\n\r\n	// Specular map\r\n	vec3 specularColor = vSpecularColor.rgb;\r\n#ifdef SPECULAR\r\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\r\n#endif\r\n\r\n	// Fresnel\r\n#ifdef DIFFUSEFRESNEL\r\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\r\n\r\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\r\n#endif\r\n\r\n	// Composition\r\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n	vec3 finalSpecular = specularBase * specularColor;\r\n\r\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}"):t.h["legacydefault.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_PROJECTION	4.\r\n\r\n// Constants\r\nuniform vec3 vEyePosition;\r\nuniform vec3 vAmbientColor;\r\nuniform vec4 vDiffuseColor;\r\nuniform vec4 vSpecularColor;\r\nuniform vec3 vEmissiveColor;\r\n\r\n// Input\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n// Lights\r\n#ifdef LIGHT0\r\nuniform vec4 vLightData0;\r\nuniform vec4 vLightDiffuse0;\r\nuniform vec3 vLightSpecular0;\r\n#ifdef SHADOW0\r\nvarying vec4 vPositionFromLight0;\r\nuniform sampler2D shadowSampler0;\r\n#endif\r\n#ifdef SPOTLIGHT0\r\nuniform vec4 vLightDirection0;\r\n#endif\r\n#ifdef HEMILIGHT0\r\nuniform vec3 vLightGround0;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\nuniform vec4 vLightData1;\r\nuniform vec4 vLightDiffuse1;\r\nuniform vec3 vLightSpecular1;\r\n#ifdef SHADOW1\r\nvarying vec4 vPositionFromLight1;\r\nuniform sampler2D shadowSampler1;\r\n#endif\r\n#ifdef SPOTLIGHT1\r\nuniform vec4 vLightDirection1;\r\n#endif\r\n#ifdef HEMILIGHT1\r\nuniform vec3 vLightGround1;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\nuniform vec4 vLightData2;\r\nuniform vec4 vLightDiffuse2;\r\nuniform vec3 vLightSpecular2;\r\n#ifdef SHADOW2\r\nvarying vec4 vPositionFromLight2;\r\nuniform sampler2D shadowSampler2;\r\n#endif\r\n#ifdef SPOTLIGHT2\r\nuniform vec4 vLightDirection2;\r\n#endif\r\n#ifdef HEMILIGHT2\r\nuniform vec3 vLightGround2;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\nuniform vec4 vLightData3;\r\nuniform vec4 vLightDiffuse3;\r\nuniform vec3 vLightSpecular3;\r\n#ifdef SHADOW3\r\nvarying vec4 vPositionFromLight3;\r\nuniform sampler2D shadowSampler3;\r\n#endif\r\n#ifdef SPOTLIGHT3\r\nuniform vec4 vLightDirection3;\r\n#endif\r\n#ifdef HEMILIGHT3\r\nuniform vec3 vLightGround3;\r\n#endif\r\n#endif\r\n\r\n// Samplers\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform sampler2D diffuseSampler;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform sampler2D ambientSampler;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY	\r\nvarying vec2 vOpacityUV;\r\nuniform sampler2D opacitySampler;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vReflectionUVW;\r\nuniform samplerCube reflectionCubeSampler;\r\nuniform sampler2D reflection2DSampler;\r\nuniform vec3 vReflectionInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform sampler2D emissiveSampler;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform sampler2D specularSampler;\r\n#endif\r\n\r\n// Fresnel\r\n#ifdef FRESNEL\r\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\r\n{\r\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\r\n	return clamp(fresnelTerm, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifdef DIFFUSEFRESNEL\r\nuniform vec4 diffuseLeftColor;\r\nuniform vec4 diffuseRightColor;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\nuniform vec4 opacityParts;\r\n#endif\r\n\r\n#ifdef REFLECTIONFRESNEL\r\nuniform vec4 reflectionLeftColor;\r\nuniform vec4 reflectionRightColor;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\nuniform vec4 emissiveLeftColor;\r\nuniform vec4 emissiveRightColor;\r\n#endif\r\n\r\n// Shadows\r\n#ifdef SHADOWS\r\n\r\nfloat unpack(vec4 color)\r\n{\r\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\r\n	return dot(color, bitShift);\r\n}\r\n\r\nfloat unpackHalf(vec2 color)\r\n{\r\n	return color.x + (color.y / 255.0);\r\n}\r\n\r\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float shadow = unpack(texture2D(shadowSampler, uv));\r\n\r\n	if (depth.z > shadow)\r\n	{\r\n		return 0.;\r\n	}\r\n	return 1.;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nfloat ChebychevInequality(vec2 moments, float t)\r\n{\r\n	if (t <= moments.x)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float variance = moments.y - (moments.x * moments.x);\r\n	variance = max(variance, 0.);\r\n\r\n	float d = t - moments.x;\r\n	return variance / (variance + d * d);\r\n}\r\n\r\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	vec4 texel = texture2D(shadowSampler, uv);\r\n\r\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\r\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\r\n}\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n// Light Computing\r\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW;\r\n	if (lightData.w == 0.)\r\n	{\r\n		lightVectorW = normalize(lightData.xyz - vPositionW);\r\n	}\r\n	else\r\n	{\r\n		lightVectorW = normalize(-lightData.xyz);\r\n	}\r\n\r\n	// diffuse\r\n	float ndl = max(0., dot(vNormal, lightVectorW));\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\r\n\r\n	result[0] = ndl * diffuseColor.rgb;\r\n	result[1] = specComp * specularColor;\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\r\n\r\n	// diffuse\r\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\r\n	float spotAtten = 0.0;\r\n\r\n	if (cosAngle >= lightDirection.w)\r\n	{\r\n		cosAngle = max(0., pow(cosAngle, lightData.w));\r\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\r\n\r\n		// Diffuse\r\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\r\n\r\n		// Specular\r\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\r\n		float specComp = max(0., dot(vNormal, angleW));\r\n		specComp = pow(specComp, vSpecularColor.a);\r\n\r\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\r\n		result[1] = specComp * specularColor * spotAtten;\r\n		result[2] = vec3(0.);\r\n\r\n		return result;\r\n	}\r\n\r\n	result[0] = vec3(0.);\r\n	result[1] = vec3(0.);\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\r\n	mat3 result;\r\n\r\n	// Diffuse\r\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\r\n\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, vSpecularColor.a);\r\n\r\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\r\n	result[1] = specComp * specularColor;\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nvoid main(void) {\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n\r\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\r\n\r\n	// Base color\r\n	vec4 baseColor = vec4(1., 1., 1., 1.);\r\n	vec3 diffuseColor = vDiffuseColor.rgb;\r\n\r\n#ifdef VERTEXCOLOR\r\n	baseColor.rgb *= vColor.rgb;\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\r\n\r\n#ifdef ALPHATEST\r\n	if (baseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	baseColor.rgb *= vDiffuseInfos.y;\r\n#endif\r\n\r\n	// Bump\r\n	vec3 normalW = normalize(vNormalW);\r\n\r\n	// Ambient color\r\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\r\n\r\n#ifdef AMBIENT\r\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\r\n#endif\r\n\r\n	// Lighting\r\n	vec3 diffuseBase = vec3(0., 0., 0.);\r\n	vec3 specularBase = vec3(0., 0., 0.);\r\n	float shadow = 1.;\r\n\r\n#ifdef LIGHT0\r\n#ifdef SPOTLIGHT0\r\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef HEMILIGHT0\r\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\r\n#endif\r\n#ifdef POINTDIRLIGHT0\r\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef SHADOW0\r\n#ifdef SHADOWVSM0\r\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT1\r\n#ifdef SPOTLIGHT1\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef HEMILIGHT1\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\r\n#endif\r\n#ifdef POINTDIRLIGHT1\r\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef SHADOW1\r\n#ifdef SHADOWVSM1\r\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT2\r\n#ifdef SPOTLIGHT2\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef HEMILIGHT2\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\r\n#endif\r\n#ifdef POINTDIRLIGHT2\r\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef SHADOW2\r\n#ifdef SHADOWVSM2\r\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n#ifdef LIGHT3\r\n#ifdef SPOTLIGHT3\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef HEMILIGHT3\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\r\n#endif\r\n#ifdef POINTDIRLIGHT3\r\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef SHADOW3\r\n#ifdef SHADOWVSM3\r\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n\r\n	// Reflection\r\n	vec3 reflectionColor = vec3(0., 0., 0.);\r\n\r\n#ifdef REFLECTION\r\n	if (vReflectionInfos.z != 0.0)\r\n	{\r\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\r\n	}\r\n	else\r\n	{\r\n		vec2 coords = vReflectionUVW.xy;\r\n\r\n		if (vReflectionInfos.x == MAP_PROJECTION)\r\n		{\r\n			coords /= vReflectionUVW.z;\r\n		}\r\n\r\n		coords.y = 1.0 - coords.y;\r\n\r\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\r\n	}\r\n\r\n#ifdef REFLECTIONFRESNEL\r\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\r\n\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#endif\r\n\r\n	// Alpha\r\n	float alpha = vDiffuseColor.a;\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\r\n#ifdef OPACITYRGB\r\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\r\n#else\r\n	alpha *= opacityMap.a * vOpacityInfos.y;\r\n#endif\r\n#endif\r\n\r\n#ifdef VERTEXALPHA\r\n	alpha *= vColor.a;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\r\n\r\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\r\n#endif\r\n\r\n	// Emissive\r\n	vec3 emissiveColor = vEmissiveColor;\r\n#ifdef EMISSIVE\r\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\r\n\r\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\r\n#endif\r\n\r\n	// Specular map\r\n	vec3 specularColor = vSpecularColor.rgb;\r\n#ifdef SPECULAR\r\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\r\n#endif\r\n\r\n	// Fresnel\r\n#ifdef DIFFUSEFRESNEL\r\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\r\n\r\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\r\n#endif\r\n\r\n	// Composition\r\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n	vec3 finalSpecular = specularBase * specularColor;\r\n\r\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}",
null!=Os["legacydefault.vertex"]?t.setReserved("legacydefault.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_EXPLICIT	0.\r\n#define MAP_SPHERICAL	1.\r\n#define MAP_PLANAR		2.\r\n#define MAP_CUBIC		3.\r\n#define MAP_PROJECTION	4.\r\n#define MAP_SKYBOX		5.\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\nuniform mat4 world;\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nuniform vec3 vEyePosition;\r\nvarying vec3 vReflectionUVW;\r\nuniform vec3 vReflectionInfos;\r\nuniform mat4 reflectionMatrix;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\r\n{\r\n	if (mode == MAP_SPHERICAL)\r\n	{\r\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\r\n	}\r\n	else if (mode == MAP_PLANAR)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1));\r\n	}\r\n	else if (mode == MAP_CUBIC)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = reflect(viewDir, worldNormal);\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 0));\r\n	}\r\n	else if (mode == MAP_PROJECTION)\r\n	{\r\n		return vec3(reflectionMatrix * (view * worldPos));\r\n	}\r\n	else if (mode == MAP_SKYBOX)\r\n	{\r\n		return position;\r\n	}\r\n\r\n	return vec3(0, 0, 0);\r\n}\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = world * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = world * (m0 + m1 + m2);\r\n#endif \r\n\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef REFLECTION\r\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef SPECULAR\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n}"):t.h["legacydefault.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_EXPLICIT	0.\r\n#define MAP_SPHERICAL	1.\r\n#define MAP_PLANAR		2.\r\n#define MAP_CUBIC		3.\r\n#define MAP_PROJECTION	4.\r\n#define MAP_SKYBOX		5.\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\nuniform mat4 world;\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nuniform vec3 vEyePosition;\r\nvarying vec3 vReflectionUVW;\r\nuniform vec3 vReflectionInfos;\r\nuniform mat4 reflectionMatrix;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\r\n{\r\n	if (mode == MAP_SPHERICAL)\r\n	{\r\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\r\n	}\r\n	else if (mode == MAP_PLANAR)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1));\r\n	}\r\n	else if (mode == MAP_CUBIC)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = reflect(viewDir, worldNormal);\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 0));\r\n	}\r\n	else if (mode == MAP_PROJECTION)\r\n	{\r\n		return vec3(reflectionMatrix * (view * worldPos));\r\n	}\r\n	else if (mode == MAP_SKYBOX)\r\n	{\r\n		return position;\r\n	}\r\n\r\n	return vec3(0, 0, 0);\r\n}\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = world * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = world * (m0 + m1 + m2);\r\n#endif \r\n\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef REFLECTION\r\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef SPECULAR\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n}",null!=Os["lensFlare.fragment"]?t.setReserved("lensFlare.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}"):t.h["lensFlare.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}",null!=Os["lensFlare.vertex"]?t.setReserved("lensFlare.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 viewportMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\r\n}"):t.h["lensFlare.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 viewportMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\r\n}",null!=Os["lensHighlights.fragment"]?t.setReserved("lensHighlights.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float gain;\r\nuniform float threshold;\r\nuniform bool pentagon;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// apply luminance filter\r\nvec4 highlightColor(vec4 color) {\r\n	vec4 highlight = color;\r\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\r\n	float lum_threshold;\r\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\r\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\r\n\r\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\r\n\r\n	highlight *= luminance * gain;\r\n	highlight.a = 1.0;\r\n\r\n	return highlight;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	// quick exit if no highlight computing\r\n	if (gain == -1.0) {\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n		return;\r\n	}\r\n\r\n	float w = 2.0 / screen_width;\r\n	float h = 2.0 / screen_height;\r\n\r\n	float weight = 1.0;\r\n\r\n	// compute blurred color\r\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	if (pentagon) {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\r\n	}\r\n	else {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\r\n	}\r\n\r\n	blurred /= 39.0;\r\n\r\n	gl_FragColor = blurred;\r\n\r\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\r\n}"):t.h["lensHighlights.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float gain;\r\nuniform float threshold;\r\nuniform bool pentagon;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// apply luminance filter\r\nvec4 highlightColor(vec4 color) {\r\n	vec4 highlight = color;\r\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\r\n	float lum_threshold;\r\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\r\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\r\n\r\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\r\n\r\n	highlight *= luminance * gain;\r\n	highlight.a = 1.0;\r\n\r\n	return highlight;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	// quick exit if no highlight computing\r\n	if (gain == -1.0) {\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n		return;\r\n	}\r\n\r\n	float w = 2.0 / screen_width;\r\n	float h = 2.0 / screen_height;\r\n\r\n	float weight = 1.0;\r\n\r\n	// compute blurred color\r\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	if (pentagon) {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\r\n	}\r\n	else {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\r\n	}\r\n\r\n	blurred /= 39.0;\r\n\r\n	gl_FragColor = blurred;\r\n\r\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\r\n}",null!=Os["marble.fragment"]?t.setReserved("marble.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfTilesHeight;\r\nuniform float numberOfTilesWidth;\r\nuniform float amplitude;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\r\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat turbulence(vec2 P)\r\n{\r\n	float val = 0.0;\r\n	float freq = 1.0;\r\n	for (int i = 0; i < 4; i++)\r\n	{\r\n		val += abs(noise(P*freq) / freq);\r\n		freq *= 2.07;\r\n	}\r\n	return val;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvec3 marble_color(float x)\r\n{\r\n	vec3 col;\r\n	x = 0.5*(x + 1.);\r\n	x = sqrt(x);             \r\n	x = sqrt(x);\r\n	x = sqrt(x);\r\n	col = vec3(.2 + .75*x);  \r\n	col.b *= 0.95;           \r\n	return col;\r\n}\r\n\r\nvoid main()\r\n{\r\n	float brickW = 1.0 / numberOfTilesWidth;\r\n	float brickH = 1.0 / numberOfTilesHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.01;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\r\n		t += amplitude * turbulence(brickvUV.xy);\r\n		t = sin(t);\r\n		color = marble_color(t);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 0.0);\r\n}"):t.h["marble.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfTilesHeight;\r\nuniform float numberOfTilesWidth;\r\nuniform float amplitude;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\r\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat turbulence(vec2 P)\r\n{\r\n	float val = 0.0;\r\n	float freq = 1.0;\r\n	for (int i = 0; i < 4; i++)\r\n	{\r\n		val += abs(noise(P*freq) / freq);\r\n		freq *= 2.07;\r\n	}\r\n	return val;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvec3 marble_color(float x)\r\n{\r\n	vec3 col;\r\n	x = 0.5*(x + 1.);\r\n	x = sqrt(x);             \r\n	x = sqrt(x);\r\n	x = sqrt(x);\r\n	col = vec3(.2 + .75*x);  \r\n	col.b *= 0.95;           \r\n	return col;\r\n}\r\n\r\nvoid main()\r\n{\r\n	float brickW = 1.0 / numberOfTilesWidth;\r\n	float brickH = 1.0 / numberOfTilesHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.01;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\r\n		t += amplitude * turbulence(brickvUV.xy);\r\n		t = sin(t);\r\n		color = marble_color(t);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 0.0);\r\n}",
null!=Os["outline.fragment"]?t.setReserved("outline.fragment","precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}"):t.h["outline.fragment"]="precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}",null!=Os["outline.vertex"]?t.setReserved("outline.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\nuniform float offset;\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n	vec3 offsetPosition = position + normal * offset;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}"):t.h["outline.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\nuniform float offset;\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n	vec3 offsetPosition = position + normal * offset;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",null!=Os["particles.fragment"]?t.setReserved("particles.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\nuniform vec4 textureMask;\r\nuniform sampler2D diffuseSampler;\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\r\n}"):t.h["particles.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\nuniform vec4 textureMask;\r\nuniform sampler2D diffuseSampler;\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\r\n}",null!=Os["particles.vertex"]?t.setReserved("particles.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute vec4 options;\r\n\r\n// Uniforms\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nuniform mat4 invView;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \r\n	vec3 cornerPos;\r\n	float size = options.y;\r\n	float angle = options.x;\r\n	vec2 offset = options.zw;\r\n\r\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n	\r\n	vColor = color;\r\n	vUV = offset;\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n}"):t.h["particles.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute vec4 options;\r\n\r\n// Uniforms\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nuniform mat4 invView;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \r\n	vec3 cornerPos;\r\n	float size = options.y;\r\n	float angle = options.x;\r\n	vec2 offset = options.zw;\r\n\r\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n	\r\n	vColor = color;\r\n	vUV = offset;\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n}",null!=Os["pass.fragment"]?t.setReserved("pass.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	gl_FragColor = texture2D(textureSampler, vUV);\r\n}"):t.h["pass.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	gl_FragColor = texture2D(textureSampler, vUV);\r\n}",null!=Os["postprocess.vertex"]?t.setReserved("postprocess.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}"):t.h["postprocess.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",null!=Os["procedural.vertex"]?t.setReserved("procedural.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n	vPosition = position;\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}"):t.h["procedural.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n	vPosition = position;\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",null!=Os["refraction.fragment"]?t.setReserved("refraction.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D refractionSampler;\r\n\r\n// Parameters\r\nuniform vec3 baseColor;\r\nuniform float depth;\r\nuniform float colorLevel;\r\n\r\nvoid main() {\r\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\r\n\r\n	vec2 uv = vUV - vec2(0.5);\r\n	vec2 offset = uv * depth * ref;\r\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\r\n\r\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\r\n}"):t.h["refraction.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D refractionSampler;\r\n\r\n// Parameters\r\nuniform vec3 baseColor;\r\nuniform float depth;\r\nuniform float colorLevel;\r\n\r\nvoid main() {\r\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\r\n\r\n	vec2 uv = vUV - vec2(0.5);\r\n	vec2 offset = uv * depth * ref;\r\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\r\n\r\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\r\n}",null!=Os["road.fragment"]?t.setReserved("road.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;                    \r\nuniform vec3 roadColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\r\n	vec3 color = roadColor * ratioy;\r\n	gl_FragColor = vec4(color, 1.0);\r\n}"):t.h["road.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;                    \r\nuniform vec3 roadColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\r\n	vec3 color = roadColor * ratioy;\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",null!=Os["shadowMap.fragment"]?t.setReserved("shadowMap.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvec4 pack(float depth)\r\n{\r\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\r\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\n	vec4 res = fract(depth * bit_shift);\r\n	res -= res.xxyz * bit_mask;\r\n\r\n	return res;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nvec2 packHalf(float depth) \r\n{ \r\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\r\n	vec2 color = vec2(depth, fract(depth * 255.));\r\n\r\n	return color - (color.yy * bitOffset);\r\n}\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n	float depth = vPosition.z / vPosition.w;\r\n	depth = depth * 0.5 + 0.5;\r\n\r\n#ifdef VSM\r\n	float moment1 = depth;\r\n	float moment2 = moment1 * moment1;\r\n\r\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\r\n#else\r\n	gl_FragColor = pack(depth);\r\n#endif\r\n}"):t.h["shadowMap.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvec4 pack(float depth)\r\n{\r\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\r\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\n	vec4 res = fract(depth * bit_shift);\r\n	res -= res.xxyz * bit_mask;\r\n\r\n	return res;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nvec2 packHalf(float depth) \r\n{ \r\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\r\n	vec2 color = vec2(depth, fract(depth * 255.));\r\n\r\n	return color - (color.yy * bitOffset);\r\n}\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n	float depth = vPosition.z / vPosition.w;\r\n	depth = depth * 0.5 + 0.5;\r\n\r\n#ifdef VSM\r\n	float moment1 = depth;\r\n	float moment2 = moment1 * moment1;\r\n\r\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\r\n#else\r\n	gl_FragColor = pack(depth);\r\n#endif\r\n}",null!=Os["shadowMap.vertex"]?t.setReserved("shadowMap.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#endif\r\n\r\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\r\n	gl_Position = vPosition;\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}"):t.h["shadowMap.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#endif\r\n\r\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\r\n	gl_Position = vPosition;\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",null!=Os["sprites.fragment"]?t.setReserved("sprites.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform bool alphaTest;\r\n\r\nvarying vec4 vColor;\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return min(1., max(0., fogCoeff));\r\n}\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	if (alphaTest) \r\n	{\r\n		if (baseColor.a < 0.95)\r\n			discard;\r\n	}\r\n\r\n	baseColor *= vColor;\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = baseColor;\r\n}"):t.h["sprites.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform bool alphaTest;\r\n\r\nvarying vec4 vColor;\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return min(1., max(0., fogCoeff));\r\n}\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	if (alphaTest) \r\n	{\r\n		if (baseColor.a < 0.95)\r\n			discard;\r\n	}\r\n\r\n	baseColor *= vColor;\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = baseColor;\r\n}",null!=Os["sprites.vertex"]?t.setReserved("sprites.vertex","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec4 position;\r\nattribute vec4 options;\r\nattribute vec4 cellInfo;\r\nattribute vec4 color;\r\n\r\n// Uniforms\r\nuniform vec2 textureInfos;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \r\n	vec2 cornerPos;\r\n	\r\n	float angle = position.w;\r\n	vec2 size = vec2(options.x, options.y);\r\n	vec2 offset = options.zw;\r\n	vec2 uvScale = textureInfos.xy;\r\n\r\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n\r\n	// Color\r\n	vColor = color;\r\n	\r\n	// Texture\r\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\r\n\r\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = viewPos.z;\r\n#endif\r\n}"):t.h["sprites.vertex"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec4 position;\r\nattribute vec4 options;\r\nattribute vec4 cellInfo;\r\nattribute vec4 color;\r\n\r\n// Uniforms\r\nuniform vec2 textureInfos;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \r\n	vec2 cornerPos;\r\n	\r\n	float angle = position.w;\r\n	vec2 size = vec2(options.x, options.y);\r\n	vec2 offset = options.zw;\r\n	vec2 uvScale = textureInfos.xy;\r\n\r\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n\r\n	// Color\r\n	vColor = color;\r\n	\r\n	// Texture\r\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\r\n\r\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = viewPos.z;\r\n#endif\r\n}",null!=Os["ssao.fragment"]?t.setReserved("ssao.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define SAMPLES 16\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D randomSampler;\r\n\r\nuniform float randTextureTiles;\r\nuniform float samplesFactor;\r\nuniform vec3 sampleSphere[16];\r\n\r\nuniform float totalStrength;\r\nuniform float radius;\r\nuniform float area;\r\nuniform float fallOff;\r\n\r\nvarying vec2 vUV;\r\n\r\nconst vec2 offset1 = vec2(0.0, 0.001);\r\nconst vec2 offset2 = vec2(0.001, 0.0);\r\n\r\nvec3 normalFromDepth(const float depth, const vec2 coords) {\r\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\r\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\r\n\r\n    vec3 p1 = vec3(offset1, depth1 - depth);\r\n    vec3 p2 = vec3(offset2, depth2 - depth);\r\n\r\n    vec3 normal = cross(p1, p2);\r\n    normal.z = -normal.z;\r\n\r\n    return normalize(normal);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	const float base = 0.2;\r\n\r\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\r\n	float depth = texture2D(textureSampler, vUV).r;\r\n	vec3 position = vec3(vUV, depth);\r\n	vec3 normal = normalFromDepth(depth, vUV);\r\n	float radiusDepth = radius / depth;\r\n	float occlusion = 0.0;\r\n\r\n	vec3 ray;\r\n	vec3 hemiRay;\r\n	float occlusionDepth;\r\n	float difference;\r\n\r\n	for (int i = 0; i < SAMPLES; i++)\r\n	{\r\n		ray = radiusDepth * reflect(sampleSphere[i], random);\r\n		hemiRay = position + sign(dot(ray, normal)) * ray;\r\n\r\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\r\n		difference = depth - occlusionDepth;\r\n\r\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\r\n	}\r\n\r\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\r\n\r\n	float result = clamp(ao + base, 0.0, 1.0);\r\n	gl_FragColor.r = result;\r\n	gl_FragColor.g = result;\r\n	gl_FragColor.b = result;\r\n	gl_FragColor.a = 1.0;\r\n}\r\n"):t.h["ssao.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define SAMPLES 16\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D randomSampler;\r\n\r\nuniform float randTextureTiles;\r\nuniform float samplesFactor;\r\nuniform vec3 sampleSphere[16];\r\n\r\nuniform float totalStrength;\r\nuniform float radius;\r\nuniform float area;\r\nuniform float fallOff;\r\n\r\nvarying vec2 vUV;\r\n\r\nconst vec2 offset1 = vec2(0.0, 0.001);\r\nconst vec2 offset2 = vec2(0.001, 0.0);\r\n\r\nvec3 normalFromDepth(const float depth, const vec2 coords) {\r\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\r\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\r\n\r\n    vec3 p1 = vec3(offset1, depth1 - depth);\r\n    vec3 p2 = vec3(offset2, depth2 - depth);\r\n\r\n    vec3 normal = cross(p1, p2);\r\n    normal.z = -normal.z;\r\n\r\n    return normalize(normal);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	const float base = 0.2;\r\n\r\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\r\n	float depth = texture2D(textureSampler, vUV).r;\r\n	vec3 position = vec3(vUV, depth);\r\n	vec3 normal = normalFromDepth(depth, vUV);\r\n	float radiusDepth = radius / depth;\r\n	float occlusion = 0.0;\r\n\r\n	vec3 ray;\r\n	vec3 hemiRay;\r\n	float occlusionDepth;\r\n	float difference;\r\n\r\n	for (int i = 0; i < SAMPLES; i++)\r\n	{\r\n		ray = radiusDepth * reflect(sampleSphere[i], random);\r\n		hemiRay = position + sign(dot(ray, normal)) * ray;\r\n\r\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\r\n		difference = depth - occlusionDepth;\r\n\r\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\r\n	}\r\n\r\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\r\n\r\n	float result = clamp(ao + base, 0.0, 1.0);\r\n	gl_FragColor.r = result;\r\n	gl_FragColor.g = result;\r\n	gl_FragColor.b = result;\r\n	gl_FragColor.a = 1.0;\r\n}\r\n",null!=Os["ssaoCombine.fragment"]?t.setReserved("ssaoCombine.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D originalColor;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\r\n}\r\n"):t.h["ssaoCombine.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D originalColor;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\r\n}\r\n",null!=Os["stereoscopicInterlace.fragment"]?t.setReserved("stereoscopicInterlace.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D camASampler;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 stepSize;\r\n\r\nvoid main(void)\r\n{\r\n    bool useCamB;\r\n    vec2 texCoord1;\r\n    vec2 texCoord2;\r\n    \r\n    vec3 frag1;\r\n    vec3 frag2;\r\n    \r\n#ifdef IS_STEREOSCOPIC_HORIZ\r\n	    useCamB = vUV.x > 0.5;\r\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\r\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\r\n#else\r\n	    useCamB = vUV.y > 0.5;\r\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\r\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\r\n#endif\r\n    \r\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\r\n    if (useCamB){\r\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\r\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\r\n    }else{\r\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\r\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\r\n    }\r\n    \r\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\r\n}"):t.h["stereoscopicInterlace.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D camASampler;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 stepSize;\r\n\r\nvoid main(void)\r\n{\r\n    bool useCamB;\r\n    vec2 texCoord1;\r\n    vec2 texCoord2;\r\n    \r\n    vec3 frag1;\r\n    vec3 frag2;\r\n    \r\n#ifdef IS_STEREOSCOPIC_HORIZ\r\n	    useCamB = vUV.x > 0.5;\r\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\r\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\r\n#else\r\n	    useCamB = vUV.y > 0.5;\r\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\r\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\r\n#endif\r\n    \r\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\r\n    if (useCamB){\r\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\r\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\r\n    }else{\r\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\r\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\r\n    }\r\n    \r\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\r\n}",null!=Os["volumetricLightScattering.fragment"]?t.setReserved("volumetricLightScattering.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D lightScatteringSampler;\r\n\r\nuniform float decay;\r\nuniform float exposure;\r\nuniform float weight;\r\nuniform float density;\r\nuniform vec2 meshPositionOnScreen;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n    vec2 tc = vUV;\r\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\r\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\r\n\r\n    float illuminationDecay = 1.0;\r\n\r\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\r\n\r\n    for(int i=0; i < NUM_SAMPLES; i++) {\r\n        tc -= deltaTexCoord;\r\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\r\n        sample *= illuminationDecay * weight;\r\n        color += sample;\r\n        illuminationDecay *= decay;\r\n    }\r\n\r\n    vec4 realColor = texture2D(textureSampler, vUV);\r\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\r\n}\r\n"):t.h["volumetricLightScattering.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D lightScatteringSampler;\r\n\r\nuniform float decay;\r\nuniform float exposure;\r\nuniform float weight;\r\nuniform float density;\r\nuniform vec2 meshPositionOnScreen;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n    vec2 tc = vUV;\r\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\r\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\r\n\r\n    float illuminationDecay = 1.0;\r\n\r\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\r\n\r\n    for(int i=0; i < NUM_SAMPLES; i++) {\r\n        tc -= deltaTexCoord;\r\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\r\n        sample *= illuminationDecay * weight;\r\n        color += sample;\r\n        illuminationDecay *= decay;\r\n    }\r\n\r\n    vec4 realColor = texture2D(textureSampler, vUV);\r\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\r\n}\r\n",
null!=Os["volumetricLightScatteringPass.fragment"]?t.setReserved("volumetricLightScatteringPass.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\n#if defined(DIFFUSE_COLOR_RENDER)\r\nuniform vec3 color;\r\n#endif\r\n\r\n#if defined(OPACITY)\r\nuniform sampler2D opacitySampler;\r\nuniform float opacityLevel;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n	if (diffuseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\r\n	float alpha = 1.0;\r\n\r\n	#ifdef OPACITYRGB\r\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\r\n	#else\r\n	alpha *= opacityColor.a * opacityLevel;\r\n	#endif\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, alpha);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\r\n	#endif\r\n\r\n	gl_FragColor.a = alpha;\r\n#else\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = diffuseColor;\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, 1.0);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	#endif\r\n#endif\r\n\r\n}\r\n"):t.h["volumetricLightScatteringPass.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\n#if defined(DIFFUSE_COLOR_RENDER)\r\nuniform vec3 color;\r\n#endif\r\n\r\n#if defined(OPACITY)\r\nuniform sampler2D opacitySampler;\r\nuniform float opacityLevel;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n	if (diffuseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\r\n	float alpha = 1.0;\r\n\r\n	#ifdef OPACITYRGB\r\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\r\n	#else\r\n	alpha *= opacityColor.a * opacityLevel;\r\n	#endif\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, alpha);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\r\n	#endif\r\n\r\n	gl_FragColor.a = alpha;\r\n#else\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = diffuseColor;\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, 1.0);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	#endif\r\n#endif\r\n\r\n}\r\n",null!=Os["vrDistortionCorrection.fragment"]?t.setReserved("vrDistortionCorrection.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 LensCenter;\r\nuniform vec2 Scale;\r\nuniform vec2 ScaleIn;\r\nuniform vec4 HmdWarpParam;\r\n\r\nvec2 HmdWarp(vec2 in01) {\r\n\r\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\r\n	float rSq = theta.x * theta.x + theta.y * theta.y;\r\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\r\n	return LensCenter + Scale * rvector;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec2 tc = HmdWarp(vUV);\r\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	else{\r\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\r\n	}\r\n}"):t.h["vrDistortionCorrection.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 LensCenter;\r\nuniform vec2 Scale;\r\nuniform vec2 ScaleIn;\r\nuniform vec4 HmdWarpParam;\r\n\r\nvec2 HmdWarp(vec2 in01) {\r\n\r\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\r\n	float rSq = theta.x * theta.x + theta.y * theta.y;\r\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\r\n	return LensCenter + Scale * rvector;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec2 tc = HmdWarp(vUV);\r\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	else{\r\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\r\n	}\r\n}",null!=Os["wood.fragment"]?t.setReserved("wood.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float ampScale;\r\nuniform vec3 woodColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\r\n	vec3 wood = woodColor * ratioy;\r\n	gl_FragColor = vec4(wood, 1.0);\r\n}"):t.h["wood.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float ampScale;\r\nuniform vec3 woodColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\r\n	vec3 wood = woodColor * ratioy;\r\n	gl_FragColor = vec4(wood, 1.0);\r\n}",null!=Os["compose.fragment"]?t.setReserved("compose.fragment","#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D sceneSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform float sceneIntensity;\nuniform float glowIntensity;\nuniform float highlightIntensity;\n\nvoid main(void) \n{\n	vec4 orig = texture2D(sceneSampler, vUV);\n	vec4 blur = texture2D(textureSampler, vUV);\n\n	vec4 final = sceneIntensity * orig + glowIntensity * blur + highlightIntensity * blur.a;\n	final.a = 1.0;\n\n	gl_FragColor = final;\n}"):t.h["compose.fragment"]="#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D sceneSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform float sceneIntensity;\nuniform float glowIntensity;\nuniform float highlightIntensity;\n\nvoid main(void) \n{\n	vec4 orig = texture2D(sceneSampler, vUV);\n	vec4 blur = texture2D(textureSampler, vUV);\n\n	vec4 final = sceneIntensity * orig + glowIntensity * blur + highlightIntensity * blur.a;\n	final.a = 1.0;\n\n	gl_FragColor = final;\n}",null!=Os["downsample.fragment"]?t.setReserved("downsample.fragment","#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform float highlightThreshold;\n\nfloat highlights(vec3 color)\n{\n	return smoothstep(highlightThreshold, 1.0, dot(color, vec3(0.3, 0.59, 0.11)));\n}\n\nvoid main(void) \n{\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\n	vec4 baseColor = texture2D(textureSampler, vUV + vec2(-1.0, -1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(1.0, -1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(1.0, 1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(-1.0, 1.0) * texelSize) * 0.25;\n	\n	baseColor.a = highlights(baseColor.rgb);\n\n	gl_FragColor = baseColor;\n}"):t.h["downsample.fragment"]="#ifdef GL_ES\nprecision highp float;\n#endif\n\n// Samplers\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\n// Parameters\nuniform vec2 screenSize;\nuniform float highlightThreshold;\n\nfloat highlights(vec3 color)\n{\n	return smoothstep(highlightThreshold, 1.0, dot(color, vec3(0.3, 0.59, 0.11)));\n}\n\nvoid main(void) \n{\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\n	vec4 baseColor = texture2D(textureSampler, vUV + vec2(-1.0, -1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(1.0, -1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(1.0, 1.0) * texelSize) * 0.25;\n	baseColor += texture2D(textureSampler, vUV + vec2(-1.0, 1.0) * texelSize) * 0.25;\n	\n	baseColor.a = highlights(baseColor.rgb);\n\n	gl_FragColor = baseColor;\n}",null!=Os["cellShading.vertex"]?t.setReserved("cellShading.vertex","\n #ifdef GL_ES \n precision highp float; \n #endif \n attribute vec3 position; \n attribute vec3 normal; \n attribute vec2 uv; \n uniform mat4 world; \n uniform mat4 viewProjection; \n varying vec3 vPositionW; \n varying vec3 vNormalW; \n varying vec2 vUV; \n void main(void) { \n vec4 outPosition = viewProjection * world * vec4(position, 1.0); \n gl_Position = outPosition; \n vPositionW = vec3(world * vec4(position, 1.0)); \n vNormalW = normalize(vec3(world * vec4(normal, 0.0))); \n vUV = uv; \n } \n"):t.h["cellShading.vertex"]="\n #ifdef GL_ES \n precision highp float; \n #endif \n attribute vec3 position; \n attribute vec3 normal; \n attribute vec2 uv; \n uniform mat4 world; \n uniform mat4 viewProjection; \n varying vec3 vPositionW; \n varying vec3 vNormalW; \n varying vec2 vUV; \n void main(void) { \n vec4 outPosition = viewProjection * world * vec4(position, 1.0); \n gl_Position = outPosition; \n vPositionW = vec3(world * vec4(position, 1.0)); \n vNormalW = normalize(vec3(world * vec4(normal, 0.0))); \n vUV = uv; \n } \n",null!=Os["cellShading.fragment"]?t.setReserved("cellShading.fragment","\n #ifdef GL_ES \n precision highp float; \n #endif \n varying vec3 vPositionW; \n varying vec3 vNormalW; \n varying vec2 vUV; \n uniform float ToonThresholds[4]; \n uniform float ToonBrightnessLevels[5]; \n uniform vec3 vLightPosition; \n uniform vec3 vLightColor; \n uniform sampler2D textureSampler; \n void main(void) { \n vec3 lightVectorW = normalize(vLightPosition - vPositionW); \n float ndl = max(0., dot(vNormalW, lightVectorW)); \n vec3 color = texture2D(textureSampler, vUV).rgb * vLightColor; \n if (ndl > ToonThresholds[0]) { color *= ToonBrightnessLevels[0]; } \n else if (ndl > ToonThresholds[1]) { \n color *= ToonBrightnessLevels[1]; } \n else if (ndl > ToonThresholds[2]) { color *= ToonBrightnessLevels[2]; } \n else if (ndl > ToonThresholds[3]) { color *= ToonBrightnessLevels[3]; } \n else { color *= ToonBrightnessLevels[4]; } \n gl_FragColor = vec4(color, 1.); \n } \n"):t.h["cellShading.fragment"]="\n #ifdef GL_ES \n precision highp float; \n #endif \n varying vec3 vPositionW; \n varying vec3 vNormalW; \n varying vec2 vUV; \n uniform float ToonThresholds[4]; \n uniform float ToonBrightnessLevels[5]; \n uniform vec3 vLightPosition; \n uniform vec3 vLightColor; \n uniform sampler2D textureSampler; \n void main(void) { \n vec3 lightVectorW = normalize(vLightPosition - vPositionW); \n float ndl = max(0., dot(vNormalW, lightVectorW)); \n vec3 color = texture2D(textureSampler, vUV).rgb * vLightColor; \n if (ndl > ToonThresholds[0]) { color *= ToonBrightnessLevels[0]; } \n else if (ndl > ToonThresholds[1]) { \n color *= ToonBrightnessLevels[1]; } \n else if (ndl > ToonThresholds[2]) { color *= ToonBrightnessLevels[2]; } \n else if (ndl > ToonThresholds[3]) { color *= ToonBrightnessLevels[3]; } \n else { color *= ToonBrightnessLevels[4]; } \n gl_FragColor = vec4(color, 1.); \n } \n",e=t}(this),Tt.X=new W(1,0,0),Tt.Y=new W(0,1,0),Tt.Z=new W(0,0,1),jt.QUADRATIC=0,Jt.NoImpostor=0,Jt.SphereImpostor=1,Jt.BoxImpostor=2,Jt.PlaneImpostor=3,Jt.MeshImpostor=4,Jt.CapsuleImpostor=5,Jt.ConeImpostor=6,Jt.CylinderImpostor=7,Jt.ConvexHullImpostor=8,Jt.Epsilon=.001,ai.PASS_EFFECT_NAME="passEffect",ai.PASS_SAMPLER_NAME="passSampler",pi._GlobalId=0,gi.MASK=1073741824,gi.unknown=0,gi.key_a=4,gi.key_b=5,gi.key_c=6,gi.key_d=7,gi.key_e=8,gi.key_f=9,gi.key_g=10,gi.key_h=11,gi.key_i=12,gi.key_j=13,gi.key_k=14,gi.key_l=15,gi.key_m=16,gi.key_n=17,gi.key_o=18,gi.key_p=19,gi.key_q=20,gi.key_r=21,gi.key_s=22,gi.key_t=23,gi.key_u=24,gi.key_v=25,gi.key_w=26,gi.key_x=27,gi.key_y=28,gi.key_z=29,gi.key_1=30,gi.key_2=31,gi.key_3=32,gi.key_4=33,gi.key_5=34,gi.key_6=35,gi.key_7=36,gi.key_8=37,gi.key_9=38,gi.key_0=39,gi.enter=40,gi.escape=41,gi.backspace=42,gi.tab=43,gi.space=44,gi.minus=45,gi.equals=46,gi.leftbracket=47,gi.rightbracket=48,gi.backslash=49,gi.nonushash=50,gi.semicolon=51,gi.apostrophe=52,gi.grave=53,gi.comma=54,gi.period=55,gi.slash=56,gi.capslock=57,gi.f1=58,gi.f2=59,gi.f3=60,gi.f4=61,gi.f5=62,gi.f6=63,gi.f7=64,gi.f8=65,gi.f9=66,gi.f10=67,gi.f11=68,gi.f12=69,gi.printscreen=70,gi.scrolllock=71,gi.pause=72,gi.insert=73,gi.home=74,gi.pageup=75,gi["delete"]=76,gi.end=77,gi.pagedown=78,gi.right=79,gi.left=80,gi.down=81,gi.up=82,gi.numlockclear=83,gi.kp_divide=84,gi.kp_multiply=85,gi.kp_minus=86,gi.kp_plus=87,gi.kp_enter=88,gi.kp_1=89,gi.kp_2=90,gi.kp_3=91,gi.kp_4=92,gi.kp_5=93,gi.kp_6=94,gi.kp_7=95,gi.kp_8=96,gi.kp_9=97,gi.kp_0=98,gi.kp_period=99,gi.nonusbackslash=100,gi.application=101,gi.power=102,gi.kp_equals=103,gi.f13=104,gi.f14=105,gi.f15=106,gi.f16=107,gi.f17=108,gi.f18=109,gi.f19=110,gi.f20=111,gi.f21=112,gi.f22=113,gi.f23=114,gi.f24=115,gi.execute=116,gi.help=117,gi.menu=118,gi.select=119,gi.stop=120,gi.again=121,gi.undo=122,gi.cut=123,gi.copy=124,gi.paste=125,gi.find=126,gi.mute=127,gi.volumeup=128,gi.volumedown=129,gi.kp_comma=133,gi.kp_equalsas400=134,gi.international1=135,gi.international2=136,gi.international3=137,gi.international4=138,gi.international5=139,gi.international6=140,gi.international7=141,gi.international8=142,gi.international9=143,gi.lang1=144,gi.lang2=145,gi.lang3=146,gi.lang4=147,gi.lang5=148,gi.lang6=149,gi.lang7=150,gi.lang8=151,gi.lang9=152,gi.alterase=153,gi.sysreq=154,gi.cancel=155,gi.clear=156,gi.prior=157,gi.return2=158,gi.separator=159,gi.out=160,gi.oper=161,gi.clearagain=162,gi.crsel=163,gi.exsel=164,gi.kp_00=176,gi.kp_000=177,gi.thousandsseparator=178,gi.decimalseparator=179,gi.currencyunit=180,gi.currencysubunit=181,gi.kp_leftparen=182,gi.kp_rightparen=183,gi.kp_leftbrace=184,gi.kp_rightbrace=185,gi.kp_tab=186,gi.kp_backspace=187,gi.kp_a=188,gi.kp_b=189,gi.kp_c=190,gi.kp_d=191,gi.kp_e=192,gi.kp_f=193,gi.kp_xor=194,gi.kp_power=195,gi.kp_percent=196,gi.kp_less=197,gi.kp_greater=198,gi.kp_ampersand=199,gi.kp_dblampersand=200,gi.kp_verticalbar=201,gi.kp_dblverticalbar=202,gi.kp_colon=203,gi.kp_hash=204,gi.kp_space=205,gi.kp_at=206,gi.kp_exclam=207,gi.kp_memstore=208,gi.kp_memrecall=209,gi.kp_memclear=210,gi.kp_memadd=211,gi.kp_memsubtract=212,gi.kp_memmultiply=213,gi.kp_memdivide=214,gi.kp_plusminus=215,gi.kp_clear=216,gi.kp_clearentry=217,gi.kp_binary=218,gi.kp_octal=219,gi.kp_decimal=220,gi.kp_hexadecimal=221,gi.lctrl=224,gi.lshift=225,gi.lalt=226,gi.lmeta=227,gi.rctrl=228,gi.rshift=229,gi.ralt=230,gi.rmeta=231,gi.mode=257,gi.audionext=258,gi.audioprev=259,gi.audiostop=260,gi.audioplay=261,gi.audiomute=262,gi.mediaselect=263,gi.www=264,gi.mail=265,gi.calculator=266,gi.computer=267,gi.ac_search=268,gi.ac_home=269,gi.ac_back=270,gi.ac_forward=271,gi.ac_stop=272,gi.ac_refresh=273,gi.ac_bookmarks=274,gi.brightnessdown=275,gi.brightnessup=276,gi.displayswitch=277,gi.kbdillumtoggle=278,gi.kbdillumdown=279,gi.kbdillumup=280,gi.eject=281,gi.sleep=282,gi.app1=283,gi.app2=284,gi.scancode_names=[null,null,null,null,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0","Enter","Escape","Backspace","Tab","Space","-","=","[","]","\\","#",";","'","`",",",".","/","CapsLock","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","PrintScreen","ScrollLock","Pause","Insert","Home","PageUp","Delete","End","PageDown","Right","Left","Down","Up","Numlock","Keypad /","Keypad *","Keypad -","Keypad +","Keypad Enter","Keypad 1","Keypad 2","Keypad 3","Keypad 4","Keypad 5","Keypad 6","Keypad 7","Keypad 8","Keypad 9","Keypad 0","Keypad .",null,"Application","Power","Keypad =","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Execute","Help","Menu","Select","Stop","Again","Undo","Cut","Copy","Paste","Find","Mute","VolumeUp","VolumeDown",null,null,null,"Keypad ,","Keypad = (AS400)",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"AltErase","SysReq","Cancel","Clear","Prior","Enter","Separator","Out","Oper","Clear / Again","CrSel","ExSel",null,null,null,null,null,null,null,null,null,null,null,"Keypad 00","Keypad 000","ThousandsSeparator","DecimalSeparator","CurrencyUnit","CurrencySubUnit","Keypad (","Keypad )","Keypad {","Keypad }","Keypad Tab","Keypad Backspace","Keypad A","Keypad B","Keypad C","Keypad D","Keypad E","Keypad F","Keypad XOR","Keypad ^","Keypad %","Keypad <","Keypad >","Keypad &","Keypad &&","Keypad |","Keypad ||","Keypad :","Keypad #","Keypad Space","Keypad @","Keypad !","Keypad MemStore","Keypad MemRecall","Keypad MemClear","Keypad MemAdd","Keypad MemSubtract","Keypad MemMultiply","Keypad MemDivide","Keypad +/-","Keypad Clear","Keypad ClearEntry","Keypad Binary","Keypad Octal","Keypad Decimal","Keypad Hexadecimal",null,null,"Left Ctrl","Left Shift","Left Alt","Left Meta","Right Ctrl","Right Shift","Right Alt","Right Meta",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"ModeSwitch","AudioNext","AudioPrev","AudioStop","AudioPlay","AudioMute","MediaSelect","WWW","Mail","Calculator","Computer","AC Search","AC Home","AC Back","AC Forward","AC Stop","AC Refresh","AC Bookmarks","BrightnessDown","BrightnessUp","DisplaySwitch","KBDIllumToggle","KBDIllumDown","KBDIllumUp","Eject","Sleep"],xi.unknown=0,xi.enter=13,xi.escape=27,xi.backspace=8,xi.tab=9,xi.space=32,xi.exclaim=33,xi.quotedbl=34,xi.hash=35,xi.percent=37,xi.dollar=36,xi.ampersand=38,xi.quote=39,xi.leftparen=40,xi.rightparen=41,xi.asterisk=42,xi.plus=43,xi.comma=44,xi.minus=45,xi.period=46,xi.slash=47,xi.key_0=48,xi.key_1=49,xi.key_2=50,xi.key_3=51,xi.key_4=52,xi.key_5=53,xi.key_6=54,xi.key_7=55,xi.key_8=56,xi.key_9=57,xi.colon=58,xi.semicolon=59,xi.less=60,xi.equals=61,xi.greater=62,xi.question=63,xi.at=64,xi.leftbracket=91,xi.backslash=92,xi.rightbracket=93,xi.caret=94,xi.underscore=95,xi.backquote=96,xi.key_a=97,xi.key_b=98,xi.key_c=99,xi.key_d=100,xi.key_e=101,xi.key_f=102,xi.key_g=103,xi.key_h=104,xi.key_i=105,xi.key_j=106,xi.key_k=107,xi.key_l=108,xi.key_m=109,xi.key_n=110,xi.key_o=111,xi.key_p=112,xi.key_q=113,xi.key_r=114,xi.key_s=115,xi.key_t=116,xi.key_u=117,xi.key_v=118,xi.key_w=119,xi.key_x=120,xi.key_y=121,xi.key_z=122,xi.capslock=xi.from_scan(gi.capslock),xi.f1=xi.from_scan(gi.f1),xi.f2=xi.from_scan(gi.f2),xi.f3=xi.from_scan(gi.f3),xi.f4=xi.from_scan(gi.f4),xi.f5=xi.from_scan(gi.f5),xi.f6=xi.from_scan(gi.f6),xi.f7=xi.from_scan(gi.f7),xi.f8=xi.from_scan(gi.f8),xi.f9=xi.from_scan(gi.f9),xi.f10=xi.from_scan(gi.f10),xi.f11=xi.from_scan(gi.f11),xi.f12=xi.from_scan(gi.f12),xi.printscreen=xi.from_scan(gi.printscreen),xi.scrolllock=xi.from_scan(gi.scrolllock),xi.pause=xi.from_scan(gi.pause),xi.insert=xi.from_scan(gi.insert),xi.home=xi.from_scan(gi.home),xi.pageup=xi.from_scan(gi.pageup),xi["delete"]=127,xi.end=xi.from_scan(gi.end),xi.pagedown=xi.from_scan(gi.pagedown),xi.right=xi.from_scan(gi.right),xi.left=xi.from_scan(gi.left),xi.down=xi.from_scan(gi.down),xi.up=xi.from_scan(gi.up),xi.numlockclear=xi.from_scan(gi.numlockclear),xi.kp_divide=xi.from_scan(gi.kp_divide),xi.kp_multiply=xi.from_scan(gi.kp_multiply),xi.kp_minus=xi.from_scan(gi.kp_minus),xi.kp_plus=xi.from_scan(gi.kp_plus),xi.kp_enter=xi.from_scan(gi.kp_enter),xi.kp_1=xi.from_scan(gi.kp_1),xi.kp_2=xi.from_scan(gi.kp_2),xi.kp_3=xi.from_scan(gi.kp_3),xi.kp_4=xi.from_scan(gi.kp_4),xi.kp_5=xi.from_scan(gi.kp_5),xi.kp_6=xi.from_scan(gi.kp_6),xi.kp_7=xi.from_scan(gi.kp_7),xi.kp_8=xi.from_scan(gi.kp_8),xi.kp_9=xi.from_scan(gi.kp_9),xi.kp_0=xi.from_scan(gi.kp_0),xi.kp_period=xi.from_scan(gi.kp_period),xi.application=xi.from_scan(gi.application),xi.power=xi.from_scan(gi.power),xi.kp_equals=xi.from_scan(gi.kp_equals),xi.f13=xi.from_scan(gi.f13),xi.f14=xi.from_scan(gi.f14),xi.f15=xi.from_scan(gi.f15),xi.f16=xi.from_scan(gi.f16),xi.f17=xi.from_scan(gi.f17),xi.f18=xi.from_scan(gi.f18),xi.f19=xi.from_scan(gi.f19),xi.f20=xi.from_scan(gi.f20),xi.f21=xi.from_scan(gi.f21),xi.f22=xi.from_scan(gi.f22),xi.f23=xi.from_scan(gi.f23),xi.f24=xi.from_scan(gi.f24),xi.execute=xi.from_scan(gi.execute),xi.help=xi.from_scan(gi.help),xi.menu=xi.from_scan(gi.menu),xi.select=xi.from_scan(gi.select),xi.stop=xi.from_scan(gi.stop),xi.again=xi.from_scan(gi.again),xi.undo=xi.from_scan(gi.undo),xi.cut=xi.from_scan(gi.cut),xi.copy=xi.from_scan(gi.copy),xi.paste=xi.from_scan(gi.paste),xi.find=xi.from_scan(gi.find),xi.mute=xi.from_scan(gi.mute),xi.volumeup=xi.from_scan(gi.volumeup),xi.volumedown=xi.from_scan(gi.volumedown),xi.kp_comma=xi.from_scan(gi.kp_comma),xi.kp_equalsas400=xi.from_scan(gi.kp_equalsas400),xi.alterase=xi.from_scan(gi.alterase),xi.sysreq=xi.from_scan(gi.sysreq),xi.cancel=xi.from_scan(gi.cancel),xi.clear=xi.from_scan(gi.clear),xi.prior=xi.from_scan(gi.prior),xi.return2=xi.from_scan(gi.return2),xi.separator=xi.from_scan(gi.separator),xi.out=xi.from_scan(gi.out),xi.oper=xi.from_scan(gi.oper),xi.clearagain=xi.from_scan(gi.clearagain),xi.crsel=xi.from_scan(gi.crsel),xi.exsel=xi.from_scan(gi.exsel),xi.kp_00=xi.from_scan(gi.kp_00),xi.kp_000=xi.from_scan(gi.kp_000),xi.thousandsseparator=xi.from_scan(gi.thousandsseparator),xi.decimalseparator=xi.from_scan(gi.decimalseparator),xi.currencyunit=xi.from_scan(gi.currencyunit),xi.currencysubunit=xi.from_scan(gi.currencysubunit),xi.kp_leftparen=xi.from_scan(gi.kp_leftparen),xi.kp_rightparen=xi.from_scan(gi.kp_rightparen),xi.kp_leftbrace=xi.from_scan(gi.kp_leftbrace),xi.kp_rightbrace=xi.from_scan(gi.kp_rightbrace),xi.kp_tab=xi.from_scan(gi.kp_tab),xi.kp_backspace=xi.from_scan(gi.kp_backspace),xi.kp_a=xi.from_scan(gi.kp_a),xi.kp_b=xi.from_scan(gi.kp_b),xi.kp_c=xi.from_scan(gi.kp_c),xi.kp_d=xi.from_scan(gi.kp_d),xi.kp_e=xi.from_scan(gi.kp_e),xi.kp_f=xi.from_scan(gi.kp_f),xi.kp_xor=xi.from_scan(gi.kp_xor),xi.kp_power=xi.from_scan(gi.kp_power),xi.kp_percent=xi.from_scan(gi.kp_percent),xi.kp_less=xi.from_scan(gi.kp_less),xi.kp_greater=xi.from_scan(gi.kp_greater),xi.kp_ampersand=xi.from_scan(gi.kp_ampersand),xi.kp_dblampersand=xi.from_scan(gi.kp_dblampersand),xi.kp_verticalbar=xi.from_scan(gi.kp_verticalbar),xi.kp_dblverticalbar=xi.from_scan(gi.kp_dblverticalbar),xi.kp_colon=xi.from_scan(gi.kp_colon),xi.kp_hash=xi.from_scan(gi.kp_hash),xi.kp_space=xi.from_scan(gi.kp_space),xi.kp_at=xi.from_scan(gi.kp_at),xi.kp_exclam=xi.from_scan(gi.kp_exclam),xi.kp_memstore=xi.from_scan(gi.kp_memstore),xi.kp_memrecall=xi.from_scan(gi.kp_memrecall),xi.kp_memclear=xi.from_scan(gi.kp_memclear),xi.kp_memadd=xi.from_scan(gi.kp_memadd),xi.kp_memsubtract=xi.from_scan(gi.kp_memsubtract),xi.kp_memmultiply=xi.from_scan(gi.kp_memmultiply),xi.kp_memdivide=xi.from_scan(gi.kp_memdivide),xi.kp_plusminus=xi.from_scan(gi.kp_plusminus),xi.kp_clear=xi.from_scan(gi.kp_clear),xi.kp_clearentry=xi.from_scan(gi.kp_clearentry),xi.kp_binary=xi.from_scan(gi.kp_binary),xi.kp_octal=xi.from_scan(gi.kp_octal),xi.kp_decimal=xi.from_scan(gi.kp_decimal),xi.kp_hexadecimal=xi.from_scan(gi.kp_hexadecimal),xi.lctrl=xi.from_scan(gi.lctrl),xi.lshift=xi.from_scan(gi.lshift),xi.lalt=xi.from_scan(gi.lalt),xi.lmeta=xi.from_scan(gi.lmeta),xi.rctrl=xi.from_scan(gi.rctrl),xi.rshift=xi.from_scan(gi.rshift),xi.ralt=xi.from_scan(gi.ralt),xi.rmeta=xi.from_scan(gi.rmeta),xi.mode=xi.from_scan(gi.mode),xi.audionext=xi.from_scan(gi.audionext),xi.audioprev=xi.from_scan(gi.audioprev),xi.audiostop=xi.from_scan(gi.audiostop),xi.audioplay=xi.from_scan(gi.audioplay),xi.audiomute=xi.from_scan(gi.audiomute),xi.mediaselect=xi.from_scan(gi.mediaselect),xi.www=xi.from_scan(gi.www),xi.mail=xi.from_scan(gi.mail),xi.calculator=xi.from_scan(gi.calculator),xi.computer=xi.from_scan(gi.computer),xi.ac_search=xi.from_scan(gi.ac_search),xi.ac_home=xi.from_scan(gi.ac_home),xi.ac_back=xi.from_scan(gi.ac_back),xi.ac_forward=xi.from_scan(gi.ac_forward),xi.ac_stop=xi.from_scan(gi.ac_stop),xi.ac_refresh=xi.from_scan(gi.ac_refresh),xi.ac_bookmarks=xi.from_scan(gi.ac_bookmarks),xi.brightnessdown=xi.from_scan(gi.brightnessdown),xi.brightnessup=xi.from_scan(gi.brightnessup),xi.displayswitch=xi.from_scan(gi.displayswitch),xi.kbdillumtoggle=xi.from_scan(gi.kbdillumtoggle),xi.kbdillumdown=xi.from_scan(gi.kbdillumdown),xi.kbdillumup=xi.from_scan(gi.kbdillumup),xi.eject=xi.from_scan(gi.eject),xi.sleep=xi.from_scan(gi.sleep),Ci.Stride=32,Ri.count=0,Ui.i64tmp=function(){var e,t=new Pi(0,0)
return e=t}(this),Xi.BYTES_PER_ELEMENT=1,Ki.cache=new ji,Ki.libraries=new Bi,Ki.initialized=!1,$i.images=new Bi,$i.loaders=new Bi,hn.NONE=0,hn.FALSE=0,hn.TRUE=1,hn.SOURCE_RELATIVE=514,hn.CONE_INNER_ANGLE=4097,hn.CONE_OUTER_ANGLE=4098,hn.PITCH=4099,hn.POSITION=4100,hn.DIRECTION=4101,hn.VELOCITY=4102,hn.LOOPING=4103,hn.BUFFER=4105,hn.GAIN=4106,hn.MIN_GAIN=4109,hn.MAX_GAIN=4110,hn.ORIENTATION=4111,hn.SOURCE_STATE=4112,hn.INITIAL=4113,hn.PLAYING=4114,hn.PAUSED=4115,hn.STOPPED=4116,hn.BUFFERS_QUEUED=4117,hn.BUFFERS_PROCESSED=4118,hn.REFERENCE_DISTANCE=4128,hn.ROLLOFF_FACTOR=4129,hn.CONE_OUTER_GAIN=4130,hn.MAX_DISTANCE=4131,hn.SEC_OFFSET=4132,hn.SAMPLE_OFFSET=4133,hn.BYTE_OFFSET=4134,hn.SOURCE_TYPE=4135,hn.STATIC=4136,hn.STREAMING=4137,hn.UNDETERMINED=4144,hn.FORMAT_MONO8=4352,hn.FORMAT_MONO16=4353,hn.FORMAT_STEREO8=4354,hn.FORMAT_STEREO16=4355,hn.FREQUENCY=8193,hn.BITS=8194,hn.CHANNELS=8195,hn.SIZE=8196,hn.NO_ERROR=0,hn.INVALID_NAME=40961,hn.INVALID_ENUM=40962,hn.INVALID_VALUE=40963,hn.INVALID_OPERATION=40964,hn.OUT_OF_MEMORY=40965,hn.VENDOR=45057,hn.VERSION=45058,hn.RENDERER=45059,hn.EXTENSIONS=45060,hn.DOPPLER_FACTOR=49152,hn.SPEED_OF_SOUND=49155,hn.DOPPLER_VELOCITY=49153,hn.DISTANCE_MODEL=53248,hn.INVERSE_DISTANCE=53249,hn.INVERSE_DISTANCE_CLAMPED=53250,hn.LINEAR_DISTANCE=53251,hn.LINEAR_DISTANCE_CLAMPED=53252,hn.EXPONENT_DISTANCE=53253,hn.EXPONENT_DISTANCE_CLAMPED=53254,un.FALSE=0,un.TRUE=1,un.FREQUENCY=4103,un.REFRESH=4104,un.SYNC=4105,un.MONO_SOURCES=4112,un.STEREO_SOURCES=4113,un.NO_ERROR=0,un.INVALID_DEVICE=40961,un.INVALID_CONTEXT=40962,un.INVALID_ENUM=40963,un.INVALID_VALUE=40964,un.OUT_OF_MEMORY=40965,un.ATTRIBUTES_SIZE=4098,un.ALL_ATTRIBUTES=4099,un.DEFAULT_DEVICE_SPECIFIER=4100,un.DEVICE_SPECIFIER=4101,un.EXTENSIONS=4102,un.ENUMERATE_ALL_EXT=1,un.DEFAULT_ALL_DEVICES_SPECIFIER=4114,un.ALL_DEVICES_SPECIFIER=4115,_n.__base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",En.DEPTH_BUFFER_BIT=256,En.STENCIL_BUFFER_BIT=1024,En.COLOR_BUFFER_BIT=16384,En.POINTS=0,En.LINES=1,En.LINE_LOOP=2,En.LINE_STRIP=3,En.TRIANGLES=4,En.TRIANGLE_STRIP=5,En.TRIANGLE_FAN=6,En.ZERO=0,En.ONE=1,En.SRC_COLOR=768,En.ONE_MINUS_SRC_COLOR=769,En.SRC_ALPHA=770,En.ONE_MINUS_SRC_ALPHA=771,En.DST_ALPHA=772,En.ONE_MINUS_DST_ALPHA=773,En.DST_COLOR=774,En.ONE_MINUS_DST_COLOR=775,En.SRC_ALPHA_SATURATE=776,En.FUNC_ADD=32774,En.BLEND_EQUATION=32777,En.BLEND_EQUATION_RGB=32777,En.BLEND_EQUATION_ALPHA=34877,En.FUNC_SUBTRACT=32778,En.FUNC_REVERSE_SUBTRACT=32779,En.BLEND_DST_RGB=32968,En.BLEND_SRC_RGB=32969,En.BLEND_DST_ALPHA=32970,En.BLEND_SRC_ALPHA=32971,En.CONSTANT_COLOR=32769,En.ONE_MINUS_CONSTANT_COLOR=32770,En.CONSTANT_ALPHA=32771,En.ONE_MINUS_CONSTANT_ALPHA=32772,En.BLEND_COLOR=32773,En.ARRAY_BUFFER=34962,En.ELEMENT_ARRAY_BUFFER=34963,En.ARRAY_BUFFER_BINDING=34964,En.ELEMENT_ARRAY_BUFFER_BINDING=34965,En.STREAM_DRAW=35040,En.STATIC_DRAW=35044,En.DYNAMIC_DRAW=35048,En.BUFFER_SIZE=34660,En.BUFFER_USAGE=34661,En.CURRENT_VERTEX_ATTRIB=34342,En.FRONT=1028,En.BACK=1029,En.FRONT_AND_BACK=1032,En.CULL_FACE=2884,En.BLEND=3042,En.DITHER=3024,En.STENCIL_TEST=2960,En.DEPTH_TEST=2929,En.SCISSOR_TEST=3089,En.POLYGON_OFFSET_FILL=32823,En.SAMPLE_ALPHA_TO_COVERAGE=32926,En.SAMPLE_COVERAGE=32928,En.NO_ERROR=0,En.INVALID_ENUM=1280,En.INVALID_VALUE=1281,En.INVALID_OPERATION=1282,En.OUT_OF_MEMORY=1285,En.CW=2304,En.CCW=2305,En.LINE_WIDTH=2849,En.ALIASED_POINT_SIZE_RANGE=33901,En.ALIASED_LINE_WIDTH_RANGE=33902,En.CULL_FACE_MODE=2885,En.FRONT_FACE=2886,En.DEPTH_RANGE=2928,En.DEPTH_WRITEMASK=2930,En.DEPTH_CLEAR_VALUE=2931,En.DEPTH_FUNC=2932,En.STENCIL_CLEAR_VALUE=2961,En.STENCIL_FUNC=2962,En.STENCIL_FAIL=2964,En.STENCIL_PASS_DEPTH_FAIL=2965,En.STENCIL_PASS_DEPTH_PASS=2966,En.STENCIL_REF=2967,En.STENCIL_VALUE_MASK=2963,En.STENCIL_WRITEMASK=2968,En.STENCIL_BACK_FUNC=34816,En.STENCIL_BACK_FAIL=34817,En.STENCIL_BACK_PASS_DEPTH_FAIL=34818,En.STENCIL_BACK_PASS_DEPTH_PASS=34819,En.STENCIL_BACK_REF=36003,En.STENCIL_BACK_VALUE_MASK=36004,En.STENCIL_BACK_WRITEMASK=36005,En.VIEWPORT=2978,En.SCISSOR_BOX=3088,En.COLOR_CLEAR_VALUE=3106,En.COLOR_WRITEMASK=3107,En.UNPACK_ALIGNMENT=3317,En.PACK_ALIGNMENT=3333,En.MAX_TEXTURE_SIZE=3379,En.MAX_VIEWPORT_DIMS=3386,En.SUBPIXEL_BITS=3408,En.RED_BITS=3410,En.GREEN_BITS=3411,En.BLUE_BITS=3412,En.ALPHA_BITS=3413,En.DEPTH_BITS=3414,En.STENCIL_BITS=3415,En.POLYGON_OFFSET_UNITS=10752,En.POLYGON_OFFSET_FACTOR=32824,En.TEXTURE_BINDING_2D=32873,En.SAMPLE_BUFFERS=32936,En.SAMPLES=32937,En.SAMPLE_COVERAGE_VALUE=32938,En.SAMPLE_COVERAGE_INVERT=32939,En.COMPRESSED_TEXTURE_FORMATS=34467,En.DONT_CARE=4352,En.FASTEST=4353,En.NICEST=4354,En.GENERATE_MIPMAP_HINT=33170,En.BYTE=5120,En.UNSIGNED_BYTE=5121,En.SHORT=5122,En.UNSIGNED_SHORT=5123,En.INT=5124,En.UNSIGNED_INT=5125,En.FLOAT=5126,En.DEPTH_COMPONENT=6402,En.ALPHA=6406,En.RGB=6407,En.RGBA=6408,En.LUMINANCE=6409,En.LUMINANCE_ALPHA=6410,En.UNSIGNED_SHORT_4_4_4_4=32819,En.UNSIGNED_SHORT_5_5_5_1=32820,En.UNSIGNED_SHORT_5_6_5=33635,En.FRAGMENT_SHADER=35632,En.VERTEX_SHADER=35633,En.MAX_VERTEX_ATTRIBS=34921,En.MAX_VERTEX_UNIFORM_VECTORS=36347,En.MAX_VARYING_VECTORS=36348,En.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,En.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,En.MAX_TEXTURE_IMAGE_UNITS=34930,En.MAX_FRAGMENT_UNIFORM_VECTORS=36349,En.SHADER_TYPE=35663,En.DELETE_STATUS=35712,En.LINK_STATUS=35714,En.VALIDATE_STATUS=35715,En.ATTACHED_SHADERS=35717,En.ACTIVE_UNIFORMS=35718,En.ACTIVE_ATTRIBUTES=35721,En.SHADING_LANGUAGE_VERSION=35724,En.CURRENT_PROGRAM=35725,En.NEVER=512,En.LESS=513,En.EQUAL=514,En.LEQUAL=515,En.GREATER=516,En.NOTEQUAL=517,En.GEQUAL=518,En.ALWAYS=519,En.KEEP=7680,En.REPLACE=7681,En.INCR=7682,En.DECR=7683,En.INVERT=5386,En.INCR_WRAP=34055,En.DECR_WRAP=34056,En.VENDOR=7936,En.RENDERER=7937,En.VERSION=7938,En.NEAREST=9728,En.LINEAR=9729,En.NEAREST_MIPMAP_NEAREST=9984,En.LINEAR_MIPMAP_NEAREST=9985,En.NEAREST_MIPMAP_LINEAR=9986,En.LINEAR_MIPMAP_LINEAR=9987,En.TEXTURE_MAG_FILTER=10240,En.TEXTURE_MIN_FILTER=10241,En.TEXTURE_WRAP_S=10242,En.TEXTURE_WRAP_T=10243,En.TEXTURE_2D=3553,En.TEXTURE=5890,En.TEXTURE_CUBE_MAP=34067,En.TEXTURE_BINDING_CUBE_MAP=34068,En.TEXTURE_CUBE_MAP_POSITIVE_X=34069,En.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,En.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,En.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,En.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,En.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,En.MAX_CUBE_MAP_TEXTURE_SIZE=34076,En.TEXTURE0=33984,En.TEXTURE1=33985,En.TEXTURE2=33986,En.TEXTURE3=33987,En.TEXTURE4=33988,En.TEXTURE5=33989,En.TEXTURE6=33990,En.TEXTURE7=33991,En.TEXTURE8=33992,En.TEXTURE9=33993,En.TEXTURE10=33994,En.TEXTURE11=33995,En.TEXTURE12=33996,En.TEXTURE13=33997,En.TEXTURE14=33998,En.TEXTURE15=33999,En.TEXTURE16=34e3,En.TEXTURE17=34001,En.TEXTURE18=34002,En.TEXTURE19=34003,En.TEXTURE20=34004,En.TEXTURE21=34005,En.TEXTURE22=34006,En.TEXTURE23=34007,En.TEXTURE24=34008,En.TEXTURE25=34009,En.TEXTURE26=34010,En.TEXTURE27=34011,En.TEXTURE28=34012,En.TEXTURE29=34013,En.TEXTURE30=34014,En.TEXTURE31=34015,En.ACTIVE_TEXTURE=34016,En.REPEAT=10497,En.CLAMP_TO_EDGE=33071,En.MIRRORED_REPEAT=33648,En.FLOAT_VEC2=35664,En.FLOAT_VEC3=35665,En.FLOAT_VEC4=35666,En.INT_VEC2=35667,En.INT_VEC3=35668,En.INT_VEC4=35669,En.BOOL=35670,En.BOOL_VEC2=35671,En.BOOL_VEC3=35672,En.BOOL_VEC4=35673,En.FLOAT_MAT2=35674,En.FLOAT_MAT3=35675,En.FLOAT_MAT4=35676,En.SAMPLER_2D=35678,En.SAMPLER_CUBE=35680,En.VERTEX_ATTRIB_ARRAY_ENABLED=34338,En.VERTEX_ATTRIB_ARRAY_SIZE=34339,En.VERTEX_ATTRIB_ARRAY_STRIDE=34340,En.VERTEX_ATTRIB_ARRAY_TYPE=34341,En.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,En.VERTEX_ATTRIB_ARRAY_POINTER=34373,En.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,En.VERTEX_PROGRAM_POINT_SIZE=34370,En.POINT_SPRITE=34913,En.COMPILE_STATUS=35713,En.LOW_FLOAT=36336,En.MEDIUM_FLOAT=36337,En.HIGH_FLOAT=36338,En.LOW_INT=36339,En.MEDIUM_INT=36340,En.HIGH_INT=36341,En.FRAMEBUFFER=36160,En.RENDERBUFFER=36161,En.RGBA4=32854,En.RGB5_A1=32855,En.RGB565=36194,En.DEPTH_COMPONENT16=33189,En.STENCIL_INDEX=6401,En.STENCIL_INDEX8=36168,En.DEPTH_STENCIL=34041,En.RENDERBUFFER_WIDTH=36162,En.RENDERBUFFER_HEIGHT=36163,En.RENDERBUFFER_INTERNAL_FORMAT=36164,En.RENDERBUFFER_RED_SIZE=36176,En.RENDERBUFFER_GREEN_SIZE=36177,En.RENDERBUFFER_BLUE_SIZE=36178,En.RENDERBUFFER_ALPHA_SIZE=36179,En.RENDERBUFFER_DEPTH_SIZE=36180,En.RENDERBUFFER_STENCIL_SIZE=36181,En.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,En.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,En.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,En.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,En.COLOR_ATTACHMENT0=36064,En.DEPTH_ATTACHMENT=36096,En.STENCIL_ATTACHMENT=36128,En.DEPTH_STENCIL_ATTACHMENT=33306,En.NONE=0,En.FRAMEBUFFER_COMPLETE=36053,En.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,En.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,En.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,En.FRAMEBUFFER_UNSUPPORTED=36061,En.FRAMEBUFFER_BINDING=36006,En.RENDERBUFFER_BINDING=36007,En.MAX_RENDERBUFFER_SIZE=34024,En.INVALID_FRAMEBUFFER_OPERATION=1286,En.UNPACK_FLIP_Y_WEBGL=37440,En.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,En.CONTEXT_LOST_WEBGL=37442,En.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,En.BROWSER_DEFAULT_WEBGL=37444,Fn.__identity=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],Rn.__identity=new Rn,jn.devices=new Fi,Kn.LEFT_X=0,Kn.LEFT_Y=1,Kn.RIGHT_X=2,Kn.RIGHT_Y=3,Kn.TRIGGER_LEFT=4,Kn.TRIGGER_RIGHT=5,Zn.A=0,Zn.B=1,Zn.X=2,Zn.Y=3,Zn.BACK=4,Zn.GUIDE=5,Zn.START=6,Zn.LEFT_STICK=7,Zn.RIGHT_STICK=8,Zn.LEFT_SHOULDER=9,Zn.RIGHT_SHOULDER=10,Zn.DPAD_UP=11,Zn.DPAD_DOWN=12,Zn.DPAD_LEFT=13,Zn.DPAD_RIGHT=14,qn.NONE=0,qn.LEFT_SHIFT=1,qn.RIGHT_SHIFT=2,qn.LEFT_CTRL=64,qn.RIGHT_CTRL=128,qn.LEFT_ALT=256,qn.RIGHT_ALT=512,qn.LEFT_META=1024,qn.RIGHT_META=2048,qn.NUM_LOCK=4096,qn.CAPS_LOCK=8192,qn.MODE=16384,qn.CTRL=192,qn.SHIFT=3,qn.ALT=768,qn.META=3072,Jn.lime_byte_array_get_native_pointer=Gn.load("lime","lime_byte_array_get_native_pointer",1),Jn.lime_byte_array_overwrite_file=Gn.load("lime","lime_byte_array_overwrite_file",2),Jn.lime_byte_array_read_file=Gn.load("lime","lime_byte_array_read_file",1),Jn.lime_lzma_decode=Gn.load("lime","lime_lzma_decode",1),Jn.lime_lzma_encode=Gn.load("lime","lime_lzma_encode",1),rr.actuators=[],rr.actuatorsLength=0,rr.addedEvent=!1,lr.defaultActuator=rr,lr.defaultEase=sr.get_easeOut(),lr.targetLibraries=new Ri,Fr.BROAD_PHASE_BRUTE_FORCE=1,Fr.BROAD_PHASE_SWEEP_AND_PRUNE=2,Fr.BROAD_PHASE_DYNAMIC_BOUNDING_VOLUME_TREE=3,Kr.nextID=0,Kr.SHAPE_SPHERE=1,Kr.SHAPE_BOX=2,as.JOINT_DISTANCE=1,as.JOINT_BALL_AND_SOCKET=2,as.JOINT_HINGE=3,as.JOINT_WHEEL=4,as.JOINT_SLIDER=5,as.JOINT_PRISMATIC=6,Ss.BODY_DYNAMIC=1,Ss.BODY_STATIC=2,Ss.MAX_SHAPES=64,Ms.TO_RAD=Math.PI/180,Ms.WORLD_SCALE=100,Ms.INV_SCALE=.01,Ms.gravityX=0,Ms.gravityY=0,Ms.gravityZ=-9.8,As.FLOAT_SINGLE_MIN=1.401298464324817e-45,As.FLOAT_SINGLE_MAX=3.4028234663852886e38,As.FLOAT_DOUBLE_MIN=5e-324,As.FLOAT_DOUBLE_MAX=1.7976931348623157e308,a.main()}("undefined"!=typeof console?console:{log:function(){}},"undefined"!=typeof window?window:exports)
